<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Ứng dụng Pomodoro hỗ trợ học tập với tích hợp Gemini AI và giao diện hiện đại." />
    <title>Pomodoro Study App — Tích hợp Gemini AI (Giao diện mới)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — PHIÊN BẢN GIAO DIỆN TẬP TRUNG (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Mặc định) - Cập nhật từ file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Thêm biến RGB cho panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: THÊM CÁC THEME MỚI === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: THÊM CÁC THEME MỚI === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Thêm các quy tắc border cho theme light/pastel */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Sửa đổi: bỏ border mặc định */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Sửa đổi */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    /* Nâng khối đang mở menu lên trên các khối khác */
    .topic-item.menu-active { position: relative; z-index: 20; }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Sửa đổi */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Giữ nền trong suốt khi di chuột qua */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Sửa đổi màu */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Sửa đổi màu */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */
    #view-timer .panel-bg hr {
        border: none; /* Bỏ đường viền mặc định */
        height: 1px;  /* Đặt chiều cao cho đường kẻ */
        background-color: var(--muted); /* Sử dụng màu phụ của theme */
        opacity: 0.3; /* Làm cho nó mờ đi, hòa vào nền */
        margin-top: 0; /* Điều chỉnh lại khoảng cách */
    }
    /* === END: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Sửa đổi */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Sửa đổi */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Sửa đổi */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Nâng z-index để nằm trên header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Sửa đổi */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Sửa đổi */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Sửa đổi */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Sửa đổi */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Sửa đổi */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Sửa đổi: chuyển sang nền trắng trong suốt */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Viền trắng mờ */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Tinh chỉnh: sát mẫu hơn */
        border-color: var(--acc);
    }
    /* === START: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Dùng nền đen mờ thay vì trắng mờ */
        border-color: rgba(0, 0, 0, 0.1); /* Viền đen mờ trên theme sáng */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Tăng độ đậm khi focus */
    }
    /* === END: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */

    /* Cải thiện nền và màu chữ cho option trong select theo theme hiện tại */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Sửa đổi */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Giảm/loại bỏ bóng chữ cho theme sáng để tránh nhòe/lóa */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
.method-item[open] summary {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
    [data-theme='light'] .method-item[open] summary,
    [data-theme='pastel'] .method-item[open] summary {
        border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* Method actions inline with summary and show on hover */
    .method-item summary { display: flex; align-items: center; justify-content: space-between; }
    .method-item summary > span { flex: 1; }
    .method-item summary .topic-actions { margin-left: 8px; }
    .method-title { cursor: pointer; }
    .method-item:hover .topic-actions, .method-item:focus-within .topic-actions { opacity: 1; visibility: visible; }

    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Đồng hồ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Đồng hồ</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Chủ đề">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Chủ đề</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Thống kê">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Thống kê</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Kho Tri Thức">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Kho Tri Thức</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Cài đặt">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Cài đặt</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Hướng dẫn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Hướng dẫn</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">Chưa chọn Chủ đề con</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard Tổng quan">📊 Tổng Quan </button>
          <a href="https://forms.gle/EfFqBJFTbFtDo5H4A" target="_blank" rel="noopener noreferrer" class="btn ghost small" title="Gửi phản hồi của bạn">💬 Phản Hồi</a>
          <button class="btn ghost small" id="btnExport" title="Xuất JSON">⬇️ Xuất File</button>
          <label class="btn ghost small" for="importFile" title="Nhập JSON">⬆️ Nhập File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Ẩn/Hiện giao diện">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Toàn màn hình">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Chào mừng đến với Pomodoro Study App!</h3>
                <p>Hãy bắt đầu bằng cách chọn một <strong>Chủ đề con</strong> hoặc tạo Chủ đề/Chủ đề con mới.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Tạo Chủ đề Mới</button>
            </div>
            <div class="presets" role="group" aria-label="Chọn chế độ preset">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">TRẠNG THÁI</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Checklist Hạ nhiệt</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Lưu công việc đang làm (Save/Commit).</li>
                <li>Ghi chú nhanh "Next step".</li>
                <li>Dọn dẹp không gian làm việc.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Bắt đầu (Space)">▶️ Bắt đầu</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="Kết thúc phiên làm việc">🧘 Bắt đầu nghỉ</button>
              <button class="btn" id="btnPause" aria-label="Tạm dừng (Space)">⏸️ Tạm dừng</button>
              <button class="btn" id="btnResume" aria-label="Tiếp tục (Space)">⏵ Tiếp tục</button>
              <button class="btn warn" id="btnSkip" aria-label="Bỏ qua (N)">⏭️ Bỏ qua</button>
              <button class="btn danger" id="btnReset">↺ Đặt lại</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Nghỉ sớm</button>
            </div>
            <div class="tiny">Phím tắt: <strong>Space</strong> = Bắt đầu/Tạm dừng/Tiếp tục, <strong>N</strong> = Tiếp theo/Bỏ qua</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Nhiệm vụ</button>
                <button class="tab-btn" data-tab="notes">Ghi chú</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-do cho chủ đề con này:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Thêm một task mới..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Thêm</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Thêm ghi chú mới..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Thêm ghi chú</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini cho: <span id="currentSubtopicNameChat">(chưa chọn)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Xóa lịch sử">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Giải thích khái niệm chính của chủ đề này">Giải thích khái niệm</button>
                  <button class="btn small ghost" data-prompt="Tạo một dàn ý chi tiết cho chủ đề này">Tạo dàn ý</button>
                  <button class="btn small ghost" data-prompt="Liệt kê 5 câu hỏi ôn tập quan trọng về chủ đề này">Tạo câu hỏi ôn tập</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Hỏi Gemini điều gì đó..." />
                  <button id="btnSendMessage" class="btn acc">Gửi</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Quản lý Chủ đề</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Thêm Chủ đề</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Nhấp mũi tên để mở/đóng danh sách chủ đề con.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Thống kê & Lịch sử — <span id="currentSubtopicName">(chưa chọn)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Tổng thời gian</h4><div class="stat-value" id="statTotal">0 phút</div></div>
              <div class="stat-card"><h4>Phiên</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Nhiệm vụ Hoàn thành</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">Lịch sử (LÀM VIỆC)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Kho Tri Thức Cá Nhân Hóa</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Thêm tri thức</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Nhấp vào từng mục để xem chi tiết.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Khám Phá Pomodoro Study App</h3>
              <p>
                  Chào mừng bạn đến với không gian học tập được thiết kế dành riêng cho sự tập trung và hiệu quả. Hãy cùng khám phá những tính năng sẽ đồng hành cùng bạn trên hành trình chinh phục tri thức.
              </p>

              <h4>🚀 Khởi Đầu Nhanh Chỉ Trong 4 Bước</h4>
              <p>Để hành trình của bạn luôn mạch lạc, mọi thứ trong ứng dụng được sắp xếp theo cấu trúc <strong>Chủ đề Lớn → Chủ đề con</strong>.</p>
              <ol>
                  <li>Mở mục <strong>📚 Chủ đề</strong> từ thanh điều hướng bên cạnh.</li>
                  <li>Nhấn <strong>＋ Thêm Chủ đề</strong> để tạo một lĩnh vực lớn (ví dụ: "Tiếng Anh Giao Tiếp").</li>
                  <li>Bên cạnh chủ đề vừa tạo, nhấn <strong>＋ Thêm</strong> để tạo một chủ đề con, chi tiết hơn (ví dụ: "Bài 1: Luyện phát âm IPA").</li>
                  <li>Chọn chủ đề con đó. Giờ đây, bạn đã sẵn sàng để bắt đầu phiên học đầu tiên của mình!</li>
              </ol>

              <hr />
              <h4>✨ Những Tính Năng Đáng Chú Ý</h4>

              <h4>Các Chế Độ Đồng Hồ Linh Hoạt ⏱️</h4>
              <p>Ứng dụng không chỉ có Pomodoro. Hãy chọn phương pháp phù hợp với công việc của bạn:</p>
              <ul>
                  <li><strong>Pomodoro Cổ Điển (Kiểu A/B):</strong> Làm việc tập trung trong các phiên định sẵn (ví dụ: 25 phút làm, 5 phút nghỉ) để xây dựng kỷ luật và nhịp độ.</li>
                  <li><strong>Chế độ Flowtime (Kiểu 🌊 Flow):</strong> Dành cho công việc cần dòng chảy sâu. Đồng hồ sẽ đếm lên, cho phép bạn làm việc đến khi tự cảm thấy cần nghỉ. Thời gian nghỉ sẽ được đề xuất dựa trên thời gian bạn đã làm việc.</li>
                  <li><strong>Đệm "Hạ nhiệt" (Wind-down):</strong> Một khoảng đệm tùy chỉnh giữa lúc làm và lúc nghỉ, giúp bạn kết thúc công việc đang dở, ghi chú lại "bước tiếp theo" và chuyển trạng thái một cách mượt mà, không bị cắt ngang đột ngột.</li>
              </ul>

              <h4>Kho Tri Thức Cá Nhân Hóa 💡</h4>
              <p>Bạn có thể <strong>Thêm, Sửa, Xóa</strong> các phương pháp và ghi chú quan trọng. Với trình soạn thảo mạnh mẽ, bạn dễ dàng định dạng tiêu đề, in đậm, tạo danh sách và thậm chí chọn màu chữ để làm nổi bật thông tin.</p>

              <h4>Quản Lý Chủ Đề Trực Quan</h4>
              <p>Dễ dàng sắp xếp các mục tiêu học tập của bạn. Sử dụng thao tác <strong>kéo và thả</strong> để sắp xếp lại thứ tự các Chủ đề hoặc di chuyển một Chủ đề con sang một lĩnh vực khác một cách trực quan.</p>

              <h4>Nhiệm Vụ & Ghi Chú Tích Hợp 📝</h4>
              <p>Ngay trong màn hình đồng hồ, bạn có thể tạo danh sách việc cần làm (to-do) cho từng chủ đề con hoặc ghi lại những ý tưởng chợt nảy ra mà không làm gián đoạn dòng chảy công việc.</p>

              <h4>Chế Độ Zen 🧘</h4>
              <p>Khi cần tập trung tuyệt đối, hãy nhấn vào biểu tượng con mắt (👁️). Giao diện sẽ ẩn đi, chỉ để lại hình nền và chiếc đồng hồ. Trong chế độ này, bạn có thể <strong>kéo thả đồng hồ</strong> đến bất kỳ vị trí nào trên màn hình để có một không gian làm việc gọn gàng nhất.</p>

              <h4>Thống Kê & Cột Mốc 🏆</h4>
              <p>Theo dõi hành trình của bạn qua những con số biết nói. Ứng dụng sẽ tự động ghi nhận và chúc mừng khi bạn đạt được những cột mốc quan trọng về thời gian tập trung, biến mỗi nỗ lực thành một thành tựu đáng tự hào.</p>

              <hr />
              <h4>⌨️ Phím Tắt Thông Minh</h4>
              <ul>
                  <li><kbd>Space</kbd>: Bắt đầu / Tạm dừng / Tiếp tục phiên học.</li>
                  <li><kbd>N</kbd>: Bỏ qua phiên làm việc hoặc nghỉ hiện tại.</li>
                  <li><kbd>Esc</kbd>: Đóng các cửa sổ đang mở (như Cài đặt).</li>
              </ul>

              <hr />
              <h4>🛠️ Cài Đặt Nâng Cao & Tích Hợp</h4>

              <h4>Trợ Lý Gemini AI 🧠</h4>
              <p>Biến ứng dụng thành một người bạn đồng hành thông minh. Ngoài việc hỏi đáp, bạn còn có thể:</p>
              <ul>
                  <li><strong>Tự động Định dạng Thông minh:</strong> Khi soạn thảo trong mục "Phương pháp", hãy để AI tự động phân tích và định dạng văn bản thô của bạn—tự nhận diện tiêu đề, các ý chính cần in đậm và danh sách.</li>
                  <li><strong>Thiết lập:</strong> Truy cập Google AI Studio để tạo API Key miễn phí và dán vào ô "Gemini API Key" trong Cài đặt của ứng dụng.</li>
              </ul>

              <h4>Tùy Biến Giao Diện & Âm Thanh 🎨</h4>
              <p>Biến không gian học tập thành của riêng bạn:</p>
              <ul>
                  <li><strong>Nhiều Theme & Hình nền:</strong> Lựa chọn giữa các theme có sẵn (Sáng, Tối, Pastel...) hoặc <strong>tải lên hình nền của riêng bạn</strong> để tạo cảm hứng.</li>
                  <li><strong>Âm báo Tùy chỉnh:</strong> Bạn có thể <strong>tải lên các file âm thanh (.mp3, .wav...) của riêng mình</strong> để sử dụng làm chuông báo cho các phiên làm việc và nghỉ ngơi.</li>
              </ul>

              <h4>Nhạc Nền YouTube 🎶</h4>
              <p>Tạo không gian học tập hoàn hảo bằng cách phát một video hoặc danh sách phát YouTube làm nhạc nền. Dán đường dẫn (URL) vào ô "Nhạc nền YouTube" trong Cài đặt.</p>

              <h4>An Toàn Dữ Liệu: Sao Lưu & Phục Hồi 🛡️</h4>
              <p>Ứng dụng tự động sao lưu tiến trình của bạn mỗi ngày. Bạn có thể tùy chỉnh số ngày lưu giữ bản sao lưu và phục hồi dữ liệu từ một ngày trong quá khứ nếu cần. ⚠️ <strong>Cảnh báo:</strong> Phục hồi sẽ ghi đè toàn bộ dữ liệu hiện tại.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Chúc mừng Bạn!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Tiếp tục hành trình!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Cài đặt</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Đồng hồ</button>
              <button class="tab-btn" data-tab="settings-ui">Giao diện & Âm thanh</button>
              <button class="tab-btn" data-tab="settings-integrations">Tích hợp</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Kiểu A </button>
                      <button class="btn ghost" data-preset-target="B"> Kiểu B </button>
                      <button class="btn ghost" data-preset-target="C"> Kiểu C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Thời lượng Pomodoro</h4>
                      <div class="row">
                          <label>LÀM VIỆC (phút)<input type="number" id="set_work" min="1" /></label>
                          <label>HẠ NHIỆT (phút)<input type="number" id="set_winddown" min="0" /></label>
                          <label>NGHỈ NGẮN (phút)<input type="number" id="set_short" min="1" /></label>
                          <label>NGHỈ DÀI (phút)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Chu kỳ Pomodoro<input type="number" id="set_cycles" min="1" /></label>
                          <label>Chu kỳ nghỉ dài<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Tỷ lệ nghỉ (Làm việc / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Gợi ý: Thời gian nghỉ = tổng thời gian làm việc / X. Mặc định là 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Tự động bắt đầu phiên tiếp theo</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Bật Hạ nhiệt sau phiên làm</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableSessionNotes">Nhắc ghi chú sau mỗi phiên</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableSessionNotes">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Giao diện</h4>
                      <div class="row">
                          <label>Theme Giao Diện
                                <select id="set_theme_color">
                                    <option value="default">Mặc định (Dark Blue)</option>
                                    <option value="light">Light - Trà Sữa</option>
                                    <option value="pastel">Pastel - Dễ thương</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Chế độ hiển thị nền
                              <select id="set_backgroundMode">
                                  <option value="cover">Lấp đầy (Mặc định)</option>
                                  <option value="contain">Vừa vặn (Sắc nét)</option>
                                  <option value="auto">Kích thước gốc (Lặp lại)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Hình nền
                              <label class="btn small ghost" for="uploadBg">Tải ảnh mới</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Xóa nền</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Độ trong suốt của nền</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Âm thanh</h4>
                      <div class="row">
                          <label>Âm lượng (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Kiểu âm báo
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Tùy chỉnh âm báo</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Âm báo hết LÀM VIỆC</small>
                              <label title="Âm báo hết LÀM VIỆC" class="btn small ghost" for="uploadSoundWork">LÀM VIỆC</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ NGẮN</small>
                              <label title="Âm báo hết NGHỈ NGẮN" class="btn small ghost" for="uploadSoundBreak">NGHỈ NGẮN</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ DÀI</small>
                              <label title="Âm báo hết NGHỈ DÀI" class="btn small ghost" for="uploadSoundLong">NGHỈ DÀI</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Tích hợp AI</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Dán API Key của bạn vào đây..." />
                      </label>
                      <div class="tiny">Cần có để sử dụng các tính năng AI. Lấy key miễn phí tại <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 Nhạc nền YouTube</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Dán link YouTube vào đây..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Dùng ảnh bìa video làm nền</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Dừng sẽ không tự phát lại cho đến khi bạn bấm ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Âm lượng</div>
                  </div>
                  <div>
                      <h4>🛡️ Cài đặt sao lưu</h4>
                      <div class="row">
                          <label>Số ngày sao lưu cần giữ lại
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Phục hồi dữ liệu</h4>
                      <p class="tiny">Phục hồi dữ liệu từ một bản sao lưu tự động hàng ngày. Hành động này sẽ ghi đè lên dữ liệu hiện tại của bạn.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Phục hồi</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Mặc định</button>
              <button class="btn acc" id="btnSaveSettings">Lưu</button>
              <button class="btn" id="btnCloseSettings">Đóng</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Ghi chú cho phiên vừa hoàn thành</h3>
      <div class="row"><textarea id="noteText" placeholder="Bạn học được gì? Khó khăn? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Tóm tắt & Gợi ý</button>
        <button class="btn" id="btnSkipNote">Bỏ qua</button>
        <button class="btn acc" id="btnSaveNote">Lưu ghi chú</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Tiêu đề</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Hủy</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Tổng quan</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Đóng</button>
        </div>
        <p class="tiny">Tổng hợp thời gian và số phiên đã hoàn thành trên tất cả các chủ đề.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Chỉnh-sửa Phương-pháp</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Tiêu-đề<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Nội-dung</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Tiêu-đề nhỏ">H</button>
          <button id="toolBold" class="btn small ghost" title="In đậm">B</button>
          <button id="toolItalic" class="btn small ghost" title="In nghiêng">I</button>
          <button id="toolList" class="btn small ghost" title="Danh-sách">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Danh sách chấm tròn">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Màu chữ">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Màu chữ mặc định"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Màu nhấn mạnh"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Màu tích cực"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Màu cảnh báo"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Màu nguy hiểm"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Màu tím"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="Tính năng này yêu cầu Gemini API Key">✨ Tự động định dạng</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Hủy</button>
          <button class="btn acc" id="btnSaveMethod">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Nhấn "Bật âm thanh" để cho phép phát nhạc nền.</span>
    <button id="btnEnableSound" class="btn small acc">Bật âm thanh</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
   const _0x2ebaf0=_0x5e48;(function(_0x128091,_0x1aa1e3){const _0x57b8c1=_0x5e48,_0x339365=_0x128091();while(!![]){try{const _0x3199db=parseInt(_0x57b8c1(0x119))/0x1+parseInt(_0x57b8c1(0x1cb))/0x2*(-parseInt(_0x57b8c1(0x19d))/0x3)+-parseInt(_0x57b8c1(0x3fe))/0x4+-parseInt(_0x57b8c1(0x174))/0x5+-parseInt(_0x57b8c1(0x1dc))/0x6*(parseInt(_0x57b8c1(0x2b6))/0x7)+-parseInt(_0x57b8c1(0x238))/0x8*(parseInt(_0x57b8c1(0x168))/0x9)+parseInt(_0x57b8c1(0x1d1))/0xa;if(_0x3199db===_0x1aa1e3)break;else _0x339365['push'](_0x339365['shift']());}catch(_0x289b16){_0x339365['push'](_0x339365['shift']());}}}(_0x3bcb,0x3fb5d),window[_0x2ebaf0(0x3ed)](_0x2ebaf0(0x134),()=>{try{updateFullscreenButton();}catch(_0x35c807){}}));const IS_FILE_PROTOCOL=window[_0x2ebaf0(0x39c)][_0x2ebaf0(0x129)]===_0x2ebaf0(0x328);function startYtApiWatchdog(){const _0x26ab35=_0x2ebaf0,_0xbf050f=document[_0x26ab35(0x42e)](_0x26ab35(0x132));if(!_0xbf050f)return;const _0x454886=setTimeout(()=>{const _0x47aab5=_0x26ab35;try{(!window['YT']||!window['YT'][_0x47aab5(0x11e)])&&(_0xbf050f['textContent']=_0x47aab5(0x3ec),_0xbf050f[_0x47aab5(0x2a4)]['color']=_0x47aab5(0x32c));}catch(_0x1c4ac4){}},0x5dc),_0x120559=setTimeout(()=>{const _0x4fc5d6=_0x26ab35;try{(!window['YT']||!window['YT'][_0x4fc5d6(0x11e)])&&(_0xbf050f[_0x4fc5d6(0x196)]=_0x4fc5d6(0x2a3),_0xbf050f[_0x4fc5d6(0x2a4)]['color']=_0x4fc5d6(0x261));}catch(_0x5612c3){}},0x1b58);window['__ytApiWatchdog']={'cancel'(){clearTimeout(_0x454886),clearTimeout(_0x120559);}};}(function(){const _0x2896d9=_0x2ebaf0,_0x121f9b={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>'Chu\x20kỳ\x20'+current+'/'+target,'timer.selectSubtopicPrompt':_0x2896d9(0x3a0)};window['t']=function _0x4f6783(_0x44e9b0,_0x4e7a6d){const _0xea4418=_0x2896d9;try{const _0x26bf9d=_0x121f9b[_0x44e9b0];if(typeof _0x26bf9d==='function')return _0x26bf9d(_0x4e7a6d||{});if(typeof _0x26bf9d===_0xea4418(0x3da))return _0x26bf9d;}catch(_0x13e3a6){}return _0x44e9b0;},window[_0x2896d9(0x2f6)]=function _0x25290e(_0x4e2725){const _0x4e99c4=_0x2896d9;try{localStorage[_0x4e99c4(0x128)](_0x4e99c4(0x1e0),_0x4e2725||'vi');}catch(_0x53c937){}return Promise[_0x4e99c4(0x1e9)]();};}());function ensureYouTubeAPI(){const _0x273152=_0x2ebaf0;if(IS_FILE_PROTOCOL)return Promise['resolve'](![]);try{if(window['YT']&&window['YT'][_0x273152(0x11e)])return Promise[_0x273152(0x1e9)](!![]);}catch(_0x858185){}if(window['__ytApiPromise'])return window[_0x273152(0x277)];return startYtApiWatchdog(),window['__ytApiPromise']=new Promise((_0x3bbf06,_0x3c4d5d)=>{const _0xc98b6b=_0x273152;try{const _0x57be32=document[_0xc98b6b(0x407)](_0xc98b6b(0x3ac));_0x57be32[_0xc98b6b(0x199)]='https://www.youtube.com/iframe_api',_0x57be32[_0xc98b6b(0x138)]=!![],_0x57be32[_0xc98b6b(0x239)]=!![],_0x57be32[_0xc98b6b(0x180)]=()=>_0x3bbf06(!![]),_0x57be32[_0xc98b6b(0x258)]=()=>_0x3c4d5d(new Error('Failed\x20to\x20load\x20YouTube\x20API')),document[_0xc98b6b(0x383)]['appendChild'](_0x57be32);}catch(_0x1c75ee){_0x3c4d5d(_0x1c75ee);}}),window[_0x273152(0x277)];}const storageManager={'DB_NAME':'PomodoroAppDB','DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x3c9f4e,_0x11dd1)=>{const _0x4c7adf=_0x5e48;if(this['db'])return _0x3c9f4e(this['db']);const _0x41bc5a=indexedDB['open'](this[_0x4c7adf(0x30a)],this['DB_VERSION']);_0x41bc5a[_0x4c7adf(0x2dd)]=_0xd8b02f=>{const _0x376f3a=_0x4c7adf,_0x5279f8=_0xd8b02f[_0x376f3a(0x23a)][_0x376f3a(0x20e)];!_0x5279f8[_0x376f3a(0x39d)]['contains']('settings')&&_0x5279f8[_0x376f3a(0x42f)]('settings');!_0x5279f8[_0x376f3a(0x39d)][_0x376f3a(0x214)](_0x376f3a(0x220))&&_0x5279f8[_0x376f3a(0x42f)](_0x376f3a(0x220),{'keyPath':'id'});if(!_0x5279f8[_0x376f3a(0x39d)]['contains'](_0x376f3a(0x294))){const _0xff472d=_0x5279f8[_0x376f3a(0x42f)](_0x376f3a(0x294),{'keyPath':'id'});_0xff472d[_0x376f3a(0x394)](_0x376f3a(0x438),_0x376f3a(0x287));}!_0x5279f8['objectStoreNames'][_0x376f3a(0x214)](_0x376f3a(0x2e4))&&_0x5279f8[_0x376f3a(0x42f)](_0x376f3a(0x2e4),{'keyPath':'date'});},_0x41bc5a[_0x4c7adf(0x25d)]=_0x5d107d=>{const _0x157d48=_0x4c7adf;this['db']=_0x5d107d[_0x157d48(0x23a)][_0x157d48(0x20e)],console[_0x157d48(0x159)](_0x157d48(0x293)),_0x3c9f4e(this['db']);},_0x41bc5a[_0x4c7adf(0x258)]=_0x2c4774=>{const _0x11b648=_0x4c7adf;console[_0x11b648(0x143)](_0x11b648(0x3a6),_0x2c4774[_0x11b648(0x23a)][_0x11b648(0x3f5)]),_0x11dd1(_0x2c4774[_0x11b648(0x23a)][_0x11b648(0x143)]);};});},async '_getStore'(_0x1c2d88,_0x464065=_0x2ebaf0(0x1c8)){const _0x5b82b3=_0x2ebaf0;await this[_0x5b82b3(0x165)]();const _0x36821d=this['db'][_0x5b82b3(0x361)]([_0x1c2d88],_0x464065);return _0x36821d['objectStore'](_0x1c2d88);},async 'getSettings'(){const _0x241a70=_0x2ebaf0,_0x3701e6=await this[_0x241a70(0x1d9)](_0x241a70(0x3fb));return new Promise((_0x2d579b,_0x563c60)=>{const _0x3ca1da=_0x241a70,_0x1da6db=_0x3701e6[_0x3ca1da(0x34a)](_0x3ca1da(0x237));_0x1da6db[_0x3ca1da(0x25d)]=()=>_0x2d579b(_0x1da6db[_0x3ca1da(0x20e)]),_0x1da6db[_0x3ca1da(0x258)]=()=>_0x563c60(_0x1da6db[_0x3ca1da(0x143)]);});},async 'updateSettings'(_0x2d4cf1){const _0x277972=_0x2ebaf0,_0x6a60fc=await this[_0x277972(0x1d9)](_0x277972(0x3fb),_0x277972(0x37f));return new Promise((_0x4c3d59,_0x561642)=>{const _0x2857aa=_0x277972,_0x46316e=_0x6a60fc[_0x2857aa(0x121)](_0x2d4cf1,'main_settings');_0x46316e['onsuccess']=()=>_0x4c3d59(_0x46316e[_0x2857aa(0x20e)]),_0x46316e[_0x2857aa(0x258)]=()=>_0x561642(_0x46316e['error']);});},async 'getAll'(_0x550fbe){const _0x259100=_0x2ebaf0,_0x73afd1=await this[_0x259100(0x1d9)](_0x550fbe);return new Promise((_0x3b6c45,_0x5e38bd)=>{const _0x2e79ba=_0x259100,_0xdbb854=_0x73afd1[_0x2e79ba(0x31c)]();_0xdbb854['onsuccess']=()=>_0x3b6c45(_0xdbb854[_0x2e79ba(0x20e)]),_0xdbb854['onerror']=()=>_0x5e38bd(_0xdbb854[_0x2e79ba(0x143)]);});},async 'update'(_0x3d2086,_0xcdf768){const _0x2bda2e=_0x2ebaf0,_0x493548=await this[_0x2bda2e(0x1d9)](_0x3d2086,'readwrite');return new Promise((_0x40c3d8,_0xb54a5f)=>{const _0x52e86c=_0x2bda2e,_0x464645=_0x493548['put'](_0xcdf768);_0x464645[_0x52e86c(0x25d)]=()=>_0x40c3d8(_0x464645[_0x52e86c(0x20e)]),_0x464645[_0x52e86c(0x258)]=()=>_0xb54a5f(_0x464645[_0x52e86c(0x143)]);});},async 'add'(_0x5b5dd5,_0x21941f){const _0x5ba961=_0x2ebaf0,_0x3f356b=await this[_0x5ba961(0x1d9)](_0x5b5dd5,_0x5ba961(0x37f));return new Promise((_0x553bbf,_0x27b8a2)=>{const _0x454721=_0x5ba961,_0x3f6f27=_0x3f356b[_0x454721(0x1ed)](_0x21941f);_0x3f6f27[_0x454721(0x25d)]=()=>_0x553bbf(_0x3f6f27[_0x454721(0x20e)]),_0x3f6f27['onerror']=()=>_0x27b8a2(_0x3f6f27[_0x454721(0x143)]);});},async 'delete'(_0x3be882,_0x3e7a94){const _0x1166d9=_0x2ebaf0,_0x46e195=await this[_0x1166d9(0x1d9)](_0x3be882,_0x1166d9(0x37f));return new Promise((_0x18dfa8,_0x1aee4c)=>{const _0x3bc610=_0x1166d9,_0x4ac8c5=_0x46e195[_0x3bc610(0x1fd)](_0x3e7a94);_0x4ac8c5[_0x3bc610(0x25d)]=()=>_0x18dfa8(_0x4ac8c5[_0x3bc610(0x20e)]),_0x4ac8c5[_0x3bc610(0x258)]=()=>_0x1aee4c(_0x4ac8c5[_0x3bc610(0x143)]);});},async 'save'(_0x36a57e){return await this['initDB'](),new Promise((_0x10a5a3,_0x50680e)=>{const _0x4aa27a=_0x5e48,_0x172f03=this['db']['transaction']([_0x4aa27a(0x3fb),_0x4aa27a(0x220),_0x4aa27a(0x294)],_0x4aa27a(0x37f)),_0x24df29=_0x172f03[_0x4aa27a(0x306)](_0x4aa27a(0x3fb)),_0x240510=_0x172f03[_0x4aa27a(0x306)](_0x4aa27a(0x220)),_0x14e2cd=_0x172f03['objectStore']('subtopics');_0x24df29[_0x4aa27a(0x121)](_0x36a57e[_0x4aa27a(0x3fb)],_0x4aa27a(0x237)),_0x240510[_0x4aa27a(0x118)](),_0x14e2cd['clear'](),_0x36a57e[_0x4aa27a(0x220)][_0x4aa27a(0x17a)](_0x17737d=>{const _0x1f1299=_0x4aa27a,{subtopics:_0x299ce3,..._0x174985}=_0x17737d;_0x240510[_0x1f1299(0x121)](_0x174985),(_0x299ce3||[])[_0x1f1299(0x17a)](_0x58e884=>_0x14e2cd[_0x1f1299(0x121)](_0x58e884));}),_0x172f03['oncomplete']=()=>_0x10a5a3(),_0x172f03[_0x4aa27a(0x258)]=_0x28e113=>_0x50680e(_0x28e113['target'][_0x4aa27a(0x143)]);});},async 'autoBackup'(_0x598012){const _0x124865=_0x2ebaf0;await this[_0x124865(0x165)]();const _0x2d1d1e=new Date()['toISOString']()[_0x124865(0x1b8)](0x0,0xa),_0x3c3176=localStorage[_0x124865(0x3bf)](_0x124865(0x1df));if(_0x2d1d1e!==_0x3c3176){console[_0x124865(0x159)](_0x124865(0x269)+_0x2d1d1e+'...');const _0x30a2db={'date':_0x2d1d1e,'data':JSON[_0x124865(0x1b5)](JSON[_0x124865(0x428)](_0x598012))},_0x1c3c4f=this['db'][_0x124865(0x361)]([_0x124865(0x2e4)],_0x124865(0x37f)),_0x5ed015=_0x1c3c4f['objectStore']('backups'),_0x37206a=_0x5ed015[_0x124865(0x121)](_0x30a2db);_0x37206a[_0x124865(0x25d)]=()=>{const _0xcbf128=_0x124865;localStorage[_0xcbf128(0x128)]('lastBackupDate',_0x2d1d1e),console[_0xcbf128(0x159)](_0xcbf128(0x2d9)),this['cleanupOldBackups'](_0x598012?.[_0xcbf128(0x3fb)]?.[_0xcbf128(0x368)]||0x7);},_0x37206a[_0x124865(0x258)]=_0x3be323=>{const _0x33f456=_0x124865;console[_0x33f456(0x143)](_0x33f456(0x3b2),_0x3be323[_0x33f456(0x23a)][_0x33f456(0x143)]);};}},async 'cleanupOldBackups'(_0x13a5f9){const _0x1c1051=_0x2ebaf0;await this[_0x1c1051(0x165)]();const _0x51128c=this['db'][_0x1c1051(0x361)](['backups'],_0x1c1051(0x37f)),_0x1bb8c4=_0x51128c[_0x1c1051(0x306)](_0x1c1051(0x2e4)),_0x5061e8=_0x1bb8c4[_0x1c1051(0x2de)]();_0x5061e8[_0x1c1051(0x25d)]=()=>{const _0x22f697=_0x1c1051,_0x46866b=_0x5061e8[_0x22f697(0x20e)][_0x22f697(0x36f)]()[_0x22f697(0x25f)]();if(_0x46866b[_0x22f697(0x402)]>_0x13a5f9){const _0x5d8c6b=_0x46866b[_0x22f697(0x1b8)](_0x13a5f9);_0x5d8c6b[_0x22f697(0x17a)](_0x3b6c5b=>{const _0xa59c13=_0x22f697;_0x1bb8c4['delete'](_0x3b6c5b),console[_0xa59c13(0x159)]('Deleted\x20old\x20backup:\x20'+_0x3b6c5b);});}};},async 'getBackupList'(){const _0x222502=_0x2ebaf0;return await this[_0x222502(0x165)](),new Promise((_0x3e0cde,_0x4593b1)=>{const _0x2f78e8=_0x222502,_0x116158=this['db'][_0x2f78e8(0x361)]([_0x2f78e8(0x2e4)],'readonly'),_0x2efe05=_0x116158[_0x2f78e8(0x306)](_0x2f78e8(0x2e4)),_0x26113c=_0x2efe05['getAll']();_0x26113c[_0x2f78e8(0x25d)]=()=>_0x3e0cde(_0x26113c['result'][_0x2f78e8(0x36f)]((_0x38d87a,_0x36bb1b)=>_0x36bb1b[_0x2f78e8(0x200)][_0x2f78e8(0x274)](_0x38d87a[_0x2f78e8(0x200)]))),_0x26113c[_0x2f78e8(0x258)]=_0x20a0b3=>_0x4593b1(_0x20a0b3[_0x2f78e8(0x23a)][_0x2f78e8(0x143)]);});},async 'restoreBackup'(_0x3825d8){const _0x5dac66=_0x2ebaf0;return await this[_0x5dac66(0x165)](),new Promise((_0x268dc6,_0x1e078c)=>{const _0x30d36e=_0x5dac66,_0x10eeac=this['db'][_0x30d36e(0x361)]([_0x30d36e(0x2e4)],_0x30d36e(0x1c8)),_0x459ab3=_0x10eeac[_0x30d36e(0x306)](_0x30d36e(0x2e4)),_0x4775b5=_0x459ab3['get'](_0x3825d8);_0x4775b5[_0x30d36e(0x25d)]=()=>{const _0xd9fcc3=_0x30d36e;_0x4775b5[_0xd9fcc3(0x20e)]&&_0x4775b5[_0xd9fcc3(0x20e)][_0xd9fcc3(0x13b)]?(localStorage['setItem'](_0xd9fcc3(0x22c),JSON[_0xd9fcc3(0x428)](_0x4775b5[_0xd9fcc3(0x20e)][_0xd9fcc3(0x13b)])),_0x268dc6(_0x4775b5[_0xd9fcc3(0x20e)][_0xd9fcc3(0x13b)])):_0x1e078c(new Error(_0xd9fcc3(0x425)));},_0x4775b5[_0x30d36e(0x258)]=_0xa211a1=>_0x1e078c(_0xa211a1['target']['error']);});},'exportData'(_0x50c34a){const _0x499d88=_0x2ebaf0;let _0x461e2c={};try{_0x461e2c=JSON[_0x499d88(0x1b5)](JSON[_0x499d88(0x428)](_0x50c34a||{}));}catch(_0x52c474){_0x461e2c=_0x50c34a;}try{if(_0x461e2c&&_0x461e2c[_0x499d88(0x3fb)])_0x461e2c[_0x499d88(0x3fb)][_0x499d88(0x34c)]='';}catch(_0x6aba8f){}const _0x1d0ac=new Blob([JSON[_0x499d88(0x428)](_0x461e2c,null,0x2)],{'type':_0x499d88(0x3a5)}),_0x1ff2fc=document[_0x499d88(0x407)]('a'),_0x51e8bf=new Date(),_0x4b262a=_0x5e4de5=>(''+_0x5e4de5)[_0x499d88(0x2d7)](0x2,'0');_0x1ff2fc['href']=URL[_0x499d88(0x21a)](_0x1d0ac),_0x1ff2fc[_0x499d88(0x2c4)]='pomodoro_backup_'+_0x51e8bf[_0x499d88(0x1c7)]()+_0x4b262a(_0x51e8bf[_0x499d88(0x282)]()+0x1)+_0x4b262a(_0x51e8bf[_0x499d88(0x43b)]())+'.json',_0x1ff2fc[_0x499d88(0x25b)](),URL['revokeObjectURL'](_0x1ff2fc[_0x499d88(0x317)]);},async 'importData'(_0x3a6c7f){const _0x24e4cc=_0x2ebaf0,_0x383e94=await _0x3a6c7f[_0x24e4cc(0x3b7)](),_0x4d6395=JSON[_0x24e4cc(0x1b5)](_0x383e94);if(!_0x4d6395[_0x24e4cc(0x2ba)]||!_0x4d6395[_0x24e4cc(0x3fb)]||!Array[_0x24e4cc(0x2cf)](_0x4d6395[_0x24e4cc(0x220)]))throw new Error(_0x24e4cc(0x14f));try{const _0x29f7e6=window[_0x24e4cc(0x13b)]&&window[_0x24e4cc(0x13b)][_0x24e4cc(0x3fb)]&&window[_0x24e4cc(0x13b)][_0x24e4cc(0x3fb)][_0x24e4cc(0x34c)]||'';(!(_0x24e4cc(0x34c)in _0x4d6395[_0x24e4cc(0x3fb)])||_0x4d6395[_0x24e4cc(0x3fb)][_0x24e4cc(0x34c)]==='')&&(_0x4d6395[_0x24e4cc(0x3fb)]['apiKey']=_0x29f7e6);}catch(_0x189815){}return localStorage['setItem'](_0x24e4cc(0x22c),JSON[_0x24e4cc(0x428)](_0x4d6395)),_0x4d6395;}},$=(_0x4ad788,_0x632b6a=document)=>_0x632b6a[_0x2ebaf0(0x273)](_0x4ad788),breakSuggestions=[_0x2ebaf0(0x36e),_0x2ebaf0(0x335),'Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.',_0x2ebaf0(0x289),'Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.',_0x2ebaf0(0x2d8),_0x2ebaf0(0x366),'Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.',_0x2ebaf0(0x2a7),_0x2ebaf0(0x3b6),_0x2ebaf0(0x33e),_0x2ebaf0(0x21f),_0x2ebaf0(0x1d5),_0x2ebaf0(0x20a),_0x2ebaf0(0x2b9),_0x2ebaf0(0x393),_0x2ebaf0(0x41c),_0x2ebaf0(0x352),'Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.',_0x2ebaf0(0x3a8),_0x2ebaf0(0x1bf),_0x2ebaf0(0x41b),_0x2ebaf0(0x20b),_0x2ebaf0(0x1ab),_0x2ebaf0(0x17b),_0x2ebaf0(0x131),_0x2ebaf0(0x11a),'Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.',_0x2ebaf0(0x298)],$$=(_0x15a70e,_0x41ec47=document)=>Array[_0x2ebaf0(0x18f)](_0x41ec47[_0x2ebaf0(0x43c)](_0x15a70e));function on(_0x47927e,_0x5c2d97,_0x3ef3ff){const _0x4eb01a=_0x2ebaf0;if(!_0x47927e){console[_0x4eb01a(0x124)](_0x4eb01a(0x372),_0x5c2d97);return;}_0x47927e[_0x4eb01a(0x3ed)](_0x5c2d97,_0x3ef3ff);}function _0x5e48(_0x1dde39,_0x785d08){const _0x3bcb02=_0x3bcb();return _0x5e48=function(_0x5e48b3,_0x470f9b){_0x5e48b3=_0x5e48b3-0x114;let _0x56f8fe=_0x3bcb02[_0x5e48b3];return _0x56f8fe;},_0x5e48(_0x1dde39,_0x785d08);}const formatMMSS=_0x39b678=>{const _0x435ec4=_0x2ebaf0,_0x5ef6a5=Math[_0x435ec4(0x1a9)](_0x39b678/0x3c)[_0x435ec4(0x1b1)]()[_0x435ec4(0x2d7)](0x2,'0'),_0x563815=Math[_0x435ec4(0x1a9)](_0x39b678%0x3c)['toString']()[_0x435ec4(0x2d7)](0x2,'0');return _0x5ef6a5+':'+_0x563815;},uid=(_0x364810='id')=>_0x364810+'_'+Date['now']()+'_'+Math[_0x2ebaf0(0x133)]()[_0x2ebaf0(0x1b1)](0x24)[_0x2ebaf0(0x1b8)](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0x195aa0){const _0xddc95c=_0x2ebaf0;try{const _0x51825c=_0x195aa0[_0xddc95c(0x43c)](_0xddc95c(0x346));if(!_0x51825c['length'])return;const _0x18f838=_0x51825c[0x0],_0x552027=_0x51825c[_0x51825c[_0xddc95c(0x402)]-0x1],_0x4c11b2=_0xd98dbf=>{const _0x44da25=_0xddc95c;if(_0xd98dbf[_0x44da25(0x35e)]===_0x44da25(0x359)){if(_0xd98dbf[_0x44da25(0x2c6)]&&document[_0x44da25(0x33f)]===_0x18f838)_0xd98dbf[_0x44da25(0x3c0)](),_0x552027[_0x44da25(0x205)]();else!_0xd98dbf[_0x44da25(0x2c6)]&&document['activeElement']===_0x552027&&(_0xd98dbf[_0x44da25(0x3c0)](),_0x18f838[_0x44da25(0x205)]());}};_0x195aa0[_0xddc95c(0x3ed)](_0xddc95c(0x1cf),_0x4c11b2),_0x18f838[_0xddc95c(0x205)](),__releaseFocusTrap=()=>{const _0x199fe6=_0xddc95c;try{_0x195aa0[_0x199fe6(0x397)](_0x199fe6(0x1cf),_0x4c11b2);}catch(_0x24535a){}};}catch(_0x54d723){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x259dfa){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()['toISOString']();function toast(_0x37bad9,_0x4bb0f5=0xa28){const _0x5d6cb0=_0x2ebaf0,_0x12d728=$(_0x5d6cb0(0x2e2)),_0x1444a3=document[_0x5d6cb0(0x407)](_0x5d6cb0(0x2c8));_0x1444a3[_0x5d6cb0(0x23e)]='toast',_0x1444a3[_0x5d6cb0(0x196)]=_0x37bad9,_0x12d728[_0x5d6cb0(0x284)](_0x1444a3),setTimeout(()=>{const _0x3a38cf=_0x5d6cb0;_0x1444a3[_0x3a38cf(0x2a4)]['opacity']='0';},_0x4bb0f5-0x12c),setTimeout(()=>_0x12d728['removeChild'](_0x1444a3),_0x4bb0f5);}function escapeHTML(_0x118c02){const _0x41edf0=_0x2ebaf0;return _0x118c02[_0x41edf0(0x1f0)](/[&<>"']/g,_0x1d2315=>({'&':_0x41edf0(0x3af),'<':'&lt;','>':_0x41edf0(0x12a),'\x22':_0x41edf0(0x2d2),'\x27':_0x41edf0(0x151)}[_0x1d2315]));}function formatDaysHoursMinutes(_0x32d5af){const _0x5a73ee=_0x2ebaf0;if(!_0x32d5af||_0x32d5af<0x1)return _0x5a73ee(0x409);const _0x1749a1=Math[_0x5a73ee(0x1a9)](_0x32d5af/0x3c),_0x35350c=_0x32d5af%0x3c,_0x1cd910=_0x35350c[_0x5a73ee(0x1b1)]()[_0x5a73ee(0x2d7)](0x2,'0');return _0x1749a1+'\x20tiếng\x20'+_0x1cd910+_0x5a73ee(0x2fe);}function formatGeminiResponse(_0x15b1e8){const _0x5b7c44=_0x2ebaf0;return _0x15b1e8[_0x5b7c44(0x1f0)](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0x1c3fb2){const _0x132004=_0x2ebaf0,_0x59186f=(_0x1c3fb2||'')['split']('\x0a');let _0x92ab3b='',_0x4a6c5c=null;const _0x59d84f=()=>{const _0x32e7e5=_0x5e48;_0x4a6c5c&&(_0x92ab3b+=_0x4a6c5c==='ol'?'</ol>':_0x32e7e5(0x378),_0x4a6c5c=null);};for(let _0xfe46ad of _0x59186f){let _0x474714=(_0xfe46ad||'')[_0x132004(0x31d)]();if(!_0x474714){_0x59d84f();continue;}if(_0x474714['startsWith'](_0x132004(0x2f2)))_0x59d84f(),_0x92ab3b+=_0x132004(0x35d)+escapeHTML(_0x474714[_0x132004(0x3ba)](0x5))+_0x132004(0x35b);else{if(/^\d+\.\s/[_0x132004(0x305)](_0x474714)){_0x4a6c5c!=='ol'&&(_0x59d84f(),_0x92ab3b+='<ol>',_0x4a6c5c='ol');const _0x4809e9=_0x474714['substring'](_0x474714[_0x132004(0x321)]('\x20')+0x1);_0x92ab3b+='<li>'+escapeHTML(_0x4809e9)+_0x132004(0x1b0);}else _0x474714[_0x132004(0x27f)]('-\x20')?(_0x4a6c5c!=='ul'&&(_0x59d84f(),_0x92ab3b+='<ul>',_0x4a6c5c='ul'),_0x92ab3b+='<li>'+escapeHTML(_0x474714[_0x132004(0x3ba)](0x2))+_0x132004(0x1b0)):(_0x59d84f(),_0x474714=escapeHTML(_0x474714)[_0x132004(0x1f0)](/\*\*(.*?)\*\*/g,_0x132004(0x2b1))[_0x132004(0x1f0)](/_(.*?)_/g,_0x132004(0x400)),_0x92ab3b+=_0x132004(0x162)+_0x474714+_0x132004(0x2e5));}}return _0x59d84f(),_0x92ab3b;}function wrapTextInMarkdown(_0x49f2c5,_0x268f0c,_0x530aab=''){const _0x1abf87=_0x2ebaf0;if(!_0x49f2c5)return;const _0x49644c=_0x49f2c5[_0x1abf87(0x3c8)]||0x0,_0x5d244a=_0x49f2c5[_0x1abf87(0x2ec)]||0x0,_0x3f6b5e=_0x49f2c5[_0x1abf87(0x2c3)][_0x1abf87(0x3ba)](_0x49644c,_0x5d244a),_0x72bfb2=_0x268f0c+_0x3f6b5e+(_0x530aab||_0x268f0c);_0x49f2c5[_0x1abf87(0x41a)](_0x72bfb2,_0x49644c,_0x5d244a,_0x1abf87(0x197)),_0x49f2c5[_0x1abf87(0x205)]();}function _0x3bcb(){const _0x1a0565=['Daily\x20backup\x20successful.','longBreakIntervalA','Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.','finishFlowSession','onupgradeneeded','getAllKeys','fixed','set_youtubeUrl','_sortable','#toasts','onYouTubeIframeAPIReady','backups','</p>','#btnResume','isCompleted','input','auto','methods','var(--acc-2)','selectionEnd','unMute','#set_cycles','sid','#set_ytThumbAsBg','sound_unlocked','####\x20','\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22','#btnCloseSettings','autoplay;\x20encrypted-media;\x20picture-in-picture','loadLanguage','checked','innerWidth','#set_enableSessionNotes','AudioContext','#ytUrlFeedback','Thêm\x20ghi\x20chú','destination','\x20phút','none','yt-fallback','button','playVideo','Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','statusText','test','objectStore','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22','Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a','bg-view-mode','DB_NAME','textarea','Chỉnh-sửa\x20Tri\x20thức','#btnAddTopic','</div>','stop','ArrowLeft','toLocaleDateString','#set_long','sub-row','#btnAddSubtopicTask','setProperty','#editorPreview','href','Không\x20thể\x20lưu\x20thay\x20đổi.','no-subtopic-selected','Lỗi\x20lưu\x20file.','\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22','getAll','trim','stopVideo','Chọn\x20một\x20chủ\x20đề\x20con\x20trước.','#set_short','indexOf','#breakSuggestionDisplay','Nội\x20dung\x20bị\x20chặn\x20vì:\x20','#settings-flowtime','#btnCancelMethodEditor','tagName','hidden','file:','#btnToggleBg','innerHTML','B_short','var(--sub)','Gửi','achievedMilestones','Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','Enter','content','default','remaining','#genericTitle','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','durationMinutes','<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>','hours','pause','#methodEditorId','Tên\x20Chủ\x20đề\x20mới?','.method-edit','.app-content','Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.','activeElement','theme','toLocaleString','Xác\x20nhận\x20chuyển\x20đổi','menu-active','item','PLAYING','button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])','innerHeight','note','toLowerCase','get','open','apiKey','#btnSkipNote','Đã\x20cập\x20nhật\x20hình\x20nền.','#milestoneTitle','#view-methods\x20.method-item','vi-VN','Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','createdAt','Lỗi\x20khởi\x20tạo:\x20','body','exitFullscreen','object','Tab','https://www.youtube.com','</h4>','badge','<h4>','key','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.','LÀM\x20VIỆC','transaction','#generalNotesList','selectedSubtopicId','cover','youtubeVolume','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','baseVal','backupDaysToKeep','input,select,textarea','#set_winddown','.topic-item.menu-active','#statTasks','actions-menu','Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.','sort','menu-item','🌊\x20Flow','Missing\x20element','cycles','disabled','aria-pressed','AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.','#btnSummarize','</ul>','#btnSaveNote','append','#summariesList','#historyList','#set_theme','setAttribute','readwrite','currentView','#set_autoStartNext','.tab-btn','head','#settings-pomodoro','show','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>','summaries','blockReason','Nghỉ\x20','.tab-content','#audioLongEnd','#statSessions','destroy','setValueAtTime','useYtThumbnailAsBg','<div>','getIframe','<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20','Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','createIndex','ArrowDown','getSettings','removeEventListener','breathing','#selectedContext','includes','B_winddown','location','objectStoreNames','getPropertyValue','Sửa\x20tên\x20Chủ\x20đề','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.','break_end','cueVideoById','collapsedTopics','Thêm\x20Tri\x20thức\x20mới','application/json','IndexedDB\x20error:','classList','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.','fullscreenElement','timerState','display','script','.color-swatch','space','&amp;','#toolItalic','position','Backup\x20failed:','removing','state','?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','text','scrollHeight','POST','substring','--panel-opacity','\x20(A)','#statTotal','/maxresdefault.jpg','getItem','preventDefault','Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','abs','Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','#btnTestSound','PlayerState','\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]','left','selectionStart','<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>','autoStartNext','Chưa\x20có\x20tiêu\x20đề','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22','.actions-menu','updateSettings','timer','#dashboardContent','.topic-item','soundPermissionBar','\x27\x20·\x20Mode\x20','totalMinutes','<div><span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span></div>','presetTarget','badge\x20state\x20break','topic-item','createOscillator','string','#currentSubtopicNameChat','#currentSubtopicName','<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>','#set_backgroundMode','sessionsCompleted','#stateBadge','#btnSaveSettings','#set_flowRatio','block','autoBackup','frequency','chev\x20btn\x20small\x20ghost','workMinutes','dateISO','#modalSettings','code','contentWindow','Đang\x20tải\x20API\x20YouTube...','addEventListener','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','btn\x20subtopic-btn','badge\x20state\x20long','user','modalMethodEditor','currentConfig','#cycleInfo','errorCode','parentElement','map','youtube-player-container','#btnGenericOk','command','settings','bold','https://img.youtube.com/vi/','1874888cCmfdo','Bản\x20sao\x20lưu\x20ngày:\x20','<i>$1</i>','Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!','length','restoreBackup','\x20|\x20<strong>Tổng\x20phiên:</strong>\x20','chime','methodId','createElement','currentDurations','0\x20phút','method-content','triangle','#set_work','color','view','(Không\x20tạo\x20được\x20tóm\x20tắt)','stroke','segmentTotal','expanded','select','ghost','Failed\x20to\x20delete\x20summary:','connect','Xóa\x20tri\x20thức\x20\x22','Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.','Thoát\x20toàn\x20màn\x20hình','setRangeText','Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.','.color-picker-wrapper','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','reloading','resume','.method-delete','status','Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.','Tóm\x20tắt','Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.','origin','<div\x20class=\x22spinner\x22></div>','stringify','transition','Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.','url(','.actions-menu.show','Chọn\x20chủ\x20đề\x20con\x20trước.','getElementById','createObjectStore','pointerdown','A_short','Thêm\x20tùy\x20chọn','#btnClearChat','summary_','right','save','__ytApiWatchdog','by_topic','Âm\x20thanh\x20đã\x20được\x20bật!','backgroundSize','getDate','querySelectorAll','reset','var(--muted)','pomodoro_files','createGain','width','clear','342036lLGhyf','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','API\x20response\x20structure\x20is\x20unexpected:','TẠM\x20DỪNG','longBreakIntervalB','Player','blob:','#importFile','put','removeProperty','https:','warn','stats','50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.','#set_apiKey','setItem','protocol','&gt;','.timer-circle-container','max','ENDED','dataset','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>','values','Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.','ytUrlFeedback','random','load','onkeydown','light','Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20','async','onclick','#btnEnableSound','data','Đã\x20xóa\x20tóm\x20tắt.','work_end','#welcomePanel\x20p','Failed\x20to\x20save\x20data:','getBoundingClientRect','.nav-btn[data-view=\x22','now','error','#newSubtopicTaskInput','model','Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.','beep','exponentialRampToValueAtTime','flatMap','?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','tasksCompleted','setPreset','\x0a-\x20','Tệp\x20không\x20đúng\x20định\x20dạng','idle','&#39;','message','text/plain','#modalNote','Lỗi:\x20','flowtimeBreakRatio','Gemini\x20API\x20Error:','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>','log','#modalMilestone','#modalGeneric','BUFFERING','undefined','<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>','#btnAutoFormat','.actions-menu-btn','insertUnorderedList','<p>','#btnFinishFlow','find','initDB','note-item','.txt','189abtZBm','offsetHeight','B_work','#view-','paused','reduce','AI\x20đã\x20định\x20dạng\x20xong!','bottom','#btnStart','#btnAddGeneralNote','#btnSummarizeNote','customBg','2116160gKcrNE','#uploadSoundWork','clientX','break','.aux-panel,\x20.modal-card','note-content','forEach','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','reload','note-content-wrapper','tasks','.timer-circle-progress','onload','#set_panelOpacity','5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.','#aiPromptSuggestions\x20button','closest','durations','#btnPresetC','Hiện\x20giao\x20diện','#methodEditorTitle','details','data:','then','absolute','method-title','#btnToggleYtSound','from','.modal','#btnHelpCreateTopic','#draggableTimer','#set_enableWinddown','SẴN\x20SÀNG','#view-methods\x20.methods-container','textContent','end','interval','src','#ytSoundVolume','soundTheme','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','3xEwuHQ','findIndex','push','Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.','name','mousemove','\x20hidden','#set_youtubeUrl','Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','tid','note-meta','Toàn\x20màn\x20hình','floor','sess','Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.','selectedTopicId','.view','Tên\x20Chủ\x20đề\x20con\x20mới?','timer.selectSubtopicPrompt','</li>','toString','update','#uploadSoundBreak','getPlayerState','parse','setVolume','title','slice','#btnCloseDashboard','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','#btnBreakEarly','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=','Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.','#btnSendMessage','Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!','#btnGenericCancel','Đã\x20khôi\x20phục\x20mặc\x20định','http:','/hqdefault.jpg','importData','#set_volume','parts','getFullYear','readonly','long_end','cyclesA','684424WMVftx','btnToggleYtSound','#btnSettings','about:blank','keydown','#genericMessage','17994950xLacLI','linearRampToValueAtTime','persistTimerState','\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.','start','Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','.nav-btn[data-view]','_getStore','#modalMethodEditor','btn\x20small\x20danger','42IODrmR','sine','isNaN','lastBackupDate','lang','Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.','unshift','#btnPause','chatHistory','topic-title','AutoBackup\x20error:','-9999px','Xóa\x20Chủ\x20đề\x20con','resolve','Xóa','newIndex','Initialization\x20error:','add','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','allow','replace','Đã\x20lưu\x20ghi\x20chú','_startTick','cancel','file','#toolBullet','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20được\x20thêm\x20vào.</p>','files','round','customSounds','</tbody></table>','#btnSaveMethod','getBackupList','delete','_onFinishSegment','prevState','date','NGHỈ\x20DÀI','subtopic','filter','Nhập\x20thất\x20bại:\x20','focus','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','Lỗi\x20phát\x20âm\x20thanh:','panelOpacity','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.','Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.','Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.','--bg-image','result','#btnToggleCustomSounds','#set_backupDays','top','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.','type','contains','Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','work','Xác\x20nhận\x20xóa','foreColor','B_long','createObjectURL','chat-msg\x20','mute','repeat','topic-actions','Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','topics','Đã\x20dừng\x20nhạc\x20nền.','topic','Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.','.subtopics','Ẩn\x20giao\x20diện','#set_interval','strokeDasharray','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>','#btnRestoreBackup','clientY','cycleIndex','pomodoroData_v11','#btnAddMethod','img.youtube.com/vi/','#milestoneMessage','A_long','Sửa','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','</td><td>','winddown','Chưa\x20chọn\x20Chủ\x20đề\x20con','Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.','main_settings','187888HPClDV','defer','target','Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...','mode','Đang\x20phát\x20nhạc\x20nền...','className','pauseVideo','Đã\x20chuyển\x20sang\x20Kiểu\x20','Chủ\x20đề\x20con:\x20','<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>','italic','exportData','postMessage','promptFeedback','Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.','skip','tab','Sửa\x20tên\x20Chủ\x20đề\x20con','#set_theme_color','#backupList','min','Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22','function','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','#view-timer','flex','#btnSkip','backgroundRepeat','#modalDashboard','<div\x20class=\x22hist-meta\x22>','beginWork','onerror','A_work','Đã\x20xóa\x20lịch\x20sử\x20chat.','click','active','onsuccess','ArrowUp','reverse','#btnMilestoneClose','var(--danger)','fullscreenchange','</td></tr>','stopPropagation','long_break','match','#windDownChecklist','change','Creating\x20backup\x20for\x20','menu-item\x20danger','updateUI','Đổi\x20tên\x20Chủ\x20đề\x20con','cyclesTarget','</label>','sessions','mousedown','#timerPresetSelector\x20button','backgroundImage','querySelector','localeCompare','formatBlock','\x20(B)','__ytApiPromise','timerState_','#methodEditorContentInput','oncomplete','#btnDefaults','#btnReset','Sortable','scrollTop','startsWith','requestFullscreen','Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20','getMonth','#btnFullscreen','appendChild','toggle','Xác\x20nhận\x20phục\x20hồi','topicId','Escape','Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.','acc','Lỗi\x20lưu\x20dữ\x20liệu:\x20','Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','iframe','...','backgroundMode','webkitAudioContext','LÀM\x20VIỆC\x20(FLOW)','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>','IndexedDB\x20initialized\x20successfully.','subtopics','volume','Thêm\x20Chủ\x20đề\x20con','❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.','Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!','remove','beginBreak','#toolH4','topicsList','http','cyclesB','\x20·\x20','wind_down','#noteText','Xuất','Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.','style','#audioWorkEnd','scroll','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','gain','documentElement','btn\x20small','enableWinddown','oldIndex','<input\x20type=\x22checkbox\x22\x20id=\x22','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','mouseup','#btnExport','<strong>$1</strong>','Đã\x20lưu\x20cài\x20đặt','preset','✨\x20Tự\x20động\x20định\x20dạng','#chatInput','153202BkEDpX','#topicsList','A_winddown','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','version','<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>','candidates','Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.','isConnected','Lỗi\x20HTTP:\x20','generalNotes','splice','json','value','download','#genericInput','shiftKey','all','div','<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>','option','.color-palette','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','ArrowRight','enableSessionNotes','isArray','catch','.sub-row','&quot;','tickHandle','pastel','Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.','execCommand','padStart','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.'];_0x3bcb=function(){return _0x1a0565;};return _0x3bcb();}function updateEditorPreview(){const _0x149814=_0x2ebaf0,_0x5e4e76=$(_0x149814(0x279)),_0x1140cd=$(_0x149814(0x316));if(!_0x5e4e76||!_0x1140cd)return;const _0x3252b6=_0x5e4e76['value']||'';_0x1140cd[_0x149814(0x32a)]=parseSimpleMarkdown(_0x3252b6);}function normalizeDataStructure(_0x3b82bf){const _0x2fda42=_0x2ebaf0;if(!_0x3b82bf||typeof _0x3b82bf!==_0x2fda42(0x358))return;const _0x44bdc7=_0x3b82bf[_0x2fda42(0x3fb)]||{},_0xeffe27={...defaults[_0x2fda42(0x3fb)],..._0x44bdc7,'durations':{...defaults[_0x2fda42(0x3fb)][_0x2fda42(0x185)],..._0x44bdc7[_0x2fda42(0x185)]||{}}};if(!Array[_0x2fda42(0x2cf)](_0xeffe27[_0x2fda42(0x32e)]))_0xeffe27['achievedMilestones']=[];_0x3b82bf[_0x2fda42(0x3fb)]=_0xeffe27,_0x3b82bf[_0x2fda42(0x220)]=Array['isArray'](_0x3b82bf[_0x2fda42(0x220)])?_0x3b82bf[_0x2fda42(0x220)]:[],_0x3b82bf[_0x2fda42(0x220)][_0x2fda42(0x17a)](_0x573d78=>{const _0xa34f0b=_0x2fda42;_0x573d78['subtopics']=Array[_0xa34f0b(0x2cf)](_0x573d78[_0xa34f0b(0x294)])?_0x573d78['subtopics']:[],_0x573d78[_0xa34f0b(0x294)]['forEach'](_0x46ab73=>{const _0x35e343=_0xa34f0b;_0x46ab73[_0x35e343(0x17e)]=_0x46ab73['tasks']||[],_0x46ab73[_0x35e343(0x2c0)]=_0x46ab73[_0x35e343(0x2c0)]||[],_0x46ab73[_0x35e343(0x387)]=_0x46ab73['summaries']||[],_0x46ab73[_0x35e343(0x1e4)]=_0x46ab73['chatHistory']||[],_0x46ab73[_0x35e343(0x125)]=_0x46ab73[_0x35e343(0x125)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x46ab73[_0x35e343(0x26f)]=_0x46ab73[_0x35e343(0x26f)]||[],_0x46ab73[_0x35e343(0x3aa)]=_0x46ab73['timerState']||{'state':_0x35e343(0x150),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x23c87f){const _0x3986b2=_0x2ebaf0;if(!_0x23c87f)return null;const _0x557d4c=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0x3fb910=_0x23c87f[_0x3986b2(0x266)](_0x557d4c);return _0x3fb910?_0x3fb910[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x3f2e04=_0x2ebaf0;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x35db27=document[_0x3f2e04(0x42e)](_0x3f2e04(0x2e0)),_0xc1cc72=(_0x35db27&&_0x35db27[_0x3f2e04(0x2c3)]?_0x35db27[_0x3f2e04(0x2c3)]:'')['trim']();return _0xc1cc72;}catch(_0x119e07){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function handleYoutubeUrlInput(){const _0xa012b0=_0x2ebaf0,_0x4c60a2=$('#set_youtubeUrl'),_0x275fd1=$(_0xa012b0(0x2fb)),_0x33fc81=$('#btnToggleYtSound'),_0x754c94=_0x4c60a2['value']['trim'](),_0x44567d=extractYouTubeID(_0x754c94);if(_0x44567d){_0x275fd1[_0xa012b0(0x196)]=_0xa012b0(0x1ba),_0x275fd1[_0xa012b0(0x2a4)][_0xa012b0(0x40d)]=_0xa012b0(0x2eb),_0x33fc81[_0xa012b0(0x374)]=![],sessionYoutubeUrl=_0x754c94;try{ytUserPaused=![];}catch(_0x5853cd){}try{const _0x20ac13=_0xa012b0(0x3fd)+_0x44567d+'/maxresdefault.jpg',_0x18ba62=new Image();_0x18ba62[_0xa012b0(0x180)]=async()=>{const _0x4b418b=_0xa012b0;data[_0x4b418b(0x3fb)][_0x4b418b(0x173)]=_0x20ac13;try{await saveData();}catch(_0xc35b58){}applyCustomBg();},_0x18ba62[_0xa012b0(0x258)]=async()=>{const _0x415817=_0xa012b0,_0xce3943=_0x415817(0x3fd)+_0x44567d+_0x415817(0x1c3);data[_0x415817(0x3fb)][_0x415817(0x173)]=_0xce3943;try{await saveData();}catch(_0x2a189f){}applyCustomBg();},_0x18ba62[_0xa012b0(0x199)]=_0x20ac13;}catch(_0x17d121){}try{if(IS_FILE_PROTOCOL){const _0x197d3d=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x44567d,{'autoplay':0x1,'mute':_0x197d3d});try{setTimeout(()=>{try{fallbackPostMessage('playVideo');}catch(_0x3e1e5a){}},0xfa);}catch(_0x153f72){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0x1797bb=_0xa012b0,_0x228019=document[_0x1797bb(0x42e)](_0x1797bb(0x132));if(_0x228019)_0x228019['textContent']='Đang\x20phát';},0x1f4);}catch(_0x25deaf){}}else ensureYouTubeAPI()[_0xa012b0(0x18b)](()=>{const _0x537ef2=_0xa012b0;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer[_0x537ef2(0x21c)]&&ytPlayer['playVideo']&&(ytPlayer['mute'](),ytPlayer[_0x537ef2(0x302)](),_ytPrimed=!![],showSoundPermission());}catch(_0x28e44b){}})['catch'](()=>{});}catch(_0x3c1989){}}else{if(_0x754c94===''){_0x275fd1[_0xa012b0(0x196)]='',_0x33fc81[_0xa012b0(0x374)]=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x52dda9){}else ytPlayer&&ytPlayer[_0xa012b0(0x31e)]&&ytPlayer[_0xa012b0(0x31e)]();}else _0x275fd1['textContent']=_0xa012b0(0x297),_0x275fd1['style']['color']=_0xa012b0(0x261),_0x33fc81[_0xa012b0(0x374)]=!![];}}function applyTheme(_0x38a848){const _0x5c7e3c=_0x2ebaf0,_0x2d3a0f=_0x38a848||data[_0x5c7e3c(0x3fb)][_0x5c7e3c(0x340)]||_0x5c7e3c(0x332);document[_0x5c7e3c(0x356)][_0x5c7e3c(0x12e)][_0x5c7e3c(0x340)]=_0x2d3a0f;const _0x33551f=['lofi',_0x5c7e3c(0x3ae)][_0x5c7e3c(0x39a)](_0x2d3a0f),_0x5866be=_0x2d3a0f==='light'||_0x2d3a0f===_0x5c7e3c(0x2d4),_0x9f20f4=data[_0x5c7e3c(0x3fb)][_0x5c7e3c(0x173)],_0x235f7f=()=>{const _0xecdde7=_0x5c7e3c;try{document[_0xecdde7(0x356)][_0xecdde7(0x2a4)][_0xecdde7(0x272)]='';}catch(_0x2cee79){}};if(_0x9f20f4&&!data[_0x5c7e3c(0x3fb)][_0x5c7e3c(0x38f)])document[_0x5c7e3c(0x356)]['style'][_0x5c7e3c(0x315)](_0x5c7e3c(0x20d),'url('+_0x9f20f4+')'),_0x235f7f();else{if(_0x9f20f4&&data['settings']['useYtThumbnailAsBg'])document[_0x5c7e3c(0x356)]['style'][_0x5c7e3c(0x315)](_0x5c7e3c(0x20d),_0x5c7e3c(0x42b)+_0x9f20f4+')'),_0x235f7f();else{if(_0x33551f)document[_0x5c7e3c(0x356)][_0x5c7e3c(0x2a4)][_0x5c7e3c(0x122)](_0x5c7e3c(0x20d)),_0x235f7f();else _0x5866be?(document[_0x5c7e3c(0x356)][_0x5c7e3c(0x2a4)][_0x5c7e3c(0x315)]('--bg-image',_0x5c7e3c(0x2ff)),_0x235f7f()):(document[_0x5c7e3c(0x356)][_0x5c7e3c(0x2a4)][_0x5c7e3c(0x315)](_0x5c7e3c(0x20d),''),document[_0x5c7e3c(0x356)][_0x5c7e3c(0x2a4)][_0x5c7e3c(0x272)]='radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)');}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':_0x2ebaf0(0x3cf),'preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x2ebaf0(0x147),'theme':'default','cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'enableSessionNotes':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x2ebaf0(0x364),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':'Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','content':_0x2ebaf0(0x353)},{'id':uid('m'),'title':_0x2ebaf0(0x28c),'content':'<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>'},{'id':uid('m'),'title':_0x2ebaf0(0x14b),'content':_0x2ebaf0(0x2bb)},{'id':uid('m'),'title':_0x2ebaf0(0x3ee),'content':'<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>'},{'id':uid('m'),'title':_0x2ebaf0(0x303),'content':_0x2ebaf0(0x3c9)}]},'topics':[]};let data,editingPreset='A',AUDIO_CTX=null;function ensureAudio(){const _0x2916ba=_0x2ebaf0;if(!AUDIO_CTX)AUDIO_CTX=new(window[(_0x2916ba(0x2fa))]||window[(_0x2916ba(0x290))])();}function tone(_0x2f18a6=0x370,_0x2f4cae=0xc8,_0x4ada5a=0.2,_0x3fe14e=_0x2ebaf0(0x1dd),_0x5b6bd4=0x0){const _0x5e5a41=_0x2ebaf0;ensureAudio();const _0x3d26e5=AUDIO_CTX,_0x5dc917=_0x3d26e5[_0x5e5a41(0x3d9)](),_0xac572d=_0x3d26e5[_0x5e5a41(0x116)]();_0x5dc917[_0x5e5a41(0x213)]=_0x3fe14e,_0x5dc917[_0x5e5a41(0x3e5)]['value']=_0x2f18a6,_0x5dc917[_0x5e5a41(0x416)](_0xac572d),_0xac572d[_0x5e5a41(0x416)](_0x3d26e5[_0x5e5a41(0x2fd)]);const _0x3556a7=_0x3d26e5['currentTime']+_0x5b6bd4;_0xac572d[_0x5e5a41(0x2a8)][_0x5e5a41(0x38e)](0x0,_0x3556a7),_0xac572d[_0x5e5a41(0x2a8)][_0x5e5a41(0x1d2)](_0x4ada5a,_0x3556a7+0.01),_0xac572d['gain'][_0x5e5a41(0x148)](0.0001,_0x3556a7+_0x2f4cae/0x3e8),_0x5dc917[_0x5e5a41(0x1d6)](_0x3556a7),_0x5dc917[_0x5e5a41(0x30f)](_0x3556a7+_0x2f4cae/0x3e8+0.05);}function playSound(_0x124ab1){const _0x1fea33=_0x2ebaf0;if(!data[_0x1fea33(0x3fb)]['soundOn'])return;const _0x253d19=Math['max'](0x0,Math['min'](0x1,data['settings']['volume']??0.8)),_0x870784=data['settings'][_0x1fea33(0x1f9)]?.[_0x124ab1];let _0x577b5c;if(_0x124ab1===_0x1fea33(0x13d))_0x577b5c=$(_0x1fea33(0x2a5));else{if(_0x124ab1===_0x1fea33(0x3a1))_0x577b5c=$('#audioBreakEnd');else{if(_0x124ab1==='long_end')_0x577b5c=$(_0x1fea33(0x38b));}}if(_0x870784&&_0x577b5c){_0x870784['startsWith'](_0x1fea33(0x18a))||_0x870784[_0x1fea33(0x27f)](_0x1fea33(0x29d))||_0x870784[_0x1fea33(0x27f)](_0x1fea33(0x11f))?(_0x577b5c['src']=_0x870784,_0x577b5c[_0x1fea33(0x295)]=_0x253d19,_0x577b5c['play']()[_0x1fea33(0x2d0)](_0x571f34=>console[_0x1fea33(0x143)](_0x1fea33(0x208),_0x571f34))):getStoredFileUrl(_0x870784)[_0x1fea33(0x18b)](_0x4084c3=>{const _0x4debf1=_0x1fea33;_0x4084c3&&(_0x577b5c['src']=_0x4084c3,_0x577b5c[_0x4debf1(0x295)]=_0x253d19,_0x577b5c['play']()[_0x4debf1(0x2d0)](_0x2db810=>console[_0x4debf1(0x143)](_0x4debf1(0x208),_0x2db810)));});return;}const _0x18539f=data[_0x1fea33(0x3fb)]['soundTheme']||'beep';if(_0x18539f===_0x1fea33(0x147)){if(_0x124ab1===_0x1fea33(0x13d))tone(0x370,0xfa,_0x253d19),tone(0x294,0xb4,_0x253d19*0.8,_0x1fea33(0x1dd),0.22);else{if(_0x124ab1==='break_end')tone(0x294,0xdc,_0x253d19*0.9);else _0x124ab1===_0x1fea33(0x1c9)&&(tone(0x208,0xc8,_0x253d19),tone(0x30c,0xc8,_0x253d19,'sine',0.22),tone(0x410,0xdc,_0x253d19,'sine',0.44));}}else{if(_0x124ab1===_0x1fea33(0x13d))tone(0x4b0,0xa0,_0x253d19*0.9,'triangle'),tone(0x384,0xdc,_0x253d19*0.8,'triangle',0.18);else{if(_0x124ab1==='break_end')tone(0x370,0xf0,_0x253d19*0.8,_0x1fea33(0x40b));else _0x124ab1===_0x1fea33(0x1c9)&&(tone(0x258,0xdc,_0x253d19*0.9,_0x1fea33(0x40b)),tone(0x3b6,0xf0,_0x253d19*0.9,_0x1fea33(0x40b),0.22),tone(0x4b0,0xf0,_0x253d19,'triangle',0.44));}}}async function saveData(){const _0x544920=_0x2ebaf0;try{await storageManager[_0x544920(0x436)](data);}catch(_0x2ef771){console[_0x544920(0x143)](_0x544920(0x13f),_0x2ef771),toast(_0x544920(0x28b)+_0x2ef771[_0x544920(0x152)]);}}async function ensureValidSelection(){const _0x6cce1d=_0x2ebaf0,_0x9d33b1=data['settings'];if(!data['topics']||data[_0x6cce1d(0x220)]['length']===0x0){_0x9d33b1['selectedTopicId']='',_0x9d33b1[_0x6cce1d(0x363)]='',await saveData();return;}const _0x1a144e=data[_0x6cce1d(0x220)][_0x6cce1d(0x164)](_0x59b4e1=>_0x59b4e1['id']===_0x9d33b1[_0x6cce1d(0x1ac)]),_0x4144db=_0x1a144e?.[_0x6cce1d(0x294)][_0x6cce1d(0x164)](_0x9bb0e7=>_0x9bb0e7['id']===_0x9d33b1['selectedSubtopicId']);if(!_0x1a144e||!_0x4144db){const _0x5cd2f7=data[_0x6cce1d(0x220)][0x0],_0x3070a2=_0x5cd2f7?.[_0x6cce1d(0x294)]?.[0x0];_0x9d33b1[_0x6cce1d(0x1ac)]=_0x5cd2f7?.['id']||'',_0x9d33b1[_0x6cce1d(0x363)]=_0x3070a2?.['id']||'',await saveData();}}function showInputModal(_0x14854f,_0x2afd22,_0x571b30=''){const _0x337419=_0x2ebaf0;$('#genericTitle')['textContent']=_0x14854f,$(_0x337419(0x1d0))[_0x337419(0x3a7)][_0x337419(0x1ed)](_0x337419(0x327));const _0xe18406=$(_0x337419(0x2c5));_0xe18406[_0x337419(0x2c3)]=_0x571b30,_0xe18406[_0x337419(0x3a7)][_0x337419(0x299)](_0x337419(0x327)),$(_0x337419(0x15b))[_0x337419(0x3a7)]['add'](_0x337419(0x385));try{trapFocus($(_0x337419(0x15b)));}catch(_0x1c2562){}_0xe18406[_0x337419(0x205)](),_0xe18406['select']();const _0x44cd1f=()=>{const _0x1a9e40=_0x337419;_0x2afd22(_0xe18406[_0x1a9e40(0x2c3)]),_0xcb53d8();},_0x9e23=()=>_0xcb53d8(),_0x761658=_0x44dac1=>{const _0x23ce48=_0x337419;if(_0x44dac1['key']===_0x23ce48(0x330))_0x44cd1f();if(_0x44dac1[_0x23ce48(0x35e)]===_0x23ce48(0x288))_0x9e23();};$(_0x337419(0x3f9))[_0x337419(0x139)]=_0x44cd1f,$('#btnGenericCancel')[_0x337419(0x139)]=_0x9e23,_0xe18406[_0x337419(0x135)]=_0x761658;function _0xcb53d8(){const _0x2f3b9b=_0x337419;$(_0x2f3b9b(0x15b))[_0x2f3b9b(0x3a7)][_0x2f3b9b(0x299)](_0x2f3b9b(0x385)),$('#btnGenericOk')[_0x2f3b9b(0x139)]=null,$('#btnGenericCancel')['onclick']=null,_0xe18406[_0x2f3b9b(0x135)]=null;try{releaseFocus();}catch(_0x4129d6){}}}function showConfirmModal(_0x448327,_0xb2a5dc,_0x42f31c){const _0x22b710=_0x2ebaf0;$(_0x22b710(0x334))[_0x22b710(0x196)]=_0x448327;const _0x855bf9=$(_0x22b710(0x1d0));_0x855bf9[_0x22b710(0x196)]=_0xb2a5dc,_0x855bf9[_0x22b710(0x3a7)][_0x22b710(0x299)]('hidden'),$('#genericInput')['classList'][_0x22b710(0x1ed)](_0x22b710(0x327)),$(_0x22b710(0x15b))[_0x22b710(0x3a7)][_0x22b710(0x1ed)]('show');try{trapFocus($(_0x22b710(0x15b)));}catch(_0x2feb15){}const _0x57ef77=()=>{_0x42f31c(!![]),_0xa4eb69();},_0x341396=()=>{_0x42f31c(![]),_0xa4eb69();};$(_0x22b710(0x3f9))[_0x22b710(0x139)]=_0x57ef77,$(_0x22b710(0x1c0))[_0x22b710(0x139)]=_0x341396;function _0xa4eb69(){const _0x719a2=_0x22b710;$(_0x719a2(0x15b))[_0x719a2(0x3a7)][_0x719a2(0x299)](_0x719a2(0x385)),$(_0x719a2(0x3f9))[_0x719a2(0x139)]=null,$('#btnGenericCancel')[_0x719a2(0x139)]=null;try{releaseFocus();}catch(_0x1bba3f){}}}let pendingNoteSessionId=null;function openNoteModal(_0x53d41){const _0x50730a=_0x2ebaf0;pendingNoteSessionId=_0x53d41||null;const _0x2f5d1c=$(_0x50730a(0x154));if(!_0x2f5d1c)return;const _0xe1bcb7=$(_0x50730a(0x2a1));if(_0xe1bcb7)try{_0xe1bcb7[_0x50730a(0x2c3)]='';}catch(_0x47738d){}_0x2f5d1c[_0x50730a(0x3a7)][_0x50730a(0x1ed)](_0x50730a(0x385));try{trapFocus(_0x2f5d1c);}catch(_0x13e98a){}}function closeNoteModal(){const _0x1b895e=_0x2ebaf0,_0x589c4f=$('#modalNote');if(!_0x589c4f)return;_0x589c4f[_0x1b895e(0x3a7)][_0x1b895e(0x299)](_0x1b895e(0x385)),pendingNoteSessionId=null;try{releaseFocus();}catch(_0x48570d){}}async function switchView(_0x185a7c){const _0x3d0d43=_0x2ebaf0;$$(_0x3d0d43(0x1ad))[_0x3d0d43(0x17a)](_0x287dc0=>_0x287dc0[_0x3d0d43(0x3a7)][_0x3d0d43(0x299)](_0x3d0d43(0x25c))),$(_0x3d0d43(0x16b)+_0x185a7c)[_0x3d0d43(0x3a7)][_0x3d0d43(0x1ed)]('active'),$$('.nav-btn')[_0x3d0d43(0x17a)](_0x404db1=>_0x404db1[_0x3d0d43(0x3a7)]['remove'](_0x3d0d43(0x25c)));const _0x50c9d5=$(_0x3d0d43(0x141)+_0x185a7c+'\x22]');if(_0x50c9d5)_0x50c9d5['classList']['add'](_0x3d0d43(0x25c));data[_0x3d0d43(0x3fb)][_0x3d0d43(0x380)]=_0x185a7c,await saveData(),_0x185a7c===_0x3d0d43(0x125)&&renderDashboard();}function closeAllMenus(){const _0x573d42=_0x2ebaf0;$$(_0x573d42(0x42c))[_0x573d42(0x17a)](_0x3aae58=>_0x3aae58['classList'][_0x573d42(0x299)](_0x573d42(0x385))),$$(_0x573d42(0x36b))[_0x573d42(0x17a)](_0x1c5359=>_0x1c5359[_0x573d42(0x3a7)]['remove'](_0x573d42(0x343)));}function renderTopics(){const _0x202c64=_0x2ebaf0,_0x297ec8=$(_0x202c64(0x2b7));if(!_0x297ec8)return;_0x297ec8[_0x202c64(0x32a)]='';const _0x3aeaed=data[_0x202c64(0x3fb)][_0x202c64(0x3a3)]||{};data['topics']['forEach'](_0x82bd69=>{const _0x222f77=_0x202c64,_0x29a28b=document[_0x222f77(0x407)](_0x222f77(0x2c8));_0x29a28b['className']=_0x222f77(0x3d8),_0x29a28b[_0x222f77(0x12e)][_0x222f77(0x1a6)]=_0x82bd69['id'];const _0x3872b9=document[_0x222f77(0x407)](_0x222f77(0x2c8));_0x3872b9[_0x222f77(0x23e)]='topic-header';const _0x1c6912=!!_0x3aeaed[_0x82bd69['id']],_0x2c89dc=document[_0x222f77(0x407)]('button');_0x2c89dc['className']=_0x222f77(0x3e6),_0x2c89dc[_0x222f77(0x37e)]('aria-expanded',String(!_0x1c6912)),_0x2c89dc[_0x222f77(0x32a)]='<span\x20class=\x22ico\x22>▾</span>';const _0x22046a=document[_0x222f77(0x407)]('div');_0x22046a[_0x222f77(0x23e)]=_0x222f77(0x1e5),_0x22046a[_0x222f77(0x196)]=_0x82bd69[_0x222f77(0x1a1)];const _0xd30114=document[_0x222f77(0x407)](_0x222f77(0x2c8));_0xd30114['className']=_0x222f77(0x21e);const _0x439ad2=document['createElement'](_0x222f77(0x301));_0x439ad2[_0x222f77(0x23e)]=_0x222f77(0x2aa),_0x439ad2[_0x222f77(0x32a)]='＋\x20Thêm',_0x439ad2['title']=_0x222f77(0x296);const _0x6fa68e=document['createElement'](_0x222f77(0x2c8));_0x6fa68e[_0x222f77(0x2a4)][_0x222f77(0x3b1)]='relative';const _0x3ac76c=document['createElement'](_0x222f77(0x301));_0x3ac76c[_0x222f77(0x23e)]='btn\x20small\x20ghost\x20actions-menu-btn',_0x3ac76c[_0x222f77(0x32a)]=_0x222f77(0x28e),_0x3ac76c['title']='Thêm\x20tùy\x20chọn';const _0x56816e=document[_0x222f77(0x407)](_0x222f77(0x2c8));_0x56816e[_0x222f77(0x23e)]=_0x222f77(0x36d);const _0x34fa7a=document[_0x222f77(0x407)]('button');_0x34fa7a[_0x222f77(0x23e)]='menu-item',_0x34fa7a[_0x222f77(0x32a)]=_0x222f77(0x39f);const _0x46a5d4=document[_0x222f77(0x407)](_0x222f77(0x301));_0x46a5d4[_0x222f77(0x23e)]=_0x222f77(0x26a),_0x46a5d4[_0x222f77(0x32a)]='Xóa\x20Chủ\x20đề',_0x56816e['append'](_0x34fa7a,_0x46a5d4),_0x6fa68e[_0x222f77(0x37a)](_0x3ac76c,_0x56816e),_0xd30114['append'](_0x439ad2,_0x6fa68e),_0x3872b9[_0x222f77(0x37a)](_0x2c89dc,_0x22046a,_0xd30114),_0x2c89dc[_0x222f77(0x3ed)](_0x222f77(0x25b),async _0x116834=>{const _0x1f6cef=_0x222f77;_0x116834[_0x1f6cef(0x264)]();const _0x22f6bb=!!_0x3aeaed[_0x82bd69['id']];_0x22f6bb?delete _0x3aeaed[_0x82bd69['id']]:_0x3aeaed[_0x82bd69['id']]=!![],data[_0x1f6cef(0x3fb)][_0x1f6cef(0x3a3)]=_0x3aeaed,await storageManager[_0x1f6cef(0x3ce)](data['settings']),renderTopics();});const _0x4f3c61=async()=>{const _0x18c8a1=_0x222f77,_0x57a3f3=!!_0x3aeaed[_0x82bd69['id']];_0x57a3f3?delete _0x3aeaed[_0x82bd69['id']]:_0x3aeaed[_0x82bd69['id']]=!![],data[_0x18c8a1(0x3fb)]['collapsedTopics']=_0x3aeaed,await storageManager[_0x18c8a1(0x3ce)](data['settings']),renderTopics();};_0x3872b9[_0x222f77(0x3ed)](_0x222f77(0x25b),async _0x337feb=>{const _0xfe6c33=_0x222f77,_0x354d1e=_0x337feb[_0xfe6c33(0x23a)];if(_0x354d1e&&_0x354d1e[_0xfe6c33(0x184)]){if(_0x354d1e[_0xfe6c33(0x184)](_0xfe6c33(0x3cd))||_0x354d1e[_0xfe6c33(0x184)](_0xfe6c33(0x160))||_0x354d1e['closest'](_0xfe6c33(0x301))||_0x354d1e[_0xfe6c33(0x184)](_0xfe6c33(0x369)))return;}_0x337feb[_0xfe6c33(0x264)](),await _0x4f3c61();}),_0x22046a[_0x222f77(0x3ed)](_0x222f77(0x25b),async _0x5e33d6=>{_0x5e33d6['stopPropagation'](),await _0x4f3c61();}),_0x29a28b[_0x222f77(0x3ed)]('click',async _0x534d64=>{const _0x22a8f4=_0x222f77,_0x384631=_0x534d64['target'];if(_0x384631&&_0x384631['closest']){if(_0x384631[_0x22a8f4(0x184)]('.subtopics'))return;if(_0x384631['closest'](_0x22a8f4(0x3cd))||_0x384631[_0x22a8f4(0x184)](_0x22a8f4(0x160))||_0x384631[_0x22a8f4(0x184)]('button')||_0x384631[_0x22a8f4(0x184)]('input,select,textarea'))return;}await _0x4f3c61();});const _0x444c53=document[_0x222f77(0x407)](_0x222f77(0x2c8));_0x444c53['className']=_0x222f77(0x294)+(_0x1c6912?_0x222f77(0x1a3):''),_0x444c53[_0x222f77(0x12e)]['tid']=_0x82bd69['id'],_0x82bd69[_0x222f77(0x294)]['forEach'](_0x2a0faf=>{const _0x46930c=_0x222f77,_0x535852=document[_0x46930c(0x407)](_0x46930c(0x2c8));_0x535852[_0x46930c(0x23e)]=_0x46930c(0x313),_0x535852[_0x46930c(0x12e)][_0x46930c(0x2ef)]=_0x2a0faf['id'];const _0x3af5cf=document[_0x46930c(0x407)]('button');_0x3af5cf[_0x46930c(0x23e)]=_0x46930c(0x3ef),_0x3af5cf['textContent']='•\x20'+_0x2a0faf[_0x46930c(0x1a1)],_0x3af5cf[_0x46930c(0x12e)][_0x46930c(0x2ef)]=_0x2a0faf['id'],_0x3af5cf[_0x46930c(0x12e)][_0x46930c(0x1a6)]=_0x82bd69['id'];if(data[_0x46930c(0x3fb)]['selectedSubtopicId']===_0x2a0faf['id'])_0x3af5cf[_0x46930c(0x3a7)][_0x46930c(0x1ed)](_0x46930c(0x25c));const _0x360798=document[_0x46930c(0x407)](_0x46930c(0x2c8));_0x360798['className']='actions';const _0x5c135c=document[_0x46930c(0x407)](_0x46930c(0x2c8));_0x5c135c[_0x46930c(0x2a4)][_0x46930c(0x3b1)]='relative';const _0x41b4cc=document[_0x46930c(0x407)]('button');_0x41b4cc[_0x46930c(0x23e)]='btn\x20small\x20ghost\x20actions-menu-btn',_0x41b4cc[_0x46930c(0x32a)]=_0x46930c(0x28e),_0x41b4cc[_0x46930c(0x1b7)]=_0x46930c(0x432);const _0x4316d1=document[_0x46930c(0x407)](_0x46930c(0x2c8));_0x4316d1[_0x46930c(0x23e)]=_0x46930c(0x36d);const _0x410e49=document[_0x46930c(0x407)](_0x46930c(0x301));_0x410e49['className']=_0x46930c(0x370),_0x410e49[_0x46930c(0x32a)]=_0x46930c(0x24a);const _0x118b65=document[_0x46930c(0x407)](_0x46930c(0x301));_0x118b65[_0x46930c(0x23e)]=_0x46930c(0x26a),_0x118b65[_0x46930c(0x32a)]=_0x46930c(0x1e8),_0x4316d1[_0x46930c(0x37a)](_0x410e49,_0x118b65),_0x5c135c['append'](_0x41b4cc,_0x4316d1),_0x360798[_0x46930c(0x37a)](_0x5c135c),_0x535852[_0x46930c(0x37a)](_0x3af5cf,_0x360798),_0x444c53[_0x46930c(0x284)](_0x535852),_0x3af5cf[_0x46930c(0x3ed)](_0x46930c(0x25b),()=>selectSubtopic(_0x82bd69['id'],_0x2a0faf['id'])),_0x41b4cc[_0x46930c(0x3ed)](_0x46930c(0x25b),_0x26a97c=>{const _0x3e8e62=_0x46930c;_0x26a97c['stopPropagation']();const _0x477de1=_0x4316d1[_0x3e8e62(0x3a7)]['contains']('show');closeAllMenus(),_0x477de1?_0x29a28b['classList']['remove'](_0x3e8e62(0x343)):(_0x4316d1['classList'][_0x3e8e62(0x1ed)](_0x3e8e62(0x385)),_0x29a28b[_0x3e8e62(0x3a7)]['add'](_0x3e8e62(0x343)));}),_0x410e49['addEventListener']('click',()=>showInputModal(_0x46930c(0x26c),async _0x47a7fc=>{const _0x4c3bc8=_0x46930c;if(!_0x47a7fc)return;_0x2a0faf['name']=_0x47a7fc,await storageManager[_0x4c3bc8(0x1b2)]('subtopics',_0x2a0faf),renderAll();},_0x2a0faf[_0x46930c(0x1a1)])),_0x118b65[_0x46930c(0x3ed)](_0x46930c(0x25b),()=>showConfirmModal('Xác\x20nhận\x20xóa',_0x46930c(0x3cc)+_0x2a0faf[_0x46930c(0x1a1)]+_0x46930c(0x250),async _0x2d1901=>{const _0x535a99=_0x46930c;if(!_0x2d1901)return;_0x82bd69[_0x535a99(0x294)]=_0x82bd69[_0x535a99(0x294)][_0x535a99(0x203)](_0xa7e16d=>_0xa7e16d['id']!==_0x2a0faf['id']);const _0xedee13=data['settings'];_0xedee13[_0x535a99(0x363)]===_0x2a0faf['id']&&(_0xedee13[_0x535a99(0x363)]='',_0xedee13[_0x535a99(0x1ac)]='',ensureValidSelection()),await storageManager[_0x535a99(0x1fd)](_0x535a99(0x294),_0x2a0faf['id']),renderAll();}));}),_0x3ac76c[_0x222f77(0x3ed)]('click',_0x439f92=>{const _0xbf8e14=_0x222f77;_0x439f92['stopPropagation']();const _0x2a624a=_0x56816e[_0xbf8e14(0x3a7)][_0xbf8e14(0x214)]('show');closeAllMenus(),_0x2a624a?_0x29a28b[_0xbf8e14(0x3a7)][_0xbf8e14(0x299)](_0xbf8e14(0x343)):(_0x56816e['classList'][_0xbf8e14(0x1ed)]('show'),_0x29a28b[_0xbf8e14(0x3a7)]['add'](_0xbf8e14(0x343)));}),_0x439ad2[_0x222f77(0x3ed)](_0x222f77(0x25b),()=>showInputModal(_0x222f77(0x1ae),async _0x227567=>{const _0x28f45f=_0x222f77;if(!_0x227567)return;const _0x5c7894={'id':uid('s'),'topicId':_0x82bd69['id'],'name':_0x227567,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':_0x28f45f(0x150),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x82bd69[_0x28f45f(0x294)][_0x28f45f(0x19f)](_0x5c7894),await storageManager[_0x28f45f(0x1ed)](_0x28f45f(0x294),_0x5c7894),renderTopics();})),_0x34fa7a['addEventListener'](_0x222f77(0x25b),()=>showInputModal('Đổi\x20tên\x20Chủ\x20đề',async _0x5cd278=>{const _0x2fb259=_0x222f77;if(!_0x5cd278)return;_0x82bd69['name']=_0x5cd278,await storageManager[_0x2fb259(0x1b2)](_0x2fb259(0x220),_0x82bd69),renderTopics();},_0x82bd69[_0x222f77(0x1a1)])),_0x46a5d4[_0x222f77(0x3ed)]('click',()=>showConfirmModal(_0x222f77(0x217),_0x222f77(0x307)+_0x82bd69[_0x222f77(0x1a1)]+_0x222f77(0x1d4),async _0x7d9f8a=>{const _0x4dd025=_0x222f77;if(!_0x7d9f8a)return;data[_0x4dd025(0x220)]=data[_0x4dd025(0x220)][_0x4dd025(0x203)](_0x36e41a=>_0x36e41a['id']!==_0x82bd69['id']),delete _0x3aeaed[_0x82bd69['id']];data[_0x4dd025(0x3fb)][_0x4dd025(0x1ac)]===_0x82bd69['id']&&(data[_0x4dd025(0x3fb)]['selectedTopicId']='',data[_0x4dd025(0x3fb)][_0x4dd025(0x363)]='',ensureValidSelection());await storageManager[_0x4dd025(0x1fd)](_0x4dd025(0x220),_0x82bd69['id']);for(const _0x36ebcb of _0x82bd69['subtopics']){await storageManager[_0x4dd025(0x1fd)]('subtopics',_0x36ebcb['id']);}renderAll();})),_0x439ad2[_0x222f77(0x3ed)](_0x222f77(0x25b),_0xca0c16=>_0xca0c16['stopPropagation']()),_0x34fa7a[_0x222f77(0x3ed)](_0x222f77(0x25b),_0x5b08c3=>_0x5b08c3['stopPropagation']()),_0x46a5d4[_0x222f77(0x3ed)](_0x222f77(0x25b),_0x1ee1f4=>_0x1ee1f4[_0x222f77(0x264)]()),_0x29a28b[_0x222f77(0x37a)](_0x3872b9,_0x444c53),_0x297ec8['appendChild'](_0x29a28b);});if(window[_0x202c64(0x27d)]){const _0x35d0ec=document[_0x202c64(0x42e)](_0x202c64(0x29c));if(_0x35d0ec){if(_0x35d0ec['_sortable'])try{_0x35d0ec['_sortable'][_0x202c64(0x38d)]();}catch(_0x2658e4){}_0x35d0ec[_0x202c64(0x2e1)]=new Sortable(_0x35d0ec,{'animation':0x96,'draggable':'.topic-item','onEnd':async function(_0x5de5bb){const _0x512a3d=_0x202c64;if(_0x5de5bb[_0x512a3d(0x2ac)]===_0x5de5bb[_0x512a3d(0x1eb)])return;const _0x50aead=data[_0x512a3d(0x220)]['splice'](_0x5de5bb[_0x512a3d(0x2ac)],0x1)[0x0];data[_0x512a3d(0x220)]['splice'](_0x5de5bb[_0x512a3d(0x1eb)],0x0,_0x50aead),await saveData(),renderTopics();}}),_0x35d0ec[_0x202c64(0x43c)](_0x202c64(0x224))[_0x202c64(0x17a)](_0x3c1642=>{const _0x164f8a=_0x202c64;new Sortable(_0x3c1642,{'group':'subtopics-group','animation':0x96,'draggable':_0x164f8a(0x2d1),'onEnd':async function(_0x3cce21){const _0x4abaae=_0x164f8a,_0x42e506=_0x3cce21[_0x4abaae(0x18f)]?.[_0x4abaae(0x12e)]?.['tid']||_0x3cce21['from']?.[_0x4abaae(0x184)]('.topic-item')?.[_0x4abaae(0x12e)]?.['tid'],_0x3aa23f=_0x3cce21['to']?.[_0x4abaae(0x12e)]?.[_0x4abaae(0x1a6)]||_0x3cce21['to']?.[_0x4abaae(0x184)](_0x4abaae(0x3d1))?.[_0x4abaae(0x12e)]?.[_0x4abaae(0x1a6)],_0x30d4be=data[_0x4abaae(0x220)][_0x4abaae(0x164)](_0x39a64c=>_0x39a64c['id']===_0x42e506),_0x35e674=data[_0x4abaae(0x220)][_0x4abaae(0x164)](_0x181866=>_0x181866['id']===_0x3aa23f);if(!_0x30d4be||!_0x35e674)return;let _0x17599b=null;const _0x44b6c9=_0x3cce21[_0x4abaae(0x344)]?.[_0x4abaae(0x12e)]?.[_0x4abaae(0x2ef)]||_0x3cce21[_0x4abaae(0x344)]?.[_0x4abaae(0x273)]('.subtopic-btn')?.[_0x4abaae(0x12e)]?.[_0x4abaae(0x2ef)];if(_0x44b6c9){const _0x61ae08=_0x30d4be[_0x4abaae(0x294)][_0x4abaae(0x19e)](_0x380290=>_0x380290['id']===_0x44b6c9);if(_0x61ae08>=0x0)_0x17599b=_0x30d4be[_0x4abaae(0x294)]['splice'](_0x61ae08,0x1)[0x0];}!_0x17599b&&(_0x17599b=_0x30d4be['subtopics']['splice'](_0x3cce21[_0x4abaae(0x2ac)],0x1)[0x0]);if(!_0x17599b)return;_0x17599b['topicId']=_0x35e674['id'],_0x35e674[_0x4abaae(0x294)][_0x4abaae(0x2c1)](_0x3cce21['newIndex'],0x0,_0x17599b),data['settings']['selectedSubtopicId']===_0x17599b['id']&&(data['settings'][_0x4abaae(0x1ac)]=_0x35e674['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x10f3fe,_0x52eb17){const _0x8554cd=_0x2ebaf0,_0x1264a7=$(_0x8554cd(0x33d)),_0x5a3b34=getCurrentSubtopic();_0x5a3b34&&timer['state']!==_0x8554cd(0x150)&&(_0x5a3b34[_0x8554cd(0x3aa)]={'state':timer[_0x8554cd(0x3b4)],'prevState':timer['prevState'],'remaining':timer[_0x8554cd(0x333)],'segmentTotal':timer[_0x8554cd(0x411)],'cycleIndex':timer[_0x8554cd(0x22b)]}),_0x1264a7[_0x8554cd(0x3a7)][_0x8554cd(0x1ed)]('reloading'),setTimeout(async()=>{const _0x25ded9=_0x8554cd;data['settings']['selectedTopicId']=_0x10f3fe,data[_0x25ded9(0x3fb)][_0x25ded9(0x363)]=_0x52eb17;const _0xd2bd1d=getCurrentSubtopic();_0xd2bd1d[_0x25ded9(0x3aa)]?(timer[_0x25ded9(0x3b4)]=_0xd2bd1d['timerState'][_0x25ded9(0x3b4)],timer[_0x25ded9(0x1ff)]=_0xd2bd1d[_0x25ded9(0x3aa)]['prevState']||null,timer[_0x25ded9(0x333)]=_0xd2bd1d[_0x25ded9(0x3aa)][_0x25ded9(0x333)],timer[_0x25ded9(0x411)]=_0xd2bd1d[_0x25ded9(0x3aa)][_0x25ded9(0x411)],timer[_0x25ded9(0x22b)]=_0xd2bd1d[_0x25ded9(0x3aa)][_0x25ded9(0x22b)]):timer['reset'](),await saveData(),timer[_0x25ded9(0x26b)](),renderAll(),switchView(_0x25ded9(0x3cf)),_0x1264a7['classList']['remove'](_0x25ded9(0x41f));},0xc8);}function getCurrentSubtopic(){const _0x1fd923=_0x2ebaf0,_0x3f6676=data['settings'][_0x1fd923(0x1ac)],_0x39fd27=data[_0x1fd923(0x3fb)]['selectedSubtopicId'];if(!_0x3f6676||!_0x39fd27)return null;const _0x4d2200=data[_0x1fd923(0x220)][_0x1fd923(0x164)](_0x476466=>_0x476466['id']===_0x3f6676);if(!_0x4d2200)return null;return _0x4d2200['subtopics']['find'](_0x887c02=>_0x887c02['id']===_0x39fd27)||null;}function renderContextBadge(){const _0x263b15=_0x2ebaf0,_0x14b9c1=getCurrentSubtopic(),_0x1ebf46=_0x14b9c1?_0x14b9c1[_0x263b15(0x1a1)]:'(chưa\x20chọn)',_0x33ebbb=$(_0x263b15(0x399)),_0xacb828=$(_0x263b15(0x3dc)),_0x9ee8d3=$(_0x263b15(0x3db));if(_0x33ebbb)_0x33ebbb[_0x263b15(0x196)]=_0x14b9c1?_0x263b15(0x241)+_0x14b9c1['name']:_0x263b15(0x235);if(_0xacb828)_0xacb828[_0x263b15(0x196)]=_0x1ebf46;if(_0x9ee8d3)_0x9ee8d3['textContent']=_0x1ebf46;}function renderSubtopicTasks(){const _0x47ee61=_0x2ebaf0,_0xddf3a=getCurrentSubtopic(),_0x2caee1=$('#subtopicTasksList'),_0xd02d3c=$(_0x47ee61(0x144));if(!_0x2caee1||!_0xd02d3c)return;const _0x52b6e3=_0xd02d3c[_0x47ee61(0x3f6)];if(!_0xddf3a){_0x2caee1['innerHTML']=_0x47ee61(0x386),_0x52b6e3[_0x47ee61(0x3a7)][_0x47ee61(0x1ed)]('hidden');return;}_0x52b6e3[_0x47ee61(0x3a7)][_0x47ee61(0x299)](_0x47ee61(0x327)),_0x2caee1[_0x47ee61(0x32a)]='';const _0x589623=_0xddf3a[_0x47ee61(0x17e)]?_0xddf3a['tasks']['filter'](_0x403abb=>!_0x403abb[_0x47ee61(0x2e7)]):[];_0x589623[_0x47ee61(0x402)]===0x0&&(_0x2caee1[_0x47ee61(0x32a)]=_0x47ee61(0x228)),_0x589623['forEach'](_0x41f7fe=>{const _0x476741=_0x47ee61,_0x2946b5=document[_0x476741(0x407)]('li');_0x2946b5[_0x476741(0x32a)]=_0x476741(0x2ad)+_0x41f7fe['id']+_0x476741(0x31b)+_0x41f7fe['id']+'\x22>'+escapeHTML(_0x41f7fe[_0x476741(0x3b7)])+_0x476741(0x26e),_0x2946b5[_0x476741(0x273)](_0x476741(0x2e8))[_0x476741(0x3ed)]('change',_0x121479=>toggleSubtopicTask(_0x121479['target']['id'],_0x2946b5)),_0x2caee1[_0x476741(0x284)](_0x2946b5);});}async function addSubtopicTask(){const _0x3ff271=_0x2ebaf0,_0x98dd38=getCurrentSubtopic();if(!_0x98dd38){toast(t(_0x3ff271(0x1af)));return;}const _0x2a7cb9=$(_0x3ff271(0x144)),_0xe55000=_0x2a7cb9[_0x3ff271(0x2c3)]['trim']();if(_0xe55000){if(!_0x98dd38['tasks'])_0x98dd38[_0x3ff271(0x17e)]=[];_0x98dd38[_0x3ff271(0x17e)][_0x3ff271(0x19f)]({'id':uid('task'),'text':_0xe55000,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x2a7cb9['value']='';}_0x2a7cb9[_0x3ff271(0x205)]();}async function toggleSubtopicTask(_0x4c631d,_0x28b847){const _0x262496=_0x2ebaf0,_0x361d43=getCurrentSubtopic();if(!_0x361d43||!_0x361d43['tasks'])return;const _0x60f9f2=_0x361d43[_0x262496(0x17e)][_0x262496(0x164)](_0x2928f2=>_0x2928f2['id']===_0x4c631d);_0x60f9f2&&(_0x60f9f2['isCompleted']=!![],_0x361d43[_0x262496(0x125)][_0x262496(0x14c)]=(_0x361d43[_0x262496(0x125)][_0x262496(0x14c)]||0x0)+0x1,await saveData(),_0x28b847[_0x262496(0x3a7)][_0x262496(0x1ed)](_0x262496(0x3b3)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':_0x2ebaf0(0x150),'prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0x591a91,{silent:silent=![]}={}){const _0x25ede9=_0x2ebaf0,_0x48e73c=data[_0x25ede9(0x3fb)];this[_0x25ede9(0x23c)]=_0x591a91,this[_0x25ede9(0x26d)]=_0x591a91==='A'?_0x48e73c[_0x25ede9(0x1ca)]:_0x591a91==='B'?_0x48e73c[_0x25ede9(0x29e)]:0x0,_0x48e73c[_0x25ede9(0x2b3)]=_0x591a91,await saveData(),this[_0x25ede9(0x3b4)]===_0x25ede9(0x150)&&this[_0x25ede9(0x43d)]();},'currentDurations'(){const _0xa778c8=_0x2ebaf0,_0x2b4c2f=data['settings'][_0xa778c8(0x185)];if(this[_0xa778c8(0x23c)]==='A')return{'work':_0x2b4c2f[_0xa778c8(0x259)],'short':_0x2b4c2f['A_short'],'long':_0x2b4c2f[_0xa778c8(0x230)],'winddown':_0x2b4c2f['A_winddown']??0x0};if(this[_0xa778c8(0x23c)]==='B')return{'work':_0x2b4c2f[_0xa778c8(0x16a)],'short':_0x2b4c2f[_0xa778c8(0x32b)],'long':_0x2b4c2f['B_long'],'winddown':_0x2b4c2f[_0xa778c8(0x39b)]??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x321c00=_0x2ebaf0,_0x2894fe=data[_0x321c00(0x3fb)];if(this[_0x321c00(0x23c)]==='A')return{'cycles':_0x2894fe[_0x321c00(0x1ca)],'interval':_0x2894fe[_0x321c00(0x2da)]};if(this[_0x321c00(0x23c)]==='B')return{'cycles':_0x2894fe['cyclesB'],'interval':_0x2894fe[_0x321c00(0x11d)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x56e9d0=_0x2ebaf0,_0x502c18=$(_0x56e9d0(0x3e0)),_0x18c392=$(_0x56e9d0(0x17f)),_0x1641d4=$(_0x56e9d0(0x12b));if(!_0x502c18||!_0x18c392||!_0x1641d4)return;const _0x450dca=this['mode']==='C';$(_0x56e9d0(0x170))[_0x56e9d0(0x3a7)][_0x56e9d0(0x285)]('hidden',this[_0x56e9d0(0x3b4)]!=='idle'||_0x450dca&&this[_0x56e9d0(0x3b4)]===_0x56e9d0(0x216)),$(_0x56e9d0(0x163))[_0x56e9d0(0x3a7)]['toggle']('hidden',!(_0x450dca&&this[_0x56e9d0(0x3b4)]===_0x56e9d0(0x216))),$(_0x56e9d0(0x1e3))[_0x56e9d0(0x3a7)][_0x56e9d0(0x285)]('hidden',![_0x56e9d0(0x216),_0x56e9d0(0x177),_0x56e9d0(0x265)]['includes'](this[_0x56e9d0(0x3b4)])),$('#btnResume')['classList']['toggle'](_0x56e9d0(0x327),this['state']!==_0x56e9d0(0x16c));let _0x52f8d6=_0x56e9d0(0x114);if(this[_0x56e9d0(0x3b4)]===_0x56e9d0(0x216))_0x502c18[_0x56e9d0(0x196)]=_0x450dca?_0x56e9d0(0x291):_0x56e9d0(0x360),_0x502c18[_0x56e9d0(0x23e)]='badge\x20state\x20work',_0x52f8d6='var(--acc)';else{if(this[_0x56e9d0(0x3b4)]===_0x56e9d0(0x177))_0x502c18[_0x56e9d0(0x196)]='NGHỈ\x20NGẮN',_0x502c18[_0x56e9d0(0x23e)]=_0x56e9d0(0x3d7),_0x52f8d6='var(--warn)';else{if(this['state']===_0x56e9d0(0x265))_0x502c18['textContent']=_0x56e9d0(0x201),_0x502c18[_0x56e9d0(0x23e)]=_0x56e9d0(0x3f0),_0x52f8d6=_0x56e9d0(0x261);else{if(this['state']===_0x56e9d0(0x2a0)){_0x502c18[_0x56e9d0(0x196)]='HẠ\x20NHIỆT',_0x502c18[_0x56e9d0(0x23e)]='badge\x20state\x20work',_0x52f8d6=_0x56e9d0(0x2eb);try{$(_0x56e9d0(0x267))['classList'][_0x56e9d0(0x299)](_0x56e9d0(0x327)),$(_0x56e9d0(0x1bb))[_0x56e9d0(0x3a7)][_0x56e9d0(0x299)]('hidden');}catch(_0x7bb0d7){}}else this[_0x56e9d0(0x3b4)]===_0x56e9d0(0x16c)?(_0x502c18[_0x56e9d0(0x196)]=_0x56e9d0(0x11c),_0x502c18[_0x56e9d0(0x23e)]=_0x56e9d0(0x35c)):(_0x502c18[_0x56e9d0(0x196)]=_0x56e9d0(0x194),_0x502c18['className']='badge');}}}[_0x56e9d0(0x216),'break',_0x56e9d0(0x265),'wind_down']['includes'](this[_0x56e9d0(0x3b4)])?_0x1641d4[_0x56e9d0(0x3a7)][_0x56e9d0(0x1ed)](_0x56e9d0(0x398)):_0x1641d4[_0x56e9d0(0x3a7)][_0x56e9d0(0x299)]('breathing');_0x18c392[_0x56e9d0(0x2a4)][_0x56e9d0(0x410)]=_0x52f8d6,_0x1641d4[_0x56e9d0(0x3a7)][_0x56e9d0(0x299)]('finished');const _0x4c20d2=$('#timeDisplay');if(_0x4c20d2)_0x4c20d2['textContent']=formatMMSS(this[_0x56e9d0(0x333)]);const _0x1530ca=_0x18c392['r'][_0x56e9d0(0x367)]['value'],_0x143438=0x2*Math['PI']*_0x1530ca,_0x9e67d1=this[_0x56e9d0(0x411)]>0x0?_0x143438-this['remaining']/this[_0x56e9d0(0x411)]*_0x143438:_0x143438;_0x18c392[_0x56e9d0(0x2a4)][_0x56e9d0(0x227)]=_0x143438,_0x18c392['style']['strokeDashoffset']=isNaN(_0x9e67d1)?_0x143438:_0x9e67d1;const _0x59f5ba=$(_0x56e9d0(0x3f4));if(_0x59f5ba){const _0x33f4ab=this[_0x56e9d0(0x3f3)]();_0x59f5ba['textContent']=t('timer.cycleInfo',{'current':this[_0x56e9d0(0x22b)],'target':_0x33f4ab[_0x56e9d0(0x373)]}),_0x59f5ba[_0x56e9d0(0x3a7)][_0x56e9d0(0x285)](_0x56e9d0(0x327),_0x450dca);}const _0x154684=$(_0x56e9d0(0x322));_0x154684&&_0x154684[_0x56e9d0(0x3a7)][_0x56e9d0(0x285)](_0x56e9d0(0x327),_0x450dca&&this[_0x56e9d0(0x3b4)]===_0x56e9d0(0x216));const _0x4c3cf1=$(_0x56e9d0(0x192));if(_0x4c3cf1)_0x4c3cf1[_0x56e9d0(0x196)]=formatMMSS(this['remaining']);if(this[_0x56e9d0(0x3b4)]!==_0x56e9d0(0x2a0))try{$(_0x56e9d0(0x267))[_0x56e9d0(0x3a7)][_0x56e9d0(0x1ed)]('hidden'),$(_0x56e9d0(0x1bb))['classList']['add'](_0x56e9d0(0x327));}catch(_0x400771){}},'persistTimerState'(_0x19cfa5=![]){const _0x998f6c=_0x2ebaf0;try{const _0x42dc7c=getCurrentSubtopic();if(!_0x42dc7c)return;const _0x19725d={'state':this[_0x998f6c(0x3b4)],'prevState':this[_0x998f6c(0x1ff)],'remaining':this['remaining'],'segmentTotal':this[_0x998f6c(0x411)],'cycleIndex':this[_0x998f6c(0x22b)]};_0x42dc7c['timerState']=_0x19725d;try{localStorage[_0x998f6c(0x128)](_0x998f6c(0x278)+_0x42dc7c['id'],JSON[_0x998f6c(0x428)](_0x19725d));}catch(_0x1467ec){}this['lastPersist']=Date[_0x998f6c(0x142)]();}catch(_0x326130){}},'_startTick'(){const _0x19f40b=_0x2ebaf0;if(this[_0x19f40b(0x2d3)])clearInterval(this[_0x19f40b(0x2d3)]);if(this['mode']==='C'&&this[_0x19f40b(0x3b4)]===_0x19f40b(0x216)){this[_0x19f40b(0x2d3)]=setInterval(()=>{const _0x460cf6=_0x19f40b;this['remaining']+=0x1,this[_0x460cf6(0x26b)](),this[_0x460cf6(0x1d3)]();},0x3e8);return;}this['tickHandle']=setInterval(()=>{const _0x56d2c5=_0x19f40b;this[_0x56d2c5(0x333)]>0x0&&(this['remaining']-=0x1,this['updateUI'](),this[_0x56d2c5(0x1d3)]()),this['remaining']<=0x0&&(clearInterval(this['tickHandle']),this[_0x56d2c5(0x2d3)]=null,this[_0x56d2c5(0x1fe)]());},0x3e8);},'_onFinishSegment'(){const _0x4f7c4d=_0x2ebaf0;if(this[_0x4f7c4d(0x3b4)]===_0x4f7c4d(0x216)){const _0x59e919=getCurrentSubtopic();if(_0x59e919){const _0x3d05f1=this[_0x4f7c4d(0x408)]()[_0x4f7c4d(0x216)];_0x59e919[_0x4f7c4d(0x125)]['totalMinutes']=(_0x59e919['stats'][_0x4f7c4d(0x3d4)]||0x0)+_0x3d05f1,_0x59e919[_0x4f7c4d(0x125)]['sessionsCompleted']=(_0x59e919['stats'][_0x4f7c4d(0x3df)]||0x0)+0x1;const _0x3e81a={'id':uid('sess'),'dateISO':todayISO(),'durationMinutes':_0x3d05f1,'mode':this['mode'],'note':''};if(!_0x59e919[_0x4f7c4d(0x26f)])_0x59e919['sessions']=[];_0x59e919[_0x4f7c4d(0x26f)]['unshift'](_0x3e81a);if(data?.[_0x4f7c4d(0x3fb)]?.['enableSessionNotes']!==![])try{openNoteModal(_0x3e81a['id']);}catch(_0x26cc44){}saveData(),renderStatsHistory(),checkAndShowMilestones();}this[_0x4f7c4d(0x22b)]++;}if(typeof data!==_0x4f7c4d(0x15d)&&data&&data[_0x4f7c4d(0x3fb)]&&data[_0x4f7c4d(0x3fb)][_0x4f7c4d(0x2ab)]===![]&&this['state']===_0x4f7c4d(0x216))playSound('work_end');else(this[_0x4f7c4d(0x3b4)]===_0x4f7c4d(0x2a0)||this[_0x4f7c4d(0x3b4)]==='break'||this[_0x4f7c4d(0x3b4)]==='long_break')&&playSound(_0x4f7c4d(0x3a1));const _0x3ca0eb=$(_0x4f7c4d(0x12b));if(_0x3ca0eb)_0x3ca0eb['classList'][_0x4f7c4d(0x1ed)]('finished');if(data[_0x4f7c4d(0x3fb)][_0x4f7c4d(0x3ca)]){if(this[_0x4f7c4d(0x3b4)]===_0x4f7c4d(0x216))data[_0x4f7c4d(0x3fb)][_0x4f7c4d(0x2ab)]===![]?this[_0x4f7c4d(0x29a)]():this['beginWindDown']();else this[_0x4f7c4d(0x3b4)]===_0x4f7c4d(0x2a0)?this[_0x4f7c4d(0x29a)]():this[_0x4f7c4d(0x257)]();}else this['tickHandle']&&(clearInterval(this[_0x4f7c4d(0x2d3)]),this[_0x4f7c4d(0x2d3)]=null),this[_0x4f7c4d(0x3b4)]='idle',this[_0x4f7c4d(0x1ff)]=null,this[_0x4f7c4d(0x26b)](),toast(_0x4f7c4d(0x42a));},'beginWindDown'(){const _0x107355=_0x2ebaf0;if(data?.[_0x107355(0x3fb)]?.[_0x107355(0x2ab)]===![]){this['beginBreak']();return;}this['prevState']=this[_0x107355(0x3b4)],this[_0x107355(0x3b4)]='wind_down';const _0x1292fc=(this['currentDurations']()[_0x107355(0x234)]||0x0)*0x3c;if(_0x1292fc<=0x0){this[_0x107355(0x29a)]();return;}this['segmentTotal']=_0x1292fc,this[_0x107355(0x333)]=_0x1292fc;try{playSound(_0x107355(0x3a1));}catch(_0x241436){}try{toast(_0x107355(0x1bd));}catch(_0x2adbd4){}this['_startTick'](),this[_0x107355(0x26b)]();},'beginWork'(){const _0x227631=_0x2ebaf0;this[_0x227631(0x1ff)]=this[_0x227631(0x3b4)],this[_0x227631(0x3b4)]=_0x227631(0x216);if(this[_0x227631(0x23c)]==='C'){this[_0x227631(0x411)]=0x0;if(this[_0x227631(0x1ff)]!==_0x227631(0x16c))this['remaining']=0x0;}else{const _0xe8a814=this['currentDurations']()[_0x227631(0x216)]*0x3c;this[_0x227631(0x411)]=_0xe8a814;if(this[_0x227631(0x1ff)]!==_0x227631(0x16c))this['remaining']=_0xe8a814;}const _0x2e108b=$(_0x227631(0x322));_0x2e108b&&(_0x2e108b[_0x227631(0x196)]=''),this[_0x227631(0x1f2)](),this[_0x227631(0x26b)]();},'finishFlowSession'(){const _0x33fdd9=_0x2ebaf0;if(this[_0x33fdd9(0x23c)]!=='C'||this[_0x33fdd9(0x3b4)]!==_0x33fdd9(0x216))return;this[_0x33fdd9(0x2d3)]&&(clearInterval(this['tickHandle']),this['tickHandle']=null);const _0x585087=Math[_0x33fdd9(0x12c)](0x1,parseInt(data[_0x33fdd9(0x3fb)]['flowtimeBreakRatio']??0x5,0xa)),_0x5ee46f=Math['max'](0x0,this[_0x33fdd9(0x333)]|0x0),_0x570680=Math[_0x33fdd9(0x12c)](0x3c,Math[_0x33fdd9(0x1a9)](_0x5ee46f/_0x585087));try{const _0x4a69f9=getCurrentSubtopic();if(_0x4a69f9){const _0x50ad7e=Math[_0x33fdd9(0x12c)](0x1,Math[_0x33fdd9(0x1f8)](_0x5ee46f/0x3c));_0x4a69f9[_0x33fdd9(0x125)][_0x33fdd9(0x3d4)]=(_0x4a69f9[_0x33fdd9(0x125)]['totalMinutes']||0x0)+_0x50ad7e,_0x4a69f9['stats'][_0x33fdd9(0x3df)]=(_0x4a69f9[_0x33fdd9(0x125)][_0x33fdd9(0x3df)]||0x0)+0x1;const _0x15a811={'id':uid(_0x33fdd9(0x1aa)),'dateISO':todayISO(),'durationMinutes':_0x50ad7e,'mode':this[_0x33fdd9(0x23c)],'note':''};if(!_0x4a69f9['sessions'])_0x4a69f9['sessions']=[];_0x4a69f9[_0x33fdd9(0x26f)]['unshift'](_0x15a811),saveData(),renderStatsHistory(),data?.[_0x33fdd9(0x3fb)]?.['enableSessionNotes']!==![]&&openNoteModal(_0x15a811['id']);}}catch(_0x4085f4){}this[_0x33fdd9(0x3b4)]=_0x33fdd9(0x177),this[_0x33fdd9(0x411)]=_0x570680,this[_0x33fdd9(0x333)]=_0x570680,this['_startTick'](),this[_0x33fdd9(0x26b)](),this[_0x33fdd9(0x1d3)](!![]);try{toast(_0x33fdd9(0x389)+Math['round'](_0x570680/0x3c)+'\x20phút\x20theo\x20Flowtime\x20('+_0x585087+').');}catch(_0x39ea30){}},'beginBreak'(){const _0x5abb4b=_0x2ebaf0;this['prevState']=this[_0x5abb4b(0x3b4)];const _0x593d4c=this['currentConfig'](),_0x222379=this[_0x5abb4b(0x408)]();if(this['cycleIndex']>0x0&&this['cycleIndex']%_0x593d4c[_0x5abb4b(0x198)]===0x0){this['state']=_0x5abb4b(0x265);const _0x15d1a3=_0x222379['long']*0x3c;this[_0x5abb4b(0x411)]=_0x15d1a3;if(this[_0x5abb4b(0x1ff)]!==_0x5abb4b(0x16c))this[_0x5abb4b(0x333)]=_0x15d1a3;toast('Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.');}else{this['state']=_0x5abb4b(0x177);const _0x444026=_0x222379['short']*0x3c;this[_0x5abb4b(0x411)]=_0x444026;if(this[_0x5abb4b(0x1ff)]!=='paused')this['remaining']=_0x444026;}const _0x3f5cf6=$('#breakSuggestionDisplay');if(_0x3f5cf6){const _0x2bf3dc=Math[_0x5abb4b(0x1a9)](Math['random']()*breakSuggestions['length']);_0x3f5cf6['textContent']='💡\x20Gợi\x20ý:\x20'+breakSuggestions[_0x2bf3dc];}this['_startTick'](),this[_0x5abb4b(0x26b)]();},async 'start'(){const _0x44dfda=_0x2ebaf0;if(!getCurrentSubtopic()){toast('Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu');return;}ensureAudio();if(this[_0x44dfda(0x23c)]==='C'&&this[_0x44dfda(0x3b4)]==='idle')this[_0x44dfda(0x3b4)]=_0x44dfda(0x216),this['remaining']=0x0,this[_0x44dfda(0x411)]=0x0,this[_0x44dfda(0x22b)]=0x0,this[_0x44dfda(0x1f2)](),this[_0x44dfda(0x26b)]();else{if(this['state']===_0x44dfda(0x150))this['cycleIndex']=this[_0x44dfda(0x22b)]||0x0,this[_0x44dfda(0x257)]();else this[_0x44dfda(0x3b4)]===_0x44dfda(0x16c)&&this[_0x44dfda(0x420)]();}await this[_0x44dfda(0x1d3)](!![]);},async 'pause'(){const _0x1abf01=_0x2ebaf0;this[_0x1abf01(0x2d3)]&&(clearInterval(this[_0x1abf01(0x2d3)]),this[_0x1abf01(0x2d3)]=null),this[_0x1abf01(0x1ff)]=this['state'],this[_0x1abf01(0x3b4)]=_0x1abf01(0x16c),this['updateUI'](),await this[_0x1abf01(0x1d3)](!![]);},async 'resume'(){const _0x5282ca=_0x2ebaf0;if(this['state']!=='paused')return;this['state']=this[_0x5282ca(0x1ff)]||_0x5282ca(0x216),this[_0x5282ca(0x1f2)](),this['updateUI'](),await this[_0x5282ca(0x1d3)](!![]);},async 'skip'(){const _0x5f41da=_0x2ebaf0;if(this[_0x5f41da(0x23c)]==='C'&&this['state']==='work'){this[_0x5f41da(0x2dc)](),await this['persistTimerState'](!![]);return;}this['state']===_0x5f41da(0x216)?(this[_0x5f41da(0x2d3)]&&(clearInterval(this[_0x5f41da(0x2d3)]),this[_0x5f41da(0x2d3)]=null),this[_0x5f41da(0x333)]=0x0,this[_0x5f41da(0x1fe)]()):(this[_0x5f41da(0x333)]=0x0,this[_0x5f41da(0x2d3)]&&(clearInterval(this['tickHandle']),this[_0x5f41da(0x2d3)]=null),this[_0x5f41da(0x1fe)]()),await this[_0x5f41da(0x1d3)](!![]);},async 'reset'(){const _0x19535d=_0x2ebaf0;this['tickHandle']&&(clearInterval(this[_0x19535d(0x2d3)]),this[_0x19535d(0x2d3)]=null);this['state']=_0x19535d(0x150),this[_0x19535d(0x1ff)]=null,this[_0x19535d(0x333)]=0x0,this[_0x19535d(0x411)]=0x0,this[_0x19535d(0x22b)]=0x0;const _0x1a6f27=$(_0x19535d(0x322));_0x1a6f27&&(_0x1a6f27[_0x19535d(0x196)]=''),this[_0x19535d(0x26b)](),await this['persistTimerState'](!![]);}};async function deleteSummary(_0x1a2833){showConfirmModal('Xác\x20nhận\x20xóa','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?',async _0xb5a775=>{const _0xc24c4b=_0x5e48;if(!_0xb5a775)return;const _0x49cb89=getCurrentSubtopic();if(!_0x49cb89||!_0x49cb89[_0xc24c4b(0x387)])return;const _0x50a10e=[..._0x49cb89[_0xc24c4b(0x387)]];_0x49cb89[_0xc24c4b(0x387)]=_0x49cb89['summaries'][_0xc24c4b(0x203)](_0x4be762=>_0x4be762['id']!==_0x1a2833);try{await storageManager[_0xc24c4b(0x1b2)](_0xc24c4b(0x294),_0x49cb89),renderSummaries(),toast(_0xc24c4b(0x13c));}catch(_0x1d117c){console[_0xc24c4b(0x143)](_0xc24c4b(0x415),_0x1d117c),_0x49cb89[_0xc24c4b(0x387)]=_0x50a10e,toast(_0xc24c4b(0x318));}});}function exportSummary(_0x2be5e8){const _0xfe6762=_0x2ebaf0,_0x184385=new Blob([_0x2be5e8[_0xfe6762(0x331)]],{'type':_0xfe6762(0x153)}),_0x493f6e=document[_0xfe6762(0x407)]('a'),_0x5d14fb=new Date(_0x2be5e8[_0xfe6762(0x354)]),_0x426ab8=_0x3df072=>(''+_0x3df072)[_0xfe6762(0x2d7)](0x2,'0');_0x493f6e[_0xfe6762(0x317)]=URL[_0xfe6762(0x21a)](_0x184385),_0x493f6e[_0xfe6762(0x2c4)]=_0xfe6762(0x434)+_0x5d14fb['getFullYear']()+_0x426ab8(_0x5d14fb[_0xfe6762(0x282)]()+0x1)+_0x426ab8(_0x5d14fb['getDate']())+_0xfe6762(0x167),_0x493f6e[_0xfe6762(0x25b)](),URL['revokeObjectURL'](_0x493f6e['href']);}function renderStatsHistory(){const _0x583187=_0x2ebaf0,_0x53b893=getCurrentSubtopic(),_0xd8c360=$(_0x583187(0x3bd)),_0x53bdfe=$(_0x583187(0x38c)),_0x1e7ed9=$(_0x583187(0x36c)),_0x2d9c14=$(_0x583187(0x37c));if(!_0xd8c360||!_0x53bdfe||!_0x1e7ed9||!_0x2d9c14)return;if(!_0x53b893){_0xd8c360[_0x583187(0x196)]=_0x583187(0x409),_0x53bdfe['textContent']='0',_0x1e7ed9[_0x583187(0x196)]='0',_0x2d9c14[_0x583187(0x32a)]=_0x583187(0x2c9);return;}const _0x1cbaaf=_0x53b893[_0x583187(0x125)]&&_0x53b893[_0x583187(0x125)]['totalMinutes']?_0x53b893[_0x583187(0x125)][_0x583187(0x3d4)]:0x0,_0x311408=_0x53b893['stats']&&_0x53b893[_0x583187(0x125)][_0x583187(0x3df)]?_0x53b893[_0x583187(0x125)][_0x583187(0x3df)]:0x0,_0x28e7aa=_0x53b893[_0x583187(0x17e)]?_0x53b893['tasks']['filter'](_0x236f47=>_0x236f47['isCompleted'])[_0x583187(0x402)]:0x0;_0xd8c360[_0x583187(0x196)]=formatDaysHoursMinutes(_0x1cbaaf),_0x53bdfe[_0x583187(0x196)]=String(_0x311408),_0x1e7ed9['textContent']=String(_0x28e7aa),_0x2d9c14[_0x583187(0x32a)]='';const _0x9be89=Array['isArray'](_0x53b893[_0x583187(0x26f)])?_0x53b893['sessions']:[];if(_0x9be89[_0x583187(0x402)]===0x0){_0x2d9c14['innerHTML']=_0x583187(0x337);return;}_0x9be89[_0x583187(0x17a)](_0x4ca8a8=>{const _0x11d18a=_0x583187,_0x12ee9b=document['createElement'](_0x11d18a(0x2c8));_0x12ee9b['className']='hist-item';const _0x1d31c5=document[_0x11d18a(0x407)]('div'),_0x1de460=_0x4ca8a8['dateISO']?new Date(_0x4ca8a8[_0x11d18a(0x3e8)]):new Date(),_0x5e4ee3=_0x4ca8a8[_0x11d18a(0x336)]!=null?_0x4ca8a8[_0x11d18a(0x336)]:_0x4ca8a8[_0x11d18a(0x3e7)]||0x0,_0x22b5d7=_0x11d18a(0x256)+_0x1de460['toLocaleString']()+_0x11d18a(0x29f)+_0x5e4ee3+_0x11d18a(0x3d3)+(_0x4ca8a8['mode']||'')+_0x11d18a(0x30e);let _0x64db5b='';if(_0x4ca8a8[_0x11d18a(0x348)])_0x64db5b=_0x11d18a(0x390)+escapeHTML(_0x4ca8a8[_0x11d18a(0x348)])+_0x11d18a(0x30e);else data?.['settings']?.[_0x11d18a(0x2ce)]!==![]&&(_0x64db5b=_0x11d18a(0x3d5));_0x1d31c5[_0x11d18a(0x32a)]=_0x22b5d7+_0x64db5b,_0x12ee9b[_0x11d18a(0x284)](_0x1d31c5),_0x2d9c14[_0x11d18a(0x284)](_0x12ee9b);});}function renderGeneralNotes(){const _0x4e011c=_0x2ebaf0,_0xb544b3=$(_0x4e011c(0x362));if(!_0xb544b3)return;const _0x5b1f49=getCurrentSubtopic();if(!_0x5b1f49){_0xb544b3[_0x4e011c(0x32a)]=_0x4e011c(0x292);return;}_0x5b1f49[_0x4e011c(0x2c0)]=_0x5b1f49['generalNotes']||[];if(_0x5b1f49[_0x4e011c(0x2c0)][_0x4e011c(0x402)]===0x0){_0xb544b3[_0x4e011c(0x32a)]=_0x4e011c(0x3dd);return;}_0xb544b3[_0x4e011c(0x32a)]='',_0x5b1f49[_0x4e011c(0x2c0)][_0x4e011c(0x17a)](_0x177900=>{const _0x59dcb6=_0x4e011c,_0x3956fb=document[_0x59dcb6(0x407)](_0x59dcb6(0x2c8));_0x3956fb[_0x59dcb6(0x23e)]=_0x59dcb6(0x166);const _0x10b893=document[_0x59dcb6(0x407)](_0x59dcb6(0x2c8));_0x10b893[_0x59dcb6(0x23e)]=_0x59dcb6(0x179),_0x10b893[_0x59dcb6(0x196)]=typeof _0x177900==='string'?_0x177900:_0x177900[_0x59dcb6(0x3b7)]||'';const _0x1f7214=document[_0x59dcb6(0x407)](_0x59dcb6(0x2c8));_0x1f7214[_0x59dcb6(0x23e)]=_0x59dcb6(0x1a7),_0x1f7214[_0x59dcb6(0x196)]=_0x177900['createdAt']?new Date(_0x177900[_0x59dcb6(0x354)])[_0x59dcb6(0x341)]():'';const _0x2552bf=document['createElement']('div'),_0x1e7a7d=document['createElement'](_0x59dcb6(0x301));_0x1e7a7d[_0x59dcb6(0x23e)]=_0x59dcb6(0x1db),_0x1e7a7d[_0x59dcb6(0x196)]=_0x59dcb6(0x1ea),_0x1e7a7d[_0x59dcb6(0x139)]=async _0x3d771a=>{const _0x988a66=_0x59dcb6;_0x3d771a['stopPropagation']();const _0x2f02c0=getCurrentSubtopic();if(!_0x2f02c0)return;_0x2f02c0[_0x988a66(0x2c0)]=(_0x2f02c0[_0x988a66(0x2c0)]||[])[_0x988a66(0x203)](_0x111fd7=>(_0x111fd7['id']||_0x111fd7)!==(_0x177900['id']||_0x177900)),await saveData(),renderGeneralNotes();},_0x2552bf[_0x59dcb6(0x284)](_0x1e7a7d);const _0x14c7d8=document[_0x59dcb6(0x407)](_0x59dcb6(0x2c8));_0x14c7d8['className']='note-content-wrapper',_0x14c7d8[_0x59dcb6(0x37a)](_0x10b893,_0x1f7214),_0x3956fb[_0x59dcb6(0x37a)](_0x14c7d8,_0x2552bf),_0xb544b3[_0x59dcb6(0x284)](_0x3956fb);});}function renderMethods(){const _0x18bd9b=_0x2ebaf0,_0x4d9a69=document[_0x18bd9b(0x273)](_0x18bd9b(0x195));if(!_0x4d9a69)return;_0x4d9a69[_0x18bd9b(0x32a)]='';const _0x122f1d=data?.[_0x18bd9b(0x3fb)]?.[_0x18bd9b(0x2ea)]||[];if(_0x122f1d[_0x18bd9b(0x402)]===0x0){_0x4d9a69[_0x18bd9b(0x32a)]=_0x18bd9b(0x1f6);return;}_0x122f1d[_0x18bd9b(0x17a)](_0x2bd174=>{const _0x8a798a=_0x18bd9b,_0x407a16=document[_0x8a798a(0x407)](_0x8a798a(0x189));_0x407a16['className']='method-item',_0x407a16[_0x8a798a(0x12e)][_0x8a798a(0x406)]=_0x2bd174['id'];const _0x299a75=document[_0x8a798a(0x407)]('summary'),_0x123c19=document[_0x8a798a(0x407)]('span');_0x123c19[_0x8a798a(0x23e)]=_0x8a798a(0x18d),_0x123c19['textContent']=_0x2bd174[_0x8a798a(0x1b7)]||_0x8a798a(0x3cb),_0x123c19['addEventListener'](_0x8a798a(0x25b),_0x486765=>{const _0x4261fa=_0x8a798a;_0x486765[_0x4261fa(0x3c0)](),_0x486765[_0x4261fa(0x264)](),_0x407a16[_0x4261fa(0x34b)]=!_0x407a16[_0x4261fa(0x34b)];});const _0x2b4f95=document[_0x8a798a(0x407)]('div');_0x2b4f95[_0x8a798a(0x23e)]=_0x8a798a(0x21e);const _0x220d95=document[_0x8a798a(0x407)](_0x8a798a(0x301));_0x220d95[_0x8a798a(0x23e)]='btn\x20small\x20ghost\x20method-edit',_0x220d95[_0x8a798a(0x196)]=_0x8a798a(0x231),_0x220d95[_0x8a798a(0x12e)]['id']=_0x2bd174['id'];const _0x2e21be=document[_0x8a798a(0x407)](_0x8a798a(0x301));_0x2e21be[_0x8a798a(0x23e)]='btn\x20small\x20danger\x20method-delete',_0x2e21be[_0x8a798a(0x196)]=_0x8a798a(0x1ea),_0x2e21be['dataset']['id']=_0x2bd174['id'],_0x2b4f95[_0x8a798a(0x37a)](_0x220d95,_0x2e21be),_0x299a75[_0x8a798a(0x37a)](_0x123c19,_0x2b4f95);const _0x552f9e=document['createElement'](_0x8a798a(0x2c8));_0x552f9e[_0x8a798a(0x23e)]=_0x8a798a(0x40a),_0x552f9e[_0x8a798a(0x32a)]=_0x2bd174[_0x8a798a(0x331)]||'',_0x407a16['append'](_0x299a75,_0x552f9e),_0x4d9a69[_0x8a798a(0x284)](_0x407a16),_0x407a16[_0x8a798a(0x3ed)](_0x8a798a(0x25b),_0x444406=>{const _0x2ab8d8=_0x8a798a,_0x842b5e=_0x444406[_0x2ab8d8(0x23a)];if(!_0x842b5e)return;if(_0x842b5e[_0x2ab8d8(0x184)](_0x2ab8d8(0x301))||_0x842b5e['closest']('a')||_0x842b5e['closest'](_0x2ab8d8(0x41d))||_0x842b5e[_0x2ab8d8(0x184)]('.color-palette'))return;if(!_0x407a16[_0x2ab8d8(0x34b)])_0x407a16[_0x2ab8d8(0x34b)]=!![];});});const _0x388ff4=_0x4d9a69[_0x18bd9b(0x43c)]('.method-item');_0x388ff4[_0x18bd9b(0x17a)](_0x40f2f7=>{const _0x13c233=_0x18bd9b;_0x40f2f7[_0x13c233(0x3ed)](_0x13c233(0x285),()=>{const _0x470fcb=_0x13c233;_0x40f2f7['open']&&_0x388ff4[_0x470fcb(0x17a)](_0x38112d=>{if(_0x38112d!==_0x40f2f7)_0x38112d['open']=![];});});});}function addGeneralNote(){const _0x221a2f=_0x2ebaf0;showInputModal(_0x221a2f(0x2fc),async _0x50bff1=>{const _0x44105c=_0x221a2f;if(!_0x50bff1)return;const _0x5c5a32=getCurrentSubtopic();if(!_0x5c5a32){toast(_0x44105c(0x31f));return;}_0x5c5a32['generalNotes']=_0x5c5a32['generalNotes']||[],_0x5c5a32[_0x44105c(0x2c0)]['unshift']({'id':uid('gn'),'text':_0x50bff1,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0x401835=_0x2ebaf0,_0xa54fae=getCurrentSubtopic();if(!_0xa54fae){toast(_0x401835(0x42d));return;}const _0x17f740=(_0xa54fae[_0x401835(0x2c0)]||[])[_0x401835(0x3f7)](_0x22567e=>typeof _0x22567e===_0x401835(0x3da)?_0x22567e:_0x22567e[_0x401835(0x3b7)]||'')[_0x401835(0x203)](Boolean);if(_0x17f740[_0x401835(0x402)]===0x0){toast(_0x401835(0x146));return;}const _0x39684e=$(_0x401835(0x377));_0x39684e&&(_0x39684e[_0x401835(0x374)]=!![],_0x39684e[_0x401835(0x32a)]=_0x401835(0x427));try{const _0x2b2bed=_0x401835(0x308)+_0x17f740['join'](_0x401835(0x14e)),_0x3b9ae5=await callGeminiAPI(_0x2b2bed);if(!_0xa54fae['summaries'])_0xa54fae[_0x401835(0x387)]=[];_0xa54fae[_0x401835(0x387)][_0x401835(0x1e2)]({'id':uid('sum'),'content':_0x3b9ae5||_0x401835(0x40f),'createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x35c632){console[_0x401835(0x143)](_0x35c632),toast('Tóm\x20tắt\x20thất\x20bại.');}finally{_0x39684e&&(_0x39684e['disabled']=![],_0x39684e[_0x401835(0x196)]=_0x401835(0x424));}}function renderSummaries(){const _0xa2419d=_0x2ebaf0,_0x18e9c6=$(_0xa2419d(0x37b));if(!_0x18e9c6)return;const _0x25538b=getCurrentSubtopic();if(!_0x25538b){_0x18e9c6[_0xa2419d(0x32a)]=_0xa2419d(0x158);return;}_0x18e9c6[_0xa2419d(0x32a)]='';if(!_0x25538b[_0xa2419d(0x387)]||_0x25538b['summaries'][_0xa2419d(0x402)]===0x0){_0x18e9c6[_0xa2419d(0x32a)]=_0xa2419d(0x207);return;}_0x25538b[_0xa2419d(0x387)][_0xa2419d(0x17a)](_0x5c1ab0=>{const _0x55bb97=_0xa2419d,_0x468e4c=document['createElement'](_0x55bb97(0x2c8));_0x468e4c['className']=_0x55bb97(0x166);const _0x72ac45=document[_0x55bb97(0x407)](_0x55bb97(0x2c8));_0x72ac45[_0x55bb97(0x23e)]=_0x55bb97(0x17d);const _0x37f1da=document[_0x55bb97(0x407)](_0x55bb97(0x2c8));_0x37f1da[_0x55bb97(0x23e)]='note-content',_0x37f1da[_0x55bb97(0x196)]=_0x5c1ab0[_0x55bb97(0x331)];const _0x1236ae=document[_0x55bb97(0x407)](_0x55bb97(0x2c8));_0x1236ae[_0x55bb97(0x23e)]=_0x55bb97(0x1a7),_0x1236ae[_0x55bb97(0x196)]=new Date(_0x5c1ab0[_0x55bb97(0x354)])[_0x55bb97(0x341)](),_0x72ac45['append'](_0x37f1da,_0x1236ae);const _0x5f105f=document['createElement'](_0x55bb97(0x2c8)),_0x51f002=document[_0x55bb97(0x407)]('button');_0x51f002['className']=_0x55bb97(0x2aa),_0x51f002[_0x55bb97(0x196)]=_0x55bb97(0x2a2),_0x51f002[_0x55bb97(0x139)]=_0x528786=>{const _0x300f27=_0x55bb97;_0x528786[_0x300f27(0x264)](),exportSummary(_0x5c1ab0);};const _0x55667f=document[_0x55bb97(0x407)](_0x55bb97(0x301));_0x55667f[_0x55bb97(0x23e)]=_0x55bb97(0x1db),_0x55667f[_0x55bb97(0x196)]=_0x55bb97(0x1ea),_0x55667f['onclick']=_0x2aac5b=>{const _0x5af89f=_0x55bb97;_0x2aac5b[_0x5af89f(0x264)](),deleteSummary(_0x5c1ab0['id']);},_0x5f105f[_0x55bb97(0x37a)](_0x51f002,_0x55667f),_0x468e4c['append'](_0x72ac45,_0x5f105f),_0x468e4c[_0x55bb97(0x3ed)](_0x55bb97(0x25b),()=>_0x37f1da[_0x55bb97(0x3a7)][_0x55bb97(0x285)](_0x55bb97(0x412))),_0x18e9c6[_0x55bb97(0x284)](_0x468e4c);});}function loadEditingPresetFields(){const _0x3c75d7=_0x2ebaf0,_0x45f290=data['settings'],_0x51de90=_0x45f290[_0x3c75d7(0x185)],_0x1c10e0=$(_0x3c75d7(0x384)),_0x4caaa9=$(_0x3c75d7(0x324));if(_0x1c10e0&&_0x4caaa9){const _0x366c24=editingPreset==='C';_0x1c10e0[_0x3c75d7(0x3a7)][_0x3c75d7(0x285)](_0x3c75d7(0x327),_0x366c24),_0x4caaa9['classList']['toggle'](_0x3c75d7(0x327),!_0x366c24);}if(editingPreset==='A'){$('#set_work')[_0x3c75d7(0x2c3)]=_0x51de90['A_work'];if($(_0x3c75d7(0x36a)))$('#set_winddown')[_0x3c75d7(0x2c3)]=_0x51de90[_0x3c75d7(0x2b8)]??0x0;$(_0x3c75d7(0x320))[_0x3c75d7(0x2c3)]=_0x51de90['A_short'],$('#set_long')['value']=_0x51de90[_0x3c75d7(0x230)],$(_0x3c75d7(0x2ee))[_0x3c75d7(0x2c3)]=_0x45f290[_0x3c75d7(0x1ca)],$('#set_interval')['value']=_0x45f290[_0x3c75d7(0x2da)];}else{if(editingPreset==='B'){$(_0x3c75d7(0x40c))['value']=_0x51de90[_0x3c75d7(0x16a)];if($(_0x3c75d7(0x36a)))$(_0x3c75d7(0x36a))[_0x3c75d7(0x2c3)]=_0x51de90['B_winddown']??0x0;$(_0x3c75d7(0x320))['value']=_0x51de90[_0x3c75d7(0x32b)],$(_0x3c75d7(0x312))[_0x3c75d7(0x2c3)]=_0x51de90[_0x3c75d7(0x219)],$(_0x3c75d7(0x2ee))['value']=_0x45f290['cyclesB'],$('#set_interval')[_0x3c75d7(0x2c3)]=_0x45f290[_0x3c75d7(0x11d)];}else{if(editingPreset==='C'){const _0x2ef81e=$('#set_flowRatio');if(_0x2ef81e)_0x2ef81e[_0x3c75d7(0x2c3)]=_0x45f290[_0x3c75d7(0x156)]??0x5;}}}}function highlightPresetSelector(){const _0x5c75e4=_0x2ebaf0;$$(_0x5c75e4(0x271))[_0x5c75e4(0x17a)](_0x31e946=>{const _0x5e1445=_0x5c75e4,_0x301e7c=_0x31e946[_0x5e1445(0x12e)][_0x5e1445(0x3d6)]===editingPreset;_0x31e946[_0x5e1445(0x3a7)]['toggle'](_0x5e1445(0x28a),_0x301e7c),_0x31e946[_0x5e1445(0x3a7)][_0x5e1445(0x285)](_0x5e1445(0x414),!_0x301e7c);});}function openSettings(){const _0x3f9c29=_0x2ebaf0,_0x20f50c=data[_0x3f9c29(0x3fb)];editingPreset=_0x20f50c[_0x3f9c29(0x2b3)],$('#set_apiKey')[_0x3f9c29(0x2c3)]=_0x20f50c['apiKey']||'',loadEditingPresetFields(),highlightPresetSelector(),$(_0x3f9c29(0x1c5))['value']=_0x20f50c['volume']??0.8,$(_0x3f9c29(0x37d))['value']=_0x20f50c[_0x3f9c29(0x19b)]||_0x3f9c29(0x147),$(_0x3f9c29(0x24b))['value']=_0x20f50c['theme']||_0x3f9c29(0x332);const _0x45bd6b=getActiveYoutubeUrl();$(_0x3f9c29(0x1a4))[_0x3f9c29(0x2c3)]=_0x45bd6b||'';const _0x1fec43=extractYouTubeID(_0x45bd6b);$(_0x3f9c29(0x18e))['disabled']=!_0x1fec43;$(_0x3f9c29(0x2fb))&&($(_0x3f9c29(0x2fb))[_0x3f9c29(0x196)]='');$(_0x3f9c29(0x19a))[_0x3f9c29(0x2c3)]=_0x20f50c[_0x3f9c29(0x365)]||0x50,$(_0x3f9c29(0x2f0))['checked']=!!_0x20f50c[_0x3f9c29(0x38f)],$(_0x3f9c29(0x181))['value']=_0x20f50c['panelOpacity']||0.85;$(_0x3f9c29(0x3de))&&($(_0x3f9c29(0x3de))['value']=_0x20f50c[_0x3f9c29(0x28f)]||_0x3f9c29(0x364));$(_0x3f9c29(0x381))&&($(_0x3f9c29(0x381))[_0x3f9c29(0x2f7)]=!!_0x20f50c[_0x3f9c29(0x3ca)]);$(_0x3f9c29(0x193))&&($('#set_enableWinddown')[_0x3f9c29(0x2f7)]=_0x20f50c['enableWinddown']!==![]);$(_0x3f9c29(0x2f9))&&($(_0x3f9c29(0x2f9))[_0x3f9c29(0x2f7)]=_0x20f50c['enableSessionNotes']!==![]);$('#set_backupDays')&&($(_0x3f9c29(0x210))[_0x3f9c29(0x2c3)]=_0x20f50c[_0x3f9c29(0x368)]||0x7);const _0x1b1a3d=$(_0x3f9c29(0x24c));_0x1b1a3d&&storageManager[_0x3f9c29(0x1fc)]()[_0x3f9c29(0x18b)](_0x1de86c=>{const _0x4cd744=_0x3f9c29;_0x1b1a3d[_0x4cd744(0x32a)]=_0x4cd744(0x15e),_0x1de86c&&_0x1de86c['length']>0x0?_0x1de86c['forEach'](_0x5147b0=>{const _0x579d17=_0x4cd744,_0x337de3=document[_0x579d17(0x407)](_0x579d17(0x2ca));_0x337de3['value']=_0x5147b0[_0x579d17(0x200)],_0x337de3[_0x579d17(0x196)]=_0x579d17(0x3ff)+new Date(_0x5147b0[_0x579d17(0x200)])[_0x579d17(0x311)](_0x579d17(0x351)),_0x1b1a3d['appendChild'](_0x337de3);}):_0x1b1a3d[_0x4cd744(0x32a)]='<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>';});$(_0x3f9c29(0x3e9))[_0x3f9c29(0x3a7)][_0x3f9c29(0x1ed)](_0x3f9c29(0x385));try{trapFocus($(_0x3f9c29(0x3e9)));}catch(_0x37fa4d){}}function closeSettings(){const _0x48eeb6=_0x2ebaf0;$(_0x48eeb6(0x3e9))[_0x48eeb6(0x3a7)][_0x48eeb6(0x299)](_0x48eeb6(0x385));try{releaseFocus();}catch(_0x539fe6){}}async function setDefaults(){const _0x420628=_0x2ebaf0;data['settings']['durations']={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data['settings'][_0x420628(0x1ca)]=0x4,data[_0x420628(0x3fb)][_0x420628(0x2da)]=0x4,data['settings']['cyclesB']=0x4,data['settings']['longBreakIntervalB']=0x4,data[_0x420628(0x3fb)][_0x420628(0x156)]=0x5,data['settings'][_0x420628(0x2b3)]='A',data[_0x420628(0x3fb)][_0x420628(0x295)]=0.8,data[_0x420628(0x3fb)][_0x420628(0x19b)]=_0x420628(0x147),await saveData(),openSettings(),toast(_0x420628(0x1c1));}async function saveSettings(){const _0x4ce09d=_0x2ebaf0,_0x23f3eb=data['settings'];_0x23f3eb[_0x4ce09d(0x34c)]=$(_0x4ce09d(0x127))[_0x4ce09d(0x2c3)][_0x4ce09d(0x31d)]();const _0x2a9fe0=_0x23f3eb[_0x4ce09d(0x185)];if(editingPreset==='A')_0x2a9fe0[_0x4ce09d(0x259)]=clampInt($(_0x4ce09d(0x40c))['value'],0x1,0x3e7),_0x2a9fe0[_0x4ce09d(0x2b8)]=clampInt($(_0x4ce09d(0x36a))[_0x4ce09d(0x2c3)],0x0,0x3e7),_0x2a9fe0[_0x4ce09d(0x431)]=clampInt($('#set_short')[_0x4ce09d(0x2c3)],0x1,0x3e7),_0x2a9fe0[_0x4ce09d(0x230)]=clampInt($(_0x4ce09d(0x312))[_0x4ce09d(0x2c3)],0x1,0x3e7),_0x23f3eb['cyclesA']=clampInt($(_0x4ce09d(0x2ee))[_0x4ce09d(0x2c3)],0x1,0xc),_0x23f3eb[_0x4ce09d(0x2da)]=clampInt($(_0x4ce09d(0x226))[_0x4ce09d(0x2c3)],0x2,0xc);else{if(editingPreset==='B')_0x2a9fe0[_0x4ce09d(0x16a)]=clampInt($('#set_work')['value'],0x1,0x3e7),_0x2a9fe0['B_winddown']=clampInt($('#set_winddown')['value'],0x0,0x3e7),_0x2a9fe0['B_short']=clampInt($(_0x4ce09d(0x320))[_0x4ce09d(0x2c3)],0x1,0x3e7),_0x2a9fe0[_0x4ce09d(0x219)]=clampInt($(_0x4ce09d(0x312))[_0x4ce09d(0x2c3)],0x1,0x3e7),_0x23f3eb['cyclesB']=clampInt($(_0x4ce09d(0x2ee))['value'],0x1,0xc),_0x23f3eb['longBreakIntervalB']=clampInt($(_0x4ce09d(0x226))[_0x4ce09d(0x2c3)],0x2,0xc);else{if(editingPreset==='C'){const _0xfe8174=$(_0x4ce09d(0x3e2));if(_0xfe8174)_0x23f3eb[_0x4ce09d(0x156)]=clampInt(_0xfe8174[_0x4ce09d(0x2c3)],0x1,0x14);}}}_0x23f3eb['volume']=clampFloat($('#set_volume')['value'],0x0,0x1,0.8),_0x23f3eb[_0x4ce09d(0x19b)]=$('#set_theme')[_0x4ce09d(0x2c3)]===_0x4ce09d(0x405)?'chime':_0x4ce09d(0x147),_0x23f3eb['theme']=$('#set_theme_color')[_0x4ce09d(0x2c3)],_0x23f3eb[_0x4ce09d(0x209)]=parseFloat($(_0x4ce09d(0x181))[_0x4ce09d(0x2c3)])||0.85;$(_0x4ce09d(0x3de))&&(_0x23f3eb[_0x4ce09d(0x28f)]=$('#set_backgroundMode')[_0x4ce09d(0x2c3)]);_0x23f3eb[_0x4ce09d(0x3ca)]=!!($(_0x4ce09d(0x381))&&$('#set_autoStartNext')[_0x4ce09d(0x2f7)]),_0x23f3eb['enableWinddown']=!!($(_0x4ce09d(0x193))&&$(_0x4ce09d(0x193))[_0x4ce09d(0x2f7)]),_0x23f3eb[_0x4ce09d(0x2ce)]=!!($(_0x4ce09d(0x2f9))&&$('#set_enableSessionNotes')[_0x4ce09d(0x2f7)]);$(_0x4ce09d(0x210))&&(_0x23f3eb[_0x4ce09d(0x368)]=clampInt($(_0x4ce09d(0x210))['value'],0x1,0x1e));_0x23f3eb[_0x4ce09d(0x340)]===_0x4ce09d(0x136)||_0x23f3eb[_0x4ce09d(0x340)]==='pastel'?(_0x23f3eb[_0x4ce09d(0x38f)]=![],typeof _0x23f3eb[_0x4ce09d(0x173)]===_0x4ce09d(0x3da)&&_0x23f3eb[_0x4ce09d(0x173)][_0x4ce09d(0x39a)](_0x4ce09d(0x22e))&&(_0x23f3eb[_0x4ce09d(0x173)]='')):_0x23f3eb['useYtThumbnailAsBg']=!![];const _0x3dfbea=$('#set_youtubeUrl')[_0x4ce09d(0x2c3)]['trim']();_0x23f3eb[_0x4ce09d(0x38f)]=$('#set_ytThumbAsBg')[_0x4ce09d(0x2f7)],_0x23f3eb['youtubeVolume']=parseInt($(_0x4ce09d(0x19a))[_0x4ce09d(0x2c3)],0xa),sessionYoutubeUrl=_0x3dfbea;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer[_0x4ce09d(0x1b6)])ytPlayer[_0x4ce09d(0x1b6)](_0x23f3eb[_0x4ce09d(0x365)]);}else try{fallbackPostMessage(_0x4ce09d(0x1b6),[_0x23f3eb[_0x4ce09d(0x365)]]);}catch(_0x47e88c){}}catch(_0x6d9303){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x4ce09d(0x14d)](_0x23f3eb[_0x4ce09d(0x2b3)],{'silent':!![]}),closeSettings(),toast(_0x4ce09d(0x2b2));}function clampInt(_0x35bdaa,_0x76d465,_0x5266d6){const _0x4710da=_0x2ebaf0;_0x35bdaa=parseInt(_0x35bdaa||0x0,0xa);if(isNaN(_0x35bdaa))_0x35bdaa=_0x76d465;return Math[_0x4710da(0x12c)](_0x76d465,Math[_0x4710da(0x24d)](_0x5266d6,_0x35bdaa));}function clampFloat(_0xe5f001,_0x1ad823,_0x4b2057,_0x51e81a){const _0x153651=_0x2ebaf0;_0xe5f001=parseFloat(_0xe5f001);if(Number[_0x153651(0x1de)](_0xe5f001))_0xe5f001=_0x51e81a;return Math[_0x153651(0x12c)](_0x1ad823,Math['min'](_0x4b2057,_0xe5f001));}const dbPromise=new Promise((_0x55d4ae,_0x3eb2a1)=>{const _0x924b36=_0x2ebaf0,_0x381ef1=indexedDB[_0x924b36(0x34b)](_0x924b36(0x115),0x1);_0x381ef1[_0x924b36(0x2dd)]=_0x1f27e5=>_0x1f27e5[_0x924b36(0x23a)][_0x924b36(0x20e)][_0x924b36(0x42f)]('files'),_0x381ef1['onsuccess']=_0x307256=>_0x55d4ae(_0x307256['target'][_0x924b36(0x20e)]),_0x381ef1['onerror']=_0x1b5026=>_0x3eb2a1(_0x1b5026);}),fileCache={};function handleFileUpload(_0x1373d8,_0x509f05){const _0x299e5e=_0x2ebaf0;if(!_0x1373d8)return;dbPromise[_0x299e5e(0x18b)](_0x4d787c=>{const _0x958d31=_0x299e5e,_0x27e69a=uid(_0x958d31(0x1f4)),_0x6e65ef=_0x4d787c[_0x958d31(0x361)](_0x958d31(0x1f7),_0x958d31(0x37f));_0x6e65ef['objectStore'](_0x958d31(0x1f7))['put'](_0x1373d8,_0x27e69a),_0x6e65ef[_0x958d31(0x27a)]=()=>_0x509f05(_0x27e69a),_0x6e65ef[_0x958d31(0x258)]=()=>toast(_0x958d31(0x31a));});}function getStoredFileUrl(_0x1daf84){const _0x39b71d=_0x2ebaf0;if(!_0x1daf84)return Promise['resolve']('');if(fileCache[_0x1daf84])return Promise['resolve'](fileCache[_0x1daf84]);return dbPromise[_0x39b71d(0x18b)](_0x382620=>new Promise(_0x1b73e1=>{const _0x3b4545=_0x39b71d,_0x1d31cf=_0x382620[_0x3b4545(0x361)]('files',_0x3b4545(0x1c8)),_0x4e4dfe=_0x1d31cf['objectStore'](_0x3b4545(0x1f7))[_0x3b4545(0x34a)](_0x1daf84);_0x4e4dfe['onsuccess']=_0x33354d=>{const _0x57efa2=_0x3b4545,_0x4b8cae=_0x33354d[_0x57efa2(0x23a)]['result'];if(_0x4b8cae){const _0xb1844b=URL[_0x57efa2(0x21a)](_0x4b8cae);fileCache[_0x1daf84]=_0xb1844b,_0x1b73e1(_0xb1844b);}else _0x1b73e1('');},_0x4e4dfe[_0x3b4545(0x258)]=()=>_0x1b73e1('');}));}function applyCustomBg(){const _0x4f1673=_0x2ebaf0,_0x4fe6f4=data['settings'],_0x5e436d=_0x4fe6f4['customBg'],_0x793cce=_0x4fe6f4[_0x4f1673(0x340)],_0x265058=['lofi',_0x4f1673(0x3ae)][_0x4f1673(0x39a)](_0x793cce),_0x61a54=_0x793cce===_0x4f1673(0x136)||_0x793cce===_0x4f1673(0x2d4),_0x1fa5c2=_0x4fe6f4[_0x4f1673(0x28f)]||_0x4f1673(0x364);document[_0x4f1673(0x356)][_0x4f1673(0x2a4)][_0x4f1673(0x43a)]=_0x1fa5c2,document[_0x4f1673(0x356)]['style'][_0x4f1673(0x254)]=_0x1fa5c2===_0x4f1673(0x2e9)?_0x4f1673(0x21d):'no-repeat';const _0x5008e0=()=>{const _0x3e84de=_0x4f1673;try{document[_0x3e84de(0x356)][_0x3e84de(0x2a4)][_0x3e84de(0x272)]='';}catch(_0x58f088){}};if(_0x5e436d){const _0x31b4b1=_0x5e436d[_0x4f1673(0x27f)]('data:')||_0x5e436d['startsWith'](_0x4f1673(0x29d))||_0x5e436d[_0x4f1673(0x27f)]('blob:')?Promise[_0x4f1673(0x1e9)](_0x5e436d):getStoredFileUrl(_0x5e436d);_0x31b4b1['then'](_0x163acf=>{const _0x33903c=_0x4f1673;_0x163acf?document[_0x33903c(0x356)][_0x33903c(0x2a4)][_0x33903c(0x315)](_0x33903c(0x20d),'url('+_0x163acf+')'):document[_0x33903c(0x356)][_0x33903c(0x2a4)][_0x33903c(0x315)](_0x33903c(0x20d),_0x61a54?'none':''),_0x5008e0();});}else!_0x265058?_0x61a54?(document[_0x4f1673(0x356)][_0x4f1673(0x2a4)][_0x4f1673(0x315)](_0x4f1673(0x20d),'none'),_0x5008e0()):document[_0x4f1673(0x356)][_0x4f1673(0x2a4)][_0x4f1673(0x315)]('--bg-image',_0x4f1673(0x19c)):(document[_0x4f1673(0x356)][_0x4f1673(0x2a4)][_0x4f1673(0x122)](_0x4f1673(0x20d)),_0x5008e0());}function applyPanelOpacity(){const _0x516d6f=_0x2ebaf0;document[_0x516d6f(0x2a9)][_0x516d6f(0x2a4)][_0x516d6f(0x315)](_0x516d6f(0x3bb),data['settings'][_0x516d6f(0x209)]);}function renderDashboard(){const _0x57a4ac=_0x2ebaf0,_0x1375c2=data['topics'][_0x57a4ac(0x149)](_0xac01e3=>_0xac01e3[_0x57a4ac(0x294)]['map'](_0x11f856=>({'topic':_0xac01e3[_0x57a4ac(0x1a1)],'subtopic':_0x11f856['name'],'m':_0x11f856[_0x57a4ac(0x125)][_0x57a4ac(0x3d4)]||0x0,'c':_0x11f856['stats']['sessionsCompleted']||0x0,'t':_0x11f856[_0x57a4ac(0x125)]['tasksCompleted']||0x0}))),_0x346152=_0x1375c2[_0x57a4ac(0x16d)]((_0x2dfaa0,_0x47781c)=>_0x2dfaa0+_0x47781c['m'],0x0),_0x23f936=_0x1375c2[_0x57a4ac(0x16d)]((_0x495dfa,_0x27ee06)=>_0x495dfa+_0x27ee06['c'],0x0),_0x47c088=_0x1375c2[_0x57a4ac(0x16d)]((_0x2cc221,_0x5ab1eb)=>_0x2cc221+_0x5ab1eb['t'],0x0);let _0x95a7ab=_0x57a4ac(0x392)+formatDaysHoursMinutes(_0x346152)+_0x57a4ac(0x404)+_0x23f936+_0x57a4ac(0x206)+_0x47c088+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>';_0x1375c2[_0x57a4ac(0x17a)](_0x36ab4b=>{const _0x68d066=_0x57a4ac;_0x95a7ab+='<tr><td>'+escapeHTML(_0x36ab4b[_0x68d066(0x222)])+_0x68d066(0x233)+escapeHTML(_0x36ab4b[_0x68d066(0x202)])+'</td><td>'+formatDaysHoursMinutes(_0x36ab4b['m'])+_0x68d066(0x233)+_0x36ab4b['c']+_0x68d066(0x233)+_0x36ab4b['t']+_0x68d066(0x263);}),_0x95a7ab+=_0x57a4ac(0x1fa);const _0x432de0=$(_0x57a4ac(0x3d0));if(_0x432de0)_0x432de0['innerHTML']=_0x95a7ab;}function getMilestones(){const _0x31c859=_0x2ebaf0;return[{'hours':0x5,'title':_0x31c859(0x3c1),'message':'Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!'},{'hours':0x14,'title':_0x31c859(0x232),'message':'Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.'},{'hours':0x32,'title':_0x31c859(0x1d7),'message':_0x31c859(0x126)},{'hours':0x64,'title':_0x31c859(0x32f),'message':'100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.'},{'hours':0xfa,'title':_0x31c859(0x215),'message':_0x31c859(0x2ae)},{'hours':0x1f4,'title':'Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','message':'Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.'},{'hours':0x3e8,'title':_0x31c859(0x3c3),'message':'Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.'},{'hours':0x1388,'title':_0x31c859(0x1a5),'message':_0x31c859(0x182)}][_0x31c859(0x36f)]((_0x15c301,_0x223b47)=>_0x223b47[_0x31c859(0x338)]-_0x15c301[_0x31c859(0x338)]);}async function checkAndShowMilestones(){const _0x5510fb=_0x2ebaf0;if(!data||!data[_0x5510fb(0x3fb)])return;if(!Array[_0x5510fb(0x2cf)](data[_0x5510fb(0x3fb)][_0x5510fb(0x32e)]))data['settings'][_0x5510fb(0x32e)]=[];const _0x309a71=data[_0x5510fb(0x220)][_0x5510fb(0x16d)]((_0x1771ae,_0x2a5da4)=>{const _0x84cc70=_0x5510fb;return _0x1771ae+_0x2a5da4[_0x84cc70(0x294)]['reduce']((_0x13ecae,_0x4e208b)=>{const _0x5eb0d0=_0x84cc70;return _0x13ecae+(_0x4e208b[_0x5eb0d0(0x125)][_0x5eb0d0(0x3d4)]||0x0);},0x0);},0x0),_0x5710e4=_0x309a71/0x3c,_0x3bb02e=getMilestones(),_0x56761e=Array['isArray'](data['settings']['achievedMilestones'])?data[_0x5510fb(0x3fb)][_0x5510fb(0x32e)]:[],_0x5f2b5b=_0x3bb02e[_0x5510fb(0x203)](_0x55dfd6=>_0x5710e4>=_0x55dfd6['hours']&&!_0x56761e[_0x5510fb(0x39a)](_0x55dfd6[_0x5510fb(0x338)]));if(_0x5f2b5b[_0x5510fb(0x402)]===0x0)return![];const _0x74d4ab=_0x5f2b5b[_0x5510fb(0x16d)]((_0x37a04b,_0x3937c7)=>_0x37a04b&&_0x37a04b['hours']>_0x3937c7[_0x5510fb(0x338)]?_0x37a04b:_0x3937c7,null);if(!_0x74d4ab)return![];$(_0x5510fb(0x34f))[_0x5510fb(0x196)]=_0x74d4ab[_0x5510fb(0x1b7)],$(_0x5510fb(0x22f))['textContent']=_0x74d4ab[_0x5510fb(0x152)],$(_0x5510fb(0x15a))[_0x5510fb(0x3a7)]['add']('show');try{trapFocus($(_0x5510fb(0x15a)));}catch(_0x36442c){}return data[_0x5510fb(0x3fb)][_0x5510fb(0x32e)][_0x5510fb(0x19f)](_0x74d4ab[_0x5510fb(0x338)]),await saveData(),!![];}async function seedAchievedMilestones(){const _0xc7b05c=_0x2ebaf0;if(!data||!data[_0xc7b05c(0x3fb)])return;!Array['isArray'](data[_0xc7b05c(0x3fb)][_0xc7b05c(0x32e)])&&(data['settings'][_0xc7b05c(0x32e)]=[],await saveData());}async function handleSendMessage(){const _0x487842=_0x2ebaf0,_0x599449=$(_0x487842(0x1be)),_0xda10cc=$(_0x487842(0x2b5)),_0x54f08a=_0xda10cc[_0x487842(0x2c3)][_0x487842(0x31d)](),_0x21770c=getCurrentSubtopic();if(!_0x54f08a)return;if(!_0x21770c){toast(t(_0x487842(0x1af)));return;}_0xda10cc[_0x487842(0x2c3)]='',_0x599449[_0x487842(0x374)]=!![],_0x599449[_0x487842(0x32a)]=_0x487842(0x427),_0x21770c[_0x487842(0x1e4)][_0x487842(0x19f)]({'role':_0x487842(0x3f1),'text':_0x54f08a}),renderChat();const _0x500edc=await callGeminiAPI(_0x54f08a);_0x500edc&&(_0x21770c[_0x487842(0x1e4)]['push']({'role':_0x487842(0x145),'text':_0x500edc}),await saveData(),renderChat()),_0x599449['disabled']=![],_0x599449[_0x487842(0x32a)]=_0x487842(0x32d);}function renderChat(){const _0x35f410=_0x2ebaf0,_0xec468c=getCurrentSubtopic(),_0x466dc7=$('#chatMessages'),_0x13fdd0=$(_0x35f410(0x2b5)),_0x59e1ea=$(_0x35f410(0x1be));if(!_0x466dc7||!_0x13fdd0||!_0x59e1ea)return;if(!_0xec468c){_0x466dc7[_0x35f410(0x32a)]=_0x35f410(0x242),_0x13fdd0[_0x35f410(0x374)]=!![],_0x59e1ea[_0x35f410(0x374)]=!![];return;}_0x13fdd0[_0x35f410(0x374)]=![],_0x59e1ea[_0x35f410(0x374)]=![],_0x466dc7['innerHTML']='';if(!_0xec468c[_0x35f410(0x1e4)]||_0xec468c[_0x35f410(0x1e4)][_0x35f410(0x402)]===0x0){_0x466dc7['innerHTML']=_0x35f410(0x2cc);return;}_0xec468c[_0x35f410(0x1e4)][_0x35f410(0x17a)](_0x125584=>{const _0x4d36b4=_0x35f410,_0x33698f=document[_0x4d36b4(0x407)](_0x4d36b4(0x2c8));_0x33698f[_0x4d36b4(0x23e)]=_0x4d36b4(0x21b)+_0x125584['role'],_0x33698f[_0x4d36b4(0x196)]=_0x125584[_0x4d36b4(0x3b7)],_0x466dc7[_0x4d36b4(0x284)](_0x33698f);}),_0x466dc7[_0x35f410(0x27e)]=_0x466dc7[_0x35f410(0x3b8)];}async function handleSummarizeNote(){const _0x592e8c=_0x2ebaf0,_0x5c9881=$('#btnSummarizeNote'),_0x320918=$(_0x592e8c(0x2a1)),_0x2ee98d=_0x320918[_0x592e8c(0x2c3)]['trim'](),_0x5b75a0=getCurrentSubtopic();if(!_0x2ee98d){toast(_0x592e8c(0x2bd));return;}const _0x543a2a=_0x5c9881[_0x592e8c(0x32a)];_0x5c9881[_0x592e8c(0x32a)]='<div\x20class=\x22spinner\x22></div>',_0x5c9881['disabled']=!![];const _0x1cff88=_0x592e8c(0x24e)+(_0x5b75a0?.[_0x592e8c(0x1a1)]||'không\x20rõ')+_0x592e8c(0x2f3)+_0x2ee98d+_0x592e8c(0x3c6),_0x53f40a=await callGeminiAPI(_0x1cff88);_0x53f40a&&(_0x320918[_0x592e8c(0x2c3)]+='\x0a\x0a'+_0x53f40a),_0x5c9881['innerHTML']=_0x543a2a,_0x5c9881['disabled']=![];}function clearChat(){const _0x5c0418=getCurrentSubtopic();if(!_0x5c0418){toast(t('timer.selectSubtopicPrompt'));return;}showConfirmModal('Xác\x20nhận\x20xóa','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?',async _0x1767de=>{const _0x75460=_0x5e48;_0x1767de&&(_0x5c0418[_0x75460(0x1e4)]=[],await saveData(),renderChat(),toast(_0x75460(0x25a)));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0x6cd04d,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x3c7984=_0x2ebaf0,_0x678d1c=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0x6cd04d,'enablejsapi':'1','origin':_0x3c7984(0x35a)})[_0x3c7984(0x1b1)]();return'https://www.youtube.com/embed/'+_0x6cd04d+'?'+_0x678d1c;}function ensureFallbackFrame(){const _0x3384ca=_0x2ebaf0,_0x25b2c5=document[_0x3384ca(0x42e)](_0x3384ca(0x3f8));if(!_0x25b2c5)return null;if(ytFallbackFrame&&ytFallbackFrame[_0x3384ca(0x2be)])return ytFallbackFrame;const _0x458261=document[_0x3384ca(0x407)](_0x3384ca(0x28d));return _0x458261['id']=_0x3384ca(0x300),_0x458261[_0x3384ca(0x117)]='1',_0x458261['height']='1',_0x458261['style']['position']=_0x3384ca(0x18c),_0x458261['style'][_0x3384ca(0x211)]=_0x3384ca(0x1e7),_0x458261[_0x3384ca(0x2a4)][_0x3384ca(0x3c7)]=_0x3384ca(0x1e7),_0x458261[_0x3384ca(0x1ef)]=_0x3384ca(0x2f5),_0x25b2c5[_0x3384ca(0x32a)]='',_0x25b2c5[_0x3384ca(0x284)](_0x458261),ytFallbackFrame=_0x458261,_0x458261;}function fallbackLoadVideo(_0x93fed1,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x406b7d=_0x2ebaf0,_0xe4c401=document['getElementById'](_0x406b7d(0x3f8));if(!_0xe4c401)return;_0xe4c401['innerHTML']='';const _0x446fe1=document[_0x406b7d(0x407)]('iframe');_0x446fe1['id']=_0x406b7d(0x300),_0x446fe1[_0x406b7d(0x117)]='1',_0x446fe1['height']='1',_0x446fe1[_0x406b7d(0x2a4)]['position']=_0x406b7d(0x18c),_0x446fe1['style'][_0x406b7d(0x211)]='-9999px',_0x446fe1[_0x406b7d(0x2a4)][_0x406b7d(0x3c7)]=_0x406b7d(0x1e7),_0x446fe1[_0x406b7d(0x1ef)]='autoplay;\x20encrypted-media;\x20picture-in-picture',_0x446fe1[_0x406b7d(0x199)]=buildFallbackSrc(_0x93fed1,{'autoplay':autoplay,'mute':mute}),_0xe4c401[_0x406b7d(0x284)](_0x446fe1),ytFallbackFrame=_0x446fe1,ytFallbackIsPlaying=!!autoplay;try{const _0x1850b3=document[_0x406b7d(0x42e)](_0x406b7d(0x1cc));if(_0x1850b3)_0x1850b3[_0x406b7d(0x196)]=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x3debde){}}function fallbackPostMessage(_0x5d7770,_0x165638=[]){const _0x58ede3=_0x2ebaf0;try{if(!ytFallbackFrame||!ytFallbackFrame['contentWindow'])return;ytFallbackFrame[_0x58ede3(0x3eb)][_0x58ede3(0x245)](JSON[_0x58ede3(0x428)]({'event':_0x58ede3(0x3fa),'func':_0x5d7770,'args':_0x165638}),_0x58ede3(0x35a));}catch(_0xd03682){}}function fallbackPlay(){const _0x15b767=_0x2ebaf0;fallbackPostMessage(_0x15b767(0x302));}function fallbackStop(){const _0x2fc7e9=_0x2ebaf0;try{ytFallbackFrame&&(ytFallbackFrame[_0x2fc7e9(0x199)]=_0x2fc7e9(0x1ce),ytFallbackIsPlaying=![]);}catch(_0x185922){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){const _0x16e4fc=_0x2ebaf0;fallbackPostMessage(_0x16e4fc(0x2ed));}function fallbackMute(){fallbackPostMessage('mute');}window[_0x2ebaf0(0x2e3)]=function(){const _0x316523=_0x2ebaf0;if(IS_FILE_PROTOCOL){try{window[_0x316523(0x437)]&&window[_0x316523(0x437)][_0x316523(0x1f3)]();}catch(_0x5a182c){}return;}const _0x51119f={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0x316523(0x35a)};(window[_0x316523(0x39c)][_0x316523(0x129)]===_0x316523(0x1c2)||window['location']['protocol']===_0x316523(0x123))&&(_0x51119f[_0x316523(0x426)]=window[_0x316523(0x39c)]['origin']);ytPlayer=new YT[(_0x316523(0x11e))](_0x316523(0x3f8),_0x51119f);try{window[_0x316523(0x437)]&&window['__ytApiWatchdog']['cancel']();const _0x237dbc=document[_0x316523(0x42e)](_0x316523(0x132));_0x237dbc&&(_0x237dbc[_0x316523(0x196)]='');}catch(_0x176fc5){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x2ebaf0(0x3bf)](_0x2ebaf0(0x2f1))==='1';}catch(_0x11faf1){}function showSoundPermission(){const _0x9a7055=_0x2ebaf0,_0x226ca8=document['getElementById'](_0x9a7055(0x3d2));if(!_0x226ca8)return;if(_ytUnlocked){_0x226ca8[_0x9a7055(0x3a7)][_0x9a7055(0x299)]('show');return;}_0x226ca8[_0x9a7055(0x3a7)][_0x9a7055(0x1ed)](_0x9a7055(0x385));}function hideSoundPermission(){const _0x1672c5=_0x2ebaf0,_0x5eb976=document[_0x1672c5(0x42e)]('soundPermissionBar');if(!_0x5eb976)return;_0x5eb976[_0x1672c5(0x3a7)][_0x1672c5(0x299)](_0x1672c5(0x385));}function unlockAudioChain(){const _0x76255=_0x2ebaf0;try{if(AUDIO_CTX&&typeof AUDIO_CTX[_0x76255(0x420)]==='function')AUDIO_CTX[_0x76255(0x420)]();}catch(_0xed8e92){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer[_0x76255(0x2ed)]&&(ytPlayer[_0x76255(0x2ed)](),ytPlayer[_0x76255(0x302)]());}catch(_0x5d8b49){}_ytUnlocked=!![];try{localStorage[_0x76255(0x128)](_0x76255(0x2f1),'1');}catch(_0x3cdd15){}hideSoundPermission(),toast(_0x76255(0x439));}function onPlayerReady(_0x42082b){const _0x45b54b=_0x2ebaf0;try{const _0x778606=ytPlayer&&ytPlayer['getIframe']?ytPlayer[_0x45b54b(0x391)]():null;_0x778606&&_0x778606[_0x45b54b(0x37e)]('allow',_0x45b54b(0x2f5));}catch(_0x29f4c5){}try{if(ytPlayer&&ytPlayer['setVolume'])ytPlayer[_0x45b54b(0x1b6)](data&&data[_0x45b54b(0x3fb)]&&data[_0x45b54b(0x3fb)][_0x45b54b(0x365)]||0x50);}catch(_0x164488){}try{const _0x47ddb3=getActiveVideoId&&getActiveVideoId();if(_0x47ddb3&&ytPlayer&&ytPlayer['mute']&&ytPlayer[_0x45b54b(0x302)]){ytPlayer[_0x45b54b(0x21c)](),ytPlayer[_0x45b54b(0x302)](),_ytPrimed=!![];const _0x40be8b=()=>{const _0x4e4ca8=_0x45b54b;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x1a0bf0){}window['removeEventListener'](_0x4e4ca8(0x430),_0x40be8b,!![]),window['removeEventListener'](_0x4e4ca8(0x1cf),_0x40be8b,!![]);};window['addEventListener'](_0x45b54b(0x430),_0x40be8b,!![]),window['addEventListener'](_0x45b54b(0x1cf),_0x40be8b,!![]),showSoundPermission();}}catch(_0x2645f1){}updateYouTubePlayer();}function onPlayerStateChange(_0x518ff5){const _0x29d249=_0x2ebaf0,_0x2879f4=$(_0x29d249(0x18e));_0x518ff5[_0x29d249(0x13b)]==YT['PlayerState']['PLAYING']?(_0x2879f4[_0x29d249(0x196)]='⏸️',hideSoundPermission()):_0x2879f4[_0x29d249(0x196)]='▶️';if(_0x518ff5[_0x29d249(0x13b)]===YT['PlayerState'][_0x29d249(0x12d)]){if(!ytUserPaused)ytPlayer[_0x29d249(0x302)]();}}async function ytFadeTo(_0x501520,_0x570d67=0xfa){const _0x43a9db=_0x2ebaf0;try{if(!ytPlayer||!ytPlayer['getVolume']||!ytPlayer[_0x43a9db(0x1b6)])return;ytPlayer[_0x43a9db(0x2ed)]();const _0x102d71=ytPlayer['getVolume'](),_0x4b680d=_0x501520-_0x102d71;if(Math[_0x43a9db(0x3c2)](_0x4b680d)<0x1||_0x570d67<=0x0){ytPlayer['setVolume'](_0x501520);return;}const _0xa6856d=performance[_0x43a9db(0x142)]();await new Promise(_0x54296c=>{const _0x561f1b=_0x1b96ff=>{const _0x468000=_0x5e48,_0x5edda7=Math[_0x468000(0x24d)](0x1,(_0x1b96ff-_0xa6856d)/_0x570d67),_0x2c1c47=Math[_0x468000(0x1f8)](_0x102d71+_0x4b680d*_0x5edda7);ytPlayer[_0x468000(0x1b6)](_0x2c1c47);if(_0x5edda7<0x1)requestAnimationFrame(_0x561f1b);else _0x54296c();};requestAnimationFrame(_0x561f1b);});}catch(_0x2936d1){}}async function ytFadeInPlay(_0x34bb04=0xdc){const _0x479d0c=_0x2ebaf0;try{const _0x225a65=Math[_0x479d0c(0x12c)](0x0,Math[_0x479d0c(0x24d)](0x64,data&&data[_0x479d0c(0x3fb)]&&data[_0x479d0c(0x3fb)][_0x479d0c(0x365)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer[_0x479d0c(0x2ed)](),ytPlayer['playVideo']();try{ytPlayer['setVolume'](0x0);}catch(_0x136c2c){}await ytFadeTo(_0x225a65,_0x34bb04);}else{const _0x32005e=getActiveVideoId();_0x32005e&&fallbackLoadVideo(_0x32005e,{'autoplay':0x1,'mute':0x0});}}catch(_0x596eb5){}}async function ytFadeOutPause(_0x53bab7=0xb4){const _0x1d5228=_0x2ebaf0;try{const _0x458737=Math['max'](0x0,Math[_0x1d5228(0x24d)](0x64,data&&data[_0x1d5228(0x3fb)]&&data[_0x1d5228(0x3fb)][_0x1d5228(0x365)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0x53bab7);try{ytPlayer[_0x1d5228(0x23f)](),ytPlayer['setVolume'](_0x458737);}catch(_0x592c3c){}}else try{fallbackPause();}catch(_0x4857ee){}}catch(_0x2042af){}}async function updateYouTubePlayer(){const _0x4719cc=_0x2ebaf0,_0x39ed3e=getActiveVideoId();if(data[_0x4719cc(0x3fb)][_0x4719cc(0x38f)]&&_0x39ed3e){const _0x2e7c35=_0x4719cc(0x3fd)+_0x39ed3e+_0x4719cc(0x3be),_0x441a5b=new Image();_0x441a5b['onload']=async()=>{const _0x5e7c98=_0x4719cc;data[_0x5e7c98(0x3fb)][_0x5e7c98(0x173)]=_0x2e7c35,await saveData(),applyCustomBg();},_0x441a5b[_0x4719cc(0x258)]=async()=>{const _0x44c2bb=_0x4719cc,_0x2e7374=_0x44c2bb(0x3fd)+_0x39ed3e+_0x44c2bb(0x1c3);data['settings'][_0x44c2bb(0x173)]=_0x2e7374,await saveData(),applyCustomBg();},_0x441a5b['src']=_0x2e7c35;}else!_0x39ed3e&&(data[_0x4719cc(0x3fb)][_0x4719cc(0x173)]='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0x39ed3e){fallbackStop(),hideSoundPermission();return;}const _0x10589f=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x39ed3e,{'autoplay':0x1,'mute':_0x10589f});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer['cueVideoById']){try{ensureYouTubeAPI();}catch(_0x23c372){}return;}if(!_0x39ed3e){if(ytPlayer[_0x4719cc(0x31e)])ytPlayer[_0x4719cc(0x31e)]();hideSoundPermission();return;}ytPlayer[_0x4719cc(0x3a2)](_0x39ed3e),ytPlayer[_0x4719cc(0x1b6)](data[_0x4719cc(0x3fb)][_0x4719cc(0x365)]);}function toggleYtSound(){const _0x415ad3=_0x2ebaf0;if(!_ytUnlocked){try{ensureAudio();}catch(_0x4545d5){}try{unlockAudioChain();}catch(_0x53998d){}return;}if(IS_FILE_PROTOCOL){const _0x3391d9=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame[_0x415ad3(0x2be)]){if(!_0x3391d9){toast('Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.');return;}fallbackLoadVideo(_0x3391d9,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x49ed8d=document['getElementById'](_0x415ad3(0x1cc));if(_0x49ed8d)_0x49ed8d[_0x415ad3(0x196)]='⏸️';}catch(_0x234156){}toast('Đang\x20phát\x20nhạc\x20nền...');return;}if(ytFallbackIsPlaying)fallbackPostMessage('pauseVideo'),ytFallbackIsPlaying=![],toast(_0x415ad3(0x221));else{if(!_0x3391d9){toast('Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.');return;}fallbackPostMessage(_0x415ad3(0x302)),ytFallbackIsPlaying=!![],toast(_0x415ad3(0x23d));}try{const _0x4b6c09=document[_0x415ad3(0x42e)](_0x415ad3(0x1cc));if(_0x4b6c09)_0x4b6c09[_0x415ad3(0x196)]=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x1762d4){}return;}if(!ytPlayer||typeof ytPlayer[_0x415ad3(0x1b4)]!==_0x415ad3(0x24f)){try{ensureYouTubeAPI();}catch(_0x463b46){}return;}const _0xf23780=ytPlayer['getPlayerState']();_0xf23780===YT[_0x415ad3(0x3c5)][_0x415ad3(0x345)]||_0xf23780===YT[_0x415ad3(0x3c5)][_0x415ad3(0x15c)]?(ytFadeOutPause(),ytUserPaused=!![],toast(_0x415ad3(0x221))):(ytFadeInPlay(),ytUserPaused=![],toast(_0x415ad3(0x23d)));}function bindEvents(){const _0x5f0bba=_0x2ebaf0;try{const _0x5b3182=document['querySelector'](_0x5f0bba(0x13e));_0x5b3182&&(_0x5b3182[_0x5f0bba(0x32a)]=_0x5f0bba(0x247));}catch(_0xe03a94){}on($(_0x5f0bba(0x329)),'click',toggleBackgroundView),on($(_0x5f0bba(0x260)),_0x5f0bba(0x25b),()=>{const _0xdcc77e=_0x5f0bba;$(_0xdcc77e(0x15a))[_0xdcc77e(0x3a7)]['remove']('show');try{releaseFocus();}catch(_0x3ff23b){}}),on($('#btnAddTopic'),_0x5f0bba(0x25b),()=>showInputModal(_0x5f0bba(0x33b),async _0x43f02f=>{const _0xfd6378=_0x5f0bba;if(!_0x43f02f)return;data[_0xfd6378(0x220)]['push']({'id':uid('t'),'name':_0x43f02f,'subtopics':[]}),await saveData(),renderTopics();})),on($(_0x5f0bba(0x2b0)),'click',()=>storageManager[_0x5f0bba(0x244)](data)),on($(_0x5f0bba(0x120)),_0x5f0bba(0x268),_0x1ccfbe=>{const _0x32f1dd=_0x5f0bba,_0x4d5155=_0x1ccfbe[_0x32f1dd(0x23a)][_0x32f1dd(0x1f7)][0x0];if(!_0x4d5155)return;storageManager[_0x32f1dd(0x1c4)](_0x4d5155)[_0x32f1dd(0x18b)](async _0x3294b3=>{const _0x19d653=_0x32f1dd;data=_0x3294b3,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast(_0x19d653(0x401)),renderAll();})[_0x32f1dd(0x2d0)](_0x5e8605=>toast(_0x32f1dd(0x204)+_0x5e8605[_0x32f1dd(0x152)])),_0x1ccfbe['target'][_0x32f1dd(0x2c3)]=null;}),on($(_0x5f0bba(0x229)),_0x5f0bba(0x25b),()=>{const _0x175171=_0x5f0bba,_0xfd830d=$(_0x175171(0x24c)),_0x1644ea=_0xfd830d?_0xfd830d[_0x175171(0x2c3)]:'';if(!_0x1644ea){toast(_0x175171(0x423));return;}showConfirmModal(_0x175171(0x286),'Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20'+new Date(_0x1644ea)[_0x175171(0x311)]()+_0x175171(0x14a),_0x23cce1=>{const _0x4a94ca=_0x175171;_0x23cce1&&storageManager[_0x4a94ca(0x403)](_0x1644ea)['then'](_0x1f586b=>{const _0x24da41=_0x4a94ca;data=_0x1f586b,toast(_0x24da41(0x23b)),setTimeout(()=>window[_0x24da41(0x39c)][_0x24da41(0x17c)](),0x5dc);})['catch'](_0x3c0c3d=>{const _0x1f663e=_0x4a94ca;toast(_0x1f663e(0x155)+_0x3c0c3d[_0x1f663e(0x152)]);});});}),on($(_0x5f0bba(0x24b)),_0x5f0bba(0x2e8),_0x238280=>{const _0x564159=_0x5f0bba,_0x7207e6=_0x238280[_0x564159(0x23a)][_0x564159(0x2c3)];applyTheme(_0x7207e6);if(_0x7207e6===_0x564159(0x136)||_0x7207e6===_0x564159(0x2d4)){const _0x4c2711=$(_0x564159(0x2f0));_0x4c2711&&(_0x4c2711[_0x564159(0x2f7)]=![],toast(_0x564159(0x2d5),0x7d0));try{document[_0x564159(0x356)]['style'][_0x564159(0x315)](_0x564159(0x20d),_0x564159(0x2ff));}catch(_0x511da9){}}else{const _0x4afc6e=$('#set_ytThumbAsBg');_0x4afc6e&&(_0x4afc6e['checked']=!![]);try{updateYouTubePlayer();}catch(_0x4cc06b){}}}),on($(_0x5f0bba(0x1cd)),_0x5f0bba(0x25b),openSettings),on($(_0x5f0bba(0x191)),_0x5f0bba(0x25b),()=>{const _0x75f9dc=_0x5f0bba;switchView(_0x75f9dc(0x220)),$(_0x75f9dc(0x30d))[_0x75f9dc(0x25b)]();}),on($('#btnDashboard'),_0x5f0bba(0x25b),()=>{const _0x5b31e4=_0x5f0bba;renderDashboard(),$(_0x5b31e4(0x255))[_0x5b31e4(0x3a7)][_0x5b31e4(0x1ed)](_0x5b31e4(0x385));}),on($(_0x5f0bba(0x1b9)),_0x5f0bba(0x25b),()=>{const _0x47e246=_0x5f0bba;$(_0x47e246(0x255))[_0x47e246(0x3a7)][_0x47e246(0x299)](_0x47e246(0x385));}),on($(_0x5f0bba(0x2f4)),_0x5f0bba(0x25b),closeSettings),on($(_0x5f0bba(0x3e1)),_0x5f0bba(0x25b),saveSettings),on($(_0x5f0bba(0x27b)),_0x5f0bba(0x25b),setDefaults),on($(_0x5f0bba(0x3c4)),_0x5f0bba(0x25b),()=>{const _0x54fa3a=_0x5f0bba;ensureAudio(),playSound(_0x54fa3a(0x13d));}),on($(_0x5f0bba(0x20f)),'click',_0x1508f9=>{const _0x1d2cb3=_0x5f0bba;_0x1508f9[_0x1d2cb3(0x3c0)]();const _0x127505=$('#customSoundsContainer');if(_0x127505)_0x127505[_0x1d2cb3(0x3a7)]['toggle'](_0x1d2cb3(0x327));}),on($(_0x5f0bba(0x379)),_0x5f0bba(0x25b),async()=>{const _0xf24ab0=_0x5f0bba,_0xe10071=getCurrentSubtopic();if(!_0xe10071)return;const _0x54e35=pendingNoteSessionId,_0x159233=_0xe10071[_0xf24ab0(0x26f)]['find'](_0x4b6b23=>_0x4b6b23['id']===_0x54e35);_0x159233&&(_0x159233['note']=$('#noteText')[_0xf24ab0(0x2c3)][_0xf24ab0(0x31d)](),await saveData(),renderStatsHistory(),toast(_0xf24ab0(0x1f1))),closeNoteModal();}),on($(_0x5f0bba(0x34d)),_0x5f0bba(0x25b),()=>closeNoteModal()),on($(_0x5f0bba(0x171)),'click',addGeneralNote),on($(_0x5f0bba(0x172)),_0x5f0bba(0x25b),handleSummarizeNote),on($(_0x5f0bba(0x1be)),_0x5f0bba(0x25b),handleSendMessage),on($(_0x5f0bba(0x2b5)),'keydown',_0x1bfe16=>{const _0x397611=_0x5f0bba;if(_0x1bfe16['key']===_0x397611(0x330))handleSendMessage();}),$$(_0x5f0bba(0x183))[_0x5f0bba(0x17a)](_0x24babf=>{const _0x13668a=_0x5f0bba;on(_0x24babf,_0x13668a(0x25b),()=>{const _0x2d0a99=_0x13668a,_0x505854=_0x24babf[_0x2d0a99(0x12e)]['prompt'];$(_0x2d0a99(0x2b5))[_0x2d0a99(0x2c3)]=_0x505854,$(_0x2d0a99(0x2b5))[_0x2d0a99(0x205)]();});}),on($(_0x5f0bba(0x433)),_0x5f0bba(0x25b),clearChat),on($(_0x5f0bba(0x314)),_0x5f0bba(0x25b),addSubtopicTask),on($(_0x5f0bba(0x144)),_0x5f0bba(0x1cf),_0x5c4cb1=>{const _0x285ba7=_0x5f0bba;if(_0x5c4cb1[_0x285ba7(0x35e)]===_0x285ba7(0x330))addSubtopicTask();}),on($(_0x5f0bba(0x18e)),_0x5f0bba(0x25b),toggleYtSound),on($(_0x5f0bba(0x13a)),_0x5f0bba(0x25b),()=>{ensureAudio(),unlockAudioChain();}),on($(_0x5f0bba(0x19a)),_0x5f0bba(0x2e8),_0x34d61f=>{const _0x427d37=_0x5f0bba,_0x3e3a57=parseInt(_0x34d61f[_0x427d37(0x23a)][_0x427d37(0x2c3)],0xa);ytPlayer&&ytPlayer['setVolume']&&ytPlayer[_0x427d37(0x1b6)](_0x3e3a57);}),on($(_0x5f0bba(0x1a4)),'input',handleYoutubeUrlInput),$$(_0x5f0bba(0x1d8))[_0x5f0bba(0x17a)](_0x44f35b=>{_0x44f35b['addEventListener']('click',()=>{const _0x6e9a69=_0x5e48,_0x1d6d51=_0x44f35b['dataset'][_0x6e9a69(0x40e)],_0x4caf8d=data?.[_0x6e9a69(0x3fb)]?.[_0x6e9a69(0x380)]||_0x6e9a69(0x3cf);if(_0x4caf8d===_0x1d6d51&&_0x1d6d51!==_0x6e9a69(0x3cf))switchView('timer');else switchView(_0x1d6d51);});}),$$(_0x5f0bba(0x382))[_0x5f0bba(0x17a)](_0x4e7d49=>{const _0x51c258=_0x5f0bba;_0x4e7d49[_0x51c258(0x3ed)](_0x51c258(0x25b),()=>{const _0x23883c=_0x51c258,_0x4c0173=_0x4e7d49['dataset'][_0x23883c(0x249)],_0x493d19=_0x4e7d49[_0x23883c(0x184)](_0x23883c(0x178));if(!_0x493d19)return;_0x493d19[_0x23883c(0x43c)](_0x23883c(0x382))['forEach'](_0x53adb6=>_0x53adb6['classList']['remove']('active')),_0x4e7d49[_0x23883c(0x3a7)]['add']('active'),_0x493d19[_0x23883c(0x43c)](_0x23883c(0x38a))[_0x23883c(0x17a)](_0x460ea2=>{const _0x3a56a8=_0x23883c;_0x460ea2[_0x3a56a8(0x3a7)][_0x3a56a8(0x299)](_0x3a56a8(0x25c)),_0x460ea2['style'][_0x3a56a8(0x3ab)]=_0x3a56a8(0x2ff);});const _0xcdaf34=_0x493d19['querySelector']('#'+_0x4c0173);_0xcdaf34&&(_0xcdaf34[_0x23883c(0x3a7)]['add']('active'),_0xcdaf34[_0x23883c(0x2a4)][_0x23883c(0x3ab)]=_0x23883c(0x3e3),_0x493d19[_0x23883c(0x184)](_0x23883c(0x3e9))&&(_0xcdaf34['style'][_0x23883c(0x3ab)]=_0x23883c(0x252)));});});const _0x323ff8=$(_0x5f0bba(0x279));function _0x56b554(_0x535204,_0x34053e=null){const _0x20dc53=_0x5f0bba;try{document[_0x20dc53(0x2d6)]('styleWithCSS',![],!![]);}catch(_0x1b1486){}try{document[_0x20dc53(0x2d6)](_0x535204,![],_0x34053e);}catch(_0xe01200){}if(_0x323ff8)_0x323ff8['focus']();}on($('#toolBold'),'click',()=>_0x56b554(_0x5f0bba(0x3fc))),on($(_0x5f0bba(0x3b0)),_0x5f0bba(0x25b),()=>_0x56b554(_0x5f0bba(0x243))),on($(_0x5f0bba(0x29b)),_0x5f0bba(0x25b),()=>_0x56b554(_0x5f0bba(0x275),_0x5f0bba(0x35d))),on($('#toolList'),_0x5f0bba(0x25b),()=>_0x56b554('insertOrderedList')),on($(_0x5f0bba(0x1f5)),_0x5f0bba(0x25b),()=>_0x56b554(_0x5f0bba(0x161)));const _0x43aeab=$(_0x5f0bba(0x41d)),_0x13e8f5=$(_0x5f0bba(0x2cb));on($('#toolColor'),_0x5f0bba(0x25b),_0x524a64=>{const _0x5b4d85=_0x5f0bba;if(!_0x13e8f5)return;_0x524a64['stopPropagation'](),_0x13e8f5['classList'][_0x5b4d85(0x285)](_0x5b4d85(0x327));}),$$(_0x5f0bba(0x3ad))[_0x5f0bba(0x17a)](_0x41df25=>{const _0x8f09c5=_0x5f0bba;on(_0x41df25,_0x8f09c5(0x25b),_0x4e7955=>{const _0x4a6637=_0x8f09c5;_0x4e7955['preventDefault']();const _0x21e8d4=_0x41df25[_0x4a6637(0x12e)][_0x4a6637(0x40d)]||'';let _0x33e0fa=_0x21e8d4;try{const _0xecc45c=_0x21e8d4['match'](/--[a-zA-Z0-9_-]+/);if(_0xecc45c)_0x33e0fa=getComputedStyle(document['body'])[_0x4a6637(0x39e)](_0xecc45c[0x0])['trim']();}catch(_0x3a8f5b){}_0x56b554(_0x4a6637(0x218),_0x33e0fa);if(_0x13e8f5)_0x13e8f5['classList']['add'](_0x4a6637(0x327));});}),on(document,'click',_0x1b759e=>{const _0x34e821=_0x5f0bba;if(!_0x43aeab||!_0x13e8f5)return;!_0x43aeab['contains'](_0x1b759e['target'])&&!_0x13e8f5[_0x34e821(0x3a7)][_0x34e821(0x214)](_0x34e821(0x327))&&_0x13e8f5[_0x34e821(0x3a7)]['add'](_0x34e821(0x327));});function _0x6c05d6(_0x50f70){const _0x55cb2e=_0x5f0bba,_0x14f591=data?.[_0x55cb2e(0x3fb)]?.[_0x55cb2e(0x2ea)]||[],_0x2cf2f9=_0x50f70?_0x14f591['find'](_0x3ecd9c=>_0x3ecd9c['id']===_0x50f70):null;$(_0x55cb2e(0x33a))[_0x55cb2e(0x2c3)]=_0x2cf2f9&&_0x2cf2f9['id']||'',$(_0x55cb2e(0x188))[_0x55cb2e(0x196)]=_0x2cf2f9?_0x55cb2e(0x30c):_0x55cb2e(0x3a4),$('#methodEditorTitleInput')[_0x55cb2e(0x2c3)]=_0x2cf2f9&&_0x2cf2f9[_0x55cb2e(0x1b7)]||'';const _0x59f6e7=$(_0x55cb2e(0x279));if(_0x59f6e7)_0x59f6e7[_0x55cb2e(0x32a)]=_0x2cf2f9&&_0x2cf2f9[_0x55cb2e(0x331)]||'';$('#modalMethodEditor')['classList'][_0x55cb2e(0x1ed)](_0x55cb2e(0x385));try{trapFocus($('#modalMethodEditor'));}catch(_0x417086){}try{const _0x21d582=$(_0x55cb2e(0x15f));if(_0x21d582){const _0x166731=!!(data?.[_0x55cb2e(0x3fb)]?.[_0x55cb2e(0x34c)]&&data[_0x55cb2e(0x3fb)][_0x55cb2e(0x34c)][_0x55cb2e(0x31d)]());_0x21d582[_0x55cb2e(0x374)]=!_0x166731,_0x21d582[_0x55cb2e(0x1b7)]=_0x166731?_0x55cb2e(0x41e):'Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.';}}catch(_0x39a6b3){}}on($(_0x5f0bba(0x325)),_0x5f0bba(0x25b),()=>{const _0x5bad34=_0x5f0bba;$(_0x5bad34(0x1da))[_0x5bad34(0x3a7)][_0x5bad34(0x299)](_0x5bad34(0x385));try{releaseFocus();}catch(_0x4e96f0){}}),on($(_0x5f0bba(0x1fb)),_0x5f0bba(0x25b),async()=>{const _0x1a76b2=_0x5f0bba,_0x202aa6=$(_0x1a76b2(0x33a))[_0x1a76b2(0x2c3)]||uid('m'),_0x5832c7=($('#methodEditorTitleInput')[_0x1a76b2(0x2c3)]||'')[_0x1a76b2(0x31d)](),_0x527cc1=$(_0x1a76b2(0x279)),_0x26026a=_0x527cc1?_0x527cc1[_0x1a76b2(0x32a)]||'':'';if(!Array[_0x1a76b2(0x2cf)](data[_0x1a76b2(0x3fb)][_0x1a76b2(0x2ea)]))data['settings']['methods']=[];const _0x2a154b=data[_0x1a76b2(0x3fb)][_0x1a76b2(0x2ea)][_0x1a76b2(0x19e)](_0x348fde=>_0x348fde['id']===_0x202aa6),_0x4140fc={'id':_0x202aa6,'title':_0x5832c7,'content':_0x26026a};if(_0x2a154b>=0x0)data[_0x1a76b2(0x3fb)][_0x1a76b2(0x2ea)][_0x2a154b]=_0x4140fc;else data[_0x1a76b2(0x3fb)][_0x1a76b2(0x2ea)][_0x1a76b2(0x1e2)](_0x4140fc);await storageManager['updateSettings'](data[_0x1a76b2(0x3fb)]),renderMethods(),$(_0x1a76b2(0x1da))[_0x1a76b2(0x3a7)][_0x1a76b2(0x299)](_0x1a76b2(0x385));try{releaseFocus();}catch(_0x5a684d){}}),on($('#btnAutoFormat'),_0x5f0bba(0x25b),async()=>{const _0x5b842f=_0x5f0bba,_0x27a512=$(_0x5b842f(0x279));if(!_0x27a512)return;const _0x2d148d=(_0x27a512[_0x5b842f(0x196)]||'')[_0x5b842f(0x31d)]();if(!_0x2d148d||_0x2d148d[_0x5b842f(0x402)]<0x14){toast(_0x5b842f(0x1e1));return;}const _0x318d5a=$('#btnAutoFormat');_0x318d5a&&(_0x318d5a[_0x5b842f(0x374)]=!![],_0x318d5a[_0x5b842f(0x32a)]=_0x5b842f(0x427));const _0x38442f='Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22'+_0x2d148d+'\x22',_0x80f92b=await callGeminiAPI(_0x38442f);_0x80f92b?(_0x27a512[_0x5b842f(0x32a)]=_0x80f92b,toast(_0x5b842f(0x16e))):toast(_0x5b842f(0x376)),_0x318d5a&&(_0x318d5a[_0x5b842f(0x374)]=![],_0x318d5a[_0x5b842f(0x32a)]=_0x5b842f(0x2b4));}),on($(_0x5f0bba(0x22d)),_0x5f0bba(0x25b),()=>_0x6c05d6());const _0x1ce9f0=document[_0x5f0bba(0x273)]('#view-methods');_0x1ce9f0&&_0x1ce9f0[_0x5f0bba(0x3ed)](_0x5f0bba(0x25b),_0x47f950=>{const _0x4cf1f1=_0x5f0bba,_0x5df1e4=_0x47f950[_0x4cf1f1(0x23a)]['closest']&&_0x47f950[_0x4cf1f1(0x23a)][_0x4cf1f1(0x184)](_0x4cf1f1(0x33c)),_0x59617f=!_0x5df1e4&&_0x47f950[_0x4cf1f1(0x23a)][_0x4cf1f1(0x184)]&&_0x47f950[_0x4cf1f1(0x23a)][_0x4cf1f1(0x184)](_0x4cf1f1(0x421));if(_0x5df1e4){_0x47f950['preventDefault'](),_0x47f950[_0x4cf1f1(0x264)]();const _0x3ebadf=_0x5df1e4[_0x4cf1f1(0x12e)]['id'];if(_0x3ebadf)_0x6c05d6(_0x3ebadf);return;}if(_0x59617f){_0x47f950[_0x4cf1f1(0x3c0)](),_0x47f950[_0x4cf1f1(0x264)]();const _0x328a3e=_0x59617f['dataset']['id'];if(!_0x328a3e)return;const _0x503222=data?.[_0x4cf1f1(0x3fb)]?.['methods']||[],_0x315353=_0x503222[_0x4cf1f1(0x164)](_0x17d56b=>_0x17d56b['id']===_0x328a3e);if(!_0x315353)return;showConfirmModal(_0x4cf1f1(0x217),_0x4cf1f1(0x417)+(_0x315353['title']||'')+'\x22?',async _0x45e318=>{const _0x49a982=_0x4cf1f1;if(!_0x45e318)return;data[_0x49a982(0x3fb)][_0x49a982(0x2ea)]=_0x503222['filter'](_0x118b7b=>_0x118b7b['id']!==_0x328a3e),await storageManager[_0x49a982(0x3ce)](data[_0x49a982(0x3fb)]),renderMethods();});}});$$('#timerPresetSelector\x20button')['forEach'](_0x3124d2=>{const _0x32c31e=_0x5f0bba;_0x3124d2[_0x32c31e(0x3ed)](_0x32c31e(0x25b),()=>{const _0x4ea823=_0x32c31e;editingPreset=_0x3124d2['dataset'][_0x4ea823(0x3d6)],highlightPresetSelector(),loadEditingPresetFields();});}),$$('.presets\x20button')[_0x5f0bba(0x17a)](_0x474294=>{const _0x3373ff=_0x5f0bba;_0x474294['addEventListener'](_0x3373ff(0x25b),_0xe71adf=>{const _0x1d7688=_0x3373ff,_0x4ea236=_0xe71adf[_0x1d7688(0x23a)][_0x1d7688(0x12e)][_0x1d7688(0x2b3)],_0x3a23a3=data[_0x1d7688(0x3fb)][_0x1d7688(0x2b3)];if(_0x4ea236===_0x3a23a3)return;timer[_0x1d7688(0x3b4)]!=='idle'?showConfirmModal(_0x1d7688(0x342),_0x1d7688(0x137)+_0x4ea236+_0x1d7688(0x3b5),_0x233d95=>{const _0x58763a=_0x1d7688;_0x233d95&&(timer[_0x58763a(0x43d)](),timer[_0x58763a(0x14d)](_0x4ea236),renderAll(),toast('Đã\x20chuyển\x20sang\x20Kiểu\x20'+_0x4ea236+'.'));}):(timer[_0x1d7688(0x14d)](_0x4ea236),renderAll(),toast(_0x1d7688(0x240)+_0x4ea236+'.'));});}),on($('#btnStart'),_0x5f0bba(0x25b),()=>timer[_0x5f0bba(0x1d6)]()),on($(_0x5f0bba(0x163)),_0x5f0bba(0x25b),()=>timer[_0x5f0bba(0x2dc)]()),on($('#btnPause'),_0x5f0bba(0x25b),()=>timer['pause']()),on($(_0x5f0bba(0x2e6)),'click',()=>timer[_0x5f0bba(0x420)]()),on($(_0x5f0bba(0x253)),'click',()=>timer['skip']()),on($(_0x5f0bba(0x27c)),_0x5f0bba(0x25b),()=>timer[_0x5f0bba(0x43d)]()),on($(_0x5f0bba(0x1bb)),'click',()=>timer['beginBreak']()),on($('#uploadBg'),_0x5f0bba(0x268),_0x1239cd=>{const _0x3c6c74=_0x5f0bba;handleFileUpload(_0x1239cd[_0x3c6c74(0x23a)][_0x3c6c74(0x1f7)][0x0],async _0x104d2a=>{const _0x48abfa=_0x3c6c74;data['settings'][_0x48abfa(0x173)]=_0x104d2a,await saveData(),applyCustomBg(),toast(_0x48abfa(0x34e));}),_0x1239cd['target'][_0x3c6c74(0x2c3)]=null;}),on($('#btnClearBg'),_0x5f0bba(0x25b),async()=>{const _0x334f34=_0x5f0bba;data[_0x334f34(0x3fb)][_0x334f34(0x173)]='',data[_0x334f34(0x3fb)]['useYtThumbnailAsBg']=![],await saveData(),applyCustomBg(),toast(_0x334f34(0x223)),$(_0x334f34(0x3e9))[_0x334f34(0x3a7)]['contains'](_0x334f34(0x385))&&openSettings();}),on($(_0x5f0bba(0x175)),_0x5f0bba(0x268),_0x489cf2=>{const _0x560c06=_0x5f0bba;handleFileUpload(_0x489cf2[_0x560c06(0x23a)][_0x560c06(0x1f7)][0x0],async _0x17e216=>{const _0x109283=_0x560c06;data[_0x109283(0x3fb)][_0x109283(0x1f9)]['work_end']=_0x17e216,await saveData(),toast(_0x109283(0x236));}),_0x489cf2['target']['value']=null;}),on($(_0x5f0bba(0x1b3)),'change',_0xaae757=>{const _0x168cbe=_0x5f0bba;handleFileUpload(_0xaae757['target'][_0x168cbe(0x1f7)][0x0],async _0x420b8e=>{const _0x54271a=_0x168cbe;data['settings']['customSounds'][_0x54271a(0x3a1)]=_0x420b8e,await saveData(),toast(_0x54271a(0x35f));}),_0xaae757[_0x168cbe(0x23a)]['value']=null;}),on($('#uploadSoundLong'),_0x5f0bba(0x268),_0x24ad76=>{const _0x2baad6=_0x5f0bba;handleFileUpload(_0x24ad76[_0x2baad6(0x23a)][_0x2baad6(0x1f7)][0x0],async _0x450217=>{const _0x24c3a6=_0x2baad6;data[_0x24c3a6(0x3fb)][_0x24c3a6(0x1f9)][_0x24c3a6(0x1c9)]=_0x450217,await saveData(),toast(_0x24c3a6(0x212));}),_0x24ad76[_0x2baad6(0x23a)]['value']=null;}),on($(_0x5f0bba(0x283)),_0x5f0bba(0x25b),toggleFullScreen),document[_0x5f0bba(0x3ed)](_0x5f0bba(0x262),updateFullscreenButton),window[_0x5f0bba(0x3ed)](_0x5f0bba(0x1cf),_0x395dad=>{const _0x23b0fe=_0x5f0bba,_0x357dbf=(_0x395dad['target'][_0x23b0fe(0x326)]||'')[_0x23b0fe(0x349)](),_0x3a736b=[_0x23b0fe(0x2e8),_0x23b0fe(0x30b),_0x23b0fe(0x413)][_0x23b0fe(0x39a)](_0x357dbf);if(_0x395dad[_0x23b0fe(0x3ea)]==='Space'&&!_0x3a736b){_0x395dad[_0x23b0fe(0x3c0)]();if(timer[_0x23b0fe(0x3b4)]===_0x23b0fe(0x150)||timer[_0x23b0fe(0x3b4)]===_0x23b0fe(0x16c))timer[_0x23b0fe(0x1d6)]();else timer[_0x23b0fe(0x339)]();}(_0x395dad['key']==='n'||_0x395dad[_0x23b0fe(0x35e)]==='N')&&(!_0x3a736b&&(_0x395dad[_0x23b0fe(0x3c0)](),timer[_0x23b0fe(0x248)]()));if(_0x395dad[_0x23b0fe(0x35e)]===_0x23b0fe(0x288)){$$(_0x23b0fe(0x190))[_0x23b0fe(0x17a)](_0x434472=>_0x434472[_0x23b0fe(0x3a7)][_0x23b0fe(0x299)](_0x23b0fe(0x385)));try{releaseFocus();}catch(_0x7df5cf){}}if(_0x395dad['altKey']&&!_0x3a736b){if(_0x395dad[_0x23b0fe(0x35e)]===_0x23b0fe(0x25e))_0x395dad[_0x23b0fe(0x3c0)](),_0x81179c(0x0,-0xa);else{if(_0x395dad[_0x23b0fe(0x35e)]===_0x23b0fe(0x395))_0x395dad['preventDefault'](),_0x81179c(0x0,0xa);else{if(_0x395dad[_0x23b0fe(0x35e)]===_0x23b0fe(0x310))_0x395dad[_0x23b0fe(0x3c0)](),_0x81179c(-0xa,0x0);else _0x395dad[_0x23b0fe(0x35e)]===_0x23b0fe(0x2cd)&&(_0x395dad['preventDefault'](),_0x81179c(0xa,0x0));}}}}),$$(_0x5f0bba(0x190))[_0x5f0bba(0x17a)](_0x14004a=>_0x14004a[_0x5f0bba(0x3ed)](_0x5f0bba(0x25b),_0x57d7c9=>{const _0x56048b=_0x5f0bba;if(_0x57d7c9&&_0x57d7c9[_0x56048b(0x23a)]&&_0x57d7c9[_0x56048b(0x23a)]['id']===_0x56048b(0x3f2))return;if(_0x57d7c9[_0x56048b(0x23a)]===_0x14004a){_0x14004a[_0x56048b(0x3a7)][_0x56048b(0x299)](_0x56048b(0x385));try{releaseFocus();}catch(_0x9ad1f3){}}})),window[_0x5f0bba(0x3ed)](_0x5f0bba(0x25b),_0x31bf41=>{const _0xa00375=_0x5f0bba;!_0x31bf41['target']['closest']('.actions-menu-btn')&&!_0x31bf41['target'][_0xa00375(0x184)]('.actions-menu')&&closeAllMenus();});try{const _0xc44292=document[_0x5f0bba(0x273)]('.app-content');if(_0xc44292)_0xc44292[_0x5f0bba(0x3ed)](_0x5f0bba(0x2a6),closeAllMenus);}catch(_0x4ec232){}try{window['addEventListener'](_0x5f0bba(0x2a6),closeAllMenus,!![]);}catch(_0x31c522){}window[_0x5f0bba(0x3ed)]('beforeunload',()=>timer[_0x5f0bba(0x1d3)](!![]));try{const _0x147379=Array[_0x5f0bba(0x18f)](document[_0x5f0bba(0x43c)](_0x5f0bba(0x350)));_0x147379[_0x5f0bba(0x402)]&&_0x147379[_0x5f0bba(0x17a)](_0x44ab5f=>{const _0x2853e4=_0x5f0bba;_0x44ab5f[_0x2853e4(0x3ed)](_0x2853e4(0x285),()=>{const _0x3b96e1=_0x2853e4;_0x44ab5f[_0x3b96e1(0x34b)]&&_0x147379[_0x3b96e1(0x17a)](_0x416651=>{const _0x395314=_0x3b96e1;if(_0x416651!==_0x44ab5f)_0x416651[_0x395314(0x34b)]=![];});});});}catch(_0x2f5dd6){}const _0x3b78ee=$(_0x5f0bba(0x192));let _0x41cbf5=![],_0x3d9272,_0x117a1c;_0x3b78ee&&(_0x3b78ee[_0x5f0bba(0x3ed)](_0x5f0bba(0x270),_0x3ebe42=>{const _0x59ef7c=_0x5f0bba;_0x41cbf5=!![];const _0x5addd2=_0x3b78ee['getBoundingClientRect']();_0x3d9272=_0x3ebe42[_0x59ef7c(0x176)]-_0x5addd2[_0x59ef7c(0x3c7)],_0x117a1c=_0x3ebe42[_0x59ef7c(0x22a)]-_0x5addd2[_0x59ef7c(0x211)],_0x3b78ee[_0x59ef7c(0x2a4)]['transition']=_0x59ef7c(0x2ff);}),document[_0x5f0bba(0x3ed)](_0x5f0bba(0x1a2),_0x468cc7=>{const _0xc93987=_0x5f0bba;if(!_0x41cbf5)return;let _0x5dd68b=_0x468cc7[_0xc93987(0x176)]-_0x3d9272,_0x80a05f=_0x468cc7[_0xc93987(0x22a)]-_0x117a1c;const _0x37a4b2=window['innerWidth']-_0x3b78ee['offsetWidth'],_0x4d88fb=window[_0xc93987(0x347)]-_0x3b78ee[_0xc93987(0x169)];_0x5dd68b=Math[_0xc93987(0x12c)](0x0,Math[_0xc93987(0x24d)](_0x5dd68b,_0x37a4b2)),_0x80a05f=Math[_0xc93987(0x12c)](0x0,Math[_0xc93987(0x24d)](_0x80a05f,_0x4d88fb)),_0x3b78ee[_0xc93987(0x2a4)]['left']=_0x5dd68b+'px',_0x3b78ee[_0xc93987(0x2a4)]['top']=_0x80a05f+'px',_0x3b78ee['style'][_0xc93987(0x16f)]=_0xc93987(0x2e9),_0x3b78ee[_0xc93987(0x2a4)][_0xc93987(0x435)]=_0xc93987(0x2e9);}),document['addEventListener'](_0x5f0bba(0x2af),()=>{const _0x44933b=_0x5f0bba;if(!_0x41cbf5)return;_0x41cbf5=![],_0x3b78ee[_0x44933b(0x2a4)][_0x44933b(0x429)]='';}));function _0x5d8ed1(_0x3ccf80){const _0xb48b67=_0x5f0bba,_0x119968=$(_0xb48b67(0x192));if(!_0x119968)return;_0x119968['style'][_0xb48b67(0x3b1)]=_0xb48b67(0x2df),_0x119968[_0xb48b67(0x2a4)][_0xb48b67(0x429)]='',_0x119968[_0xb48b67(0x2a4)]['left']='auto',_0x119968['style'][_0xb48b67(0x211)]=_0xb48b67(0x2e9),_0x119968[_0xb48b67(0x2a4)][_0xb48b67(0x435)]=_0xb48b67(0x2e9),_0x119968[_0xb48b67(0x2a4)]['bottom']=_0xb48b67(0x2e9);const _0x5df22c=0x10;_0x3ccf80==='tl'&&(_0x119968['style']['left']=_0x5df22c+'px',_0x119968[_0xb48b67(0x2a4)][_0xb48b67(0x211)]=_0x5df22c+'px'),_0x3ccf80==='tr'&&(_0x119968['style'][_0xb48b67(0x435)]=_0x5df22c+'px',_0x119968[_0xb48b67(0x2a4)][_0xb48b67(0x211)]=_0x5df22c+'px'),_0x3ccf80==='bl'&&(_0x119968[_0xb48b67(0x2a4)][_0xb48b67(0x3c7)]=_0x5df22c+'px',_0x119968[_0xb48b67(0x2a4)][_0xb48b67(0x16f)]=_0x5df22c+'px'),_0x3ccf80==='br'&&(_0x119968[_0xb48b67(0x2a4)]['right']=_0x5df22c+'px',_0x119968[_0xb48b67(0x2a4)]['bottom']=_0x5df22c+'px');}function _0x81179c(_0x22c056,_0x5cbe3a){const _0x3c8f35=_0x5f0bba,_0x5a90df=$(_0x3c8f35(0x192));if(!_0x5a90df)return;const _0xdc4f54=_0x5a90df[_0x3c8f35(0x140)](),_0x388b78=Math['max'](0x0,Math[_0x3c8f35(0x24d)](_0xdc4f54[_0x3c8f35(0x3c7)]+_0x22c056,window[_0x3c8f35(0x2f8)]-_0x5a90df['offsetWidth'])),_0x908253=Math[_0x3c8f35(0x12c)](0x0,Math[_0x3c8f35(0x24d)](_0xdc4f54[_0x3c8f35(0x211)]+_0x5cbe3a,window[_0x3c8f35(0x347)]-_0x5a90df[_0x3c8f35(0x169)]));_0x5a90df[_0x3c8f35(0x2a4)][_0x3c8f35(0x3c7)]=_0x388b78+'px',_0x5a90df[_0x3c8f35(0x2a4)][_0x3c8f35(0x211)]=_0x908253+'px',_0x5a90df[_0x3c8f35(0x2a4)][_0x3c8f35(0x435)]='auto',_0x5a90df[_0x3c8f35(0x2a4)]['bottom']=_0x3c8f35(0x2e9);}}function toggleBackgroundView(){const _0x27bb8c=_0x2ebaf0,_0x28c8c3=document[_0x27bb8c(0x356)];_0x28c8c3[_0x27bb8c(0x3a7)][_0x27bb8c(0x285)]('bg-view-mode');const _0x3ba7f1=_0x28c8c3[_0x27bb8c(0x3a7)]['contains'](_0x27bb8c(0x309)),_0x2f73f2=$(_0x27bb8c(0x329));if(!_0x2f73f2)return;_0x3ba7f1?(_0x2f73f2['title']=_0x27bb8c(0x187),_0x2f73f2[_0x27bb8c(0x32a)]='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>'):(_0x2f73f2['title']=_0x27bb8c(0x225),_0x2f73f2[_0x27bb8c(0x32a)]=_0x27bb8c(0x12f));}function updateMainViewVisibility(){const _0x231cb2=_0x2ebaf0,_0x31635d=!!getCurrentSubtopic(),_0x34fbc3=$(_0x231cb2(0x251)),_0x4c5048=$('#welcomePanel');_0x4c5048&&_0x4c5048[_0x231cb2(0x3a7)][_0x231cb2(0x285)](_0x231cb2(0x327),_0x31635d),_0x34fbc3&&(_0x31635d?_0x34fbc3[_0x231cb2(0x3a7)][_0x231cb2(0x299)]('no-subtopic-selected'):_0x34fbc3['classList'][_0x231cb2(0x1ed)](_0x231cb2(0x319)));}function updatePresetButtonsText(){const _0x4841a8=_0x2ebaf0,_0x2a6591=data['settings'],_0x16d21b=_0x2a6591[_0x4841a8(0x1ca)],_0x17d46e=_0x2a6591['cyclesB'],_0x229014=_0x2a6591[_0x4841a8(0x185)][_0x4841a8(0x259)],_0x52b27e=_0x2a6591[_0x4841a8(0x185)][_0x4841a8(0x16a)],_0x58e205=$('#btnPresetA'),_0x28db2f=$('#btnPresetB'),_0x32b3bf=$(_0x4841a8(0x186));_0x58e205&&(_0x58e205[_0x4841a8(0x196)]=_0x16d21b+'×'+_0x229014+_0x4841a8(0x3bc)),_0x28db2f&&(_0x28db2f[_0x4841a8(0x196)]=_0x17d46e+'×'+_0x52b27e+_0x4841a8(0x276)),_0x32b3bf&&(_0x32b3bf['textContent']=_0x4841a8(0x371));}function renderAll(){const _0x3992d3=_0x2ebaf0;updatePresetButtonsText();const _0xf35ea9=data['settings'][_0x3992d3(0x2b3)];$$('.presets\x20button')[_0x3992d3(0x17a)](_0x2c66f1=>{const _0xc8bfac=_0x3992d3,_0x34c272=_0x2c66f1['dataset']['preset']===_0xf35ea9;_0x2c66f1[_0xc8bfac(0x3a7)][_0xc8bfac(0x285)]('acc',_0x34c272),_0x2c66f1[_0xc8bfac(0x3a7)][_0xc8bfac(0x285)](_0xc8bfac(0x414),!_0x34c272),_0x2c66f1[_0xc8bfac(0x37e)](_0xc8bfac(0x375),_0x34c272);}),updateMainViewVisibility(),timer[_0x3992d3(0x14d)](data[_0x3992d3(0x3fb)][_0x3992d3(0x2b3)],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data[_0x3992d3(0x3fb)]['currentView']);}function toggleFullScreen(){const _0x4b6bac=_0x2ebaf0;!document[_0x4b6bac(0x3a9)]?document[_0x4b6bac(0x2a9)][_0x4b6bac(0x280)]()[_0x4b6bac(0x2d0)](_0x21b41c=>{const _0x302ea4=_0x4b6bac;toast(_0x302ea4(0x281)+_0x21b41c['message']);}):document['exitFullscreen']&&document[_0x4b6bac(0x357)]();}function updateFullscreenButton(){const _0x1caf64=_0x2ebaf0,_0x26729a=$(_0x1caf64(0x283));document[_0x1caf64(0x3a9)]?(_0x26729a['innerHTML']='↙️',_0x26729a[_0x1caf64(0x1b7)]=_0x1caf64(0x419)):(_0x26729a['innerHTML']='↗️',_0x26729a[_0x1caf64(0x1b7)]=_0x1caf64(0x1a8));}async function initializeApp(){const _0x1526ce=_0x2ebaf0;try{await storageManager[_0x1526ce(0x165)]();const [_0x195c6e,_0x611a25,_0x47a730]=await Promise[_0x1526ce(0x2c7)]([storageManager[_0x1526ce(0x396)](),storageManager[_0x1526ce(0x31c)](_0x1526ce(0x220)),storageManager[_0x1526ce(0x31c)](_0x1526ce(0x294))]);let _0x224260;if(!_0x195c6e){const _0x2eef22=JSON['parse'](JSON['stringify'](defaults));await storageManager['updateSettings'](_0x2eef22[_0x1526ce(0x3fb)]);for(const _0x1c7709 of _0x2eef22[_0x1526ce(0x220)]){const {subtopics:_0x41fa4c,..._0x14e7f5}=_0x1c7709;await storageManager[_0x1526ce(0x1ed)](_0x1526ce(0x220),_0x14e7f5);for(const _0x249aae of _0x41fa4c){await storageManager['add']('subtopics',{..._0x249aae,'topicId':_0x1c7709['id']});}}_0x224260=_0x2eef22;}else{const _0x5dbde8={};for(const _0x4ec25e of _0x611a25)_0x5dbde8[_0x4ec25e['id']]={..._0x4ec25e,'subtopics':[]};for(const _0x17133b of _0x47a730)_0x5dbde8[_0x17133b[_0x1526ce(0x287)]]?.[_0x1526ce(0x294)]['push'](_0x17133b);_0x224260={'version':defaults[_0x1526ce(0x2ba)],'settings':_0x195c6e,'topics':Object[_0x1526ce(0x130)](_0x5dbde8)};}data=window[_0x1526ce(0x13b)]=_0x224260,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0x1526ce(0x3e4)](data);}catch(_0x103c75){console[_0x1526ce(0x124)](_0x1526ce(0x1e6),_0x103c75);}bindEvents(),applyTheme();}catch(_0x6df528){console[_0x1526ce(0x143)](_0x1526ce(0x1ec),_0x6df528),toast(_0x1526ce(0x355)+_0x6df528[_0x1526ce(0x152)]);}}callGeminiAPI=async function(_0x367a13,_0x21e72f=0x3,_0xebb87=0x3e8){const _0xf53ac9=_0x2ebaf0,_0x473a3a=data?.[_0xf53ac9(0x3fb)]?.[_0xf53ac9(0x34c)]||'';if(!_0x473a3a)return toast(_0xf53ac9(0x2db)),null;const _0x1375d7=_0xf53ac9(0x1bc)+_0x473a3a,_0x8cdbab={'contents':[{'role':'user','parts':[{'text':_0x367a13}]}]};try{const _0x38b917=await fetch(_0x1375d7,{'method':_0xf53ac9(0x3b9),'headers':{'Content-Type':_0xf53ac9(0x3a5)},'body':JSON[_0xf53ac9(0x428)](_0x8cdbab)});if(!_0x38b917['ok']){if(_0x38b917[_0xf53ac9(0x422)]===0x1ad&&_0x21e72f>0x0)return await new Promise(_0x23cc9f=>setTimeout(_0x23cc9f,_0xebb87)),callGeminiAPI(_0x367a13,_0x21e72f-0x1,_0xebb87*0x2);let _0x573979=null;try{_0x573979=await _0x38b917[_0xf53ac9(0x2c2)]();}catch(_0x471260){}let _0x5d82e3=_0xf53ac9(0x2bf)+_0x38b917[_0xf53ac9(0x422)];if(_0x38b917[_0xf53ac9(0x422)]===0x190)_0x5d82e3='Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.';else{if(_0x38b917[_0xf53ac9(0x422)]===0x1ad)_0x5d82e3=_0xf53ac9(0x1a0);else _0x573979?.['error']?.['message']&&(_0x5d82e3='Lỗi\x20từ\x20Gemini:\x20'+_0x573979['error'][_0xf53ac9(0x152)]);}return toast(_0x5d82e3,0xfa0),console[_0xf53ac9(0x143)](_0xf53ac9(0x157),_0x573979||_0x38b917[_0xf53ac9(0x304)]),null;}const _0x57a495=await _0x38b917['json']();if(_0x57a495[_0xf53ac9(0x2bc)]&&_0x57a495[_0xf53ac9(0x2bc)][0x0]?.[_0xf53ac9(0x331)]?.[_0xf53ac9(0x1c6)]?.[0x0]?.[_0xf53ac9(0x3b7)])return formatGeminiResponse(_0x57a495['candidates'][0x0][_0xf53ac9(0x331)]['parts'][0x0][_0xf53ac9(0x3b7)]);else{console['error'](_0xf53ac9(0x11b),_0x57a495);if(_0x57a495[_0xf53ac9(0x246)]?.[_0xf53ac9(0x388)])return _0xf53ac9(0x323)+_0x57a495[_0xf53ac9(0x246)][_0xf53ac9(0x388)]+_0xf53ac9(0x1ee);return _0xf53ac9(0x418);}}catch(_0x4c55cc){return console[_0xf53ac9(0x143)]('Lỗi\x20khi\x20gọi\x20Gemini\x20API:',_0x4c55cc),toast(_0xf53ac9(0x20c),0xfa0),null;}},loadLanguage(localStorage['getItem']('lang')||'vi')[_0x2ebaf0(0x18b)](initializeApp);
    </script>
</body>
</html>

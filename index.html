<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Ứng dụng Pomodoro hỗ trợ học tập với tích hợp Gemini AI và giao diện hiện đại." />
    <title>Pomodoro Study App — Tích hợp Gemini AI (Giao diện mới)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — PHIÊN BẢN GIAO DIỆN TẬP TRUNG (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Mặc định) - Cập nhật từ file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Thêm biến RGB cho panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: THÊM CÁC THEME MỚI === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: THÊM CÁC THEME MỚI === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Thêm các quy tắc border cho theme light/pastel */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Sửa đổi: bỏ border mặc định */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Sửa đổi */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Sửa đổi */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Giữ nền trong suốt khi di chuột qua */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Sửa đổi màu */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Sửa đổi màu */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */
    #view-timer .panel-bg hr {
        border: none; /* Bỏ đường viền mặc định */
        height: 1px;  /* Đặt chiều cao cho đường kẻ */
        background-color: var(--muted); /* Sử dụng màu phụ của theme */
        opacity: 0.3; /* Làm cho nó mờ đi, hòa vào nền */
        margin-top: 0; /* Điều chỉnh lại khoảng cách */
    }
    /* === END: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Sửa đổi */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Sửa đổi */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Sửa đổi */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Nâng z-index để nằm trên header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Sửa đổi */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Sửa đổi */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Sửa đổi */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Sửa đổi */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Sửa đổi */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Sửa đổi: chuyển sang nền trắng trong suốt */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Viền trắng mờ */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Tinh chỉnh: sát mẫu hơn */
        border-color: var(--acc);
    }
    /* === START: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Dùng nền đen mờ thay vì trắng mờ */
        border-color: rgba(0, 0, 0, 0.1); /* Viền đen mờ trên theme sáng */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Tăng độ đậm khi focus */
    }
    /* === END: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */

    /* Cải thiện nền và màu chữ cho option trong select theo theme hiện tại */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Sửa đổi */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Giảm/loại bỏ bóng chữ cho theme sáng để tránh nhòe/lóa */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
.method-item[open] summary {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
    [data-theme='light'] .method-item[open] summary,
    [data-theme='pastel'] .method-item[open] summary {
        border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* Method actions inline with summary and show on hover */
    .method-item summary { display: flex; align-items: center; justify-content: space-between; }
    .method-item summary > span { flex: 1; }
    .method-item summary .topic-actions { margin-left: 8px; }
    .method-title { cursor: pointer; }
    .method-item:hover .topic-actions, .method-item:focus-within .topic-actions { opacity: 1; visibility: visible; }

    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Đồng hồ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Đồng hồ</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Chủ đề">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Chủ đề</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Thống kê">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Thống kê</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Kho Tri Thức">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Kho Tri Thức</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Cài đặt">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Cài đặt</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Hướng dẫn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Hướng dẫn</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">Chưa chọn Chủ đề con</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard Tổng quan">📊 Tổng Quan </button>
          <button class="btn ghost small" id="btnExport" title="Xuất JSON">⬇️ Xuất File</button>
          <label class="btn ghost small" for="importFile" title="Nhập JSON">⬆️ Nhập File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Ẩn/Hiện giao diện">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Toàn màn hình">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Chào mừng đến với Pomodoro Study App!</h3>
                <p>Hãy bắt đầu bằng cách chọn một <strong>Chủ đề con</strong> hoặc tạo Chủ đề/Chủ đề con mới.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Tạo Chủ đề Mới</button>
            </div>
            <div class="presets" role="group" aria-label="Chọn chế độ preset">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">TRẠNG THÁI</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Checklist Hạ nhiệt</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Lưu công việc đang làm (Save/Commit).</li>
                <li>Ghi chú nhanh "Next step".</li>
                <li>Dọn dẹp không gian làm việc.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Bắt đầu (Space)">▶️ Bắt đầu</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="Kết thúc phiên làm việc">🧘 Bắt đầu nghỉ</button>
              <button class="btn" id="btnPause" aria-label="Tạm dừng (Space)">⏸️ Tạm dừng</button>
              <button class="btn" id="btnResume" aria-label="Tiếp tục (Space)">⏵ Tiếp tục</button>
              <button class="btn warn" id="btnSkip" aria-label="Bỏ qua (N)">⏭️ Bỏ qua</button>
              <button class="btn danger" id="btnReset">↺ Đặt lại</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Nghỉ sớm</button>
            </div>
            <div class="tiny">Phím tắt: <strong>Space</strong> = Bắt đầu/Tạm dừng/Tiếp tục, <strong>N</strong> = Tiếp theo/Bỏ qua</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Nhiệm vụ</button>
                <button class="tab-btn" data-tab="notes">Ghi chú</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-do cho chủ đề con này:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Thêm một task mới..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Thêm</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Thêm ghi chú mới..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Thêm ghi chú</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini cho: <span id="currentSubtopicNameChat">(chưa chọn)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Xóa lịch sử">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Giải thích khái niệm chính của chủ đề này">Giải thích khái niệm</button>
                  <button class="btn small ghost" data-prompt="Tạo một dàn ý chi tiết cho chủ đề này">Tạo dàn ý</button>
                  <button class="btn small ghost" data-prompt="Liệt kê 5 câu hỏi ôn tập quan trọng về chủ đề này">Tạo câu hỏi ôn tập</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Hỏi Gemini điều gì đó..." />
                  <button id="btnSendMessage" class="btn acc">Gửi</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Quản lý Chủ đề</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Thêm Chủ đề</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Nhấp mũi tên để mở/đóng danh sách chủ đề con.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Thống kê & Lịch sử — <span id="currentSubtopicName">(chưa chọn)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Tổng thời gian</h4><div class="stat-value" id="statTotal">0 phút</div></div>
              <div class="stat-card"><h4>Phiên</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Nhiệm vụ Hoàn thành</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">Lịch sử (LÀM VIỆC)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Kho Tri Thức Cá Nhân Hóa</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Thêm tri thức</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Nhấp vào từng mục để xem chi tiết.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Khám Phá Pomodoro Study App</h3>
              <p>
                  Chào mừng bạn đến với không gian học tập được thiết kế dành riêng cho sự tập trung và hiệu quả. Hãy cùng khám phá những tính năng sẽ đồng hành cùng bạn trên hành trình chinh phục tri thức.
              </p>

              <h4>🚀 Khởi Đầu Nhanh Chỉ Trong 4 Bước</h4>
              <p>Để hành trình của bạn luôn mạch lạc, mọi thứ trong ứng dụng được sắp xếp theo cấu trúc <strong>Chủ đề Lớn → Chủ đề con</strong>.</p>
              <ol>
                  <li>Mở mục <strong>📚 Chủ đề</strong> từ thanh điều hướng bên cạnh.</li>
                  <li>Nhấn <strong>＋ Thêm Chủ đề</strong> để tạo một lĩnh vực lớn (ví dụ: "Tiếng Anh Giao Tiếp").</li>
                  <li>Bên cạnh chủ đề vừa tạo, nhấn <strong>＋ Thêm</strong> để tạo một chủ đề con, chi tiết hơn (ví dụ: "Bài 1: Luyện phát âm IPA").</li>
                  <li>Chọn chủ đề con đó. Giờ đây, bạn đã sẵn sàng để bắt đầu phiên học đầu tiên của mình!</li>
              </ol>

              <hr />
              <h4>✨ Những Tính Năng Đáng Chú Ý</h4>

              <h4>Các Chế Độ Đồng Hồ Linh Hoạt ⏱️</h4>
              <p>Ứng dụng không chỉ có Pomodoro. Hãy chọn phương pháp phù hợp với công việc của bạn:</p>
              <ul>
                  <li><strong>Pomodoro Cổ Điển (Kiểu A/B):</strong> Làm việc tập trung trong các phiên định sẵn (ví dụ: 25 phút làm, 5 phút nghỉ) để xây dựng kỷ luật và nhịp độ.</li>
                  <li><strong>Chế độ Flowtime (Kiểu 🌊 Flow):</strong> Dành cho công việc cần dòng chảy sâu. Đồng hồ sẽ đếm lên, cho phép bạn làm việc đến khi tự cảm thấy cần nghỉ. Thời gian nghỉ sẽ được đề xuất dựa trên thời gian bạn đã làm việc.</li>
                  <li><strong>Đệm "Hạ nhiệt" (Wind-down):</strong> Một khoảng đệm tùy chỉnh giữa lúc làm và lúc nghỉ, giúp bạn kết thúc công việc đang dở, ghi chú lại "bước tiếp theo" và chuyển trạng thái một cách mượt mà, không bị cắt ngang đột ngột.</li>
              </ul>

              <h4>Kho Tri Thức Cá Nhân Hóa 💡</h4>
              <p>Bạn có thể <strong>Thêm, Sửa, Xóa</strong> các phương pháp và ghi chú quan trọng. Với trình soạn thảo mạnh mẽ, bạn dễ dàng định dạng tiêu đề, in đậm, tạo danh sách và thậm chí chọn màu chữ để làm nổi bật thông tin.</p>

              <h4>Quản Lý Chủ Đề Trực Quan</h4>
              <p>Dễ dàng sắp xếp các mục tiêu học tập của bạn. Sử dụng thao tác <strong>kéo và thả</strong> để sắp xếp lại thứ tự các Chủ đề hoặc di chuyển một Chủ đề con sang một lĩnh vực khác một cách trực quan.</p>

              <h4>Nhiệm Vụ & Ghi Chú Tích Hợp 📝</h4>
              <p>Ngay trong màn hình đồng hồ, bạn có thể tạo danh sách việc cần làm (to-do) cho từng chủ đề con hoặc ghi lại những ý tưởng chợt nảy ra mà không làm gián đoạn dòng chảy công việc.</p>

              <h4>Chế Độ Zen 🧘</h4>
              <p>Khi cần tập trung tuyệt đối, hãy nhấn vào biểu tượng con mắt (👁️). Giao diện sẽ ẩn đi, chỉ để lại hình nền và chiếc đồng hồ. Trong chế độ này, bạn có thể <strong>kéo thả đồng hồ</strong> đến bất kỳ vị trí nào trên màn hình để có một không gian làm việc gọn gàng nhất.</p>

              <h4>Thống Kê & Cột Mốc 🏆</h4>
              <p>Theo dõi hành trình của bạn qua những con số biết nói. Ứng dụng sẽ tự động ghi nhận và chúc mừng khi bạn đạt được những cột mốc quan trọng về thời gian tập trung, biến mỗi nỗ lực thành một thành tựu đáng tự hào.</p>

              <hr />
              <h4>⌨️ Phím Tắt Thông Minh</h4>
              <ul>
                  <li><kbd>Space</kbd>: Bắt đầu / Tạm dừng / Tiếp tục phiên học.</li>
                  <li><kbd>N</kbd>: Bỏ qua phiên làm việc hoặc nghỉ hiện tại.</li>
                  <li><kbd>Esc</kbd>: Đóng các cửa sổ đang mở (như Cài đặt).</li>
              </ul>

              <hr />
              <h4>🛠️ Cài Đặt Nâng Cao & Tích Hợp</h4>

              <h4>Trợ Lý Gemini AI 🧠</h4>
              <p>Biến ứng dụng thành một người bạn đồng hành thông minh. Ngoài việc hỏi đáp, bạn còn có thể:</p>
              <ul>
                  <li><strong>Tự động Định dạng Thông minh:</strong> Khi soạn thảo trong mục "Phương pháp", hãy để AI tự động phân tích và định dạng văn bản thô của bạn—tự nhận diện tiêu đề, các ý chính cần in đậm và danh sách.</li>
                  <li><strong>Thiết lập:</strong> Truy cập Google AI Studio để tạo API Key miễn phí và dán vào ô "Gemini API Key" trong Cài đặt của ứng dụng.</li>
              </ul>

              <h4>Tùy Biến Giao Diện & Âm Thanh 🎨</h4>
              <p>Biến không gian học tập thành của riêng bạn:</p>
              <ul>
                  <li><strong>Nhiều Theme & Hình nền:</strong> Lựa chọn giữa các theme có sẵn (Sáng, Tối, Pastel...) hoặc <strong>tải lên hình nền của riêng bạn</strong> để tạo cảm hứng.</li>
                  <li><strong>Âm báo Tùy chỉnh:</strong> Bạn có thể <strong>tải lên các file âm thanh (.mp3, .wav...) của riêng mình</strong> để sử dụng làm chuông báo cho các phiên làm việc và nghỉ ngơi.</li>
              </ul>

              <h4>Nhạc Nền YouTube 🎶</h4>
              <p>Tạo không gian học tập hoàn hảo bằng cách phát một video hoặc danh sách phát YouTube làm nhạc nền. Dán đường dẫn (URL) vào ô "Nhạc nền YouTube" trong Cài đặt.</p>

              <h4>An Toàn Dữ Liệu: Sao Lưu & Phục Hồi 🛡️</h4>
              <p>Ứng dụng tự động sao lưu tiến trình của bạn mỗi ngày. Bạn có thể tùy chỉnh số ngày lưu giữ bản sao lưu và phục hồi dữ liệu từ một ngày trong quá khứ nếu cần. ⚠️ <strong>Cảnh báo:</strong> Phục hồi sẽ ghi đè toàn bộ dữ liệu hiện tại.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Chúc mừng Bạn!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Tiếp tục hành trình!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Cài đặt</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Đồng hồ</button>
              <button class="tab-btn" data-tab="settings-ui">Giao diện & Âm thanh</button>
              <button class="tab-btn" data-tab="settings-integrations">Tích hợp</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Kiểu A </button>
                      <button class="btn ghost" data-preset-target="B"> Kiểu B </button>
                      <button class="btn ghost" data-preset-target="C"> Kiểu C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Thời lượng Pomodoro</h4>
                      <div class="row">
                          <label>LÀM VIỆC (phút)<input type="number" id="set_work" min="1" /></label>
                          <label>HẠ NHIỆT (phút)<input type="number" id="set_winddown" min="0" /></label>
                          <label>NGHỈ NGẮN (phút)<input type="number" id="set_short" min="1" /></label>
                          <label>NGHỈ DÀI (phút)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Chu kỳ Pomodoro<input type="number" id="set_cycles" min="1" /></label>
                          <label>Chu kỳ nghỉ dài<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Tỷ lệ nghỉ (Làm việc / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Gợi ý: Thời gian nghỉ = tổng thời gian làm việc / X. Mặc định là 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Tự động bắt đầu phiên tiếp theo</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Bật Hạ nhiệt sau phiên làm</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Giao diện</h4>
                      <div class="row">
                          <label>Theme Giao Diện
                                <select id="set_theme_color">
                                    <option value="default">Mặc định (Dark Blue)</option>
                                    <option value="light">Light - Trà Sữa</option>
                                    <option value="pastel">Pastel - Dễ thương</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Chế độ hiển thị nền
                              <select id="set_backgroundMode">
                                  <option value="cover">Lấp đầy (Mặc định)</option>
                                  <option value="contain">Vừa vặn (Sắc nét)</option>
                                  <option value="auto">Kích thước gốc (Lặp lại)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Hình nền
                              <label class="btn small ghost" for="uploadBg">Tải ảnh mới</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Xóa nền</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Độ trong suốt của nền</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Âm thanh</h4>
                      <div class="row">
                          <label>Âm lượng (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Kiểu âm báo
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Tùy chỉnh âm báo</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Âm báo hết LÀM VIỆC</small>
                              <label title="Âm báo hết LÀM VIỆC" class="btn small ghost" for="uploadSoundWork">LÀM VIỆC</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ NGẮN</small>
                              <label title="Âm báo hết NGHỈ NGẮN" class="btn small ghost" for="uploadSoundBreak">NGHỈ NGẮN</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ DÀI</small>
                              <label title="Âm báo hết NGHỈ DÀI" class="btn small ghost" for="uploadSoundLong">NGHỈ DÀI</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Tích hợp AI</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Dán API Key của bạn vào đây..." />
                      </label>
                      <div class="tiny">Cần có để sử dụng các tính năng AI. Lấy key miễn phí tại <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 Nhạc nền YouTube</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Dán link YouTube vào đây..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Dùng ảnh bìa video làm nền</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Dừng sẽ không tự phát lại cho đến khi bạn bấm ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Âm lượng</div>
                  </div>
                  <div>
                      <h4>🛡️ Cài đặt sao lưu</h4>
                      <div class="row">
                          <label>Số ngày sao lưu cần giữ lại
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Phục hồi dữ liệu</h4>
                      <p class="tiny">Phục hồi dữ liệu từ một bản sao lưu tự động hàng ngày. Hành động này sẽ ghi đè lên dữ liệu hiện tại của bạn.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Phục hồi</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Mặc định</button>
              <button class="btn acc" id="btnSaveSettings">Lưu</button>
              <button class="btn" id="btnCloseSettings">Đóng</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Ghi chú cho phiên vừa hoàn thành</h3>
      <div class="row"><textarea id="noteText" placeholder="Bạn học được gì? Khó khăn? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Tóm tắt & Gợi ý</button>
        <button class="btn" id="btnSkipNote">Bỏ qua</button>
        <button class="btn acc" id="btnSaveNote">Lưu ghi chú</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Tiêu đề</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Hủy</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Tổng quan</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Đóng</button>
        </div>
        <p class="tiny">Tổng hợp thời gian và số phiên đã hoàn thành trên tất cả các chủ đề.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Chỉnh-sửa Phương-pháp</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Tiêu-đề<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Nội-dung</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Tiêu-đề nhỏ">H</button>
          <button id="toolBold" class="btn small ghost" title="In đậm">B</button>
          <button id="toolItalic" class="btn small ghost" title="In nghiêng">I</button>
          <button id="toolList" class="btn small ghost" title="Danh-sách">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Danh sách chấm tròn">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Màu chữ">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Màu chữ mặc định"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Màu nhấn mạnh"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Màu tích cực"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Màu cảnh báo"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Màu nguy hiểm"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Màu tím"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="Tính năng này yêu cầu Gemini API Key">✨ Tự động định dạng</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Hủy</button>
          <button class="btn acc" id="btnSaveMethod">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Nhấn "Bật âm thanh" để cho phép phát nhạc nền.</span>
    <button id="btnEnableSound" class="btn small acc">Bật âm thanh</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
    const _0x4900e5=_0x1eb0;(function(_0x547155,_0x2bbfe6){const _0x3f671c=_0x1eb0,_0x23971b=_0x547155();while(!![]){try{const _0x5d2fda=-parseInt(_0x3f671c(0x2e1))/0x1+parseInt(_0x3f671c(0x46a))/0x2*(-parseInt(_0x3f671c(0x22e))/0x3)+-parseInt(_0x3f671c(0x387))/0x4*(parseInt(_0x3f671c(0x3bb))/0x5)+parseInt(_0x3f671c(0x21f))/0x6*(-parseInt(_0x3f671c(0x343))/0x7)+parseInt(_0x3f671c(0x329))/0x8*(parseInt(_0x3f671c(0x480))/0x9)+-parseInt(_0x3f671c(0x3c4))/0xa*(parseInt(_0x3f671c(0x2c9))/0xb)+parseInt(_0x3f671c(0x200))/0xc;if(_0x5d2fda===_0x2bbfe6)break;else _0x23971b['push'](_0x23971b['shift']());}catch(_0x18b7d6){_0x23971b['push'](_0x23971b['shift']());}}}(_0x344a,0xc5fa2),window[_0x4900e5(0x1da)](_0x4900e5(0x364),()=>{try{updateFullscreenButton();}catch(_0xf4ba5){}}));const IS_FILE_PROTOCOL=window[_0x4900e5(0x410)][_0x4900e5(0x326)]==='file:';function startYtApiWatchdog(){const _0x4be265=_0x4900e5,_0x1cfb32=document[_0x4be265(0x3ea)](_0x4be265(0x19c));if(!_0x1cfb32)return;const _0x26c016=setTimeout(()=>{const _0x2c3706=_0x4be265;try{(!window['YT']||!window['YT'][_0x2c3706(0x2d9)])&&(_0x1cfb32['textContent']=_0x2c3706(0x3c0),_0x1cfb32[_0x2c3706(0x365)][_0x2c3706(0x427)]=_0x2c3706(0x227));}catch(_0x23ec4f){}},0x5dc),_0x10a6b4=setTimeout(()=>{const _0x55a02f=_0x4be265;try{(!window['YT']||!window['YT'][_0x55a02f(0x2d9)])&&(_0x1cfb32['textContent']=_0x55a02f(0x42d),_0x1cfb32[_0x55a02f(0x365)][_0x55a02f(0x427)]='var(--danger)');}catch(_0xbf2390){}},0x1b58);window[_0x4be265(0x1a0)]={'cancel'(){clearTimeout(_0x26c016),clearTimeout(_0x10a6b4);}};}(function(){const _0x5759ec=_0x4900e5,_0x316bfd={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>_0x5759ec(0x44a)+current+'/'+target,'timer.selectSubtopicPrompt':_0x5759ec(0x1f2)};window['t']=function _0x23c59c(_0x1f9cf9,_0x373c4f){try{const _0x2b80ed=_0x316bfd[_0x1f9cf9];if(typeof _0x2b80ed==='function')return _0x2b80ed(_0x373c4f||{});if(typeof _0x2b80ed==='string')return _0x2b80ed;}catch(_0x22ea11){}return _0x1f9cf9;},window[_0x5759ec(0x303)]=function _0x12c10c(_0x499f2d){const _0x3ccd8e=_0x5759ec;try{localStorage[_0x3ccd8e(0x462)](_0x3ccd8e(0x174),_0x499f2d||'vi');}catch(_0x418b9e){}return Promise['resolve']();};}());function ensureYouTubeAPI(){const _0x1adb8a=_0x4900e5;if(IS_FILE_PROTOCOL)return Promise[_0x1adb8a(0x265)](![]);try{if(window['YT']&&window['YT']['Player'])return Promise[_0x1adb8a(0x265)](!![]);}catch(_0x281973){}if(window[_0x1adb8a(0x23e)])return window[_0x1adb8a(0x23e)];return startYtApiWatchdog(),window[_0x1adb8a(0x23e)]=new Promise((_0xf00bce,_0x593ea7)=>{const _0x21a85d=_0x1adb8a;try{const _0x157183=document[_0x21a85d(0x3a7)](_0x21a85d(0x315));_0x157183[_0x21a85d(0x398)]=_0x21a85d(0x179),_0x157183[_0x21a85d(0x252)]=!![],_0x157183['defer']=!![],_0x157183[_0x21a85d(0x39c)]=()=>_0xf00bce(!![]),_0x157183[_0x21a85d(0x2e0)]=()=>_0x593ea7(new Error(_0x21a85d(0x3ad))),document[_0x21a85d(0x36e)][_0x21a85d(0x20d)](_0x157183);}catch(_0x14d032){_0x593ea7(_0x14d032);}}),window[_0x1adb8a(0x23e)];}const storageManager={'DB_NAME':_0x4900e5(0x396),'DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x1f720f,_0x4f7f61)=>{const _0x11cf2d=_0x1eb0;if(this['db'])return _0x1f720f(this['db']);const _0x130f64=indexedDB[_0x11cf2d(0x1ce)](this[_0x11cf2d(0x269)],this[_0x11cf2d(0x2e2)]);_0x130f64[_0x11cf2d(0x483)]=_0x18edbd=>{const _0x537b58=_0x11cf2d,_0x42a14f=_0x18edbd[_0x537b58(0x1b1)][_0x537b58(0x473)];!_0x42a14f[_0x537b58(0x216)]['contains'](_0x537b58(0x27a))&&_0x42a14f[_0x537b58(0x3b0)](_0x537b58(0x27a));!_0x42a14f[_0x537b58(0x216)]['contains'](_0x537b58(0x2c8))&&_0x42a14f['createObjectStore']('topics',{'keyPath':'id'});if(!_0x42a14f['objectStoreNames'][_0x537b58(0x25f)](_0x537b58(0x2ee))){const _0x55d03b=_0x42a14f[_0x537b58(0x3b0)](_0x537b58(0x2ee),{'keyPath':'id'});_0x55d03b[_0x537b58(0x488)](_0x537b58(0x41b),_0x537b58(0x35b));}!_0x42a14f[_0x537b58(0x216)]['contains'](_0x537b58(0x2c5))&&_0x42a14f['createObjectStore'](_0x537b58(0x2c5),{'keyPath':_0x537b58(0x260)});},_0x130f64[_0x11cf2d(0x296)]=_0x34a5ae=>{const _0x7d01a3=_0x11cf2d;this['db']=_0x34a5ae[_0x7d01a3(0x1b1)][_0x7d01a3(0x473)],console[_0x7d01a3(0x181)](_0x7d01a3(0x1a7)),_0x1f720f(this['db']);},_0x130f64[_0x11cf2d(0x2e0)]=_0x2a0cc8=>{const _0x356ec6=_0x11cf2d;console[_0x356ec6(0x454)](_0x356ec6(0x346),_0x2a0cc8[_0x356ec6(0x1b1)][_0x356ec6(0x25b)]),_0x4f7f61(_0x2a0cc8[_0x356ec6(0x1b1)][_0x356ec6(0x454)]);};});},async '_getStore'(_0x17a097,_0x30ff23=_0x4900e5(0x37e)){const _0x207952=_0x4900e5;await this[_0x207952(0x1f0)]();const _0x1ab3dc=this['db'][_0x207952(0x3ed)]([_0x17a097],_0x30ff23);return _0x1ab3dc[_0x207952(0x393)](_0x17a097);},async 'getSettings'(){const _0x460e90=_0x4900e5,_0x56a76c=await this[_0x460e90(0x44b)](_0x460e90(0x27a));return new Promise((_0x23f323,_0xd27ae9)=>{const _0x2b9075=_0x460e90,_0x7f8fe4=_0x56a76c['get']('main_settings');_0x7f8fe4[_0x2b9075(0x296)]=()=>_0x23f323(_0x7f8fe4['result']),_0x7f8fe4[_0x2b9075(0x2e0)]=()=>_0xd27ae9(_0x7f8fe4[_0x2b9075(0x454)]);});},async 'updateSettings'(_0x4fd67d){const _0x327ec9=_0x4900e5,_0x44a93d=await this['_getStore']('settings',_0x327ec9(0x428));return new Promise((_0x15f5b9,_0x18f0a1)=>{const _0x649cfc=_0x327ec9,_0x190159=_0x44a93d[_0x649cfc(0x311)](_0x4fd67d,'main_settings');_0x190159[_0x649cfc(0x296)]=()=>_0x15f5b9(_0x190159[_0x649cfc(0x473)]),_0x190159['onerror']=()=>_0x18f0a1(_0x190159[_0x649cfc(0x454)]);});},async 'getAll'(_0x2fdf81){const _0x5e6f5e=_0x4900e5,_0x1d90e8=await this[_0x5e6f5e(0x44b)](_0x2fdf81);return new Promise((_0x36e4df,_0x4903e7)=>{const _0x44cd10=_0x5e6f5e,_0x85f5ed=_0x1d90e8[_0x44cd10(0x3c1)]();_0x85f5ed[_0x44cd10(0x296)]=()=>_0x36e4df(_0x85f5ed[_0x44cd10(0x473)]),_0x85f5ed['onerror']=()=>_0x4903e7(_0x85f5ed['error']);});},async 'update'(_0x15bcbe,_0x28697d){const _0x289c1c=_0x4900e5,_0x2d7e13=await this[_0x289c1c(0x44b)](_0x15bcbe,_0x289c1c(0x428));return new Promise((_0x2edb13,_0x10ae2b)=>{const _0x3c330b=_0x289c1c,_0x2b021c=_0x2d7e13[_0x3c330b(0x311)](_0x28697d);_0x2b021c[_0x3c330b(0x296)]=()=>_0x2edb13(_0x2b021c[_0x3c330b(0x473)]),_0x2b021c[_0x3c330b(0x2e0)]=()=>_0x10ae2b(_0x2b021c[_0x3c330b(0x454)]);});},async 'add'(_0x35a87a,_0x538ed8){const _0x15c02a=_0x4900e5,_0x3c0125=await this[_0x15c02a(0x44b)](_0x35a87a,_0x15c02a(0x428));return new Promise((_0x299065,_0x52ed45)=>{const _0x33b42c=_0x15c02a,_0x2f6a18=_0x3c0125['add'](_0x538ed8);_0x2f6a18['onsuccess']=()=>_0x299065(_0x2f6a18[_0x33b42c(0x473)]),_0x2f6a18[_0x33b42c(0x2e0)]=()=>_0x52ed45(_0x2f6a18[_0x33b42c(0x454)]);});},async 'delete'(_0x2494bc,_0x374fd8){const _0x235551=_0x4900e5,_0x20a275=await this[_0x235551(0x44b)](_0x2494bc,'readwrite');return new Promise((_0x33d8e,_0x5158be)=>{const _0x516bfe=_0x235551,_0x52e9f4=_0x20a275[_0x516bfe(0x20b)](_0x374fd8);_0x52e9f4[_0x516bfe(0x296)]=()=>_0x33d8e(_0x52e9f4[_0x516bfe(0x473)]),_0x52e9f4[_0x516bfe(0x2e0)]=()=>_0x5158be(_0x52e9f4['error']);});},async 'save'(_0x43c3bd){return await this['initDB'](),new Promise((_0x1902e2,_0x1a2646)=>{const _0x433a5a=_0x1eb0,_0x285e0b=this['db']['transaction']([_0x433a5a(0x27a),_0x433a5a(0x2c8),_0x433a5a(0x2ee)],'readwrite'),_0x1ed626=_0x285e0b[_0x433a5a(0x393)](_0x433a5a(0x27a)),_0x1fcd5f=_0x285e0b['objectStore'](_0x433a5a(0x2c8)),_0x316495=_0x285e0b[_0x433a5a(0x393)]('subtopics');_0x1ed626[_0x433a5a(0x311)](_0x43c3bd[_0x433a5a(0x27a)],_0x433a5a(0x3d1)),_0x1fcd5f[_0x433a5a(0x205)](),_0x316495[_0x433a5a(0x205)](),_0x43c3bd[_0x433a5a(0x2c8)]['forEach'](_0xe1efa6=>{const _0x6248fe=_0x433a5a,{subtopics:_0x363299,..._0x1d5a3c}=_0xe1efa6;_0x1fcd5f[_0x6248fe(0x311)](_0x1d5a3c),(_0x363299||[])[_0x6248fe(0x29b)](_0x1d40b2=>_0x316495[_0x6248fe(0x311)](_0x1d40b2));}),_0x285e0b['oncomplete']=()=>_0x1902e2(),_0x285e0b[_0x433a5a(0x2e0)]=_0x45cda4=>_0x1a2646(_0x45cda4[_0x433a5a(0x1b1)]['error']);});},async 'autoBackup'(_0x122c5d){const _0xca83de=_0x4900e5;await this[_0xca83de(0x1f0)]();const _0x13595c=new Date()[_0xca83de(0x416)]()[_0xca83de(0x225)](0x0,0xa),_0xbc7ca2=localStorage['getItem'](_0xca83de(0x186));if(_0x13595c!==_0xbc7ca2){console[_0xca83de(0x181)](_0xca83de(0x172)+_0x13595c+_0xca83de(0x2d6));const _0x5bbb52={'date':_0x13595c,'data':JSON[_0xca83de(0x235)](JSON[_0xca83de(0x281)](_0x122c5d))},_0x8c143c=this['db']['transaction']([_0xca83de(0x2c5)],_0xca83de(0x428)),_0x3cf569=_0x8c143c['objectStore'](_0xca83de(0x2c5)),_0x1e40b3=_0x3cf569[_0xca83de(0x311)](_0x5bbb52);_0x1e40b3['onsuccess']=()=>{const _0x10d132=_0xca83de;localStorage['setItem'](_0x10d132(0x186),_0x13595c),console[_0x10d132(0x181)](_0x10d132(0x1ba)),this['cleanupOldBackups'](_0x122c5d?.[_0x10d132(0x27a)]?.['backupDaysToKeep']||0x7);},_0x1e40b3['onerror']=_0x310fcd=>{const _0x509ace=_0xca83de;console[_0x509ace(0x454)](_0x509ace(0x3b7),_0x310fcd[_0x509ace(0x1b1)][_0x509ace(0x454)]);};}},async 'cleanupOldBackups'(_0x519b68){const _0x1ec9e7=_0x4900e5;await this[_0x1ec9e7(0x1f0)]();const _0x402c10=this['db']['transaction']([_0x1ec9e7(0x2c5)],_0x1ec9e7(0x428)),_0x52826c=_0x402c10[_0x1ec9e7(0x393)](_0x1ec9e7(0x2c5)),_0x60b098=_0x52826c[_0x1ec9e7(0x43d)]();_0x60b098[_0x1ec9e7(0x296)]=()=>{const _0x5a3594=_0x1ec9e7,_0x50e773=_0x60b098[_0x5a3594(0x473)]['sort']()[_0x5a3594(0x24c)]();if(_0x50e773[_0x5a3594(0x34b)]>_0x519b68){const _0x4dbe8e=_0x50e773[_0x5a3594(0x225)](_0x519b68);_0x4dbe8e['forEach'](_0x4fba1c=>{const _0x39aa33=_0x5a3594;_0x52826c[_0x39aa33(0x20b)](_0x4fba1c),console[_0x39aa33(0x181)](_0x39aa33(0x1d6)+_0x4fba1c);});}};},async 'getBackupList'(){const _0x35c023=_0x4900e5;return await this[_0x35c023(0x1f0)](),new Promise((_0x2d0019,_0x1b5d5c)=>{const _0x126a16=_0x35c023,_0x52f8c7=this['db'][_0x126a16(0x3ed)](['backups'],_0x126a16(0x37e)),_0x7b74c0=_0x52f8c7[_0x126a16(0x393)]('backups'),_0x92cac4=_0x7b74c0['getAll']();_0x92cac4[_0x126a16(0x296)]=()=>_0x2d0019(_0x92cac4[_0x126a16(0x473)][_0x126a16(0x1a8)]((_0x106d8e,_0x2bdbbf)=>_0x2bdbbf[_0x126a16(0x260)][_0x126a16(0x3e0)](_0x106d8e['date']))),_0x92cac4[_0x126a16(0x2e0)]=_0x1dc043=>_0x1b5d5c(_0x1dc043[_0x126a16(0x1b1)][_0x126a16(0x454)]);});},async 'restoreBackup'(_0x435bbb){const _0x3106e5=_0x4900e5;return await this[_0x3106e5(0x1f0)](),new Promise((_0x5696e5,_0x4f5d9c)=>{const _0x2fe9cb=_0x3106e5,_0x3bda94=this['db'][_0x2fe9cb(0x3ed)]([_0x2fe9cb(0x2c5)],_0x2fe9cb(0x37e)),_0x563a17=_0x3bda94['objectStore'](_0x2fe9cb(0x2c5)),_0x169a32=_0x563a17[_0x2fe9cb(0x3d5)](_0x435bbb);_0x169a32['onsuccess']=()=>{const _0x8887b5=_0x2fe9cb;_0x169a32[_0x8887b5(0x473)]&&_0x169a32[_0x8887b5(0x473)][_0x8887b5(0x3b1)]?(localStorage[_0x8887b5(0x462)](_0x8887b5(0x30c),JSON[_0x8887b5(0x281)](_0x169a32[_0x8887b5(0x473)][_0x8887b5(0x3b1)])),_0x5696e5(_0x169a32['result'][_0x8887b5(0x3b1)])):_0x4f5d9c(new Error('Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.'));},_0x169a32[_0x2fe9cb(0x2e0)]=_0xf07428=>_0x4f5d9c(_0xf07428[_0x2fe9cb(0x1b1)][_0x2fe9cb(0x454)]);});},'exportData'(_0x254bcd){const _0x2ba6d2=_0x4900e5;let _0x49d8fb={};try{_0x49d8fb=JSON[_0x2ba6d2(0x235)](JSON[_0x2ba6d2(0x281)](_0x254bcd||{}));}catch(_0xa506b6){_0x49d8fb=_0x254bcd;}try{if(_0x49d8fb&&_0x49d8fb[_0x2ba6d2(0x27a)])_0x49d8fb['settings']['apiKey']='';}catch(_0x5930b8){}const _0x36e7be=new Blob([JSON[_0x2ba6d2(0x281)](_0x49d8fb,null,0x2)],{'type':_0x2ba6d2(0x325)}),_0x435ea1=document[_0x2ba6d2(0x3a7)]('a'),_0x4b8f83=new Date(),_0x4729b0=_0x26c2dc=>(''+_0x26c2dc)[_0x2ba6d2(0x1cc)](0x2,'0');_0x435ea1['href']=URL['createObjectURL'](_0x36e7be),_0x435ea1[_0x2ba6d2(0x406)]=_0x2ba6d2(0x34d)+_0x4b8f83[_0x2ba6d2(0x263)]()+_0x4729b0(_0x4b8f83[_0x2ba6d2(0x331)]()+0x1)+_0x4729b0(_0x4b8f83[_0x2ba6d2(0x38b)]())+_0x2ba6d2(0x255),_0x435ea1['click'](),URL[_0x2ba6d2(0x1cd)](_0x435ea1[_0x2ba6d2(0x41c)]);},async 'importData'(_0x3e8d61){const _0x13b0e3=_0x4900e5,_0x5e74f3=await _0x3e8d61[_0x13b0e3(0x1e0)](),_0x322550=JSON[_0x13b0e3(0x235)](_0x5e74f3);if(!_0x322550['version']||!_0x322550[_0x13b0e3(0x27a)]||!Array[_0x13b0e3(0x3cd)](_0x322550[_0x13b0e3(0x2c8)]))throw new Error(_0x13b0e3(0x310));try{const _0xe154f6=window[_0x13b0e3(0x3b1)]&&window[_0x13b0e3(0x3b1)][_0x13b0e3(0x27a)]&&window[_0x13b0e3(0x3b1)][_0x13b0e3(0x27a)]['apiKey']||'';(!(_0x13b0e3(0x419)in _0x322550['settings'])||_0x322550['settings'][_0x13b0e3(0x419)]==='')&&(_0x322550[_0x13b0e3(0x27a)][_0x13b0e3(0x419)]=_0xe154f6);}catch(_0x523f8e){}return localStorage['setItem']('pomodoroData_v11',JSON[_0x13b0e3(0x281)](_0x322550)),_0x322550;}},$=(_0x3fd116,_0x20e82b=document)=>_0x20e82b[_0x4900e5(0x413)](_0x3fd116),breakSuggestions=[_0x4900e5(0x377),_0x4900e5(0x319),_0x4900e5(0x354),_0x4900e5(0x230),_0x4900e5(0x1d8),_0x4900e5(0x487),_0x4900e5(0x213),_0x4900e5(0x318),_0x4900e5(0x2c1),_0x4900e5(0x195),_0x4900e5(0x399),_0x4900e5(0x464),_0x4900e5(0x3ec),'Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.',_0x4900e5(0x20e),'Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.',_0x4900e5(0x2f2),_0x4900e5(0x1d7),_0x4900e5(0x402),_0x4900e5(0x254),_0x4900e5(0x363),_0x4900e5(0x373),_0x4900e5(0x2e4),_0x4900e5(0x34c),'Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.',_0x4900e5(0x45f),_0x4900e5(0x2d5),_0x4900e5(0x1e2),_0x4900e5(0x251),_0x4900e5(0x274)],$$=(_0x13a2e7,_0x489f43=document)=>Array[_0x4900e5(0x481)](_0x489f43['querySelectorAll'](_0x13a2e7));function on(_0x2fd210,_0x38e2d7,_0xcb2533){const _0x3b7a88=_0x4900e5;if(!_0x2fd210){console[_0x3b7a88(0x2b6)](_0x3b7a88(0x18c),_0x38e2d7);return;}_0x2fd210[_0x3b7a88(0x1da)](_0x38e2d7,_0xcb2533);}const formatMMSS=_0x43fee9=>{const _0x3bc6c6=_0x4900e5,_0x3c9ee6=Math[_0x3bc6c6(0x2cc)](_0x43fee9/0x3c)[_0x3bc6c6(0x436)]()[_0x3bc6c6(0x1cc)](0x2,'0'),_0x19370f=Math[_0x3bc6c6(0x2cc)](_0x43fee9%0x3c)[_0x3bc6c6(0x436)]()[_0x3bc6c6(0x1cc)](0x2,'0');return _0x3c9ee6+':'+_0x19370f;},uid=(_0x46d002='id')=>_0x46d002+'_'+Date['now']()+'_'+Math[_0x4900e5(0x3e2)]()[_0x4900e5(0x436)](0x24)[_0x4900e5(0x225)](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0x287bb7){const _0x47d698=_0x4900e5;try{const _0x22d4ae=_0x287bb7[_0x47d698(0x16d)](_0x47d698(0x292));if(!_0x22d4ae['length'])return;const _0xbea0aa=_0x22d4ae[0x0],_0x471294=_0x22d4ae[_0x22d4ae[_0x47d698(0x34b)]-0x1],_0x174352=_0x5d3037=>{const _0x2a9a81=_0x47d698;if(_0x5d3037[_0x2a9a81(0x333)]==='Tab'){if(_0x5d3037[_0x2a9a81(0x40e)]&&document[_0x2a9a81(0x2bc)]===_0xbea0aa)_0x5d3037[_0x2a9a81(0x305)](),_0x471294[_0x2a9a81(0x45a)]();else!_0x5d3037[_0x2a9a81(0x40e)]&&document[_0x2a9a81(0x2bc)]===_0x471294&&(_0x5d3037[_0x2a9a81(0x305)](),_0xbea0aa[_0x2a9a81(0x45a)]());}};_0x287bb7['addEventListener'](_0x47d698(0x1d9),_0x174352),_0xbea0aa[_0x47d698(0x45a)](),__releaseFocusTrap=()=>{const _0x30aa4e=_0x47d698;try{_0x287bb7[_0x30aa4e(0x1c7)](_0x30aa4e(0x1d9),_0x174352);}catch(_0xc5e7db){}};}catch(_0x10cef8){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x1ad37c){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()[_0x4900e5(0x416)]();function toast(_0x42965d,_0x4de95a=0xa28){const _0x2a6491=_0x4900e5,_0x3b7842=$('#toasts'),_0x27e655=document[_0x2a6491(0x3a7)](_0x2a6491(0x306));_0x27e655[_0x2a6491(0x2ad)]=_0x2a6491(0x3fc),_0x27e655['textContent']=_0x42965d,_0x3b7842[_0x2a6491(0x20d)](_0x27e655),setTimeout(()=>{const _0x1ba189=_0x2a6491;_0x27e655[_0x1ba189(0x365)][_0x1ba189(0x474)]='0';},_0x4de95a-0x12c),setTimeout(()=>_0x3b7842[_0x2a6491(0x1b5)](_0x27e655),_0x4de95a);}function escapeHTML(_0x4209bb){const _0x34fa8f=_0x4900e5;return _0x4209bb[_0x34fa8f(0x463)](/[&<>"']/g,_0x1d3c0a=>({'&':_0x34fa8f(0x30d),'<':_0x34fa8f(0x2a9),'>':_0x34fa8f(0x250),'\x22':_0x34fa8f(0x20c),'\x27':_0x34fa8f(0x341)}[_0x1d3c0a]));}function formatDaysHoursMinutes(_0xc380ce){const _0x14f535=_0x4900e5;if(!_0xc380ce||_0xc380ce<0x1)return _0x14f535(0x394);const _0x1b1a01=Math[_0x14f535(0x2cc)](_0xc380ce/0x3c),_0x55798e=_0xc380ce%0x3c,_0x1273d7=_0x55798e[_0x14f535(0x436)]()['padStart'](0x2,'0');return _0x1b1a01+_0x14f535(0x477)+_0x1273d7+_0x14f535(0x24a);}function formatGeminiResponse(_0x166d41){const _0x4dfeb3=_0x4900e5;return _0x166d41[_0x4dfeb3(0x463)](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0x294aed){const _0x512aab=_0x4900e5,_0x2b23c6=(_0x294aed||'')[_0x512aab(0x190)]('\x0a');let _0x5d2b13='',_0x8c8429=null;const _0x31df7e=()=>{const _0xeb34aa=_0x512aab;_0x8c8429&&(_0x5d2b13+=_0x8c8429==='ol'?_0xeb34aa(0x357):'</ul>',_0x8c8429=null);};for(let _0x14b103 of _0x2b23c6){let _0x352e9a=(_0x14b103||'')[_0x512aab(0x214)]();if(!_0x352e9a){_0x31df7e();continue;}if(_0x352e9a[_0x512aab(0x162)](_0x512aab(0x3a3)))_0x31df7e(),_0x5d2b13+=_0x512aab(0x286)+escapeHTML(_0x352e9a[_0x512aab(0x37c)](0x5))+_0x512aab(0x2ed);else{if(/^\d+\.\s/[_0x512aab(0x342)](_0x352e9a)){_0x8c8429!=='ol'&&(_0x31df7e(),_0x5d2b13+=_0x512aab(0x1fa),_0x8c8429='ol');const _0x1f4e88=_0x352e9a[_0x512aab(0x37c)](_0x352e9a[_0x512aab(0x16b)]('\x20')+0x1);_0x5d2b13+=_0x512aab(0x279)+escapeHTML(_0x1f4e88)+_0x512aab(0x1f3);}else _0x352e9a[_0x512aab(0x162)]('-\x20')?(_0x8c8429!=='ul'&&(_0x31df7e(),_0x5d2b13+='<ul>',_0x8c8429='ul'),_0x5d2b13+='<li>'+escapeHTML(_0x352e9a[_0x512aab(0x37c)](0x2))+'</li>'):(_0x31df7e(),_0x352e9a=escapeHTML(_0x352e9a)[_0x512aab(0x463)](/\*\*(.*?)\*\*/g,_0x512aab(0x228))[_0x512aab(0x463)](/_(.*?)_/g,_0x512aab(0x276)),_0x5d2b13+=_0x512aab(0x19b)+_0x352e9a+_0x512aab(0x308));}}return _0x31df7e(),_0x5d2b13;}function wrapTextInMarkdown(_0xb519b0,_0x1f48ec,_0x1d35bc=''){const _0x468cc5=_0x4900e5;if(!_0xb519b0)return;const _0x30d13a=_0xb519b0[_0x468cc5(0x3cb)]||0x0,_0x4481c0=_0xb519b0[_0x468cc5(0x19f)]||0x0,_0x15f20a=_0xb519b0[_0x468cc5(0x1f4)][_0x468cc5(0x37c)](_0x30d13a,_0x4481c0),_0x4a8e58=_0x1f48ec+_0x15f20a+(_0x1d35bc||_0x1f48ec);_0xb519b0['setRangeText'](_0x4a8e58,_0x30d13a,_0x4481c0,_0x468cc5(0x466)),_0xb519b0[_0x468cc5(0x45a)]();}function updateEditorPreview(){const _0x1570a5=_0x4900e5,_0x402688=$(_0x1570a5(0x381)),_0x2a6129=$(_0x1570a5(0x199));if(!_0x402688||!_0x2a6129)return;const _0x89dcf3=_0x402688[_0x1570a5(0x1f4)]||'';_0x2a6129[_0x1570a5(0x180)]=parseSimpleMarkdown(_0x89dcf3);}function normalizeDataStructure(_0x41ec2a){const _0x1e89ab=_0x4900e5;if(!_0x41ec2a||typeof _0x41ec2a!=='object')return;const _0x34bbc8=_0x41ec2a['settings']||{},_0x254879={...defaults[_0x1e89ab(0x27a)],..._0x34bbc8,'durations':{...defaults[_0x1e89ab(0x27a)][_0x1e89ab(0x168)],..._0x34bbc8[_0x1e89ab(0x168)]||{}}};if(!Array[_0x1e89ab(0x3cd)](_0x254879[_0x1e89ab(0x37d)]))_0x254879['achievedMilestones']=[];_0x41ec2a[_0x1e89ab(0x27a)]=_0x254879,_0x41ec2a[_0x1e89ab(0x2c8)]=Array[_0x1e89ab(0x3cd)](_0x41ec2a[_0x1e89ab(0x2c8)])?_0x41ec2a[_0x1e89ab(0x2c8)]:[],_0x41ec2a['topics'][_0x1e89ab(0x29b)](_0x4846f3=>{const _0x1501f7=_0x1e89ab;_0x4846f3[_0x1501f7(0x2ee)]=Array[_0x1501f7(0x3cd)](_0x4846f3[_0x1501f7(0x2ee)])?_0x4846f3[_0x1501f7(0x2ee)]:[],_0x4846f3[_0x1501f7(0x2ee)][_0x1501f7(0x29b)](_0x46f9e2=>{const _0x2b2871=_0x1501f7;_0x46f9e2['tasks']=_0x46f9e2[_0x2b2871(0x2a6)]||[],_0x46f9e2[_0x2b2871(0x2bd)]=_0x46f9e2[_0x2b2871(0x2bd)]||[],_0x46f9e2[_0x2b2871(0x26b)]=_0x46f9e2[_0x2b2871(0x26b)]||[],_0x46f9e2['chatHistory']=_0x46f9e2[_0x2b2871(0x3f1)]||[],_0x46f9e2[_0x2b2871(0x283)]=_0x46f9e2[_0x2b2871(0x283)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x46f9e2[_0x2b2871(0x43a)]=_0x46f9e2[_0x2b2871(0x43a)]||[],_0x46f9e2['timerState']=_0x46f9e2[_0x2b2871(0x223)]||{'state':_0x2b2871(0x41f),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x3059a6){const _0x559d22=_0x4900e5;if(!_0x3059a6)return null;const _0x5ca6af=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0x300f70=_0x3059a6[_0x559d22(0x434)](_0x5ca6af);return _0x300f70?_0x300f70[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x1e1eef=_0x4900e5;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x318bf3=document[_0x1e1eef(0x3ea)]('set_youtubeUrl'),_0x1ce2c8=(_0x318bf3&&_0x318bf3[_0x1e1eef(0x1f4)]?_0x318bf3['value']:'')['trim']();return _0x1ce2c8;}catch(_0x2632e6){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function _0x344a(){const _0x39b879=['</label>','#methodEditorTitle','yt-fallback','AutoBackup\x20error:','pastel','Backup\x20failed:','Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.','setVolume','function','5AhgYVl','\x20phút\x20theo\x20Flowtime\x20(','\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22','hist-item','selectedSubtopicId','Đang\x20tải\x20API\x20YouTube...','getAll','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','#chatMessages','2655090HsmaRY','<div\x20class=\x22spinner\x22></div>','#btnAddGeneralNote','requestFullscreen','💡\x20Gợi\x20ý:\x20','bottom','menu-item\x20danger','selectionStart','#btnSummarizeNote','isArray','B_short','#btnHelpCreateTopic','long_break','main_settings','Lỗi\x20lưu\x20file.','contentWindow','prompt','get','#btnToggleYtSound','change','B_winddown','active','#set_long','tab','Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.','break','toLocaleString','Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.','localeCompare','persistTimerState','random','btn\x20small\x20danger','onkeydown','absolute','block','A_work','all','Đã\x20lưu\x20ghi\x20chú','getElementById','getBoundingClientRect','Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','transaction','classList','display','Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','chatHistory','method-content','#btnCloseSettings','beep','SẴN\x20SÀNG','task','mute','#set_autoStartNext','insertUnorderedList','tagName','modalMethodEditor','toast','allow','tasksCompleted','btn\x20small\x20danger\x20method-delete','\x27\x20·\x20Mode\x20','aria-expanded','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','name','var(--acc-2)','setProperty','download','topic-header','textContent','A_winddown','iframe','volume','Thêm\x20ghi\x20chú','#historyList','shiftKey','#set_theme','location','#set_cycles','#set_youtubeUrl','querySelector','actions-menu','short','toISOString','parts','preset','apiKey','#audioLongEnd','by_topic','href','status','width','idle','segmentTotal','</td><td>','Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.','#btnSendMessage','pointerdown','expanded','wind_down','color','readwrite','.color-palette','input','beginWindDown','Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.','Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.','.app-content','youtubeVolume','#btnSaveNote','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20được\x20thêm\x20vào.</p>','setValueAtTime','note-meta','match','#btnMilestoneClose','toString','btn\x20subtopic-btn','_startTick','stopVideo','sessions','Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20','Âm\x20thanh\x20đã\x20được\x20bật!','getAllKeys','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>','default','mouseup','Thêm\x20tùy\x20chọn','Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.','stopPropagation','cycleIndex','mode','.txt','B_work','Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.','role','Chu\x20kỳ\x20','_getStore','beginBreak','subtopic','Gửi','newIndex','exitFullscreen','beginWork','note','state','error','#subtopicTasksList','topic-title','#set_backupDays','Bản\x20sao\x20lưu\x20ngày:\x20','timerState_','focus','lofi','tickHandle','#modalDashboard','blockReason','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','method-item','#selectedContext','setItem','replace','Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.','Đã\x20chuyển\x20sang\x20Kiểu\x20','end','durationMinutes','no-subtopic-selected','Đã\x20khôi\x20phục\x20mặc\x20định','369734aJtWnX','checked','top','Lỗi\x20HTTP:\x20','relative','currentView','#btnClearChat','sessionsCompleted','#ytSoundVolume','result','opacity','50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.','space','\x20tiếng\x20','.tab-content','#set_short','NGHỈ\x20NGẮN','youtube-player-container','<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20','\x20hidden','4835439zFDSVq','from','option','onupgradeneeded','summary_','PlayerState','acc','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.','createIndex','remove','button','startsWith','triangle','filter','#btnSaveMethod','createOscillator','finished','durations','gain','isCompleted','indexOf','#set_ytThumbAsBg','querySelectorAll','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.','scrollHeight','oldIndex','Creating\x20backup\x20for\x20','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','lang','soundOn','getItem','cancel','hidden','https://www.youtube.com/iframe_api','Đổi\x20tên\x20Chủ\x20đề','#btnDefaults','disabled','#statTotal','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.','body','innerHTML','log','#btnToggleBg','_sortable','<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>','Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22','lastBackupDate','#toolList','note-content','<input\x20type=\x22checkbox\x22\x20id=\x22','none','stop','Missing\x20element','origin','position','Đang\x20phát\x20nhạc\x20nền...','split','useYtThumbnailAsBg','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','#settings-flowtime','#audioWorkEnd','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','badge\x20state\x20break','clientY','#uploadBg','#editorPreview','#draggableTimer','<p>','ytUrlFeedback','tid','flowtimeBreakRatio','selectionEnd','__ytApiWatchdog','auto','#breakSuggestionDisplay','customBg','#aiPromptSuggestions\x20button','sub-row','#btnReset','IndexedDB\x20initialized\x20successfully.','sort','soundPermissionBar','#set_backgroundMode','🌊\x20Flow','cyclesA','removeProperty','dataset','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','timer','target','#btnCancelMethodEditor','innerHeight','right','removeChild','Lỗi\x20khởi\x20tạo:\x20','baseVal','paused','#welcomePanel','Daily\x20backup\x20successful.','Tóm\x20tắt\x20thất\x20bại.','values','note-content-wrapper','.color-picker-wrapper','cover','<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>','toggle','var(--warn)','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>','theme','data:','.aux-panel,\x20.modal-card','removeEventListener','onYouTubeIframeAPIReady','url(','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','totalMinutes','padStart','revokeObjectURL','open','Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu','ghost','Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.','https://img.youtube.com/vi/','parentElement','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','Thêm\x20Tri\x20thức\x20mới','Deleted\x20old\x20backup:\x20','Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.','Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.','keydown','addEventListener','start','item','getPlayerState','prevState','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','text','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','Ẩn\x20giao\x20diện','.color-swatch','sess','Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','fullscreenchange','#statSessions','offsetHeight','.subtopics','splice','longBreakIntervalB','#timeDisplay','#genericMessage','backgroundRepeat','initDB','.topic-item','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.','</li>','value','Không\x20thể\x20lưu\x20thay\x20đổi.','#set_winddown','aria-pressed','.tab-btn','Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...','<ol>','#importFile','#btnAutoFormat','#toolColor','textarea','bg-view-mode','45918096QTjQvE','chime','Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.','#btnAddTopic','.nav-btn[data-view]','clear','A_short','btn\x20small\x20ghost\x20method-edit','#view-methods','Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.','currentTime','delete','&quot;','appendChild','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','A_long','#backupList','save','Đang\x20phát','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','trim','undefined','objectStoreNames','Xóa\x20Chủ\x20đề','#set_flowRatio','isConnected','min','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','Chưa\x20chọn\x20Chủ\x20đề\x20con','<div>','stroke','12bNbOSc','version','LÀM\x20VIỆC\x20(FLOW)','.actions-menu','timerState','(chưa\x20chọn)','slice','</div>','var(--sub)','<strong>$1</strong>','#audioBreakEnd','transition','/hqdefault.jpg','Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','Sửa','6EsAobY','break_end','Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.','POST','customSounds','#summariesList','#timerPresetSelector\x20button','parse','#view-','.presets\x20button','Sửa\x20tên\x20Chủ\x20đề\x20con','\x20(B)','?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.','autoBackup','note-item','autoplay;\x20encrypted-media;\x20picture-in-picture','__ytApiPromise','-9999px','Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','#chatInput','AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.','</td></tr>','italic','Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.','cyclesTarget','cyclesB','Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.','playVideo','\x20phút','❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.','reverse','subtopics-group','setPreset','beforeunload','&gt;','Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.','async','backgroundSize','Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.','.json','max','setAttribute','insertOrderedList','#generalNotesList','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','errorCode','<tr><td>','Xác\x20nhận\x20phục\x20hồi','#toolH4','contains','date','#btnExport','Lỗi\x20lưu\x20dữ\x20liệu:\x20','getFullYear','#view-methods\x20.method-item','resolve','<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>','var(--muted)','styleWithCSS','DB_NAME','#toolBullet','summaries','#btnResume','badge\x20state\x20work','Initialization\x20error:','#set_enableWinddown','btnToggleYtSound','/maxresdefault.jpg','interval','var(--acc)','Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!','#btnGenericCancel','<i>$1</i>','<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>','#cycleInfo','<li>','settings','Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','Lỗi\x20khi\x20gọi\x20Gemini\x20API:','workMinutes','#btnAddSubtopicTask','methodId','toLowerCase','stringify','closest','stats','Failed\x20to\x20delete\x20summary:','Gemini\x20API\x20Error:','<h4>','fullscreenElement','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>','model','_onFinishSegment','soundTheme','100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.','string','Xác\x20nhận\x20chuyển\x20đổi','backgroundMode','skip','#modalMethodEditor','button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])','#windDownChecklist','http:','Chủ\x20đề\x20con:\x20','onsuccess','longBreakIntervalA','#btnSummarize','Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.','work','forEach','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=','click','.actions-menu-btn','connect','#methodEditorTitleInput','then','cueVideoById','#btnStart','#btnToggleCustomSounds','.method-edit','tasks','left','frequency','&lt;','remaining','Xác\x20nhận\x20xóa','mousemove','className','backupDaysToKeep','find','</tbody></table>','#modalGeneric','btn\x20small\x20ghost\x20actions-menu-btn','không\x20rõ','altKey','long','warn','reduce','--bg-image','pause','#topicsList','unshift','activeElement','generalNotes','Lỗi:\x20','blob:','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>','Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.','user','dateISO','onclick','backups','Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22','select','topics','44nhLimb','#btnPresetC','offsetWidth','floor','createGain','exportData','ArrowUp','#genericInput','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>','https://www.youtube.com','light','Xóa\x20Chủ\x20đề\x20con','Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.','...','show','＋\x20Thêm','Player','reset','<span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span>','#btnAddMethod','timer.selectSubtopicPrompt','#btnPresetA','pauseVideo','onerror','648683pnxPpr','DB_VERSION','map','Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.','#modalMilestone','http','removing','Thoát\x20toàn\x20màn\x20hình','panelOpacity','#milestoneTitle','#btnClearBg','HẠ\x20NHIỆT','</h4>','subtopics','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','Đã\x20dừng\x20nhạc\x20nền.','candidates','Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.','methods','content','summary','getIframe','.modal','getBackupList','B_long','#set_interval','menu-item','enableWinddown','<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>','findIndex','\x0a-\x20','message','flex','--panel-opacity','loadLanguage','Escape','preventDefault','div','#btnEnableSound','</p>','documentElement','Đã\x20xóa\x20lịch\x20sử\x20chat.','Xuất','pomodoroData_v11','&amp;','resume','Toàn\x20màn\x20hình','Tệp\x20không\x20đúng\x20định\x20dạng','put','ENDED','Tên\x20Chủ\x20đề\x20mới?','badge','script','type','#view-methods\x20.methods-container','Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','topic-actions','.timer-circle-container','innerWidth','files','span','Xóa','long_end','importData','<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>','#btnGenericOk','#btnBreakEarly','application/json','protocol','var(--danger)','#currentSubtopicNameChat','16HKzuWy','img.youtube.com/vi/','Chỉnh-sửa\x20Tri\x20thức','ArrowRight','flatMap','#btnCloseDashboard','PLAYING','backgroundImage','getMonth','selectedTopicId','key','sound_unlocked','Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.','about:blank','destroy','#btnFullscreen','topicsList','#ytUrlFeedback','append','text/plain','presetTarget','getVolume','collapsedTopics','.nav-btn','&#39;','test','5268739QbMTCY','sum','timer.cycleInfo','IndexedDB\x20error:','topic','BUFFERING','Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','topic-item','length','Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.','pomodoro_backup_','autoStartNext','abs','push','oncomplete','currentDurations','Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.','badge\x20state\x20long','ArrowDown','</ol>','#btnFinishFlow','LÀM\x20VIỆC','Đã\x20xóa\x20tóm\x20tắt.','topicId','bold','createdAt','#uploadSoundWork','#noteText','exponentialRampToValueAtTime','#methodEditorId','#set_apiKey','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.','load','style','chat-msg\x20','updateSettings','includes','Enter','title','#uploadSoundLong','#milestoneMessage','#btnPause','head','Sửa\x20tên\x20Chủ\x20đề','#uploadSoundBreak','Failed\x20to\x20save\x20data:','reloading','Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!','hours','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?','updateUI','Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.','Lỗi\x20phát\x20âm\x20thanh:','breathing','(Không\x20tạo\x20được\x20tóm\x20tắt)','ArrowLeft','substring','achievedMilestones','readonly','sine','Nghỉ\x20','#methodEditorContentInput','update','catch','#modalSettings','getPropertyValue','.method-delete','2017316vlYeAz','json','Lỗi\x20từ\x20Gemini:\x20','#newSubtopicTaskInput','getDate','#genericTitle','Đã\x20lưu\x20cài\x20đặt','sid','Đã\x20cập\x20nhật\x20hình\x20nền.','method-title','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','isNaN','objectStore','0\x20phút','#set_work','PomodoroAppDB','AudioContext','src','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','currentConfig','onload','execCommand','#btnSettings','.nav-btn[data-view=\x22','#set_panelOpacity','#set_volume','file','####\x20','#set_theme_color','unMute','Xóa\x20tri\x20thức\x20\x22','createElement','#btnSkip','height','work_end','add','createObjectURL','Failed\x20to\x20load\x20YouTube\x20API','#welcomePanel\x20p','#btnDashboard','createObjectStore','data'];_0x344a=function(){return _0x39b879;};return _0x344a();}function handleYoutubeUrlInput(){const _0x711341=_0x4900e5,_0x1aa3d4=$('#set_youtubeUrl'),_0x5cd5e9=$(_0x711341(0x33a)),_0x8b0419=$(_0x711341(0x3d6)),_0x93f167=_0x1aa3d4[_0x711341(0x1f4)][_0x711341(0x214)](),_0x556d47=extractYouTubeID(_0x93f167);if(_0x556d47){_0x5cd5e9[_0x711341(0x408)]=_0x711341(0x1ca),_0x5cd5e9[_0x711341(0x365)][_0x711341(0x427)]=_0x711341(0x404),_0x8b0419[_0x711341(0x17c)]=![],sessionYoutubeUrl=_0x93f167;try{ytUserPaused=![];}catch(_0x526707){}try{const _0x116403='https://img.youtube.com/vi/'+_0x556d47+'/maxresdefault.jpg',_0x3c5a4c=new Image();_0x3c5a4c['onload']=async()=>{const _0x3f174b=_0x711341;data['settings'][_0x3f174b(0x1a3)]=_0x116403;try{await saveData();}catch(_0x23c2c4){}applyCustomBg();},_0x3c5a4c['onerror']=async()=>{const _0x1dbd3f=_0x711341,_0x25790f=_0x1dbd3f(0x1d2)+_0x556d47+_0x1dbd3f(0x22b);data[_0x1dbd3f(0x27a)]['customBg']=_0x25790f;try{await saveData();}catch(_0x1cbe1e){}applyCustomBg();},_0x3c5a4c[_0x711341(0x398)]=_0x116403;}catch(_0x13646a){}try{if(IS_FILE_PROTOCOL){const _0x5ddb43=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x556d47,{'autoplay':0x1,'mute':_0x5ddb43});try{setTimeout(()=>{const _0x304d74=_0x711341;try{fallbackPostMessage(_0x304d74(0x249));}catch(_0x469aa8){}},0xfa);}catch(_0x160459){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0xda13b7=_0x711341,_0xf92b0d=document['getElementById'](_0xda13b7(0x19c));if(_0xf92b0d)_0xf92b0d['textContent']=_0xda13b7(0x212);},0x1f4);}catch(_0x5bd985){}}else ensureYouTubeAPI()[_0x711341(0x2a1)](()=>{const _0x38b6b9=_0x711341;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer['mute']&&ytPlayer[_0x38b6b9(0x249)]&&(ytPlayer[_0x38b6b9(0x3f7)](),ytPlayer[_0x38b6b9(0x249)](),_ytPrimed=!![],showSoundPermission());}catch(_0x3ec23f){}})['catch'](()=>{});}catch(_0x4b6d10){}}else{if(_0x93f167===''){_0x5cd5e9[_0x711341(0x408)]='',_0x8b0419[_0x711341(0x17c)]=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x5e5f93){}else ytPlayer&&ytPlayer[_0x711341(0x439)]&&ytPlayer[_0x711341(0x439)]();}else _0x5cd5e9[_0x711341(0x408)]=_0x711341(0x24b),_0x5cd5e9['style'][_0x711341(0x427)]=_0x711341(0x327),_0x8b0419[_0x711341(0x17c)]=!![];}}function applyTheme(_0x1c5a8e){const _0x8f3b4e=_0x4900e5,_0x2f8c1a=_0x1c5a8e||data[_0x8f3b4e(0x27a)][_0x8f3b4e(0x1c4)]||_0x8f3b4e(0x43f);document[_0x8f3b4e(0x17f)][_0x8f3b4e(0x1ae)][_0x8f3b4e(0x1c4)]=_0x2f8c1a;const _0x14954a=[_0x8f3b4e(0x45b),'space'][_0x8f3b4e(0x368)](_0x2f8c1a),_0xde604c=_0x2f8c1a===_0x8f3b4e(0x2d3)||_0x2f8c1a===_0x8f3b4e(0x3b6),_0x12cd2c=data[_0x8f3b4e(0x27a)][_0x8f3b4e(0x1a3)],_0x112840=()=>{const _0x1bfced=_0x8f3b4e;try{document[_0x1bfced(0x17f)][_0x1bfced(0x365)][_0x1bfced(0x330)]='';}catch(_0x2045a1){}};if(_0x12cd2c&&!data[_0x8f3b4e(0x27a)][_0x8f3b4e(0x191)])document[_0x8f3b4e(0x17f)][_0x8f3b4e(0x365)][_0x8f3b4e(0x405)](_0x8f3b4e(0x2b8),'url('+_0x12cd2c+')'),_0x112840();else{if(_0x12cd2c&&data[_0x8f3b4e(0x27a)]['useYtThumbnailAsBg'])document[_0x8f3b4e(0x17f)][_0x8f3b4e(0x365)][_0x8f3b4e(0x405)](_0x8f3b4e(0x2b8),'url('+_0x12cd2c+')'),_0x112840();else{if(_0x14954a)document[_0x8f3b4e(0x17f)][_0x8f3b4e(0x365)]['removeProperty'](_0x8f3b4e(0x2b8)),_0x112840();else _0xde604c?(document[_0x8f3b4e(0x17f)]['style'][_0x8f3b4e(0x405)]('--bg-image',_0x8f3b4e(0x18a)),_0x112840()):(document[_0x8f3b4e(0x17f)][_0x8f3b4e(0x365)][_0x8f3b4e(0x405)](_0x8f3b4e(0x2b8),''),document[_0x8f3b4e(0x17f)]['style'][_0x8f3b4e(0x330)]=_0x8f3b4e(0x47d));}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':'timer','preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x4900e5(0x3f4),'theme':_0x4900e5(0x43f),'cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x4900e5(0x1bf),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':_0x4900e5(0x353),'content':_0x4900e5(0x391)},{'id':uid('m'),'title':_0x4900e5(0x22c),'content':_0x4900e5(0x184)},{'id':uid('m'),'title':_0x4900e5(0x1df),'content':_0x4900e5(0x1c0)},{'id':uid('m'),'title':_0x4900e5(0x21b),'content':_0x4900e5(0x277)},{'id':uid('m'),'title':'Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','content':_0x4900e5(0x266)}]},'topics':[]};let data,editingPreset='A',AUDIO_CTX=null;function ensureAudio(){const _0x402a4c=_0x4900e5;if(!AUDIO_CTX)AUDIO_CTX=new(window[(_0x402a4c(0x397))]||window['webkitAudioContext'])();}function tone(_0x543be5=0x370,_0x269e7e=0xc8,_0x3fe864=0.2,_0x73875c=_0x4900e5(0x37f),_0x5557de=0x0){const _0x1b129b=_0x4900e5;ensureAudio();const _0x3b67a7=AUDIO_CTX,_0x1b4e78=_0x3b67a7[_0x1b129b(0x166)](),_0x3a1313=_0x3b67a7[_0x1b129b(0x2cd)]();_0x1b4e78[_0x1b129b(0x316)]=_0x73875c,_0x1b4e78[_0x1b129b(0x2a8)]['value']=_0x543be5,_0x1b4e78[_0x1b129b(0x29f)](_0x3a1313),_0x3a1313[_0x1b129b(0x29f)](_0x3b67a7['destination']);const _0xe0acfd=_0x3b67a7[_0x1b129b(0x20a)]+_0x5557de;_0x3a1313[_0x1b129b(0x169)][_0x1b129b(0x432)](0x0,_0xe0acfd),_0x3a1313[_0x1b129b(0x169)]['linearRampToValueAtTime'](_0x3fe864,_0xe0acfd+0.01),_0x3a1313[_0x1b129b(0x169)][_0x1b129b(0x360)](0.0001,_0xe0acfd+_0x269e7e/0x3e8),_0x1b4e78[_0x1b129b(0x1db)](_0xe0acfd),_0x1b4e78[_0x1b129b(0x18b)](_0xe0acfd+_0x269e7e/0x3e8+0.05);}function playSound(_0x5db536){const _0x1b63f9=_0x4900e5;if(!data[_0x1b63f9(0x27a)][_0x1b63f9(0x175)])return;const _0x50d62e=Math[_0x1b63f9(0x256)](0x0,Math[_0x1b63f9(0x21a)](0x1,data['settings'][_0x1b63f9(0x40b)]??0.8)),_0x350f51=data[_0x1b63f9(0x27a)][_0x1b63f9(0x232)]?.[_0x5db536];let _0x537883;if(_0x5db536===_0x1b63f9(0x3aa))_0x537883=$(_0x1b63f9(0x194));else{if(_0x5db536==='break_end')_0x537883=$(_0x1b63f9(0x229));else{if(_0x5db536===_0x1b63f9(0x320))_0x537883=$(_0x1b63f9(0x41a));}}if(_0x350f51&&_0x537883){_0x350f51['startsWith'](_0x1b63f9(0x1c5))||_0x350f51[_0x1b63f9(0x162)](_0x1b63f9(0x2e6))||_0x350f51[_0x1b63f9(0x162)](_0x1b63f9(0x2bf))?(_0x537883['src']=_0x350f51,_0x537883[_0x1b63f9(0x40b)]=_0x50d62e,_0x537883['play']()[_0x1b63f9(0x383)](_0xea33b=>console[_0x1b63f9(0x454)]('Lỗi\x20phát\x20âm\x20thanh:',_0xea33b))):getStoredFileUrl(_0x350f51)[_0x1b63f9(0x2a1)](_0x311699=>{const _0x3a22d3=_0x1b63f9;_0x311699&&(_0x537883[_0x3a22d3(0x398)]=_0x311699,_0x537883[_0x3a22d3(0x40b)]=_0x50d62e,_0x537883['play']()[_0x3a22d3(0x383)](_0xe7c404=>console[_0x3a22d3(0x454)](_0x3a22d3(0x378),_0xe7c404)));});return;}const _0x7883e=data[_0x1b63f9(0x27a)][_0x1b63f9(0x28b)]||_0x1b63f9(0x3f4);if(_0x7883e===_0x1b63f9(0x3f4)){if(_0x5db536==='work_end')tone(0x370,0xfa,_0x50d62e),tone(0x294,0xb4,_0x50d62e*0.8,_0x1b63f9(0x37f),0.22);else{if(_0x5db536===_0x1b63f9(0x22f))tone(0x294,0xdc,_0x50d62e*0.9);else _0x5db536===_0x1b63f9(0x320)&&(tone(0x208,0xc8,_0x50d62e),tone(0x30c,0xc8,_0x50d62e,'sine',0.22),tone(0x410,0xdc,_0x50d62e,_0x1b63f9(0x37f),0.44));}}else{if(_0x5db536==='work_end')tone(0x4b0,0xa0,_0x50d62e*0.9,_0x1b63f9(0x163)),tone(0x384,0xdc,_0x50d62e*0.8,'triangle',0.18);else{if(_0x5db536===_0x1b63f9(0x22f))tone(0x370,0xf0,_0x50d62e*0.8,_0x1b63f9(0x163));else _0x5db536==='long_end'&&(tone(0x258,0xdc,_0x50d62e*0.9,_0x1b63f9(0x163)),tone(0x3b6,0xf0,_0x50d62e*0.9,_0x1b63f9(0x163),0.22),tone(0x4b0,0xf0,_0x50d62e,_0x1b63f9(0x163),0.44));}}}async function saveData(){const _0x5a8a61=_0x4900e5;try{await storageManager[_0x5a8a61(0x211)](data);}catch(_0x3f7029){console[_0x5a8a61(0x454)](_0x5a8a61(0x371),_0x3f7029),toast(_0x5a8a61(0x262)+_0x3f7029['message']);}}async function ensureValidSelection(){const _0x2592d0=_0x4900e5,_0x27455d=data[_0x2592d0(0x27a)];if(!data['topics']||data[_0x2592d0(0x2c8)][_0x2592d0(0x34b)]===0x0){_0x27455d[_0x2592d0(0x332)]='',_0x27455d['selectedSubtopicId']='',await saveData();return;}const _0x49cdef=data[_0x2592d0(0x2c8)][_0x2592d0(0x2af)](_0x4c2e40=>_0x4c2e40['id']===_0x27455d[_0x2592d0(0x332)]),_0x290997=_0x49cdef?.[_0x2592d0(0x2ee)]['find'](_0x27cdec=>_0x27cdec['id']===_0x27455d[_0x2592d0(0x3bf)]);if(!_0x49cdef||!_0x290997){const _0x4625bb=data[_0x2592d0(0x2c8)][0x0],_0x6af693=_0x4625bb?.[_0x2592d0(0x2ee)]?.[0x0];_0x27455d[_0x2592d0(0x332)]=_0x4625bb?.['id']||'',_0x27455d['selectedSubtopicId']=_0x6af693?.['id']||'',await saveData();}}function showInputModal(_0x169b7f,_0x20f0bb,_0x5615bd=''){const _0x2f3a3e=_0x4900e5;$(_0x2f3a3e(0x38c))['textContent']=_0x169b7f,$('#genericMessage')[_0x2f3a3e(0x3ee)][_0x2f3a3e(0x3ab)](_0x2f3a3e(0x178));const _0x5d80fc=$('#genericInput');_0x5d80fc[_0x2f3a3e(0x1f4)]=_0x5615bd,_0x5d80fc[_0x2f3a3e(0x3ee)][_0x2f3a3e(0x160)]('hidden'),$(_0x2f3a3e(0x2b1))[_0x2f3a3e(0x3ee)]['add'](_0x2f3a3e(0x2d7));try{trapFocus($(_0x2f3a3e(0x2b1)));}catch(_0x120e6c){}_0x5d80fc[_0x2f3a3e(0x45a)](),_0x5d80fc[_0x2f3a3e(0x2c7)]();const _0x52eba6=()=>{const _0xccf32=_0x2f3a3e;_0x20f0bb(_0x5d80fc[_0xccf32(0x1f4)]),_0x2f7c62();},_0x48d1f8=()=>_0x2f7c62(),_0x125c61=_0x13557e=>{const _0x4c3e3a=_0x2f3a3e;if(_0x13557e[_0x4c3e3a(0x333)]==='Enter')_0x52eba6();if(_0x13557e['key']===_0x4c3e3a(0x304))_0x48d1f8();};$(_0x2f3a3e(0x323))[_0x2f3a3e(0x2c4)]=_0x52eba6,$('#btnGenericCancel')[_0x2f3a3e(0x2c4)]=_0x48d1f8,_0x5d80fc['onkeydown']=_0x125c61;function _0x2f7c62(){const _0x3a2b55=_0x2f3a3e;$(_0x3a2b55(0x2b1))[_0x3a2b55(0x3ee)]['remove'](_0x3a2b55(0x2d7)),$('#btnGenericOk')[_0x3a2b55(0x2c4)]=null,$(_0x3a2b55(0x275))['onclick']=null,_0x5d80fc[_0x3a2b55(0x3e4)]=null;try{releaseFocus();}catch(_0x27f1df){}}}function showConfirmModal(_0x2b8fbf,_0x1e0e88,_0x43d4ce){const _0x190687=_0x4900e5;$(_0x190687(0x38c))[_0x190687(0x408)]=_0x2b8fbf;const _0x5ea253=$(_0x190687(0x1ee));_0x5ea253['textContent']=_0x1e0e88,_0x5ea253['classList']['remove'](_0x190687(0x178)),$(_0x190687(0x2d0))[_0x190687(0x3ee)][_0x190687(0x3ab)]('hidden'),$('#modalGeneric')[_0x190687(0x3ee)][_0x190687(0x3ab)](_0x190687(0x2d7));try{trapFocus($(_0x190687(0x2b1)));}catch(_0x360a5c){}const _0x438a0e=()=>{_0x43d4ce(!![]),_0x1f6fd1();},_0x72c6e4=()=>{_0x43d4ce(![]),_0x1f6fd1();};$(_0x190687(0x323))['onclick']=_0x438a0e,$(_0x190687(0x275))[_0x190687(0x2c4)]=_0x72c6e4;function _0x1f6fd1(){const _0xd964ca=_0x190687;$(_0xd964ca(0x2b1))[_0xd964ca(0x3ee)][_0xd964ca(0x160)](_0xd964ca(0x2d7)),$(_0xd964ca(0x323))[_0xd964ca(0x2c4)]=null,$(_0xd964ca(0x275))[_0xd964ca(0x2c4)]=null;try{releaseFocus();}catch(_0x9007ef){}}}async function switchView(_0x1b8372){const _0x5dc2d1=_0x4900e5;$$('.view')[_0x5dc2d1(0x29b)](_0x210541=>_0x210541[_0x5dc2d1(0x3ee)][_0x5dc2d1(0x160)](_0x5dc2d1(0x3d9))),$(_0x5dc2d1(0x236)+_0x1b8372)[_0x5dc2d1(0x3ee)]['add'](_0x5dc2d1(0x3d9)),$$(_0x5dc2d1(0x340))['forEach'](_0x5360de=>_0x5360de[_0x5dc2d1(0x3ee)]['remove'](_0x5dc2d1(0x3d9)));const _0x55bd0c=$(_0x5dc2d1(0x39f)+_0x1b8372+'\x22]');if(_0x55bd0c)_0x55bd0c['classList'][_0x5dc2d1(0x3ab)]('active');data[_0x5dc2d1(0x27a)][_0x5dc2d1(0x46f)]=_0x1b8372,await saveData(),_0x1b8372===_0x5dc2d1(0x283)&&renderDashboard();}function closeAllMenus(){const _0x2ef448=_0x4900e5;$$('.actions-menu.show')[_0x2ef448(0x29b)](_0x3b5c2d=>_0x3b5c2d[_0x2ef448(0x3ee)]['remove'](_0x2ef448(0x2d7)));}function renderTopics(){const _0x57c915=_0x4900e5,_0x59293c=$(_0x57c915(0x2ba));if(!_0x59293c)return;_0x59293c[_0x57c915(0x180)]='';const _0x50937b=data[_0x57c915(0x27a)][_0x57c915(0x33f)]||{};data[_0x57c915(0x2c8)][_0x57c915(0x29b)](_0x266a0d=>{const _0x3b5ad5=_0x57c915,_0xf13f53=document[_0x3b5ad5(0x3a7)]('div');_0xf13f53[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x34a),_0xf13f53[_0x3b5ad5(0x1ae)][_0x3b5ad5(0x19d)]=_0x266a0d['id'];const _0x3e609a=document[_0x3b5ad5(0x3a7)]('div');_0x3e609a[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x407);const _0x39d9ba=!!_0x50937b[_0x266a0d['id']],_0x4944a1=document['createElement'](_0x3b5ad5(0x161));_0x4944a1[_0x3b5ad5(0x2ad)]='chev\x20btn\x20small\x20ghost',_0x4944a1['setAttribute'](_0x3b5ad5(0x401),String(!_0x39d9ba)),_0x4944a1[_0x3b5ad5(0x180)]='<span\x20class=\x22ico\x22>▾</span>';const _0x43796a=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x306));_0x43796a[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x456),_0x43796a[_0x3b5ad5(0x408)]=_0x266a0d[_0x3b5ad5(0x403)];const _0x1f8abc=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x306));_0x1f8abc[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x31a);const _0x41c9c7=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x161));_0x41c9c7[_0x3b5ad5(0x2ad)]='btn\x20small',_0x41c9c7[_0x3b5ad5(0x180)]=_0x3b5ad5(0x2d8),_0x41c9c7[_0x3b5ad5(0x36a)]='Thêm\x20Chủ\x20đề\x20con';const _0x59ce5e=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x306));_0x59ce5e[_0x3b5ad5(0x365)][_0x3b5ad5(0x18e)]=_0x3b5ad5(0x46e);const _0x58be7f=document[_0x3b5ad5(0x3a7)]('button');_0x58be7f[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x2b2),_0x58be7f[_0x3b5ad5(0x180)]=_0x3b5ad5(0x2d6),_0x58be7f['title']=_0x3b5ad5(0x441);const _0x396299=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x306));_0x396299['className']=_0x3b5ad5(0x414);const _0x30fd49=document['createElement'](_0x3b5ad5(0x161));_0x30fd49['className']=_0x3b5ad5(0x2fb),_0x30fd49[_0x3b5ad5(0x180)]=_0x3b5ad5(0x36f);const _0x24602a=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x161));_0x24602a[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x3ca),_0x24602a[_0x3b5ad5(0x180)]=_0x3b5ad5(0x217),_0x396299[_0x3b5ad5(0x33b)](_0x30fd49,_0x24602a),_0x59ce5e[_0x3b5ad5(0x33b)](_0x58be7f,_0x396299),_0x1f8abc['append'](_0x41c9c7,_0x59ce5e),_0x3e609a[_0x3b5ad5(0x33b)](_0x4944a1,_0x43796a,_0x1f8abc),_0x4944a1['addEventListener'](_0x3b5ad5(0x29d),async _0x3a35d1=>{const _0xc0a84c=_0x3b5ad5;_0x3a35d1[_0xc0a84c(0x443)]();const _0x3e3c41=!!_0x50937b[_0x266a0d['id']];_0x3e3c41?delete _0x50937b[_0x266a0d['id']]:_0x50937b[_0x266a0d['id']]=!![],data['settings'][_0xc0a84c(0x33f)]=_0x50937b,await storageManager[_0xc0a84c(0x367)](data[_0xc0a84c(0x27a)]),renderTopics();});const _0x18628f=async()=>{const _0x475fe7=_0x3b5ad5,_0x364dc3=!!_0x50937b[_0x266a0d['id']];_0x364dc3?delete _0x50937b[_0x266a0d['id']]:_0x50937b[_0x266a0d['id']]=!![],data[_0x475fe7(0x27a)]['collapsedTopics']=_0x50937b,await storageManager[_0x475fe7(0x367)](data[_0x475fe7(0x27a)]),renderTopics();};_0x3e609a['addEventListener'](_0x3b5ad5(0x29d),async _0xa3c8d3=>{const _0x47f6ae=_0x3b5ad5,_0x24ac22=_0xa3c8d3[_0x47f6ae(0x1b1)];if(_0x24ac22&&_0x24ac22['closest']){if(_0x24ac22[_0x47f6ae(0x282)](_0x47f6ae(0x222))||_0x24ac22[_0x47f6ae(0x282)](_0x47f6ae(0x29e))||_0x24ac22[_0x47f6ae(0x282)]('button')||_0x24ac22[_0x47f6ae(0x282)]('input,select,textarea'))return;}_0xa3c8d3[_0x47f6ae(0x443)](),await _0x18628f();}),_0x43796a[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),async _0x154917=>{const _0xef73d2=_0x3b5ad5;_0x154917[_0xef73d2(0x443)](),await _0x18628f();}),_0xf13f53[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),async _0x4fb5cc=>{const _0x395508=_0x3b5ad5,_0x2b19ca=_0x4fb5cc[_0x395508(0x1b1)];if(_0x2b19ca&&_0x2b19ca[_0x395508(0x282)]){if(_0x2b19ca[_0x395508(0x282)](_0x395508(0x1ea)))return;if(_0x2b19ca[_0x395508(0x282)](_0x395508(0x222))||_0x2b19ca[_0x395508(0x282)](_0x395508(0x29e))||_0x2b19ca[_0x395508(0x282)](_0x395508(0x161))||_0x2b19ca[_0x395508(0x282)]('input,select,textarea'))return;}await _0x18628f();});const _0x586f57=document[_0x3b5ad5(0x3a7)](_0x3b5ad5(0x306));_0x586f57[_0x3b5ad5(0x2ad)]=_0x3b5ad5(0x2ee)+(_0x39d9ba?_0x3b5ad5(0x47f):''),_0x586f57[_0x3b5ad5(0x1ae)][_0x3b5ad5(0x19d)]=_0x266a0d['id'],_0x266a0d[_0x3b5ad5(0x2ee)]['forEach'](_0x38e945=>{const _0x4ae70b=_0x3b5ad5,_0x236319=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x306));_0x236319[_0x4ae70b(0x2ad)]=_0x4ae70b(0x1a5),_0x236319[_0x4ae70b(0x1ae)][_0x4ae70b(0x38e)]=_0x38e945['id'];const _0x327bde=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x161));_0x327bde[_0x4ae70b(0x2ad)]=_0x4ae70b(0x437),_0x327bde[_0x4ae70b(0x408)]='•\x20'+_0x38e945[_0x4ae70b(0x403)],_0x327bde[_0x4ae70b(0x1ae)][_0x4ae70b(0x38e)]=_0x38e945['id'],_0x327bde['dataset'][_0x4ae70b(0x19d)]=_0x266a0d['id'];if(data[_0x4ae70b(0x27a)][_0x4ae70b(0x3bf)]===_0x38e945['id'])_0x327bde[_0x4ae70b(0x3ee)][_0x4ae70b(0x3ab)]('active');const _0x460392=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x306));_0x460392['className']='actions';const _0x29c4c6=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x306));_0x29c4c6[_0x4ae70b(0x365)][_0x4ae70b(0x18e)]=_0x4ae70b(0x46e);const _0x23109d=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x161));_0x23109d[_0x4ae70b(0x2ad)]=_0x4ae70b(0x2b2),_0x23109d['innerHTML']=_0x4ae70b(0x2d6),_0x23109d[_0x4ae70b(0x36a)]=_0x4ae70b(0x441);const _0x96f59c=document[_0x4ae70b(0x3a7)]('div');_0x96f59c[_0x4ae70b(0x2ad)]=_0x4ae70b(0x414);const _0x194eb9=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x161));_0x194eb9['className']='menu-item',_0x194eb9['innerHTML']=_0x4ae70b(0x238);const _0x30e0c5=document[_0x4ae70b(0x3a7)](_0x4ae70b(0x161));_0x30e0c5[_0x4ae70b(0x2ad)]=_0x4ae70b(0x3ca),_0x30e0c5[_0x4ae70b(0x180)]=_0x4ae70b(0x2d4),_0x96f59c[_0x4ae70b(0x33b)](_0x194eb9,_0x30e0c5),_0x29c4c6['append'](_0x23109d,_0x96f59c),_0x460392['append'](_0x29c4c6),_0x236319[_0x4ae70b(0x33b)](_0x327bde,_0x460392),_0x586f57[_0x4ae70b(0x20d)](_0x236319),_0x327bde[_0x4ae70b(0x1da)]('click',()=>selectSubtopic(_0x266a0d['id'],_0x38e945['id'])),_0x23109d[_0x4ae70b(0x1da)](_0x4ae70b(0x29d),_0x253188=>{const _0x154097=_0x4ae70b;_0x253188[_0x154097(0x443)](),closeAllMenus(),_0x96f59c[_0x154097(0x3ee)][_0x154097(0x1c1)]('show');}),_0x194eb9[_0x4ae70b(0x1da)](_0x4ae70b(0x29d),()=>showInputModal('Đổi\x20tên\x20Chủ\x20đề\x20con',async _0x2cc160=>{const _0x436d6e=_0x4ae70b;if(!_0x2cc160)return;_0x38e945['name']=_0x2cc160,await storageManager[_0x436d6e(0x382)](_0x436d6e(0x2ee),_0x38e945),renderAll();},_0x38e945[_0x4ae70b(0x403)])),_0x30e0c5[_0x4ae70b(0x1da)](_0x4ae70b(0x29d),()=>showConfirmModal(_0x4ae70b(0x2ab),'Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22'+_0x38e945['name']+_0x4ae70b(0x2ef),async _0x2759bc=>{const _0x696aa5=_0x4ae70b;if(!_0x2759bc)return;_0x266a0d[_0x696aa5(0x2ee)]=_0x266a0d[_0x696aa5(0x2ee)][_0x696aa5(0x164)](_0x3ddd00=>_0x3ddd00['id']!==_0x38e945['id']);const _0x4486d6=data[_0x696aa5(0x27a)];_0x4486d6[_0x696aa5(0x3bf)]===_0x38e945['id']&&(_0x4486d6[_0x696aa5(0x3bf)]='',_0x4486d6[_0x696aa5(0x332)]='',ensureValidSelection()),await storageManager[_0x696aa5(0x20b)](_0x696aa5(0x2ee),_0x38e945['id']),renderAll();}));}),_0x58be7f['addEventListener'](_0x3b5ad5(0x29d),_0x4ad893=>{const _0x2b1a77=_0x3b5ad5;_0x4ad893[_0x2b1a77(0x443)](),closeAllMenus(),_0x396299[_0x2b1a77(0x3ee)][_0x2b1a77(0x1c1)](_0x2b1a77(0x2d7));}),_0x41c9c7[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),()=>showInputModal('Tên\x20Chủ\x20đề\x20con\x20mới?',async _0x391631=>{const _0x152019=_0x3b5ad5;if(!_0x391631)return;const _0x1c10d0={'id':uid('s'),'topicId':_0x266a0d['id'],'name':_0x391631,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':_0x152019(0x41f),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x266a0d[_0x152019(0x2ee)][_0x152019(0x350)](_0x1c10d0),await storageManager[_0x152019(0x3ab)](_0x152019(0x2ee),_0x1c10d0),renderTopics();})),_0x30fd49[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),()=>showInputModal(_0x3b5ad5(0x17a),async _0x3b0091=>{const _0x430149=_0x3b5ad5;if(!_0x3b0091)return;_0x266a0d[_0x430149(0x403)]=_0x3b0091,await storageManager['update'](_0x430149(0x2c8),_0x266a0d),renderTopics();},_0x266a0d[_0x3b5ad5(0x403)])),_0x24602a[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),()=>showConfirmModal('Xác\x20nhận\x20xóa','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22'+_0x266a0d['name']+'\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.',async _0x2e15c4=>{const _0x545271=_0x3b5ad5;if(!_0x2e15c4)return;data['topics']=data['topics'][_0x545271(0x164)](_0x14025d=>_0x14025d['id']!==_0x266a0d['id']),delete _0x50937b[_0x266a0d['id']];data[_0x545271(0x27a)][_0x545271(0x332)]===_0x266a0d['id']&&(data['settings']['selectedTopicId']='',data[_0x545271(0x27a)][_0x545271(0x3bf)]='',ensureValidSelection());await storageManager[_0x545271(0x20b)](_0x545271(0x2c8),_0x266a0d['id']);for(const _0x161e88 of _0x266a0d[_0x545271(0x2ee)]){await storageManager['delete'](_0x545271(0x2ee),_0x161e88['id']);}renderAll();})),_0x41c9c7[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),_0x38de87=>_0x38de87[_0x3b5ad5(0x443)]()),_0x30fd49['addEventListener'](_0x3b5ad5(0x29d),_0xb78c4c=>_0xb78c4c['stopPropagation']()),_0x24602a[_0x3b5ad5(0x1da)](_0x3b5ad5(0x29d),_0x15aa44=>_0x15aa44[_0x3b5ad5(0x443)]()),_0xf13f53[_0x3b5ad5(0x33b)](_0x3e609a,_0x586f57),_0x59293c['appendChild'](_0xf13f53);});if(window['Sortable']){const _0x5d5bf5=document[_0x57c915(0x3ea)](_0x57c915(0x339));if(_0x5d5bf5){if(_0x5d5bf5['_sortable'])try{_0x5d5bf5[_0x57c915(0x183)][_0x57c915(0x337)]();}catch(_0x3ef39e){}_0x5d5bf5[_0x57c915(0x183)]=new Sortable(_0x5d5bf5,{'animation':0x96,'draggable':_0x57c915(0x1f1),'onEnd':async function(_0x148bae){const _0x53a495=_0x57c915;if(_0x148bae[_0x53a495(0x171)]===_0x148bae[_0x53a495(0x44f)])return;const _0x5d284a=data[_0x53a495(0x2c8)][_0x53a495(0x1eb)](_0x148bae[_0x53a495(0x171)],0x1)[0x0];data[_0x53a495(0x2c8)][_0x53a495(0x1eb)](_0x148bae['newIndex'],0x0,_0x5d284a),await saveData(),renderTopics();}}),_0x5d5bf5['querySelectorAll'](_0x57c915(0x1ea))[_0x57c915(0x29b)](_0x334780=>{const _0xfd8211=_0x57c915;new Sortable(_0x334780,{'group':_0xfd8211(0x24d),'animation':0x96,'draggable':'.sub-row','onEnd':async function(_0x4d6dbc){const _0x2d27d0=_0xfd8211,_0x18b996=_0x4d6dbc[_0x2d27d0(0x481)]?.[_0x2d27d0(0x1ae)]?.[_0x2d27d0(0x19d)]||_0x4d6dbc[_0x2d27d0(0x481)]?.['closest'](_0x2d27d0(0x1f1))?.[_0x2d27d0(0x1ae)]?.[_0x2d27d0(0x19d)],_0x2ceeea=_0x4d6dbc['to']?.[_0x2d27d0(0x1ae)]?.[_0x2d27d0(0x19d)]||_0x4d6dbc['to']?.[_0x2d27d0(0x282)]('.topic-item')?.['dataset']?.[_0x2d27d0(0x19d)],_0x47a293=data[_0x2d27d0(0x2c8)][_0x2d27d0(0x2af)](_0x52c050=>_0x52c050['id']===_0x18b996),_0x56011e=data['topics'][_0x2d27d0(0x2af)](_0x4f02e8=>_0x4f02e8['id']===_0x2ceeea);if(!_0x47a293||!_0x56011e)return;let _0x8e880a=null;const _0x40ef07=_0x4d6dbc[_0x2d27d0(0x1dc)]?.[_0x2d27d0(0x1ae)]?.[_0x2d27d0(0x38e)]||_0x4d6dbc[_0x2d27d0(0x1dc)]?.['querySelector']('.subtopic-btn')?.[_0x2d27d0(0x1ae)]?.[_0x2d27d0(0x38e)];if(_0x40ef07){const _0x57eb6e=_0x47a293['subtopics'][_0x2d27d0(0x2fe)](_0x103b8e=>_0x103b8e['id']===_0x40ef07);if(_0x57eb6e>=0x0)_0x8e880a=_0x47a293['subtopics'][_0x2d27d0(0x1eb)](_0x57eb6e,0x1)[0x0];}!_0x8e880a&&(_0x8e880a=_0x47a293['subtopics'][_0x2d27d0(0x1eb)](_0x4d6dbc['oldIndex'],0x1)[0x0]);if(!_0x8e880a)return;_0x8e880a[_0x2d27d0(0x35b)]=_0x56011e['id'],_0x56011e[_0x2d27d0(0x2ee)][_0x2d27d0(0x1eb)](_0x4d6dbc['newIndex'],0x0,_0x8e880a),data[_0x2d27d0(0x27a)][_0x2d27d0(0x3bf)]===_0x8e880a['id']&&(data[_0x2d27d0(0x27a)][_0x2d27d0(0x332)]=_0x56011e['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x18726f,_0x269f2e){const _0x1554f7=_0x4900e5,_0x1798e5=$(_0x1554f7(0x42e)),_0x3db27c=getCurrentSubtopic();_0x3db27c&&timer[_0x1554f7(0x453)]!==_0x1554f7(0x41f)&&(_0x3db27c[_0x1554f7(0x223)]={'state':timer['state'],'prevState':timer['prevState'],'remaining':timer['remaining'],'segmentTotal':timer[_0x1554f7(0x420)],'cycleIndex':timer['cycleIndex']}),_0x1798e5['classList']['add'](_0x1554f7(0x372)),setTimeout(async()=>{const _0x5b76aa=_0x1554f7;data[_0x5b76aa(0x27a)][_0x5b76aa(0x332)]=_0x18726f,data[_0x5b76aa(0x27a)]['selectedSubtopicId']=_0x269f2e;const _0x39ebe2=getCurrentSubtopic();_0x39ebe2[_0x5b76aa(0x223)]?(timer[_0x5b76aa(0x453)]=_0x39ebe2[_0x5b76aa(0x223)][_0x5b76aa(0x453)],timer[_0x5b76aa(0x1de)]=_0x39ebe2[_0x5b76aa(0x223)][_0x5b76aa(0x1de)]||null,timer['remaining']=_0x39ebe2['timerState'][_0x5b76aa(0x2aa)],timer[_0x5b76aa(0x420)]=_0x39ebe2[_0x5b76aa(0x223)][_0x5b76aa(0x420)],timer[_0x5b76aa(0x444)]=_0x39ebe2[_0x5b76aa(0x223)]['cycleIndex']):timer['reset'](),await saveData(),timer[_0x5b76aa(0x376)](),renderAll(),switchView(_0x5b76aa(0x1b0)),_0x1798e5['classList']['remove'](_0x5b76aa(0x372));},0xc8);}function getCurrentSubtopic(){const _0xd8f955=_0x4900e5,_0x26d4ad=data['settings']['selectedTopicId'],_0x52eb91=data['settings'][_0xd8f955(0x3bf)];if(!_0x26d4ad||!_0x52eb91)return null;const _0x42d158=data[_0xd8f955(0x2c8)]['find'](_0xa7c8d7=>_0xa7c8d7['id']===_0x26d4ad);if(!_0x42d158)return null;return _0x42d158[_0xd8f955(0x2ee)][_0xd8f955(0x2af)](_0x278240=>_0x278240['id']===_0x52eb91)||null;}function renderContextBadge(){const _0x59eaee=_0x4900e5,_0x55fafd=getCurrentSubtopic(),_0x1fcd16=_0x55fafd?_0x55fafd['name']:_0x59eaee(0x224),_0x527078=$(_0x59eaee(0x461)),_0x181fd1=$('#currentSubtopicName'),_0x59d7ce=$(_0x59eaee(0x328));if(_0x527078)_0x527078[_0x59eaee(0x408)]=_0x55fafd?_0x59eaee(0x295)+_0x55fafd[_0x59eaee(0x403)]:_0x59eaee(0x21c);if(_0x181fd1)_0x181fd1[_0x59eaee(0x408)]=_0x1fcd16;if(_0x59d7ce)_0x59d7ce[_0x59eaee(0x408)]=_0x1fcd16;}function renderSubtopicTasks(){const _0x2a5c60=_0x4900e5,_0x2d7fb3=getCurrentSubtopic(),_0x348060=$(_0x2a5c60(0x455)),_0x2ea697=$('#newSubtopicTaskInput');if(!_0x348060||!_0x2ea697)return;const _0xd249c8=_0x2ea697[_0x2a5c60(0x1d3)];if(!_0x2d7fb3){_0x348060[_0x2a5c60(0x180)]=_0x2a5c60(0x43e),_0xd249c8[_0x2a5c60(0x3ee)]['add'](_0x2a5c60(0x178));return;}_0xd249c8[_0x2a5c60(0x3ee)][_0x2a5c60(0x160)](_0x2a5c60(0x178)),_0x348060[_0x2a5c60(0x180)]='';const _0x579656=_0x2d7fb3[_0x2a5c60(0x2a6)]?_0x2d7fb3[_0x2a5c60(0x2a6)][_0x2a5c60(0x164)](_0x12920a=>!_0x12920a[_0x2a5c60(0x16a)]):[];_0x579656[_0x2a5c60(0x34b)]===0x0&&(_0x348060[_0x2a5c60(0x180)]=_0x2a5c60(0x1c3)),_0x579656['forEach'](_0x4c705a=>{const _0x3cb1a4=_0x2a5c60,_0x18a19a=document[_0x3cb1a4(0x3a7)]('li');_0x18a19a[_0x3cb1a4(0x180)]=_0x3cb1a4(0x189)+_0x4c705a['id']+'\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22'+_0x4c705a['id']+'\x22>'+escapeHTML(_0x4c705a[_0x3cb1a4(0x1e0)])+_0x3cb1a4(0x3b2),_0x18a19a['querySelector'](_0x3cb1a4(0x42a))['addEventListener'](_0x3cb1a4(0x3d7),_0x17a3d5=>toggleSubtopicTask(_0x17a3d5['target']['id'],_0x18a19a)),_0x348060[_0x3cb1a4(0x20d)](_0x18a19a);});}async function addSubtopicTask(){const _0xf9767a=_0x4900e5,_0x36e7b9=getCurrentSubtopic();if(!_0x36e7b9){toast(t(_0xf9767a(0x2dd)));return;}const _0x5805=$(_0xf9767a(0x38a)),_0x590181=_0x5805[_0xf9767a(0x1f4)][_0xf9767a(0x214)]();if(_0x590181){if(!_0x36e7b9[_0xf9767a(0x2a6)])_0x36e7b9[_0xf9767a(0x2a6)]=[];_0x36e7b9[_0xf9767a(0x2a6)][_0xf9767a(0x350)]({'id':uid(_0xf9767a(0x3f6)),'text':_0x590181,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x5805[_0xf9767a(0x1f4)]='';}_0x5805[_0xf9767a(0x45a)]();}async function toggleSubtopicTask(_0x20f3d1,_0x40e508){const _0x24e675=_0x4900e5,_0x4e6d1f=getCurrentSubtopic();if(!_0x4e6d1f||!_0x4e6d1f[_0x24e675(0x2a6)])return;const _0x56b4f7=_0x4e6d1f[_0x24e675(0x2a6)]['find'](_0x4eb298=>_0x4eb298['id']===_0x20f3d1);_0x56b4f7&&(_0x56b4f7[_0x24e675(0x16a)]=!![],_0x4e6d1f['stats'][_0x24e675(0x3fe)]=(_0x4e6d1f[_0x24e675(0x283)][_0x24e675(0x3fe)]||0x0)+0x1,await saveData(),_0x40e508['classList'][_0x24e675(0x3ab)](_0x24e675(0x2e7)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':_0x4900e5(0x41f),'prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0x35c11f,{silent:silent=![]}={}){const _0x5b411a=_0x4900e5,_0x466c4e=data[_0x5b411a(0x27a)];this[_0x5b411a(0x445)]=_0x35c11f,this[_0x5b411a(0x246)]=_0x35c11f==='A'?_0x466c4e[_0x5b411a(0x1ac)]:_0x35c11f==='B'?_0x466c4e[_0x5b411a(0x247)]:0x0,_0x466c4e[_0x5b411a(0x418)]=_0x35c11f,await saveData(),this[_0x5b411a(0x453)]==='idle'&&this[_0x5b411a(0x2da)]();},'currentDurations'(){const _0x425a51=_0x4900e5,_0x4f582b=data[_0x425a51(0x27a)][_0x425a51(0x168)];if(this['mode']==='A')return{'work':_0x4f582b[_0x425a51(0x3e7)],'short':_0x4f582b[_0x425a51(0x206)],'long':_0x4f582b[_0x425a51(0x20f)],'winddown':_0x4f582b['A_winddown']??0x0};if(this[_0x425a51(0x445)]==='B')return{'work':_0x4f582b[_0x425a51(0x447)],'short':_0x4f582b[_0x425a51(0x3ce)],'long':_0x4f582b[_0x425a51(0x2f9)],'winddown':_0x4f582b['B_winddown']??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x203960=_0x4900e5,_0x5c0236=data[_0x203960(0x27a)];if(this[_0x203960(0x445)]==='A')return{'cycles':_0x5c0236[_0x203960(0x1ac)],'interval':_0x5c0236[_0x203960(0x297)]};if(this[_0x203960(0x445)]==='B')return{'cycles':_0x5c0236[_0x203960(0x247)],'interval':_0x5c0236[_0x203960(0x1ec)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x5f3234=_0x4900e5,_0x1004ae=$('#stateBadge'),_0x2ef1be=$('.timer-circle-progress'),_0x1cd86f=$(_0x5f3234(0x31b));if(!_0x1004ae||!_0x2ef1be||!_0x1cd86f)return;const _0x1bb396=this['mode']==='C';$('#btnStart')[_0x5f3234(0x3ee)][_0x5f3234(0x1c1)]('hidden',this[_0x5f3234(0x453)]!=='idle'||_0x1bb396&&this[_0x5f3234(0x453)]===_0x5f3234(0x29a)),$(_0x5f3234(0x358))[_0x5f3234(0x3ee)][_0x5f3234(0x1c1)](_0x5f3234(0x178),!(_0x1bb396&&this[_0x5f3234(0x453)]===_0x5f3234(0x29a))),$('#btnPause')[_0x5f3234(0x3ee)][_0x5f3234(0x1c1)](_0x5f3234(0x178),![_0x5f3234(0x29a),'break','long_break']['includes'](this['state'])),$(_0x5f3234(0x26c))[_0x5f3234(0x3ee)][_0x5f3234(0x1c1)](_0x5f3234(0x178),this[_0x5f3234(0x453)]!==_0x5f3234(0x1b8));let _0x403cc2=_0x5f3234(0x267);if(this[_0x5f3234(0x453)]===_0x5f3234(0x29a))_0x1004ae[_0x5f3234(0x408)]=_0x1bb396?_0x5f3234(0x221):_0x5f3234(0x359),_0x1004ae['className']='badge\x20state\x20work',_0x403cc2=_0x5f3234(0x273);else{if(this[_0x5f3234(0x453)]===_0x5f3234(0x3dd))_0x1004ae[_0x5f3234(0x408)]=_0x5f3234(0x47a),_0x1004ae[_0x5f3234(0x2ad)]=_0x5f3234(0x196),_0x403cc2=_0x5f3234(0x1c2);else{if(this['state']===_0x5f3234(0x3d0))_0x1004ae[_0x5f3234(0x408)]='NGHỈ\x20DÀI',_0x1004ae[_0x5f3234(0x2ad)]=_0x5f3234(0x355),_0x403cc2=_0x5f3234(0x327);else{if(this[_0x5f3234(0x453)]===_0x5f3234(0x426)){_0x1004ae[_0x5f3234(0x408)]=_0x5f3234(0x2ec),_0x1004ae['className']=_0x5f3234(0x26d),_0x403cc2=_0x5f3234(0x404);try{$('#windDownChecklist')[_0x5f3234(0x3ee)][_0x5f3234(0x160)](_0x5f3234(0x178)),$(_0x5f3234(0x324))['classList'][_0x5f3234(0x160)](_0x5f3234(0x178));}catch(_0x220104){}}else this[_0x5f3234(0x453)]===_0x5f3234(0x1b8)?(_0x1004ae[_0x5f3234(0x408)]='TẠM\x20DỪNG',_0x1004ae[_0x5f3234(0x2ad)]='badge'):(_0x1004ae['textContent']=_0x5f3234(0x3f5),_0x1004ae[_0x5f3234(0x2ad)]=_0x5f3234(0x314));}}}[_0x5f3234(0x29a),'break',_0x5f3234(0x3d0),_0x5f3234(0x426)]['includes'](this['state'])?_0x1cd86f[_0x5f3234(0x3ee)][_0x5f3234(0x3ab)]('breathing'):_0x1cd86f[_0x5f3234(0x3ee)][_0x5f3234(0x160)](_0x5f3234(0x379));_0x2ef1be[_0x5f3234(0x365)][_0x5f3234(0x21e)]=_0x403cc2,_0x1cd86f[_0x5f3234(0x3ee)][_0x5f3234(0x160)]('finished');const _0x591d05=$(_0x5f3234(0x1ed));if(_0x591d05)_0x591d05[_0x5f3234(0x408)]=formatMMSS(this[_0x5f3234(0x2aa)]);const _0x14c0a8=_0x2ef1be['r'][_0x5f3234(0x1b7)][_0x5f3234(0x1f4)],_0xb8caed=0x2*Math['PI']*_0x14c0a8,_0x3959f9=this[_0x5f3234(0x420)]>0x0?_0xb8caed-this[_0x5f3234(0x2aa)]/this[_0x5f3234(0x420)]*_0xb8caed:_0xb8caed;_0x2ef1be[_0x5f3234(0x365)]['strokeDasharray']=_0xb8caed,_0x2ef1be['style']['strokeDashoffset']=isNaN(_0x3959f9)?_0xb8caed:_0x3959f9;const _0x598cea=$(_0x5f3234(0x278));if(_0x598cea){const _0x4f589d=this[_0x5f3234(0x39b)]();_0x598cea[_0x5f3234(0x408)]=t(_0x5f3234(0x345),{'current':this[_0x5f3234(0x444)],'target':_0x4f589d['cycles']}),_0x598cea[_0x5f3234(0x3ee)]['toggle'](_0x5f3234(0x178),_0x1bb396);}const _0x226de4=$('#breakSuggestionDisplay');_0x226de4&&_0x226de4[_0x5f3234(0x3ee)][_0x5f3234(0x1c1)]('hidden',_0x1bb396&&this[_0x5f3234(0x453)]===_0x5f3234(0x29a));const _0x1dcb9f=$('#draggableTimer');if(_0x1dcb9f)_0x1dcb9f[_0x5f3234(0x408)]=formatMMSS(this[_0x5f3234(0x2aa)]);if(this[_0x5f3234(0x453)]!==_0x5f3234(0x426))try{$(_0x5f3234(0x293))[_0x5f3234(0x3ee)][_0x5f3234(0x3ab)]('hidden'),$(_0x5f3234(0x324))[_0x5f3234(0x3ee)][_0x5f3234(0x3ab)](_0x5f3234(0x178));}catch(_0x32df8e){}},'persistTimerState'(_0x4f5ba9=![]){const _0x562f1d=_0x4900e5;try{const _0x196b8e=getCurrentSubtopic();if(!_0x196b8e)return;const _0x33ecd1={'state':this[_0x562f1d(0x453)],'prevState':this[_0x562f1d(0x1de)],'remaining':this[_0x562f1d(0x2aa)],'segmentTotal':this[_0x562f1d(0x420)],'cycleIndex':this['cycleIndex']};_0x196b8e[_0x562f1d(0x223)]=_0x33ecd1;try{localStorage[_0x562f1d(0x462)](_0x562f1d(0x459)+_0x196b8e['id'],JSON['stringify'](_0x33ecd1));}catch(_0x7a336){}this['lastPersist']=Date['now']();}catch(_0xab6d02){}},'_startTick'(){const _0xdf4368=_0x4900e5;if(this[_0xdf4368(0x45c)])clearInterval(this[_0xdf4368(0x45c)]);if(this[_0xdf4368(0x445)]==='C'&&this['state']===_0xdf4368(0x29a)){this['tickHandle']=setInterval(()=>{const _0x5e60e2=_0xdf4368;this[_0x5e60e2(0x2aa)]+=0x1,this[_0x5e60e2(0x376)](),this['persistTimerState']();},0x3e8);return;}this[_0xdf4368(0x45c)]=setInterval(()=>{const _0x32b474=_0xdf4368;this[_0x32b474(0x2aa)]>0x0&&(this[_0x32b474(0x2aa)]-=0x1,this[_0x32b474(0x376)](),this[_0x32b474(0x3e1)]()),this[_0x32b474(0x2aa)]<=0x0&&(clearInterval(this[_0x32b474(0x45c)]),this[_0x32b474(0x45c)]=null,this['_onFinishSegment']());},0x3e8);},'_onFinishSegment'(){const _0x2ba6e4=_0x4900e5;if(this[_0x2ba6e4(0x453)]===_0x2ba6e4(0x29a)){const _0x50c6ae=getCurrentSubtopic();if(_0x50c6ae){const _0xc2c0b8=this[_0x2ba6e4(0x352)]()[_0x2ba6e4(0x29a)];_0x50c6ae[_0x2ba6e4(0x283)][_0x2ba6e4(0x1cb)]=(_0x50c6ae['stats']['totalMinutes']||0x0)+_0xc2c0b8,_0x50c6ae['stats'][_0x2ba6e4(0x471)]=(_0x50c6ae[_0x2ba6e4(0x283)][_0x2ba6e4(0x471)]||0x0)+0x1;const _0x4ac3dd={'id':uid(_0x2ba6e4(0x1e5)),'dateISO':todayISO(),'durationMinutes':_0xc2c0b8,'mode':this['mode'],'note':''};if(!_0x50c6ae[_0x2ba6e4(0x43a)])_0x50c6ae[_0x2ba6e4(0x43a)]=[];_0x50c6ae['sessions'][_0x2ba6e4(0x2bb)](_0x4ac3dd),saveData(),renderStatsHistory(),checkAndShowMilestones();}this['cycleIndex']++;}if(typeof data!==_0x2ba6e4(0x215)&&data&&data[_0x2ba6e4(0x27a)]&&data[_0x2ba6e4(0x27a)][_0x2ba6e4(0x2fc)]===![]&&this[_0x2ba6e4(0x453)]===_0x2ba6e4(0x29a))playSound(_0x2ba6e4(0x3aa));else(this['state']===_0x2ba6e4(0x426)||this[_0x2ba6e4(0x453)]===_0x2ba6e4(0x3dd)||this[_0x2ba6e4(0x453)]===_0x2ba6e4(0x3d0))&&playSound('break_end');const _0x580aef=$('.timer-circle-container');if(_0x580aef)_0x580aef[_0x2ba6e4(0x3ee)][_0x2ba6e4(0x3ab)](_0x2ba6e4(0x167));if(data[_0x2ba6e4(0x27a)][_0x2ba6e4(0x34e)]){if(this[_0x2ba6e4(0x453)]===_0x2ba6e4(0x29a))data[_0x2ba6e4(0x27a)]['enableWinddown']===![]?this[_0x2ba6e4(0x44c)]():this[_0x2ba6e4(0x42b)]();else this[_0x2ba6e4(0x453)]===_0x2ba6e4(0x426)?this[_0x2ba6e4(0x44c)]():this['beginWork']();}else this['tickHandle']&&(clearInterval(this[_0x2ba6e4(0x45c)]),this[_0x2ba6e4(0x45c)]=null),this[_0x2ba6e4(0x453)]=_0x2ba6e4(0x41f),this[_0x2ba6e4(0x1de)]=null,this[_0x2ba6e4(0x376)](),toast(_0x2ba6e4(0x209));},'beginWindDown'(){const _0x270f8c=_0x4900e5;if(data?.['settings']?.[_0x270f8c(0x2fc)]===![]){this[_0x270f8c(0x44c)]();return;}this[_0x270f8c(0x1de)]=this[_0x270f8c(0x453)],this['state']=_0x270f8c(0x426);const _0x114c36=(this[_0x270f8c(0x352)]()['winddown']||0x0)*0x3c;if(_0x114c36<=0x0){this[_0x270f8c(0x44c)]();return;}this[_0x270f8c(0x420)]=_0x114c36,this[_0x270f8c(0x2aa)]=_0x114c36;try{playSound(_0x270f8c(0x22f));}catch(_0x54c569){}try{toast(_0x270f8c(0x422));}catch(_0x4b34e5){}this['_startTick'](),this['updateUI']();},'beginWork'(){const _0x59798a=_0x4900e5;this[_0x59798a(0x1de)]=this['state'],this[_0x59798a(0x453)]='work';if(this['mode']==='C'){this['segmentTotal']=0x0;if(this[_0x59798a(0x1de)]!==_0x59798a(0x1b8))this[_0x59798a(0x2aa)]=0x0;}else{const _0x52fca5=this[_0x59798a(0x352)]()['work']*0x3c;this[_0x59798a(0x420)]=_0x52fca5;if(this[_0x59798a(0x1de)]!==_0x59798a(0x1b8))this[_0x59798a(0x2aa)]=_0x52fca5;}const _0x529b42=$(_0x59798a(0x1a2));_0x529b42&&(_0x529b42[_0x59798a(0x408)]=''),this[_0x59798a(0x438)](),this['updateUI']();},'finishFlowSession'(){const _0xd71cc6=_0x4900e5;if(this[_0xd71cc6(0x445)]!=='C'||this[_0xd71cc6(0x453)]!==_0xd71cc6(0x29a))return;this[_0xd71cc6(0x45c)]&&(clearInterval(this['tickHandle']),this[_0xd71cc6(0x45c)]=null);const _0x3103cc=Math['max'](0x1,parseInt(data[_0xd71cc6(0x27a)][_0xd71cc6(0x19e)]??0x5,0xa)),_0x132c78=Math[_0xd71cc6(0x256)](0x0,this[_0xd71cc6(0x2aa)]|0x0),_0x424bcc=Math[_0xd71cc6(0x256)](0x3c,Math[_0xd71cc6(0x2cc)](_0x132c78/_0x3103cc));this[_0xd71cc6(0x453)]='break',this[_0xd71cc6(0x420)]=_0x424bcc,this[_0xd71cc6(0x2aa)]=_0x424bcc,this[_0xd71cc6(0x438)](),this[_0xd71cc6(0x376)](),this['persistTimerState'](!![]);try{toast(_0xd71cc6(0x380)+Math['round'](_0x424bcc/0x3c)+_0xd71cc6(0x3bc)+_0x3103cc+').');}catch(_0x16ecf0){}},'beginBreak'(){const _0x54ed2f=_0x4900e5;this[_0x54ed2f(0x1de)]=this[_0x54ed2f(0x453)];const _0x34c750=this[_0x54ed2f(0x39b)](),_0x45a5cf=this['currentDurations']();if(this[_0x54ed2f(0x444)]>0x0&&this['cycleIndex']%_0x34c750[_0x54ed2f(0x272)]===0x0){this[_0x54ed2f(0x453)]=_0x54ed2f(0x3d0);const _0x20ea3e=_0x45a5cf[_0x54ed2f(0x2b5)]*0x3c;this['segmentTotal']=_0x20ea3e;if(this[_0x54ed2f(0x1de)]!==_0x54ed2f(0x1b8))this[_0x54ed2f(0x2aa)]=_0x20ea3e;toast(_0x54ed2f(0x1d1));}else{this[_0x54ed2f(0x453)]=_0x54ed2f(0x3dd);const _0x24e15d=_0x45a5cf[_0x54ed2f(0x415)]*0x3c;this[_0x54ed2f(0x420)]=_0x24e15d;if(this[_0x54ed2f(0x1de)]!==_0x54ed2f(0x1b8))this[_0x54ed2f(0x2aa)]=_0x24e15d;}const _0x237543=$(_0x54ed2f(0x1a2));if(_0x237543){const _0x56457d=Math['floor'](Math[_0x54ed2f(0x3e2)]()*breakSuggestions['length']);_0x237543[_0x54ed2f(0x408)]=_0x54ed2f(0x3c8)+breakSuggestions[_0x56457d];}this[_0x54ed2f(0x438)](),this['updateUI']();},async 'start'(){const _0x4b9d78=_0x4900e5;if(!getCurrentSubtopic()){toast(_0x4b9d78(0x1cf));return;}ensureAudio();if(this[_0x4b9d78(0x445)]==='C'&&this['state']===_0x4b9d78(0x41f))this[_0x4b9d78(0x453)]=_0x4b9d78(0x29a),this['remaining']=0x0,this[_0x4b9d78(0x420)]=0x0,this[_0x4b9d78(0x444)]=0x0,this[_0x4b9d78(0x438)](),this['updateUI']();else{if(this[_0x4b9d78(0x453)]===_0x4b9d78(0x41f))this[_0x4b9d78(0x444)]=this[_0x4b9d78(0x444)]||0x0,this[_0x4b9d78(0x451)]();else this[_0x4b9d78(0x453)]==='paused'&&this[_0x4b9d78(0x30e)]();}await this['persistTimerState'](!![]);},async 'pause'(){const _0x20842a=_0x4900e5;this['tickHandle']&&(clearInterval(this[_0x20842a(0x45c)]),this['tickHandle']=null),this[_0x20842a(0x1de)]=this['state'],this[_0x20842a(0x453)]=_0x20842a(0x1b8),this[_0x20842a(0x376)](),await this[_0x20842a(0x3e1)](!![]);},async 'resume'(){const _0x4ee009=_0x4900e5;if(this['state']!==_0x4ee009(0x1b8))return;this[_0x4ee009(0x453)]=this[_0x4ee009(0x1de)]||_0x4ee009(0x29a),this['_startTick'](),this[_0x4ee009(0x376)](),await this[_0x4ee009(0x3e1)](!![]);},async 'skip'(){const _0x180505=_0x4900e5;if(this[_0x180505(0x445)]==='C'&&this[_0x180505(0x453)]===_0x180505(0x29a)){this['finishFlowSession'](),await this[_0x180505(0x3e1)](!![]);return;}this[_0x180505(0x453)]===_0x180505(0x29a)?(this['tickHandle']&&(clearInterval(this['tickHandle']),this[_0x180505(0x45c)]=null),this[_0x180505(0x2aa)]=0x0,this[_0x180505(0x28a)]()):(this['remaining']=0x0,this[_0x180505(0x45c)]&&(clearInterval(this[_0x180505(0x45c)]),this[_0x180505(0x45c)]=null),this['_onFinishSegment']()),await this['persistTimerState'](!![]);},async 'reset'(){const _0x4c34af=_0x4900e5;this[_0x4c34af(0x45c)]&&(clearInterval(this[_0x4c34af(0x45c)]),this['tickHandle']=null);this['state']='idle',this[_0x4c34af(0x1de)]=null,this[_0x4c34af(0x2aa)]=0x0,this[_0x4c34af(0x420)]=0x0,this[_0x4c34af(0x444)]=0x0;const _0x4bbe93=$(_0x4c34af(0x1a2));_0x4bbe93&&(_0x4bbe93[_0x4c34af(0x408)]=''),this['updateUI'](),await this[_0x4c34af(0x3e1)](!![]);}};async function deleteSummary(_0xd30e26){const _0x46a7ae=_0x4900e5;showConfirmModal(_0x46a7ae(0x2ab),'Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?',async _0x306696=>{const _0xaf1498=_0x46a7ae;if(!_0x306696)return;const _0x80916b=getCurrentSubtopic();if(!_0x80916b||!_0x80916b[_0xaf1498(0x26b)])return;const _0x2853fe=[..._0x80916b[_0xaf1498(0x26b)]];_0x80916b['summaries']=_0x80916b['summaries']['filter'](_0x35e38b=>_0x35e38b['id']!==_0xd30e26);try{await storageManager['update'](_0xaf1498(0x2ee),_0x80916b),renderSummaries(),toast(_0xaf1498(0x35a));}catch(_0x199d3f){console[_0xaf1498(0x454)](_0xaf1498(0x284),_0x199d3f),_0x80916b[_0xaf1498(0x26b)]=_0x2853fe,toast(_0xaf1498(0x1f5));}});}function exportSummary(_0x4cebda){const _0x3a2f17=_0x4900e5,_0x15449d=new Blob([_0x4cebda[_0x3a2f17(0x2f4)]],{'type':_0x3a2f17(0x33c)}),_0x1d86af=document['createElement']('a'),_0x4f1fb4=new Date(_0x4cebda['createdAt']),_0x9d600e=_0x5ee77=>(''+_0x5ee77)[_0x3a2f17(0x1cc)](0x2,'0');_0x1d86af[_0x3a2f17(0x41c)]=URL[_0x3a2f17(0x3ac)](_0x15449d),_0x1d86af[_0x3a2f17(0x406)]=_0x3a2f17(0x484)+_0x4f1fb4[_0x3a2f17(0x263)]()+_0x9d600e(_0x4f1fb4[_0x3a2f17(0x331)]()+0x1)+_0x9d600e(_0x4f1fb4[_0x3a2f17(0x38b)]())+_0x3a2f17(0x446),_0x1d86af[_0x3a2f17(0x29d)](),URL['revokeObjectURL'](_0x1d86af['href']);}function renderStatsHistory(){const _0x1e74ac=_0x4900e5,_0x3c8950=getCurrentSubtopic(),_0x40ebca=$(_0x1e74ac(0x17d)),_0x324be2=$(_0x1e74ac(0x1e8)),_0x21dac0=$('#statTasks'),_0x4b619b=$(_0x1e74ac(0x40d));if(!_0x40ebca||!_0x324be2||!_0x21dac0||!_0x4b619b)return;if(!_0x3c8950){_0x40ebca[_0x1e74ac(0x408)]=_0x1e74ac(0x394),_0x324be2[_0x1e74ac(0x408)]='0',_0x21dac0[_0x1e74ac(0x408)]='0',_0x4b619b[_0x1e74ac(0x180)]=_0x1e74ac(0x2fd);return;}const _0x13459f=_0x3c8950[_0x1e74ac(0x283)]&&_0x3c8950['stats'][_0x1e74ac(0x1cb)]?_0x3c8950[_0x1e74ac(0x283)][_0x1e74ac(0x1cb)]:0x0,_0x2e7f9f=_0x3c8950[_0x1e74ac(0x283)]&&_0x3c8950[_0x1e74ac(0x283)][_0x1e74ac(0x471)]?_0x3c8950['stats'][_0x1e74ac(0x471)]:0x0,_0x49251f=_0x3c8950[_0x1e74ac(0x2a6)]?_0x3c8950[_0x1e74ac(0x2a6)][_0x1e74ac(0x164)](_0x5202f9=>_0x5202f9['isCompleted'])[_0x1e74ac(0x34b)]:0x0;_0x40ebca[_0x1e74ac(0x408)]=formatDaysHoursMinutes(_0x13459f),_0x324be2[_0x1e74ac(0x408)]=String(_0x2e7f9f),_0x21dac0[_0x1e74ac(0x408)]=String(_0x49251f),_0x4b619b[_0x1e74ac(0x180)]='';const _0x480187=Array[_0x1e74ac(0x3cd)](_0x3c8950[_0x1e74ac(0x43a)])?_0x3c8950['sessions']:[];if(_0x480187['length']===0x0){_0x4b619b[_0x1e74ac(0x180)]='<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>';return;}_0x480187[_0x1e74ac(0x29b)](_0x52b1f0=>{const _0xca6ee=_0x1e74ac,_0x56ade4=document[_0xca6ee(0x3a7)](_0xca6ee(0x306));_0x56ade4[_0xca6ee(0x2ad)]=_0xca6ee(0x3be);const _0x4e647d=document[_0xca6ee(0x3a7)](_0xca6ee(0x306)),_0x36b13a=_0x52b1f0[_0xca6ee(0x2c3)]?new Date(_0x52b1f0['dateISO']):new Date(),_0xf31376=_0x52b1f0[_0xca6ee(0x467)]!=null?_0x52b1f0[_0xca6ee(0x467)]:_0x52b1f0[_0xca6ee(0x27d)]||0x0;_0x4e647d[_0xca6ee(0x180)]='<div\x20class=\x22hist-meta\x22>'+_0x36b13a[_0xca6ee(0x3de)]()+'\x20·\x20'+_0xf31376+_0xca6ee(0x400)+(_0x52b1f0[_0xca6ee(0x445)]||'')+_0xca6ee(0x226)+(_0xca6ee(0x21d)+(_0x52b1f0[_0xca6ee(0x452)]?escapeHTML(_0x52b1f0[_0xca6ee(0x452)]):_0xca6ee(0x2db))+_0xca6ee(0x226)),_0x56ade4[_0xca6ee(0x20d)](_0x4e647d),_0x4b619b[_0xca6ee(0x20d)](_0x56ade4);});}function renderGeneralNotes(){const _0x1a3a48=_0x4900e5,_0x121ead=$(_0x1a3a48(0x259));if(!_0x121ead)return;const _0x5da791=getCurrentSubtopic();if(!_0x5da791){_0x121ead[_0x1a3a48(0x180)]=_0x1a3a48(0x2c0);return;}_0x5da791[_0x1a3a48(0x2bd)]=_0x5da791[_0x1a3a48(0x2bd)]||[];if(_0x5da791[_0x1a3a48(0x2bd)][_0x1a3a48(0x34b)]===0x0){_0x121ead[_0x1a3a48(0x180)]=_0x1a3a48(0x47c);return;}_0x121ead[_0x1a3a48(0x180)]='',_0x5da791[_0x1a3a48(0x2bd)]['forEach'](_0x3f53ce=>{const _0x2c4347=_0x1a3a48,_0x3c87b4=document[_0x2c4347(0x3a7)](_0x2c4347(0x306));_0x3c87b4['className']='note-item';const _0x910ed6=document[_0x2c4347(0x3a7)]('div');_0x910ed6[_0x2c4347(0x2ad)]=_0x2c4347(0x188),_0x910ed6[_0x2c4347(0x408)]=typeof _0x3f53ce===_0x2c4347(0x28d)?_0x3f53ce:_0x3f53ce[_0x2c4347(0x1e0)]||'';const _0x6c4344=document[_0x2c4347(0x3a7)](_0x2c4347(0x306));_0x6c4344[_0x2c4347(0x2ad)]='note-meta',_0x6c4344[_0x2c4347(0x408)]=_0x3f53ce[_0x2c4347(0x35d)]?new Date(_0x3f53ce[_0x2c4347(0x35d)])[_0x2c4347(0x3de)]():'';const _0x35199e=document['createElement'](_0x2c4347(0x306)),_0x4075f8=document[_0x2c4347(0x3a7)](_0x2c4347(0x161));_0x4075f8[_0x2c4347(0x2ad)]=_0x2c4347(0x3e3),_0x4075f8[_0x2c4347(0x408)]=_0x2c4347(0x31f),_0x4075f8[_0x2c4347(0x2c4)]=async _0xba45cc=>{const _0x5ce7fa=_0x2c4347;_0xba45cc[_0x5ce7fa(0x443)]();const _0x5df874=getCurrentSubtopic();if(!_0x5df874)return;_0x5df874[_0x5ce7fa(0x2bd)]=(_0x5df874[_0x5ce7fa(0x2bd)]||[])[_0x5ce7fa(0x164)](_0x14a04e=>(_0x14a04e['id']||_0x14a04e)!==(_0x3f53ce['id']||_0x3f53ce)),await saveData(),renderGeneralNotes();},_0x35199e[_0x2c4347(0x20d)](_0x4075f8);const _0x9276f1=document[_0x2c4347(0x3a7)](_0x2c4347(0x306));_0x9276f1['className']='note-content-wrapper',_0x9276f1['append'](_0x910ed6,_0x6c4344),_0x3c87b4[_0x2c4347(0x33b)](_0x9276f1,_0x35199e),_0x121ead[_0x2c4347(0x20d)](_0x3c87b4);});}function renderMethods(){const _0x50fa10=_0x4900e5,_0xcae8f5=document['querySelector'](_0x50fa10(0x317));if(!_0xcae8f5)return;_0xcae8f5[_0x50fa10(0x180)]='';const _0x2c9b73=data?.[_0x50fa10(0x27a)]?.[_0x50fa10(0x2f3)]||[];if(_0x2c9b73[_0x50fa10(0x34b)]===0x0){_0xcae8f5[_0x50fa10(0x180)]=_0x50fa10(0x431);return;}_0x2c9b73[_0x50fa10(0x29b)](_0x23383d=>{const _0x3aed4a=_0x50fa10,_0x4b4c0e=document[_0x3aed4a(0x3a7)]('details');_0x4b4c0e['className']=_0x3aed4a(0x460),_0x4b4c0e[_0x3aed4a(0x1ae)][_0x3aed4a(0x27f)]=_0x23383d['id'];const _0x5f57ad=document['createElement'](_0x3aed4a(0x2f5)),_0x1fddb2=document[_0x3aed4a(0x3a7)](_0x3aed4a(0x31e));_0x1fddb2['className']=_0x3aed4a(0x390),_0x1fddb2['textContent']=_0x23383d[_0x3aed4a(0x36a)]||'Chưa\x20có\x20tiêu\x20đề',_0x1fddb2[_0x3aed4a(0x1da)](_0x3aed4a(0x29d),_0x426145=>{const _0x443a85=_0x3aed4a;_0x426145['preventDefault'](),_0x426145[_0x443a85(0x443)](),_0x4b4c0e[_0x443a85(0x1ce)]=!_0x4b4c0e[_0x443a85(0x1ce)];});const _0x28eafe=document[_0x3aed4a(0x3a7)]('div');_0x28eafe['className']=_0x3aed4a(0x31a);const _0x4dc497=document['createElement'](_0x3aed4a(0x161));_0x4dc497['className']=_0x3aed4a(0x207),_0x4dc497['textContent']=_0x3aed4a(0x22d),_0x4dc497[_0x3aed4a(0x1ae)]['id']=_0x23383d['id'];const _0x5df26e=document[_0x3aed4a(0x3a7)]('button');_0x5df26e['className']=_0x3aed4a(0x3ff),_0x5df26e['textContent']=_0x3aed4a(0x31f),_0x5df26e[_0x3aed4a(0x1ae)]['id']=_0x23383d['id'],_0x28eafe[_0x3aed4a(0x33b)](_0x4dc497,_0x5df26e),_0x5f57ad[_0x3aed4a(0x33b)](_0x1fddb2,_0x28eafe);const _0x44ede2=document[_0x3aed4a(0x3a7)](_0x3aed4a(0x306));_0x44ede2['className']=_0x3aed4a(0x3f2),_0x44ede2[_0x3aed4a(0x180)]=_0x23383d[_0x3aed4a(0x2f4)]||'',_0x4b4c0e[_0x3aed4a(0x33b)](_0x5f57ad,_0x44ede2),_0xcae8f5['appendChild'](_0x4b4c0e),_0x4b4c0e[_0x3aed4a(0x1da)](_0x3aed4a(0x29d),_0x2337fa=>{const _0x281693=_0x3aed4a,_0x4634e3=_0x2337fa[_0x281693(0x1b1)];if(!_0x4634e3)return;if(_0x4634e3[_0x281693(0x282)]('button')||_0x4634e3[_0x281693(0x282)]('a')||_0x4634e3['closest'](_0x281693(0x1be))||_0x4634e3['closest']('.color-palette'))return;if(!_0x4b4c0e['open'])_0x4b4c0e[_0x281693(0x1ce)]=!![];});});const _0x2cb556=_0xcae8f5[_0x50fa10(0x16d)]('.method-item');_0x2cb556['forEach'](_0x280215=>{const _0x4d9692=_0x50fa10;_0x280215[_0x4d9692(0x1da)](_0x4d9692(0x1c1),()=>{const _0xce7df5=_0x4d9692;_0x280215['open']&&_0x2cb556[_0xce7df5(0x29b)](_0x4f00c9=>{const _0x1eab52=_0xce7df5;if(_0x4f00c9!==_0x280215)_0x4f00c9[_0x1eab52(0x1ce)]=![];});});});}function addGeneralNote(){const _0x179ba7=_0x4900e5;showInputModal(_0x179ba7(0x40c),async _0x20096b=>{const _0x1d4966=_0x179ba7;if(!_0x20096b)return;const _0x199162=getCurrentSubtopic();if(!_0x199162){toast('Chọn\x20một\x20chủ\x20đề\x20con\x20trước.');return;}_0x199162[_0x1d4966(0x2bd)]=_0x199162[_0x1d4966(0x2bd)]||[],_0x199162[_0x1d4966(0x2bd)][_0x1d4966(0x2bb)]({'id':uid('gn'),'text':_0x20096b,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0x161b17=_0x4900e5,_0x561a13=getCurrentSubtopic();if(!_0x561a13){toast('Chọn\x20chủ\x20đề\x20con\x20trước.');return;}const _0x43fff5=(_0x561a13[_0x161b17(0x2bd)]||[])['map'](_0x2b7512=>typeof _0x2b7512===_0x161b17(0x28d)?_0x2b7512:_0x2b7512[_0x161b17(0x1e0)]||'')[_0x161b17(0x164)](Boolean);if(_0x43fff5[_0x161b17(0x34b)]===0x0){toast(_0x161b17(0x248));return;}const _0x506747=$(_0x161b17(0x298));_0x506747&&(_0x506747[_0x161b17(0x17c)]=!![],_0x506747[_0x161b17(0x180)]=_0x161b17(0x3c5));try{const _0x2d794c='Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a'+_0x43fff5['join'](_0x161b17(0x2ff)),_0x4fd8db=await callGeminiAPI(_0x2d794c);if(!_0x561a13[_0x161b17(0x26b)])_0x561a13[_0x161b17(0x26b)]=[];_0x561a13[_0x161b17(0x26b)][_0x161b17(0x2bb)]({'id':uid(_0x161b17(0x344)),'content':_0x4fd8db||_0x161b17(0x37a),'createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x16b7a7){console[_0x161b17(0x454)](_0x16b7a7),toast(_0x161b17(0x1bb));}finally{_0x506747&&(_0x506747[_0x161b17(0x17c)]=![],_0x506747[_0x161b17(0x408)]='Tóm\x20tắt');}}function renderSummaries(){const _0x2170e1=_0x4900e5,_0x220467=$(_0x2170e1(0x233));if(!_0x220467)return;const _0x544c6b=getCurrentSubtopic();if(!_0x544c6b){_0x220467[_0x2170e1(0x180)]=_0x2170e1(0x2d1);return;}_0x220467['innerHTML']='';if(!_0x544c6b[_0x2170e1(0x26b)]||_0x544c6b[_0x2170e1(0x26b)][_0x2170e1(0x34b)]===0x0){_0x220467[_0x2170e1(0x180)]=_0x2170e1(0x16e);return;}_0x544c6b[_0x2170e1(0x26b)][_0x2170e1(0x29b)](_0x5b411e=>{const _0x5f02a1=_0x2170e1,_0x1f25de=document[_0x5f02a1(0x3a7)](_0x5f02a1(0x306));_0x1f25de[_0x5f02a1(0x2ad)]=_0x5f02a1(0x23c);const _0x2fca20=document[_0x5f02a1(0x3a7)](_0x5f02a1(0x306));_0x2fca20['className']=_0x5f02a1(0x1bd);const _0x168f7f=document['createElement']('div');_0x168f7f[_0x5f02a1(0x2ad)]=_0x5f02a1(0x188),_0x168f7f[_0x5f02a1(0x408)]=_0x5b411e[_0x5f02a1(0x2f4)];const _0x309cea=document['createElement'](_0x5f02a1(0x306));_0x309cea['className']=_0x5f02a1(0x433),_0x309cea[_0x5f02a1(0x408)]=new Date(_0x5b411e['createdAt'])[_0x5f02a1(0x3de)](),_0x2fca20[_0x5f02a1(0x33b)](_0x168f7f,_0x309cea);const _0x416ec0=document['createElement'](_0x5f02a1(0x306)),_0x430927=document[_0x5f02a1(0x3a7)](_0x5f02a1(0x161));_0x430927['className']='btn\x20small',_0x430927[_0x5f02a1(0x408)]=_0x5f02a1(0x30b),_0x430927[_0x5f02a1(0x2c4)]=_0x409f50=>{const _0x3c0464=_0x5f02a1;_0x409f50[_0x3c0464(0x443)](),exportSummary(_0x5b411e);};const _0x310165=document['createElement']('button');_0x310165[_0x5f02a1(0x2ad)]='btn\x20small\x20danger',_0x310165[_0x5f02a1(0x408)]='Xóa',_0x310165[_0x5f02a1(0x2c4)]=_0x27d343=>{const _0x40a8bf=_0x5f02a1;_0x27d343[_0x40a8bf(0x443)](),deleteSummary(_0x5b411e['id']);},_0x416ec0['append'](_0x430927,_0x310165),_0x1f25de[_0x5f02a1(0x33b)](_0x2fca20,_0x416ec0),_0x1f25de[_0x5f02a1(0x1da)](_0x5f02a1(0x29d),()=>_0x168f7f[_0x5f02a1(0x3ee)]['toggle'](_0x5f02a1(0x425))),_0x220467[_0x5f02a1(0x20d)](_0x1f25de);});}function loadEditingPresetFields(){const _0x5136d0=_0x4900e5,_0x285089=data[_0x5136d0(0x27a)],_0xf7f5f7=_0x285089[_0x5136d0(0x168)],_0x382ae0=$('#settings-pomodoro'),_0x2f5159=$(_0x5136d0(0x193));if(_0x382ae0&&_0x2f5159){const _0x3ff0d9=editingPreset==='C';_0x382ae0[_0x5136d0(0x3ee)]['toggle'](_0x5136d0(0x178),_0x3ff0d9),_0x2f5159[_0x5136d0(0x3ee)]['toggle']('hidden',!_0x3ff0d9);}if(editingPreset==='A'){$(_0x5136d0(0x395))[_0x5136d0(0x1f4)]=_0xf7f5f7[_0x5136d0(0x3e7)];if($(_0x5136d0(0x1f6)))$(_0x5136d0(0x1f6))[_0x5136d0(0x1f4)]=_0xf7f5f7[_0x5136d0(0x409)]??0x0;$(_0x5136d0(0x479))['value']=_0xf7f5f7[_0x5136d0(0x206)],$(_0x5136d0(0x3da))[_0x5136d0(0x1f4)]=_0xf7f5f7[_0x5136d0(0x20f)],$(_0x5136d0(0x411))['value']=_0x285089[_0x5136d0(0x1ac)],$(_0x5136d0(0x2fa))[_0x5136d0(0x1f4)]=_0x285089[_0x5136d0(0x297)];}else{if(editingPreset==='B'){$(_0x5136d0(0x395))[_0x5136d0(0x1f4)]=_0xf7f5f7[_0x5136d0(0x447)];if($(_0x5136d0(0x1f6)))$(_0x5136d0(0x1f6))[_0x5136d0(0x1f4)]=_0xf7f5f7[_0x5136d0(0x3d8)]??0x0;$(_0x5136d0(0x479))[_0x5136d0(0x1f4)]=_0xf7f5f7[_0x5136d0(0x3ce)],$(_0x5136d0(0x3da))['value']=_0xf7f5f7[_0x5136d0(0x2f9)],$('#set_cycles')[_0x5136d0(0x1f4)]=_0x285089[_0x5136d0(0x247)],$('#set_interval')[_0x5136d0(0x1f4)]=_0x285089[_0x5136d0(0x1ec)];}else{if(editingPreset==='C'){const _0x193820=$(_0x5136d0(0x218));if(_0x193820)_0x193820[_0x5136d0(0x1f4)]=_0x285089[_0x5136d0(0x19e)]??0x5;}}}}function highlightPresetSelector(){const _0x143f21=_0x4900e5;$$('#timerPresetSelector\x20button')[_0x143f21(0x29b)](_0x1f6881=>{const _0x31c122=_0x143f21,_0x2fe257=_0x1f6881[_0x31c122(0x1ae)][_0x31c122(0x33d)]===editingPreset;_0x1f6881[_0x31c122(0x3ee)][_0x31c122(0x1c1)]('acc',_0x2fe257),_0x1f6881['classList'][_0x31c122(0x1c1)](_0x31c122(0x1d0),!_0x2fe257);});}function openSettings(){const _0x5c2cce=_0x4900e5,_0x52233a=data[_0x5c2cce(0x27a)];editingPreset=_0x52233a[_0x5c2cce(0x418)],$(_0x5c2cce(0x362))[_0x5c2cce(0x1f4)]=_0x52233a[_0x5c2cce(0x419)]||'',loadEditingPresetFields(),highlightPresetSelector(),$('#set_volume')[_0x5c2cce(0x1f4)]=_0x52233a['volume']??0.8,$(_0x5c2cce(0x40f))[_0x5c2cce(0x1f4)]=_0x52233a[_0x5c2cce(0x28b)]||_0x5c2cce(0x3f4),$('#set_theme_color')[_0x5c2cce(0x1f4)]=_0x52233a[_0x5c2cce(0x1c4)]||_0x5c2cce(0x43f);const _0x573f74=getActiveYoutubeUrl();$(_0x5c2cce(0x412))[_0x5c2cce(0x1f4)]=_0x573f74||'';const _0x2b2636=extractYouTubeID(_0x573f74);$(_0x5c2cce(0x3d6))[_0x5c2cce(0x17c)]=!_0x2b2636;$(_0x5c2cce(0x33a))&&($(_0x5c2cce(0x33a))[_0x5c2cce(0x408)]='');$(_0x5c2cce(0x472))[_0x5c2cce(0x1f4)]=_0x52233a['youtubeVolume']||0x50,$('#set_ytThumbAsBg')['checked']=!!_0x52233a[_0x5c2cce(0x191)],$(_0x5c2cce(0x3a0))[_0x5c2cce(0x1f4)]=_0x52233a[_0x5c2cce(0x2e9)]||0.85;$('#set_backgroundMode')&&($('#set_backgroundMode')[_0x5c2cce(0x1f4)]=_0x52233a['backgroundMode']||_0x5c2cce(0x1bf));$(_0x5c2cce(0x3f8))&&($(_0x5c2cce(0x3f8))[_0x5c2cce(0x46b)]=!!_0x52233a['autoStartNext']);$(_0x5c2cce(0x26f))&&($(_0x5c2cce(0x26f))[_0x5c2cce(0x46b)]=_0x52233a[_0x5c2cce(0x2fc)]!==![]);$(_0x5c2cce(0x457))&&($(_0x5c2cce(0x457))['value']=_0x52233a['backupDaysToKeep']||0x7);const _0x54f476=$(_0x5c2cce(0x210));_0x54f476&&storageManager[_0x5c2cce(0x2f8)]()[_0x5c2cce(0x2a1)](_0x21b762=>{const _0x19d4e5=_0x5c2cce;_0x54f476[_0x19d4e5(0x180)]='<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>',_0x21b762&&_0x21b762[_0x19d4e5(0x34b)]>0x0?_0x21b762[_0x19d4e5(0x29b)](_0x2cb79f=>{const _0x3e549e=_0x19d4e5,_0xb4a54e=document['createElement'](_0x3e549e(0x482));_0xb4a54e['value']=_0x2cb79f[_0x3e549e(0x260)],_0xb4a54e[_0x3e549e(0x408)]=_0x3e549e(0x458)+new Date(_0x2cb79f['date'])['toLocaleDateString']('vi-VN'),_0x54f476[_0x3e549e(0x20d)](_0xb4a54e);}):_0x54f476[_0x19d4e5(0x180)]='<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>';});$(_0x5c2cce(0x384))[_0x5c2cce(0x3ee)][_0x5c2cce(0x3ab)](_0x5c2cce(0x2d7));try{trapFocus($(_0x5c2cce(0x384)));}catch(_0x2780c3){}}function closeSettings(){const _0x1fae54=_0x4900e5;$('#modalSettings')[_0x1fae54(0x3ee)][_0x1fae54(0x160)](_0x1fae54(0x2d7));try{releaseFocus();}catch(_0x1d46f2){}}async function setDefaults(){const _0x57c75d=_0x4900e5;data[_0x57c75d(0x27a)][_0x57c75d(0x168)]={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data['settings'][_0x57c75d(0x1ac)]=0x4,data[_0x57c75d(0x27a)][_0x57c75d(0x297)]=0x4,data[_0x57c75d(0x27a)][_0x57c75d(0x247)]=0x4,data['settings'][_0x57c75d(0x1ec)]=0x4,data[_0x57c75d(0x27a)]['flowtimeBreakRatio']=0x5,data[_0x57c75d(0x27a)]['preset']='A',data[_0x57c75d(0x27a)][_0x57c75d(0x40b)]=0.8,data['settings'][_0x57c75d(0x28b)]=_0x57c75d(0x3f4),await saveData(),openSettings(),toast(_0x57c75d(0x469));}async function saveSettings(){const _0x42d7ea=_0x4900e5,_0x1c7dce=data[_0x42d7ea(0x27a)];_0x1c7dce[_0x42d7ea(0x419)]=$('#set_apiKey')[_0x42d7ea(0x1f4)]['trim']();const _0x1a2b89=_0x1c7dce[_0x42d7ea(0x168)];if(editingPreset==='A')_0x1a2b89[_0x42d7ea(0x3e7)]=clampInt($(_0x42d7ea(0x395))[_0x42d7ea(0x1f4)],0x1,0x3e7),_0x1a2b89[_0x42d7ea(0x409)]=clampInt($(_0x42d7ea(0x1f6))[_0x42d7ea(0x1f4)],0x0,0x3e7),_0x1a2b89['A_short']=clampInt($(_0x42d7ea(0x479))[_0x42d7ea(0x1f4)],0x1,0x3e7),_0x1a2b89['A_long']=clampInt($(_0x42d7ea(0x3da))['value'],0x1,0x3e7),_0x1c7dce[_0x42d7ea(0x1ac)]=clampInt($('#set_cycles')[_0x42d7ea(0x1f4)],0x1,0xc),_0x1c7dce[_0x42d7ea(0x297)]=clampInt($('#set_interval')[_0x42d7ea(0x1f4)],0x2,0xc);else{if(editingPreset==='B')_0x1a2b89['B_work']=clampInt($(_0x42d7ea(0x395))[_0x42d7ea(0x1f4)],0x1,0x3e7),_0x1a2b89[_0x42d7ea(0x3d8)]=clampInt($(_0x42d7ea(0x1f6))[_0x42d7ea(0x1f4)],0x0,0x3e7),_0x1a2b89[_0x42d7ea(0x3ce)]=clampInt($(_0x42d7ea(0x479))[_0x42d7ea(0x1f4)],0x1,0x3e7),_0x1a2b89['B_long']=clampInt($(_0x42d7ea(0x3da))[_0x42d7ea(0x1f4)],0x1,0x3e7),_0x1c7dce[_0x42d7ea(0x247)]=clampInt($(_0x42d7ea(0x411))[_0x42d7ea(0x1f4)],0x1,0xc),_0x1c7dce[_0x42d7ea(0x1ec)]=clampInt($(_0x42d7ea(0x2fa))['value'],0x2,0xc);else{if(editingPreset==='C'){const _0x5a0a7c=$('#set_flowRatio');if(_0x5a0a7c)_0x1c7dce[_0x42d7ea(0x19e)]=clampInt(_0x5a0a7c[_0x42d7ea(0x1f4)],0x1,0x14);}}}_0x1c7dce[_0x42d7ea(0x40b)]=clampFloat($(_0x42d7ea(0x3a1))[_0x42d7ea(0x1f4)],0x0,0x1,0.8),_0x1c7dce['soundTheme']=$(_0x42d7ea(0x40f))[_0x42d7ea(0x1f4)]==='chime'?_0x42d7ea(0x201):'beep',_0x1c7dce[_0x42d7ea(0x1c4)]=$(_0x42d7ea(0x3a4))[_0x42d7ea(0x1f4)],_0x1c7dce[_0x42d7ea(0x2e9)]=parseFloat($(_0x42d7ea(0x3a0))[_0x42d7ea(0x1f4)])||0.85;$(_0x42d7ea(0x1aa))&&(_0x1c7dce[_0x42d7ea(0x28f)]=$(_0x42d7ea(0x1aa))[_0x42d7ea(0x1f4)]);_0x1c7dce[_0x42d7ea(0x34e)]=!!($(_0x42d7ea(0x3f8))&&$('#set_autoStartNext')['checked']),_0x1c7dce['enableWinddown']=!!($(_0x42d7ea(0x26f))&&$('#set_enableWinddown')[_0x42d7ea(0x46b)]);$('#set_backupDays')&&(_0x1c7dce[_0x42d7ea(0x2ae)]=clampInt($(_0x42d7ea(0x457))['value'],0x1,0x1e));_0x1c7dce[_0x42d7ea(0x1c4)]===_0x42d7ea(0x2d3)||_0x1c7dce[_0x42d7ea(0x1c4)]==='pastel'?(_0x1c7dce[_0x42d7ea(0x191)]=![],typeof _0x1c7dce[_0x42d7ea(0x1a3)]===_0x42d7ea(0x28d)&&_0x1c7dce[_0x42d7ea(0x1a3)][_0x42d7ea(0x368)](_0x42d7ea(0x32a))&&(_0x1c7dce['customBg']='')):_0x1c7dce[_0x42d7ea(0x191)]=!![];const _0x4f83d5=$(_0x42d7ea(0x412))[_0x42d7ea(0x1f4)][_0x42d7ea(0x214)]();_0x1c7dce[_0x42d7ea(0x191)]=$(_0x42d7ea(0x16c))[_0x42d7ea(0x46b)],_0x1c7dce['youtubeVolume']=parseInt($(_0x42d7ea(0x472))[_0x42d7ea(0x1f4)],0xa),sessionYoutubeUrl=_0x4f83d5;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer[_0x42d7ea(0x3b9)])ytPlayer[_0x42d7ea(0x3b9)](_0x1c7dce[_0x42d7ea(0x42f)]);}else try{fallbackPostMessage(_0x42d7ea(0x3b9),[_0x1c7dce[_0x42d7ea(0x42f)]]);}catch(_0x3c254c){}}catch(_0x46f27f){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x42d7ea(0x24e)](_0x1c7dce[_0x42d7ea(0x418)],{'silent':!![]}),closeSettings(),toast(_0x42d7ea(0x38d));}function clampInt(_0x565f8e,_0x3188a9,_0x56acca){const _0x45a1c7=_0x4900e5;_0x565f8e=parseInt(_0x565f8e||0x0,0xa);if(isNaN(_0x565f8e))_0x565f8e=_0x3188a9;return Math[_0x45a1c7(0x256)](_0x3188a9,Math['min'](_0x56acca,_0x565f8e));}function clampFloat(_0x4da649,_0x4bad04,_0x385296,_0x31e4ec){const _0x568813=_0x4900e5;_0x4da649=parseFloat(_0x4da649);if(Number[_0x568813(0x392)](_0x4da649))_0x4da649=_0x31e4ec;return Math[_0x568813(0x256)](_0x4bad04,Math[_0x568813(0x21a)](_0x385296,_0x4da649));}const dbPromise=new Promise((_0x5a9396,_0x3628bc)=>{const _0x92ed07=_0x4900e5,_0x2edd9f=indexedDB[_0x92ed07(0x1ce)]('pomodoro_files',0x1);_0x2edd9f[_0x92ed07(0x483)]=_0x189881=>_0x189881[_0x92ed07(0x1b1)][_0x92ed07(0x473)]['createObjectStore'](_0x92ed07(0x31d)),_0x2edd9f[_0x92ed07(0x296)]=_0x163871=>_0x5a9396(_0x163871['target'][_0x92ed07(0x473)]),_0x2edd9f[_0x92ed07(0x2e0)]=_0x56b2f0=>_0x3628bc(_0x56b2f0);}),fileCache={};function handleFileUpload(_0x4683f7,_0x33979c){if(!_0x4683f7)return;dbPromise['then'](_0x2fe8ce=>{const _0x1b90a0=_0x1eb0,_0x285359=uid(_0x1b90a0(0x3a2)),_0x5ca6aa=_0x2fe8ce[_0x1b90a0(0x3ed)](_0x1b90a0(0x31d),_0x1b90a0(0x428));_0x5ca6aa[_0x1b90a0(0x393)](_0x1b90a0(0x31d))[_0x1b90a0(0x311)](_0x4683f7,_0x285359),_0x5ca6aa[_0x1b90a0(0x351)]=()=>_0x33979c(_0x285359),_0x5ca6aa['onerror']=()=>toast(_0x1b90a0(0x3d2));});}function getStoredFileUrl(_0x554e6a){const _0x11388c=_0x4900e5;if(!_0x554e6a)return Promise[_0x11388c(0x265)]('');if(fileCache[_0x554e6a])return Promise[_0x11388c(0x265)](fileCache[_0x554e6a]);return dbPromise[_0x11388c(0x2a1)](_0x1b2d0b=>new Promise(_0x2e6b80=>{const _0x58dd53=_0x11388c,_0x686523=_0x1b2d0b[_0x58dd53(0x3ed)](_0x58dd53(0x31d),_0x58dd53(0x37e)),_0x422fce=_0x686523[_0x58dd53(0x393)](_0x58dd53(0x31d))[_0x58dd53(0x3d5)](_0x554e6a);_0x422fce[_0x58dd53(0x296)]=_0x1cd677=>{const _0x5dd5ac=_0x58dd53,_0x9deb61=_0x1cd677[_0x5dd5ac(0x1b1)][_0x5dd5ac(0x473)];if(_0x9deb61){const _0x195192=URL[_0x5dd5ac(0x3ac)](_0x9deb61);fileCache[_0x554e6a]=_0x195192,_0x2e6b80(_0x195192);}else _0x2e6b80('');},_0x422fce[_0x58dd53(0x2e0)]=()=>_0x2e6b80('');}));}function applyCustomBg(){const _0x270b7f=_0x4900e5,_0x912e32=data[_0x270b7f(0x27a)],_0x248dab=_0x912e32['customBg'],_0x486830=_0x912e32['theme'],_0x332464=[_0x270b7f(0x45b),_0x270b7f(0x476)][_0x270b7f(0x368)](_0x486830),_0x7b03b3=_0x486830===_0x270b7f(0x2d3)||_0x486830==='pastel',_0x42674c=_0x912e32[_0x270b7f(0x28f)]||_0x270b7f(0x1bf);document[_0x270b7f(0x17f)][_0x270b7f(0x365)][_0x270b7f(0x253)]=_0x42674c,document[_0x270b7f(0x17f)][_0x270b7f(0x365)][_0x270b7f(0x1ef)]=_0x42674c===_0x270b7f(0x1a1)?'repeat':'no-repeat';const _0x153f33=()=>{const _0x5155dd=_0x270b7f;try{document[_0x5155dd(0x17f)][_0x5155dd(0x365)][_0x5155dd(0x330)]='';}catch(_0x57323c){}};if(_0x248dab){const _0x376866=_0x248dab[_0x270b7f(0x162)]('data:')||_0x248dab['startsWith']('http')||_0x248dab['startsWith'](_0x270b7f(0x2bf))?Promise[_0x270b7f(0x265)](_0x248dab):getStoredFileUrl(_0x248dab);_0x376866[_0x270b7f(0x2a1)](_0x2475d7=>{const _0x1b7c57=_0x270b7f;_0x2475d7?document[_0x1b7c57(0x17f)]['style'][_0x1b7c57(0x405)](_0x1b7c57(0x2b8),_0x1b7c57(0x1c9)+_0x2475d7+')'):document[_0x1b7c57(0x17f)]['style'][_0x1b7c57(0x405)](_0x1b7c57(0x2b8),_0x7b03b3?_0x1b7c57(0x18a):''),_0x153f33();});}else!_0x332464?_0x7b03b3?(document[_0x270b7f(0x17f)][_0x270b7f(0x365)]['setProperty']('--bg-image',_0x270b7f(0x18a)),_0x153f33()):document[_0x270b7f(0x17f)][_0x270b7f(0x365)]['setProperty'](_0x270b7f(0x2b8),_0x270b7f(0x47d)):(document['body']['style'][_0x270b7f(0x1ad)]('--bg-image'),_0x153f33());}function applyPanelOpacity(){const _0x30f304=_0x4900e5;document['documentElement']['style'][_0x30f304(0x405)](_0x30f304(0x302),data['settings'][_0x30f304(0x2e9)]);}function renderDashboard(){const _0x32096f=_0x4900e5,_0x1ab433=data[_0x32096f(0x2c8)][_0x32096f(0x32d)](_0x3e3c3c=>_0x3e3c3c[_0x32096f(0x2ee)][_0x32096f(0x2e3)](_0x49992f=>({'topic':_0x3e3c3c[_0x32096f(0x403)],'subtopic':_0x49992f['name'],'m':_0x49992f[_0x32096f(0x283)][_0x32096f(0x1cb)]||0x0,'c':_0x49992f[_0x32096f(0x283)][_0x32096f(0x471)]||0x0,'t':_0x49992f[_0x32096f(0x283)][_0x32096f(0x3fe)]||0x0}))),_0x23a277=_0x1ab433[_0x32096f(0x2b7)]((_0x3a8050,_0x39d539)=>_0x3a8050+_0x39d539['m'],0x0),_0x589d6d=_0x1ab433[_0x32096f(0x2b7)]((_0x41fece,_0x76bc66)=>_0x41fece+_0x76bc66['c'],0x0),_0x1a1e0c=_0x1ab433['reduce']((_0xd9895d,_0x4438a2)=>_0xd9895d+_0x4438a2['t'],0x0);let _0x3c694a='<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20'+formatDaysHoursMinutes(_0x23a277)+'\x20|\x20<strong>Tổng\x20phiên:</strong>\x20'+_0x589d6d+_0x32096f(0x192)+_0x1a1e0c+_0x32096f(0x1e1);_0x1ab433[_0x32096f(0x29b)](_0x43ca8a=>{const _0x45d295=_0x32096f;_0x3c694a+=_0x45d295(0x25c)+escapeHTML(_0x43ca8a[_0x45d295(0x347)])+_0x45d295(0x421)+escapeHTML(_0x43ca8a[_0x45d295(0x44d)])+_0x45d295(0x421)+formatDaysHoursMinutes(_0x43ca8a['m'])+_0x45d295(0x421)+_0x43ca8a['c']+_0x45d295(0x421)+_0x43ca8a['t']+_0x45d295(0x243);}),_0x3c694a+=_0x32096f(0x2b0);const _0x2ed5dc=$('#dashboardContent');if(_0x2ed5dc)_0x2ed5dc[_0x32096f(0x180)]=_0x3c694a;}function getMilestones(){const _0x3068fa=_0x4900e5;return[{'hours':0x5,'title':_0x3068fa(0x349),'message':'Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!'},{'hours':0x14,'title':_0x3068fa(0x1d4),'message':_0x3068fa(0x42c)},{'hours':0x32,'title':_0x3068fa(0x39a),'message':_0x3068fa(0x475)},{'hours':0x64,'title':_0x3068fa(0x27b),'message':_0x3068fa(0x28c)},{'hours':0xfa,'title':_0x3068fa(0x3f0),'message':_0x3068fa(0x173)},{'hours':0x1f4,'title':_0x3068fa(0x240),'message':_0x3068fa(0x335)},{'hours':0x3e8,'title':'Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','message':'Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.'},{'hours':0x1388,'title':_0x3068fa(0x1e6),'message':'5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.'}]['sort']((_0x26639d,_0x3ae772)=>_0x3ae772[_0x3068fa(0x374)]-_0x26639d[_0x3068fa(0x374)]);}async function checkAndShowMilestones(){const _0x33de6a=_0x4900e5;if(!data||!data[_0x33de6a(0x27a)])return;if(!Array['isArray'](data[_0x33de6a(0x27a)][_0x33de6a(0x37d)]))data['settings'][_0x33de6a(0x37d)]=[];const _0x1ff7ce=data[_0x33de6a(0x2c8)][_0x33de6a(0x2b7)]((_0x5bb7be,_0x3c54c6)=>{const _0x82ecb2=_0x33de6a;return _0x5bb7be+_0x3c54c6[_0x82ecb2(0x2ee)]['reduce']((_0x3a98c5,_0xe61a2c)=>{const _0x397bcf=_0x82ecb2;return _0x3a98c5+(_0xe61a2c[_0x397bcf(0x283)]['totalMinutes']||0x0);},0x0);},0x0),_0x5f27e3=_0x1ff7ce/0x3c,_0x49e88f=getMilestones(),_0x85a319=Array[_0x33de6a(0x3cd)](data['settings'][_0x33de6a(0x37d)])?data[_0x33de6a(0x27a)][_0x33de6a(0x37d)]:[],_0x1c1c6d=_0x49e88f[_0x33de6a(0x164)](_0xd2946c=>_0x5f27e3>=_0xd2946c[_0x33de6a(0x374)]&&!_0x85a319[_0x33de6a(0x368)](_0xd2946c[_0x33de6a(0x374)]));if(_0x1c1c6d['length']===0x0)return![];const _0xf14bd5=_0x1c1c6d[_0x33de6a(0x2b7)]((_0x58e4f3,_0x2d80c8)=>_0x58e4f3&&_0x58e4f3[_0x33de6a(0x374)]>_0x2d80c8['hours']?_0x58e4f3:_0x2d80c8,null);if(!_0xf14bd5)return![];$(_0x33de6a(0x2ea))['textContent']=_0xf14bd5[_0x33de6a(0x36a)],$(_0x33de6a(0x36c))['textContent']=_0xf14bd5[_0x33de6a(0x300)],$(_0x33de6a(0x2e5))[_0x33de6a(0x3ee)][_0x33de6a(0x3ab)](_0x33de6a(0x2d7));try{trapFocus($('#modalMilestone'));}catch(_0x23e37c){}return data['settings'][_0x33de6a(0x37d)][_0x33de6a(0x350)](_0xf14bd5[_0x33de6a(0x374)]),await saveData(),!![];}async function seedAchievedMilestones(){const _0x4e234e=_0x4900e5;if(!data||!data[_0x4e234e(0x27a)])return;!Array[_0x4e234e(0x3cd)](data[_0x4e234e(0x27a)][_0x4e234e(0x37d)])&&(data[_0x4e234e(0x27a)][_0x4e234e(0x37d)]=[],await saveData());}async function handleSendMessage(){const _0x2274ba=_0x4900e5,_0x4cfe45=$(_0x2274ba(0x423)),_0x4d81af=$(_0x2274ba(0x241)),_0x4a5603=_0x4d81af[_0x2274ba(0x1f4)][_0x2274ba(0x214)](),_0x5d20d7=getCurrentSubtopic();if(!_0x4a5603)return;if(!_0x5d20d7){toast(t(_0x2274ba(0x2dd)));return;}_0x4d81af[_0x2274ba(0x1f4)]='',_0x4cfe45[_0x2274ba(0x17c)]=!![],_0x4cfe45[_0x2274ba(0x180)]=_0x2274ba(0x3c5),_0x5d20d7[_0x2274ba(0x3f1)][_0x2274ba(0x350)]({'role':_0x2274ba(0x2c2),'text':_0x4a5603}),renderChat();const _0x2e199d=await callGeminiAPI(_0x4a5603);_0x2e199d&&(_0x5d20d7['chatHistory'][_0x2274ba(0x350)]({'role':_0x2274ba(0x289),'text':_0x2e199d}),await saveData(),renderChat()),_0x4cfe45[_0x2274ba(0x17c)]=![],_0x4cfe45[_0x2274ba(0x180)]=_0x2274ba(0x44e);}function renderChat(){const _0x402164=_0x4900e5,_0x1f7fcf=getCurrentSubtopic(),_0x3a5b86=$(_0x402164(0x3c3)),_0x4a7373=$('#chatInput'),_0x3380d1=$(_0x402164(0x423));if(!_0x3a5b86||!_0x4a7373||!_0x3380d1)return;if(!_0x1f7fcf){_0x3a5b86[_0x402164(0x180)]=_0x402164(0x322),_0x4a7373[_0x402164(0x17c)]=!![],_0x3380d1[_0x402164(0x17c)]=!![];return;}_0x4a7373[_0x402164(0x17c)]=![],_0x3380d1[_0x402164(0x17c)]=![],_0x3a5b86[_0x402164(0x180)]='';if(!_0x1f7fcf['chatHistory']||_0x1f7fcf[_0x402164(0x3f1)][_0x402164(0x34b)]===0x0){_0x3a5b86[_0x402164(0x180)]=_0x402164(0x3c2);return;}_0x1f7fcf[_0x402164(0x3f1)]['forEach'](_0x65a424=>{const _0x4d0c73=_0x402164,_0x1b34dc=document[_0x4d0c73(0x3a7)](_0x4d0c73(0x306));_0x1b34dc['className']=_0x4d0c73(0x366)+_0x65a424[_0x4d0c73(0x449)],_0x1b34dc[_0x4d0c73(0x408)]=_0x65a424[_0x4d0c73(0x1e0)],_0x3a5b86[_0x4d0c73(0x20d)](_0x1b34dc);}),_0x3a5b86['scrollTop']=_0x3a5b86[_0x402164(0x170)];}async function handleSummarizeNote(){const _0x5563ed=_0x4900e5,_0x4b9707=$(_0x5563ed(0x3cc)),_0x59bf0b=$('#noteText'),_0x56a8ad=_0x59bf0b['value'][_0x5563ed(0x214)](),_0x8d156b=getCurrentSubtopic();if(!_0x56a8ad){toast(_0x5563ed(0x202));return;}const _0x19d59=_0x4b9707[_0x5563ed(0x180)];_0x4b9707[_0x5563ed(0x180)]=_0x5563ed(0x3c5),_0x4b9707[_0x5563ed(0x17c)]=!![];const _0x552c30=_0x5563ed(0x185)+(_0x8d156b?.['name']||_0x5563ed(0x2b3))+_0x5563ed(0x3bd)+_0x56a8ad+'\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]',_0x27248d=await callGeminiAPI(_0x552c30);_0x27248d&&(_0x59bf0b[_0x5563ed(0x1f4)]+='\x0a\x0a'+_0x27248d),_0x4b9707[_0x5563ed(0x180)]=_0x19d59,_0x4b9707['disabled']=![];}function clearChat(){const _0x2104d6=_0x4900e5,_0xc81ca5=getCurrentSubtopic();if(!_0xc81ca5){toast(t(_0x2104d6(0x2dd)));return;}showConfirmModal(_0x2104d6(0x2ab),_0x2104d6(0x375),async _0x358d5b=>{const _0x4d4677=_0x2104d6;_0x358d5b&&(_0xc81ca5[_0x4d4677(0x3f1)]=[],await saveData(),renderChat(),toast(_0x4d4677(0x30a)));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0x5d732e,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x45883e=_0x4900e5,_0x1b099e=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0x5d732e,'enablejsapi':'1','origin':_0x45883e(0x2d2)})[_0x45883e(0x436)]();return'https://www.youtube.com/embed/'+_0x5d732e+'?'+_0x1b099e;}function ensureFallbackFrame(){const _0xa6bacd=_0x4900e5,_0x8a615e=document[_0xa6bacd(0x3ea)](_0xa6bacd(0x47b));if(!_0x8a615e)return null;if(ytFallbackFrame&&ytFallbackFrame[_0xa6bacd(0x219)])return ytFallbackFrame;const _0x2dac7e=document[_0xa6bacd(0x3a7)]('iframe');return _0x2dac7e['id']=_0xa6bacd(0x3b4),_0x2dac7e[_0xa6bacd(0x41e)]='1',_0x2dac7e['height']='1',_0x2dac7e[_0xa6bacd(0x365)][_0xa6bacd(0x18e)]='absolute',_0x2dac7e['style'][_0xa6bacd(0x46c)]=_0xa6bacd(0x23f),_0x2dac7e[_0xa6bacd(0x365)][_0xa6bacd(0x2a7)]=_0xa6bacd(0x23f),_0x2dac7e[_0xa6bacd(0x3fd)]=_0xa6bacd(0x23d),_0x8a615e[_0xa6bacd(0x180)]='',_0x8a615e[_0xa6bacd(0x20d)](_0x2dac7e),ytFallbackFrame=_0x2dac7e,_0x2dac7e;}function _0x1eb0(_0x36cb1d,_0x295e34){const _0x344afe=_0x344a();return _0x1eb0=function(_0x1eb088,_0x56e99){_0x1eb088=_0x1eb088-0x160;let _0x125e03=_0x344afe[_0x1eb088];return _0x125e03;},_0x1eb0(_0x36cb1d,_0x295e34);}function fallbackLoadVideo(_0x1ce144,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x248a2c=_0x4900e5,_0x4747a1=document[_0x248a2c(0x3ea)](_0x248a2c(0x47b));if(!_0x4747a1)return;_0x4747a1['innerHTML']='';const _0x434abc=document[_0x248a2c(0x3a7)](_0x248a2c(0x40a));_0x434abc['id']=_0x248a2c(0x3b4),_0x434abc[_0x248a2c(0x41e)]='1',_0x434abc[_0x248a2c(0x3a9)]='1',_0x434abc['style'][_0x248a2c(0x18e)]=_0x248a2c(0x3e5),_0x434abc[_0x248a2c(0x365)][_0x248a2c(0x46c)]='-9999px',_0x434abc[_0x248a2c(0x365)][_0x248a2c(0x2a7)]=_0x248a2c(0x23f),_0x434abc[_0x248a2c(0x3fd)]=_0x248a2c(0x23d),_0x434abc[_0x248a2c(0x398)]=buildFallbackSrc(_0x1ce144,{'autoplay':autoplay,'mute':mute}),_0x4747a1['appendChild'](_0x434abc),ytFallbackFrame=_0x434abc,ytFallbackIsPlaying=!!autoplay;try{const _0x10447d=document[_0x248a2c(0x3ea)](_0x248a2c(0x270));if(_0x10447d)_0x10447d[_0x248a2c(0x408)]=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x102bb7){}}function fallbackPostMessage(_0x58a824,_0x259ed2=[]){const _0x5eceeb=_0x4900e5;try{if(!ytFallbackFrame||!ytFallbackFrame['contentWindow'])return;ytFallbackFrame[_0x5eceeb(0x3d3)]['postMessage'](JSON[_0x5eceeb(0x281)]({'event':'command','func':_0x58a824,'args':_0x259ed2}),_0x5eceeb(0x2d2));}catch(_0x134af2){}}function fallbackPlay(){fallbackPostMessage('playVideo');}function fallbackStop(){const _0x25ceda=_0x4900e5;try{ytFallbackFrame&&(ytFallbackFrame[_0x25ceda(0x398)]=_0x25ceda(0x336),ytFallbackIsPlaying=![]);}catch(_0x46258c){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){const _0x59425d=_0x4900e5;fallbackPostMessage(_0x59425d(0x3a5));}function fallbackMute(){const _0x4e59d0=_0x4900e5;fallbackPostMessage(_0x4e59d0(0x3f7));}window[_0x4900e5(0x1c8)]=function(){const _0x1abb93=_0x4900e5;if(IS_FILE_PROTOCOL){try{window['__ytApiWatchdog']&&window[_0x1abb93(0x1a0)][_0x1abb93(0x177)]();}catch(_0x4f4df8){}return;}const _0x56a0e7={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0x1abb93(0x2d2)};(window['location'][_0x1abb93(0x326)]===_0x1abb93(0x294)||window['location'][_0x1abb93(0x326)]==='https:')&&(_0x56a0e7[_0x1abb93(0x18d)]=window['location'][_0x1abb93(0x18d)]);ytPlayer=new YT[(_0x1abb93(0x2d9))](_0x1abb93(0x47b),_0x56a0e7);try{window[_0x1abb93(0x1a0)]&&window[_0x1abb93(0x1a0)][_0x1abb93(0x177)]();const _0x34d336=document['getElementById']('ytUrlFeedback');_0x34d336&&(_0x34d336[_0x1abb93(0x408)]='');}catch(_0x297676){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x4900e5(0x176)](_0x4900e5(0x334))==='1';}catch(_0x53ebdd){}function showSoundPermission(){const _0x156e18=_0x4900e5,_0x3c010a=document[_0x156e18(0x3ea)](_0x156e18(0x1a9));if(!_0x3c010a)return;if(_ytUnlocked){_0x3c010a[_0x156e18(0x3ee)][_0x156e18(0x160)](_0x156e18(0x2d7));return;}_0x3c010a['classList'][_0x156e18(0x3ab)]('show');}function hideSoundPermission(){const _0x1f569d=_0x4900e5,_0x1110d9=document[_0x1f569d(0x3ea)](_0x1f569d(0x1a9));if(!_0x1110d9)return;_0x1110d9[_0x1f569d(0x3ee)]['remove'](_0x1f569d(0x2d7));}function unlockAudioChain(){const _0x225876=_0x4900e5;try{if(AUDIO_CTX&&typeof AUDIO_CTX['resume']===_0x225876(0x3ba))AUDIO_CTX[_0x225876(0x30e)]();}catch(_0x3ebf64){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer[_0x225876(0x3a5)]&&(ytPlayer['unMute'](),ytPlayer[_0x225876(0x249)]());}catch(_0x35a9d2){}_ytUnlocked=!![];try{localStorage['setItem'](_0x225876(0x334),'1');}catch(_0x37c7d1){}hideSoundPermission(),toast(_0x225876(0x43c));}function onPlayerReady(_0x1af8c4){const _0x4ce1be=_0x4900e5;try{const _0x54af9e=ytPlayer&&ytPlayer[_0x4ce1be(0x2f6)]?ytPlayer[_0x4ce1be(0x2f6)]():null;_0x54af9e&&_0x54af9e['setAttribute'](_0x4ce1be(0x3fd),_0x4ce1be(0x23d));}catch(_0x1b1dde){}try{if(ytPlayer&&ytPlayer[_0x4ce1be(0x3b9)])ytPlayer[_0x4ce1be(0x3b9)](data&&data[_0x4ce1be(0x27a)]&&data[_0x4ce1be(0x27a)][_0x4ce1be(0x42f)]||0x50);}catch(_0x5a8a62){}try{const _0x4513bb=getActiveVideoId&&getActiveVideoId();if(_0x4513bb&&ytPlayer&&ytPlayer[_0x4ce1be(0x3f7)]&&ytPlayer[_0x4ce1be(0x249)]){ytPlayer[_0x4ce1be(0x3f7)](),ytPlayer['playVideo'](),_ytPrimed=!![];const _0x1da647=()=>{const _0x441f9e=_0x4ce1be;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x23c9d6){}window[_0x441f9e(0x1c7)]('pointerdown',_0x1da647,!![]),window[_0x441f9e(0x1c7)](_0x441f9e(0x1d9),_0x1da647,!![]);};window[_0x4ce1be(0x1da)](_0x4ce1be(0x424),_0x1da647,!![]),window['addEventListener']('keydown',_0x1da647,!![]),showSoundPermission();}}catch(_0x482038){}updateYouTubePlayer();}function onPlayerStateChange(_0x4a8351){const _0x585f68=_0x4900e5,_0x24dbe5=$(_0x585f68(0x3d6));_0x4a8351[_0x585f68(0x3b1)]==YT['PlayerState'][_0x585f68(0x32f)]?(_0x24dbe5[_0x585f68(0x408)]='⏸️',hideSoundPermission()):_0x24dbe5[_0x585f68(0x408)]='▶️';if(_0x4a8351[_0x585f68(0x3b1)]===YT['PlayerState'][_0x585f68(0x312)]){if(!ytUserPaused)ytPlayer[_0x585f68(0x249)]();}}async function ytFadeTo(_0x41e642,_0x148a4e=0xfa){const _0x4872e7=_0x4900e5;try{if(!ytPlayer||!ytPlayer[_0x4872e7(0x33e)]||!ytPlayer[_0x4872e7(0x3b9)])return;ytPlayer[_0x4872e7(0x3a5)]();const _0x590552=ytPlayer[_0x4872e7(0x33e)](),_0x2ddaf2=_0x41e642-_0x590552;if(Math[_0x4872e7(0x34f)](_0x2ddaf2)<0x1||_0x148a4e<=0x0){ytPlayer[_0x4872e7(0x3b9)](_0x41e642);return;}const _0x25f000=performance['now']();await new Promise(_0x4e62e1=>{const _0x2a5c58=_0x27f843=>{const _0x16e0ec=_0x1eb0,_0x30bdb3=Math[_0x16e0ec(0x21a)](0x1,(_0x27f843-_0x25f000)/_0x148a4e),_0x284f3a=Math['round'](_0x590552+_0x2ddaf2*_0x30bdb3);ytPlayer[_0x16e0ec(0x3b9)](_0x284f3a);if(_0x30bdb3<0x1)requestAnimationFrame(_0x2a5c58);else _0x4e62e1();};requestAnimationFrame(_0x2a5c58);});}catch(_0x2687a9){}}async function ytFadeInPlay(_0x3fc249=0xdc){const _0x2dca52=_0x4900e5;try{const _0xd86d84=Math[_0x2dca52(0x256)](0x0,Math[_0x2dca52(0x21a)](0x64,data&&data[_0x2dca52(0x27a)]&&data['settings'][_0x2dca52(0x42f)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer[_0x2dca52(0x3a5)](),ytPlayer[_0x2dca52(0x249)]();try{ytPlayer['setVolume'](0x0);}catch(_0x500b5d){}await ytFadeTo(_0xd86d84,_0x3fc249);}else{const _0x4af3bd=getActiveVideoId();_0x4af3bd&&fallbackLoadVideo(_0x4af3bd,{'autoplay':0x1,'mute':0x0});}}catch(_0x53e56e){}}async function ytFadeOutPause(_0x35b6df=0xb4){const _0x1e2e3a=_0x4900e5;try{const _0x528fb0=Math[_0x1e2e3a(0x256)](0x0,Math['min'](0x64,data&&data[_0x1e2e3a(0x27a)]&&data['settings'][_0x1e2e3a(0x42f)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0x35b6df);try{ytPlayer[_0x1e2e3a(0x2df)](),ytPlayer[_0x1e2e3a(0x3b9)](_0x528fb0);}catch(_0x5838d7){}}else try{fallbackPause();}catch(_0xba7262){}}catch(_0x101e57){}}async function updateYouTubePlayer(){const _0x17ff15=_0x4900e5,_0x38ba06=getActiveVideoId();if(data['settings']['useYtThumbnailAsBg']&&_0x38ba06){const _0x38e0f7=_0x17ff15(0x1d2)+_0x38ba06+_0x17ff15(0x271),_0x508454=new Image();_0x508454['onload']=async()=>{const _0x5c3e61=_0x17ff15;data[_0x5c3e61(0x27a)]['customBg']=_0x38e0f7,await saveData(),applyCustomBg();},_0x508454[_0x17ff15(0x2e0)]=async()=>{const _0x496f79=_0x17ff15,_0x105d1d=_0x496f79(0x1d2)+_0x38ba06+_0x496f79(0x22b);data[_0x496f79(0x27a)]['customBg']=_0x105d1d,await saveData(),applyCustomBg();},_0x508454[_0x17ff15(0x398)]=_0x38e0f7;}else!_0x38ba06&&(data[_0x17ff15(0x27a)][_0x17ff15(0x1a3)]='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0x38ba06){fallbackStop(),hideSoundPermission();return;}const _0x30b9bd=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x38ba06,{'autoplay':0x1,'mute':_0x30b9bd});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer[_0x17ff15(0x2a2)]){try{ensureYouTubeAPI();}catch(_0x1d215f){}return;}if(!_0x38ba06){if(ytPlayer[_0x17ff15(0x439)])ytPlayer[_0x17ff15(0x439)]();hideSoundPermission();return;}ytPlayer[_0x17ff15(0x2a2)](_0x38ba06),ytPlayer[_0x17ff15(0x3b9)](data['settings'][_0x17ff15(0x42f)]);}function toggleYtSound(){const _0x1f3af3=_0x4900e5;if(!_ytUnlocked){try{ensureAudio();}catch(_0x2cbdc9){}try{unlockAudioChain();}catch(_0xd46f9b){}return;}if(IS_FILE_PROTOCOL){const _0x490265=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame[_0x1f3af3(0x219)]){if(!_0x490265){toast(_0x1f3af3(0x3df));return;}fallbackLoadVideo(_0x490265,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x513338=document[_0x1f3af3(0x3ea)]('btnToggleYtSound');if(_0x513338)_0x513338['textContent']='⏸️';}catch(_0xa6593f){}toast('Đang\x20phát\x20nhạc\x20nền...');return;}if(ytFallbackIsPlaying)fallbackPostMessage(_0x1f3af3(0x2df)),ytFallbackIsPlaying=![],toast('Đã\x20dừng\x20nhạc\x20nền.');else{if(!_0x490265){toast(_0x1f3af3(0x3df));return;}fallbackPostMessage(_0x1f3af3(0x249)),ytFallbackIsPlaying=!![],toast(_0x1f3af3(0x18f));}try{const _0x1c4c52=document[_0x1f3af3(0x3ea)](_0x1f3af3(0x270));if(_0x1c4c52)_0x1c4c52['textContent']=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x50b1c7){}return;}if(!ytPlayer||typeof ytPlayer[_0x1f3af3(0x1dd)]!==_0x1f3af3(0x3ba)){try{ensureYouTubeAPI();}catch(_0x185542){}return;}const _0x1d08db=ytPlayer[_0x1f3af3(0x1dd)]();_0x1d08db===YT[_0x1f3af3(0x485)][_0x1f3af3(0x32f)]||_0x1d08db===YT[_0x1f3af3(0x485)][_0x1f3af3(0x348)]?(ytFadeOutPause(),ytUserPaused=!![],toast(_0x1f3af3(0x2f0))):(ytFadeInPlay(),ytUserPaused=![],toast('Đang\x20phát\x20nhạc\x20nền...'));}function bindEvents(){const _0x157e89=_0x4900e5;try{const _0x354cf2=document[_0x157e89(0x413)](_0x157e89(0x3ae));_0x354cf2&&(_0x354cf2[_0x157e89(0x180)]='Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.');}catch(_0x2b0299){}on($(_0x157e89(0x182)),_0x157e89(0x29d),toggleBackgroundView),on($(_0x157e89(0x435)),_0x157e89(0x29d),()=>{const _0x5f5981=_0x157e89;$('#modalMilestone')[_0x5f5981(0x3ee)][_0x5f5981(0x160)](_0x5f5981(0x2d7));try{releaseFocus();}catch(_0x182160){}}),on($(_0x157e89(0x203)),_0x157e89(0x29d),()=>showInputModal(_0x157e89(0x313),async _0x787862=>{const _0x195e7b=_0x157e89;if(!_0x787862)return;data[_0x195e7b(0x2c8)][_0x195e7b(0x350)]({'id':uid('t'),'name':_0x787862,'subtopics':[]}),await saveData(),renderTopics();})),on($(_0x157e89(0x261)),'click',()=>storageManager[_0x157e89(0x2ce)](data)),on($(_0x157e89(0x1fb)),_0x157e89(0x3d7),_0x1eaa99=>{const _0x3c490e=_0x157e89,_0xc91c76=_0x1eaa99[_0x3c490e(0x1b1)]['files'][0x0];if(!_0xc91c76)return;storageManager[_0x3c490e(0x321)](_0xc91c76)['then'](async _0x5a8151=>{data=_0x5a8151,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast('Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!'),renderAll();})[_0x3c490e(0x383)](_0x46fad8=>toast('Nhập\x20thất\x20bại:\x20'+_0x46fad8[_0x3c490e(0x300)])),_0x1eaa99[_0x3c490e(0x1b1)][_0x3c490e(0x1f4)]=null;}),on($('#btnRestoreBackup'),'click',()=>{const _0x40d6ad=_0x157e89,_0x531d00=$(_0x40d6ad(0x210)),_0x4afe97=_0x531d00?_0x531d00['value']:'';if(!_0x4afe97){toast(_0x40d6ad(0x442));return;}showConfirmModal(_0x40d6ad(0x25d),_0x40d6ad(0x43b)+new Date(_0x4afe97)['toLocaleDateString']()+'?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.',_0x1d7517=>{const _0x52b391=_0x40d6ad;_0x1d7517&&storageManager['restoreBackup'](_0x4afe97)[_0x52b391(0x2a1)](_0x23a4f9=>{const _0x183bff=_0x52b391;data=_0x23a4f9,toast(_0x183bff(0x1f9)),setTimeout(()=>window[_0x183bff(0x410)]['reload'](),0x5dc);})['catch'](_0x59e7e6=>{const _0x5dd987=_0x52b391;toast(_0x5dd987(0x2be)+_0x59e7e6[_0x5dd987(0x300)]);});});}),on($(_0x157e89(0x3a4)),_0x157e89(0x42a),_0x359ae8=>{const _0x340006=_0x157e89,_0x5e68ef=_0x359ae8[_0x340006(0x1b1)]['value'];applyTheme(_0x5e68ef);if(_0x5e68ef===_0x340006(0x2d3)||_0x5e68ef===_0x340006(0x3b6)){const _0x11d693=$('#set_ytThumbAsBg');_0x11d693&&(_0x11d693['checked']=![],toast(_0x340006(0x16f),0x7d0));try{document['body']['style'][_0x340006(0x405)](_0x340006(0x2b8),_0x340006(0x18a));}catch(_0x487a3e){}}else{const _0x1d1d34=$('#set_ytThumbAsBg');_0x1d1d34&&(_0x1d1d34[_0x340006(0x46b)]=!![]);try{updateYouTubePlayer();}catch(_0x2dfd08){}}}),on($(_0x157e89(0x39e)),_0x157e89(0x29d),openSettings),on($(_0x157e89(0x3cf)),_0x157e89(0x29d),()=>{const _0x3b10f0=_0x157e89;switchView('topics'),$(_0x3b10f0(0x203))[_0x3b10f0(0x29d)]();}),on($(_0x157e89(0x3af)),_0x157e89(0x29d),()=>{const _0x585f1a=_0x157e89;renderDashboard(),$(_0x585f1a(0x45d))[_0x585f1a(0x3ee)][_0x585f1a(0x3ab)]('show');}),on($(_0x157e89(0x32e)),'click',()=>{const _0x5830af=_0x157e89;$(_0x5830af(0x45d))['classList']['remove']('show');}),on($(_0x157e89(0x3f3)),_0x157e89(0x29d),closeSettings),on($('#btnSaveSettings'),_0x157e89(0x29d),saveSettings),on($(_0x157e89(0x17b)),'click',setDefaults),on($('#btnTestSound'),_0x157e89(0x29d),()=>{const _0xebd2f8=_0x157e89;ensureAudio(),playSound(_0xebd2f8(0x3aa));}),on($(_0x157e89(0x2a4)),_0x157e89(0x29d),_0x187190=>{const _0x6994bf=_0x157e89;_0x187190['preventDefault']();const _0x5f5d74=$('#customSoundsContainer');if(_0x5f5d74)_0x5f5d74[_0x6994bf(0x3ee)]['toggle']('hidden');}),on($(_0x157e89(0x430)),'click',async()=>{const _0x54d0db=_0x157e89,_0x1792c2=getCurrentSubtopic();if(!_0x1792c2)return;const _0x41a190=pendingNoteSessionId,_0xd35400=_0x1792c2[_0x54d0db(0x43a)][_0x54d0db(0x2af)](_0x34d39d=>_0x34d39d['id']===_0x41a190);_0xd35400&&(_0xd35400[_0x54d0db(0x452)]=$(_0x54d0db(0x35f))['value'][_0x54d0db(0x214)](),await saveData(),renderStatsHistory(),toast(_0x54d0db(0x3e9))),closeNoteModal();}),on($('#btnSkipNote'),_0x157e89(0x29d),()=>closeNoteModal()),on($(_0x157e89(0x3c6)),_0x157e89(0x29d),addGeneralNote),on($(_0x157e89(0x3cc)),_0x157e89(0x29d),handleSummarizeNote),on($('#btnSendMessage'),_0x157e89(0x29d),handleSendMessage),on($(_0x157e89(0x241)),_0x157e89(0x1d9),_0x45614a=>{const _0x5d7cae=_0x157e89;if(_0x45614a[_0x5d7cae(0x333)]===_0x5d7cae(0x369))handleSendMessage();}),$$(_0x157e89(0x1a4))[_0x157e89(0x29b)](_0xefdb81=>{const _0x2453c9=_0x157e89;on(_0xefdb81,_0x2453c9(0x29d),()=>{const _0x210fa3=_0x2453c9,_0x454129=_0xefdb81['dataset'][_0x210fa3(0x3d4)];$('#chatInput')[_0x210fa3(0x1f4)]=_0x454129,$(_0x210fa3(0x241))[_0x210fa3(0x45a)]();});}),on($(_0x157e89(0x470)),_0x157e89(0x29d),clearChat),on($(_0x157e89(0x27e)),_0x157e89(0x29d),addSubtopicTask),on($(_0x157e89(0x38a)),_0x157e89(0x1d9),_0x3f0186=>{const _0x1554b6=_0x157e89;if(_0x3f0186[_0x1554b6(0x333)]===_0x1554b6(0x369))addSubtopicTask();}),on($('#btnToggleYtSound'),_0x157e89(0x29d),toggleYtSound),on($(_0x157e89(0x307)),_0x157e89(0x29d),()=>{ensureAudio(),unlockAudioChain();}),on($(_0x157e89(0x472)),'input',_0x3759cf=>{const _0x120960=_0x157e89,_0x1d9cda=parseInt(_0x3759cf[_0x120960(0x1b1)][_0x120960(0x1f4)],0xa);ytPlayer&&ytPlayer[_0x120960(0x3b9)]&&ytPlayer[_0x120960(0x3b9)](_0x1d9cda);}),on($(_0x157e89(0x412)),_0x157e89(0x42a),handleYoutubeUrlInput),$$(_0x157e89(0x204))[_0x157e89(0x29b)](_0x4536e6=>{const _0x29851f=_0x157e89;_0x4536e6[_0x29851f(0x1da)](_0x29851f(0x29d),()=>{const _0x3a9691=_0x4536e6['dataset']['view'],_0x1534fe=data?.['settings']?.['currentView']||'timer';if(_0x1534fe===_0x3a9691&&_0x3a9691!=='timer')switchView('timer');else switchView(_0x3a9691);});}),$$(_0x157e89(0x1f8))[_0x157e89(0x29b)](_0x1ccf45=>{const _0x54c3bd=_0x157e89;_0x1ccf45[_0x54c3bd(0x1da)](_0x54c3bd(0x29d),()=>{const _0x3f385c=_0x54c3bd,_0x17a757=_0x1ccf45['dataset'][_0x3f385c(0x3db)],_0x25cf85=_0x1ccf45[_0x3f385c(0x282)](_0x3f385c(0x1c6));if(!_0x25cf85)return;_0x25cf85['querySelectorAll'](_0x3f385c(0x1f8))[_0x3f385c(0x29b)](_0x2436a1=>_0x2436a1[_0x3f385c(0x3ee)]['remove'](_0x3f385c(0x3d9))),_0x1ccf45[_0x3f385c(0x3ee)][_0x3f385c(0x3ab)]('active'),_0x25cf85[_0x3f385c(0x16d)](_0x3f385c(0x478))[_0x3f385c(0x29b)](_0x166101=>{const _0x2b0936=_0x3f385c;_0x166101[_0x2b0936(0x3ee)][_0x2b0936(0x160)]('active'),_0x166101[_0x2b0936(0x365)][_0x2b0936(0x3ef)]=_0x2b0936(0x18a);});const _0x153696=_0x25cf85[_0x3f385c(0x413)]('#'+_0x17a757);_0x153696&&(_0x153696['classList']['add'](_0x3f385c(0x3d9)),_0x153696[_0x3f385c(0x365)]['display']=_0x3f385c(0x3e6),_0x25cf85[_0x3f385c(0x282)](_0x3f385c(0x384))&&(_0x153696[_0x3f385c(0x365)][_0x3f385c(0x3ef)]=_0x3f385c(0x301)));});});const _0x2c2d69=$(_0x157e89(0x381));function _0x59c121(_0x17e796,_0x20bcb1=null){const _0x459089=_0x157e89;try{document[_0x459089(0x39d)](_0x459089(0x268),![],!![]);}catch(_0x2c5392){}try{document[_0x459089(0x39d)](_0x17e796,![],_0x20bcb1);}catch(_0x11d5ff){}if(_0x2c2d69)_0x2c2d69[_0x459089(0x45a)]();}on($('#toolBold'),'click',()=>_0x59c121(_0x157e89(0x35c))),on($('#toolItalic'),'click',()=>_0x59c121(_0x157e89(0x244))),on($(_0x157e89(0x25e)),_0x157e89(0x29d),()=>_0x59c121('formatBlock',_0x157e89(0x286))),on($(_0x157e89(0x187)),_0x157e89(0x29d),()=>_0x59c121(_0x157e89(0x258))),on($(_0x157e89(0x26a)),_0x157e89(0x29d),()=>_0x59c121(_0x157e89(0x3f9)));const _0x12c9b7=$('.color-picker-wrapper'),_0x420ce8=$(_0x157e89(0x429));on($(_0x157e89(0x1fd)),_0x157e89(0x29d),_0x468041=>{const _0x297a36=_0x157e89;if(!_0x420ce8)return;_0x468041['stopPropagation'](),_0x420ce8['classList'][_0x297a36(0x1c1)](_0x297a36(0x178));}),$$(_0x157e89(0x1e4))[_0x157e89(0x29b)](_0x3d66e7=>{const _0x322c09=_0x157e89;on(_0x3d66e7,_0x322c09(0x29d),_0x48dd42=>{const _0x3fb2d3=_0x322c09;_0x48dd42[_0x3fb2d3(0x305)]();const _0x122d74=_0x3d66e7[_0x3fb2d3(0x1ae)][_0x3fb2d3(0x427)]||'';let _0x4c341d=_0x122d74;try{const _0xf1a0e9=_0x122d74['match'](/--[a-zA-Z0-9_-]+/);if(_0xf1a0e9)_0x4c341d=getComputedStyle(document[_0x3fb2d3(0x17f)])[_0x3fb2d3(0x385)](_0xf1a0e9[0x0])[_0x3fb2d3(0x214)]();}catch(_0xf83fe6){}_0x59c121('foreColor',_0x4c341d);if(_0x420ce8)_0x420ce8[_0x3fb2d3(0x3ee)]['add'](_0x3fb2d3(0x178));});}),on(document,_0x157e89(0x29d),_0x187c4a=>{const _0x476edc=_0x157e89;if(!_0x12c9b7||!_0x420ce8)return;!_0x12c9b7[_0x476edc(0x25f)](_0x187c4a[_0x476edc(0x1b1)])&&!_0x420ce8[_0x476edc(0x3ee)][_0x476edc(0x25f)](_0x476edc(0x178))&&_0x420ce8['classList']['add'](_0x476edc(0x178));});function _0x336645(_0x468f8e){const _0x2ef7a9=_0x157e89,_0x3f9ee1=data?.[_0x2ef7a9(0x27a)]?.[_0x2ef7a9(0x2f3)]||[],_0xdae47=_0x468f8e?_0x3f9ee1[_0x2ef7a9(0x2af)](_0xd0b704=>_0xd0b704['id']===_0x468f8e):null;$(_0x2ef7a9(0x361))['value']=_0xdae47&&_0xdae47['id']||'',$(_0x2ef7a9(0x3b3))[_0x2ef7a9(0x408)]=_0xdae47?_0x2ef7a9(0x32b):_0x2ef7a9(0x1d5),$('#methodEditorTitleInput')[_0x2ef7a9(0x1f4)]=_0xdae47&&_0xdae47[_0x2ef7a9(0x36a)]||'';const _0x4466d0=$(_0x2ef7a9(0x381));if(_0x4466d0)_0x4466d0[_0x2ef7a9(0x180)]=_0xdae47&&_0xdae47[_0x2ef7a9(0x2f4)]||'';$(_0x2ef7a9(0x291))[_0x2ef7a9(0x3ee)]['add']('show');try{trapFocus($(_0x2ef7a9(0x291)));}catch(_0x1bd545){}try{const _0x108082=$(_0x2ef7a9(0x1fc));if(_0x108082){const _0x3fd861=!!(data?.['settings']?.[_0x2ef7a9(0x419)]&&data[_0x2ef7a9(0x27a)][_0x2ef7a9(0x419)]['trim']());_0x108082[_0x2ef7a9(0x17c)]=!_0x3fd861,_0x108082['title']=_0x3fd861?_0x2ef7a9(0x1af):_0x2ef7a9(0x3dc);}}catch(_0x7b7535){}}on($(_0x157e89(0x1b2)),_0x157e89(0x29d),()=>{const _0x2a469c=_0x157e89;$(_0x2a469c(0x291))[_0x2a469c(0x3ee)][_0x2a469c(0x160)](_0x2a469c(0x2d7));try{releaseFocus();}catch(_0x3d4ea0){}}),on($(_0x157e89(0x165)),_0x157e89(0x29d),async()=>{const _0x5e57ec=_0x157e89,_0x188d25=$(_0x5e57ec(0x361))['value']||uid('m'),_0x300dbd=($(_0x5e57ec(0x2a0))[_0x5e57ec(0x1f4)]||'')[_0x5e57ec(0x214)](),_0x4fc1b0=$(_0x5e57ec(0x381)),_0x48b99c=_0x4fc1b0?_0x4fc1b0['innerHTML']||'':'';if(!Array[_0x5e57ec(0x3cd)](data[_0x5e57ec(0x27a)]['methods']))data[_0x5e57ec(0x27a)][_0x5e57ec(0x2f3)]=[];const _0x5a4cf2=data[_0x5e57ec(0x27a)][_0x5e57ec(0x2f3)][_0x5e57ec(0x2fe)](_0x4c074a=>_0x4c074a['id']===_0x188d25),_0xe9d13b={'id':_0x188d25,'title':_0x300dbd,'content':_0x48b99c};if(_0x5a4cf2>=0x0)data[_0x5e57ec(0x27a)]['methods'][_0x5a4cf2]=_0xe9d13b;else data['settings']['methods'][_0x5e57ec(0x2bb)](_0xe9d13b);await storageManager[_0x5e57ec(0x367)](data['settings']),renderMethods(),$('#modalMethodEditor')[_0x5e57ec(0x3ee)]['remove']('show');try{releaseFocus();}catch(_0x2b2b39){}}),on($(_0x157e89(0x1fc)),'click',async()=>{const _0x1f7e94=_0x157e89,_0x3e1b47=$('#methodEditorContentInput');if(!_0x3e1b47)return;const _0x244139=(_0x3e1b47['textContent']||'')[_0x1f7e94(0x214)]();if(!_0x244139||_0x244139[_0x1f7e94(0x34b)]<0x14){toast('Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.');return;}const _0x2a1421=$(_0x1f7e94(0x1fc));_0x2a1421&&(_0x2a1421[_0x1f7e94(0x17c)]=!![],_0x2a1421[_0x1f7e94(0x180)]=_0x1f7e94(0x3c5));const _0x1b6e5b=_0x1f7e94(0x2c6)+_0x244139+'\x22',_0x2020df=await callGeminiAPI(_0x1b6e5b);_0x2020df?(_0x3e1b47[_0x1f7e94(0x180)]=_0x2020df,toast('AI\x20đã\x20định\x20dạng\x20xong!')):toast(_0x1f7e94(0x242)),_0x2a1421&&(_0x2a1421[_0x1f7e94(0x17c)]=![],_0x2a1421[_0x1f7e94(0x180)]='✨\x20Tự\x20động\x20định\x20dạng');}),on($(_0x157e89(0x2dc)),'click',()=>_0x336645());const _0x46d355=document['querySelector'](_0x157e89(0x208));_0x46d355&&_0x46d355[_0x157e89(0x1da)](_0x157e89(0x29d),_0x554a6a=>{const _0xb8a82d=_0x157e89,_0x464233=_0x554a6a['target'][_0xb8a82d(0x282)]&&_0x554a6a['target'][_0xb8a82d(0x282)](_0xb8a82d(0x2a5)),_0x4a8038=!_0x464233&&_0x554a6a['target'][_0xb8a82d(0x282)]&&_0x554a6a[_0xb8a82d(0x1b1)]['closest'](_0xb8a82d(0x386));if(_0x464233){_0x554a6a[_0xb8a82d(0x305)](),_0x554a6a[_0xb8a82d(0x443)]();const _0x4656a6=_0x464233[_0xb8a82d(0x1ae)]['id'];if(_0x4656a6)_0x336645(_0x4656a6);return;}if(_0x4a8038){_0x554a6a[_0xb8a82d(0x305)](),_0x554a6a[_0xb8a82d(0x443)]();const _0x30cacf=_0x4a8038[_0xb8a82d(0x1ae)]['id'];if(!_0x30cacf)return;const _0x2d1f62=data?.[_0xb8a82d(0x27a)]?.[_0xb8a82d(0x2f3)]||[],_0x2cdcc1=_0x2d1f62[_0xb8a82d(0x2af)](_0x517fd6=>_0x517fd6['id']===_0x30cacf);if(!_0x2cdcc1)return;showConfirmModal(_0xb8a82d(0x2ab),_0xb8a82d(0x3a6)+(_0x2cdcc1['title']||'')+'\x22?',async _0x3e92c5=>{const _0x3f4da7=_0xb8a82d;if(!_0x3e92c5)return;data[_0x3f4da7(0x27a)][_0x3f4da7(0x2f3)]=_0x2d1f62[_0x3f4da7(0x164)](_0x107a98=>_0x107a98['id']!==_0x30cacf),await storageManager[_0x3f4da7(0x367)](data['settings']),renderMethods();});}});$$(_0x157e89(0x234))[_0x157e89(0x29b)](_0x48f678=>{const _0x1cd844=_0x157e89;_0x48f678[_0x1cd844(0x1da)]('click',()=>{const _0x58a861=_0x1cd844;editingPreset=_0x48f678[_0x58a861(0x1ae)][_0x58a861(0x33d)],highlightPresetSelector(),loadEditingPresetFields();});}),$$('.presets\x20button')[_0x157e89(0x29b)](_0xb53775=>{const _0x4d9760=_0x157e89;_0xb53775[_0x4d9760(0x1da)](_0x4d9760(0x29d),_0x111c44=>{const _0x583ed2=_0x4d9760,_0x123c57=_0x111c44[_0x583ed2(0x1b1)][_0x583ed2(0x1ae)][_0x583ed2(0x418)],_0x59a76c=data[_0x583ed2(0x27a)][_0x583ed2(0x418)];if(_0x123c57===_0x59a76c)return;timer[_0x583ed2(0x453)]!==_0x583ed2(0x41f)?showConfirmModal(_0x583ed2(0x28e),'Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20'+_0x123c57+_0x583ed2(0x23a),_0xa2ce04=>{const _0x1337a1=_0x583ed2;_0xa2ce04&&(timer[_0x1337a1(0x2da)](),timer[_0x1337a1(0x24e)](_0x123c57),renderAll(),toast(_0x1337a1(0x465)+_0x123c57+'.'));}):(timer[_0x583ed2(0x24e)](_0x123c57),renderAll(),toast(_0x583ed2(0x465)+_0x123c57+'.'));});}),on($(_0x157e89(0x2a3)),_0x157e89(0x29d),()=>timer[_0x157e89(0x1db)]()),on($(_0x157e89(0x358)),'click',()=>timer['finishFlowSession']()),on($(_0x157e89(0x36d)),_0x157e89(0x29d),()=>timer[_0x157e89(0x2b9)]()),on($(_0x157e89(0x26c)),_0x157e89(0x29d),()=>timer[_0x157e89(0x30e)]()),on($(_0x157e89(0x3a8)),'click',()=>timer[_0x157e89(0x290)]()),on($(_0x157e89(0x1a6)),_0x157e89(0x29d),()=>timer[_0x157e89(0x2da)]()),on($(_0x157e89(0x324)),_0x157e89(0x29d),()=>timer[_0x157e89(0x44c)]()),on($(_0x157e89(0x198)),_0x157e89(0x3d7),_0xb2bea6=>{const _0x5a3b13=_0x157e89;handleFileUpload(_0xb2bea6[_0x5a3b13(0x1b1)]['files'][0x0],async _0x354847=>{const _0x11f514=_0x5a3b13;data[_0x11f514(0x27a)][_0x11f514(0x1a3)]=_0x354847,await saveData(),applyCustomBg(),toast(_0x11f514(0x38f));}),_0xb2bea6['target'][_0x5a3b13(0x1f4)]=null;}),on($(_0x157e89(0x2eb)),'click',async()=>{const _0xd502e8=_0x157e89;data['settings'][_0xd502e8(0x1a3)]='',data[_0xd502e8(0x27a)][_0xd502e8(0x191)]=![],await saveData(),applyCustomBg(),toast('Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.'),$('#modalSettings')[_0xd502e8(0x3ee)][_0xd502e8(0x25f)](_0xd502e8(0x2d7))&&openSettings();}),on($(_0x157e89(0x35e)),_0x157e89(0x3d7),_0x4cbc23=>{const _0x49148a=_0x157e89;handleFileUpload(_0x4cbc23[_0x49148a(0x1b1)][_0x49148a(0x31d)][0x0],async _0x2ec397=>{const _0x3ab1d4=_0x49148a;data['settings'][_0x3ab1d4(0x232)][_0x3ab1d4(0x3aa)]=_0x2ec397,await saveData(),toast(_0x3ab1d4(0x299));}),_0x4cbc23[_0x49148a(0x1b1)]['value']=null;}),on($(_0x157e89(0x370)),_0x157e89(0x3d7),_0x3c5972=>{const _0x1c7528=_0x157e89;handleFileUpload(_0x3c5972[_0x1c7528(0x1b1)][_0x1c7528(0x31d)][0x0],async _0x3972aa=>{const _0x59ebb2=_0x1c7528;data[_0x59ebb2(0x27a)][_0x59ebb2(0x232)]['break_end']=_0x3972aa,await saveData(),toast('Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.');}),_0x3c5972[_0x1c7528(0x1b1)][_0x1c7528(0x1f4)]=null;}),on($(_0x157e89(0x36b)),_0x157e89(0x3d7),_0x48c9b8=>{const _0x50f6c9=_0x157e89;handleFileUpload(_0x48c9b8[_0x50f6c9(0x1b1)]['files'][0x0],async _0x277899=>{const _0x3f6010=_0x50f6c9;data[_0x3f6010(0x27a)]['customSounds'][_0x3f6010(0x320)]=_0x277899,await saveData(),toast(_0x3f6010(0x17e));}),_0x48c9b8[_0x50f6c9(0x1b1)][_0x50f6c9(0x1f4)]=null;}),on($(_0x157e89(0x338)),_0x157e89(0x29d),toggleFullScreen),document[_0x157e89(0x1da)](_0x157e89(0x1e7),updateFullscreenButton),window[_0x157e89(0x1da)](_0x157e89(0x1d9),_0x95e0aa=>{const _0x3031cb=_0x157e89,_0x1a16de=(_0x95e0aa['target'][_0x3031cb(0x3fa)]||'')[_0x3031cb(0x280)](),_0x34f9d0=[_0x3031cb(0x42a),_0x3031cb(0x1fe),_0x3031cb(0x2c7)]['includes'](_0x1a16de);if(_0x95e0aa['code']==='Space'&&!_0x34f9d0){_0x95e0aa[_0x3031cb(0x305)]();if(timer[_0x3031cb(0x453)]==='idle'||timer[_0x3031cb(0x453)]==='paused')timer['start']();else timer[_0x3031cb(0x2b9)]();}(_0x95e0aa[_0x3031cb(0x333)]==='n'||_0x95e0aa[_0x3031cb(0x333)]==='N')&&(!_0x34f9d0&&(_0x95e0aa[_0x3031cb(0x305)](),timer['skip']()));if(_0x95e0aa[_0x3031cb(0x333)]===_0x3031cb(0x304)){$$('.modal')[_0x3031cb(0x29b)](_0x3fb1f8=>_0x3fb1f8[_0x3031cb(0x3ee)][_0x3031cb(0x160)]('show'));try{releaseFocus();}catch(_0x3efc87){}}if(_0x95e0aa[_0x3031cb(0x2b4)]&&!_0x34f9d0){if(_0x95e0aa[_0x3031cb(0x333)]===_0x3031cb(0x2cf))_0x95e0aa['preventDefault'](),_0x498a85(0x0,-0xa);else{if(_0x95e0aa[_0x3031cb(0x333)]===_0x3031cb(0x356))_0x95e0aa[_0x3031cb(0x305)](),_0x498a85(0x0,0xa);else{if(_0x95e0aa[_0x3031cb(0x333)]===_0x3031cb(0x37b))_0x95e0aa['preventDefault'](),_0x498a85(-0xa,0x0);else _0x95e0aa['key']===_0x3031cb(0x32c)&&(_0x95e0aa[_0x3031cb(0x305)](),_0x498a85(0xa,0x0));}}}}),$$(_0x157e89(0x2f7))[_0x157e89(0x29b)](_0x2d64e0=>_0x2d64e0[_0x157e89(0x1da)](_0x157e89(0x29d),_0x4327f8=>{const _0x266fa0=_0x157e89;if(_0x4327f8&&_0x4327f8['target']&&_0x4327f8[_0x266fa0(0x1b1)]['id']===_0x266fa0(0x3fb))return;if(_0x4327f8[_0x266fa0(0x1b1)]===_0x2d64e0){_0x2d64e0['classList'][_0x266fa0(0x160)](_0x266fa0(0x2d7));try{releaseFocus();}catch(_0x35a97d){}}})),window['addEventListener']('click',_0x57880a=>{const _0x45a07b=_0x157e89;!_0x57880a[_0x45a07b(0x1b1)][_0x45a07b(0x282)](_0x45a07b(0x29e))&&!_0x57880a[_0x45a07b(0x1b1)]['closest'](_0x45a07b(0x222))&&closeAllMenus();}),window[_0x157e89(0x1da)](_0x157e89(0x24f),()=>timer[_0x157e89(0x3e1)](!![]));try{const _0x336b3d=Array[_0x157e89(0x481)](document['querySelectorAll'](_0x157e89(0x264)));_0x336b3d[_0x157e89(0x34b)]&&_0x336b3d[_0x157e89(0x29b)](_0x10b31c=>{const _0x1f8751=_0x157e89;_0x10b31c[_0x1f8751(0x1da)](_0x1f8751(0x1c1),()=>{const _0x57839f=_0x1f8751;_0x10b31c[_0x57839f(0x1ce)]&&_0x336b3d[_0x57839f(0x29b)](_0x398b5a=>{const _0x439552=_0x57839f;if(_0x398b5a!==_0x10b31c)_0x398b5a[_0x439552(0x1ce)]=![];});});});}catch(_0x1ff1b5){}const _0x222d1e=$(_0x157e89(0x19a));let _0x30706e=![],_0x48fbf3,_0x29b2ae;_0x222d1e&&(_0x222d1e[_0x157e89(0x1da)]('mousedown',_0x32c5c2=>{const _0xbc888=_0x157e89;_0x30706e=!![];const _0x344b1d=_0x222d1e[_0xbc888(0x3eb)]();_0x48fbf3=_0x32c5c2['clientX']-_0x344b1d[_0xbc888(0x2a7)],_0x29b2ae=_0x32c5c2[_0xbc888(0x197)]-_0x344b1d[_0xbc888(0x46c)],_0x222d1e[_0xbc888(0x365)][_0xbc888(0x22a)]=_0xbc888(0x18a);}),document[_0x157e89(0x1da)](_0x157e89(0x2ac),_0x472e2d=>{const _0x12110a=_0x157e89;if(!_0x30706e)return;let _0x55f40f=_0x472e2d['clientX']-_0x48fbf3,_0x242694=_0x472e2d[_0x12110a(0x197)]-_0x29b2ae;const _0x356249=window['innerWidth']-_0x222d1e[_0x12110a(0x2cb)],_0x5b2413=window[_0x12110a(0x1b3)]-_0x222d1e['offsetHeight'];_0x55f40f=Math[_0x12110a(0x256)](0x0,Math['min'](_0x55f40f,_0x356249)),_0x242694=Math[_0x12110a(0x256)](0x0,Math[_0x12110a(0x21a)](_0x242694,_0x5b2413)),_0x222d1e[_0x12110a(0x365)][_0x12110a(0x2a7)]=_0x55f40f+'px',_0x222d1e[_0x12110a(0x365)]['top']=_0x242694+'px',_0x222d1e['style'][_0x12110a(0x3c9)]=_0x12110a(0x1a1),_0x222d1e[_0x12110a(0x365)][_0x12110a(0x1b4)]=_0x12110a(0x1a1);}),document[_0x157e89(0x1da)](_0x157e89(0x440),()=>{const _0x16e2fa=_0x157e89;if(!_0x30706e)return;_0x30706e=![],_0x222d1e['style'][_0x16e2fa(0x22a)]='';}));function _0xef38f7(_0x16b87){const _0x2b71fc=_0x157e89,_0x45aae0=$('#draggableTimer');if(!_0x45aae0)return;_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x18e)]='fixed',_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x22a)]='',_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x2a7)]='auto',_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x46c)]=_0x2b71fc(0x1a1),_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x1b4)]=_0x2b71fc(0x1a1),_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x3c9)]=_0x2b71fc(0x1a1);const _0x3578de=0x10;_0x16b87==='tl'&&(_0x45aae0['style'][_0x2b71fc(0x2a7)]=_0x3578de+'px',_0x45aae0[_0x2b71fc(0x365)]['top']=_0x3578de+'px'),_0x16b87==='tr'&&(_0x45aae0['style'][_0x2b71fc(0x1b4)]=_0x3578de+'px',_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x46c)]=_0x3578de+'px'),_0x16b87==='bl'&&(_0x45aae0['style'][_0x2b71fc(0x2a7)]=_0x3578de+'px',_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x3c9)]=_0x3578de+'px'),_0x16b87==='br'&&(_0x45aae0[_0x2b71fc(0x365)][_0x2b71fc(0x1b4)]=_0x3578de+'px',_0x45aae0[_0x2b71fc(0x365)]['bottom']=_0x3578de+'px');}function _0x498a85(_0x45942c,_0x33b566){const _0xb08ddd=_0x157e89,_0x5bc5fe=$(_0xb08ddd(0x19a));if(!_0x5bc5fe)return;const _0x3794fc=_0x5bc5fe[_0xb08ddd(0x3eb)](),_0x48aaa6=Math[_0xb08ddd(0x256)](0x0,Math[_0xb08ddd(0x21a)](_0x3794fc[_0xb08ddd(0x2a7)]+_0x45942c,window[_0xb08ddd(0x31c)]-_0x5bc5fe['offsetWidth'])),_0x46b77a=Math[_0xb08ddd(0x256)](0x0,Math[_0xb08ddd(0x21a)](_0x3794fc[_0xb08ddd(0x46c)]+_0x33b566,window[_0xb08ddd(0x1b3)]-_0x5bc5fe[_0xb08ddd(0x1e9)]));_0x5bc5fe[_0xb08ddd(0x365)][_0xb08ddd(0x2a7)]=_0x48aaa6+'px',_0x5bc5fe[_0xb08ddd(0x365)][_0xb08ddd(0x46c)]=_0x46b77a+'px',_0x5bc5fe[_0xb08ddd(0x365)]['right']=_0xb08ddd(0x1a1),_0x5bc5fe['style'][_0xb08ddd(0x3c9)]='auto';}}function toggleBackgroundView(){const _0x40c4a2=_0x4900e5,_0x4e29e7=document['body'];_0x4e29e7['classList']['toggle']('bg-view-mode');const _0x15eff4=_0x4e29e7['classList'][_0x40c4a2(0x25f)](_0x40c4a2(0x1ff)),_0x3c52f4=$(_0x40c4a2(0x182));if(!_0x3c52f4)return;_0x15eff4?(_0x3c52f4['title']='Hiện\x20giao\x20diện',_0x3c52f4['innerHTML']=_0x40c4a2(0x288)):(_0x3c52f4[_0x40c4a2(0x36a)]=_0x40c4a2(0x1e3),_0x3c52f4[_0x40c4a2(0x180)]='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>');}function updateMainViewVisibility(){const _0x8fb542=_0x4900e5,_0x1b71c6=!!getCurrentSubtopic(),_0x506ffd=$('#view-timer'),_0x21170b=$(_0x8fb542(0x1b9));_0x21170b&&_0x21170b[_0x8fb542(0x3ee)][_0x8fb542(0x1c1)](_0x8fb542(0x178),_0x1b71c6),_0x506ffd&&(_0x1b71c6?_0x506ffd[_0x8fb542(0x3ee)][_0x8fb542(0x160)](_0x8fb542(0x468)):_0x506ffd['classList'][_0x8fb542(0x3ab)](_0x8fb542(0x468)));}function updatePresetButtonsText(){const _0x476397=_0x4900e5,_0x3ea84b=data[_0x476397(0x27a)],_0x498c7a=_0x3ea84b[_0x476397(0x1ac)],_0x3192cf=_0x3ea84b[_0x476397(0x247)],_0x25f8d6=_0x3ea84b[_0x476397(0x168)][_0x476397(0x3e7)],_0x27e6e5=_0x3ea84b[_0x476397(0x168)]['B_work'],_0x451b83=$(_0x476397(0x2de)),_0x466b30=$('#btnPresetB'),_0x29ddba=$(_0x476397(0x2ca));_0x451b83&&(_0x451b83[_0x476397(0x408)]=_0x498c7a+'×'+_0x25f8d6+'\x20(A)'),_0x466b30&&(_0x466b30[_0x476397(0x408)]=_0x3192cf+'×'+_0x27e6e5+_0x476397(0x239)),_0x29ddba&&(_0x29ddba[_0x476397(0x408)]=_0x476397(0x1ab));}function renderAll(){const _0x155cf5=_0x4900e5;updatePresetButtonsText();const _0x38e8ad=data[_0x155cf5(0x27a)][_0x155cf5(0x418)];$$(_0x155cf5(0x237))['forEach'](_0x4960ad=>{const _0x3fde59=_0x155cf5,_0x286378=_0x4960ad[_0x3fde59(0x1ae)][_0x3fde59(0x418)]===_0x38e8ad;_0x4960ad[_0x3fde59(0x3ee)][_0x3fde59(0x1c1)](_0x3fde59(0x486),_0x286378),_0x4960ad[_0x3fde59(0x3ee)][_0x3fde59(0x1c1)](_0x3fde59(0x1d0),!_0x286378),_0x4960ad[_0x3fde59(0x257)](_0x3fde59(0x1f7),_0x286378);}),updateMainViewVisibility(),timer[_0x155cf5(0x24e)](data[_0x155cf5(0x27a)]['preset'],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data[_0x155cf5(0x27a)][_0x155cf5(0x46f)]);}function toggleFullScreen(){const _0x365756=_0x4900e5;!document['fullscreenElement']?document[_0x365756(0x309)][_0x365756(0x3c7)]()[_0x365756(0x383)](_0x597a8e=>{const _0x5b0809=_0x365756;toast(_0x5b0809(0x47e)+_0x597a8e[_0x5b0809(0x300)]);}):document[_0x365756(0x450)]&&document[_0x365756(0x450)]();}function updateFullscreenButton(){const _0x37a276=_0x4900e5,_0x1f0671=$(_0x37a276(0x338));document[_0x37a276(0x287)]?(_0x1f0671[_0x37a276(0x180)]='↙️',_0x1f0671['title']=_0x37a276(0x2e8)):(_0x1f0671[_0x37a276(0x180)]='↗️',_0x1f0671[_0x37a276(0x36a)]=_0x37a276(0x30f));}async function initializeApp(){const _0x3936d7=_0x4900e5;try{await storageManager[_0x3936d7(0x1f0)]();const [_0x5506bf,_0x565443,_0x2535e7]=await Promise[_0x3936d7(0x3e8)]([storageManager['getSettings'](),storageManager['getAll']('topics'),storageManager[_0x3936d7(0x3c1)]('subtopics')]);let _0x2351e6;if(!_0x5506bf){const _0x41cf33=JSON[_0x3936d7(0x235)](JSON['stringify'](defaults));await storageManager[_0x3936d7(0x367)](_0x41cf33[_0x3936d7(0x27a)]);for(const _0x30fbf8 of _0x41cf33['topics']){const {subtopics:_0x4ba194,..._0x2d9b8d}=_0x30fbf8;await storageManager[_0x3936d7(0x3ab)](_0x3936d7(0x2c8),_0x2d9b8d);for(const _0x1f99ef of _0x4ba194){await storageManager[_0x3936d7(0x3ab)]('subtopics',{..._0x1f99ef,'topicId':_0x30fbf8['id']});}}_0x2351e6=_0x41cf33;}else{const _0x2e1a24={};for(const _0x67fbb6 of _0x565443)_0x2e1a24[_0x67fbb6['id']]={..._0x67fbb6,'subtopics':[]};for(const _0x43b6eb of _0x2535e7)_0x2e1a24[_0x43b6eb[_0x3936d7(0x35b)]]?.[_0x3936d7(0x2ee)][_0x3936d7(0x350)](_0x43b6eb);_0x2351e6={'version':defaults[_0x3936d7(0x220)],'settings':_0x5506bf,'topics':Object[_0x3936d7(0x1bc)](_0x2e1a24)};}data=window[_0x3936d7(0x3b1)]=_0x2351e6,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0x3936d7(0x23b)](data);}catch(_0x287df4){console[_0x3936d7(0x2b6)](_0x3936d7(0x3b5),_0x287df4);}bindEvents(),applyTheme();}catch(_0x1d9266){console[_0x3936d7(0x454)](_0x3936d7(0x26e),_0x1d9266),toast(_0x3936d7(0x1b6)+_0x1d9266[_0x3936d7(0x300)]);}}callGeminiAPI=async function(_0x8103a5,_0x5d3520=0x3,_0xc9ba52=0x3e8){const _0x4cff78=_0x4900e5,_0x3f9b31=data?.[_0x4cff78(0x27a)]?.['apiKey']||'';if(!_0x3f9b31)return toast('Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.'),null;const _0xcd5890=_0x4cff78(0x29c)+_0x3f9b31,_0x45784d={'contents':[{'role':_0x4cff78(0x2c2),'parts':[{'text':_0x8103a5}]}]};try{const _0xa57f6=await fetch(_0xcd5890,{'method':_0x4cff78(0x231),'headers':{'Content-Type':'application/json'},'body':JSON[_0x4cff78(0x281)](_0x45784d)});if(!_0xa57f6['ok']){if(_0xa57f6[_0x4cff78(0x41d)]===0x1ad&&_0x5d3520>0x0)return await new Promise(_0x25de1f=>setTimeout(_0x25de1f,_0xc9ba52)),callGeminiAPI(_0x8103a5,_0x5d3520-0x1,_0xc9ba52*0x2);let _0x53e27e=null;try{_0x53e27e=await _0xa57f6[_0x4cff78(0x388)]();}catch(_0x30799a){}let _0x546d54=_0x4cff78(0x46d)+_0xa57f6['status'];if(_0xa57f6[_0x4cff78(0x41d)]===0x190)_0x546d54=_0x4cff78(0x3b8);else{if(_0xa57f6[_0x4cff78(0x41d)]===0x1ad)_0x546d54='Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.';else _0x53e27e?.[_0x4cff78(0x454)]?.[_0x4cff78(0x300)]&&(_0x546d54=_0x4cff78(0x389)+_0x53e27e[_0x4cff78(0x454)]['message']);}return toast(_0x546d54,0xfa0),console[_0x4cff78(0x454)](_0x4cff78(0x285),_0x53e27e||_0xa57f6['statusText']),null;}const _0x3a9585=await _0xa57f6[_0x4cff78(0x388)]();if(_0x3a9585[_0x4cff78(0x2f1)]&&_0x3a9585['candidates'][0x0]?.[_0x4cff78(0x2f4)]?.[_0x4cff78(0x417)]?.[0x0]?.[_0x4cff78(0x1e0)])return formatGeminiResponse(_0x3a9585[_0x4cff78(0x2f1)][0x0][_0x4cff78(0x2f4)][_0x4cff78(0x417)][0x0]['text']);else{console[_0x4cff78(0x454)]('API\x20response\x20structure\x20is\x20unexpected:',_0x3a9585);if(_0x3a9585['promptFeedback']?.[_0x4cff78(0x45e)])return'Nội\x20dung\x20bị\x20chặn\x20vì:\x20'+_0x3a9585['promptFeedback'][_0x4cff78(0x45e)]+_0x4cff78(0x25a);return _0x4cff78(0x448);}}catch(_0x381196){return console[_0x4cff78(0x454)](_0x4cff78(0x27c),_0x381196),toast(_0x4cff78(0x245),0xfa0),null;}},loadLanguage(localStorage['getItem']('lang')||'vi')[_0x4900e5(0x2a1)](initializeApp);
    </script>
</body>
</html>

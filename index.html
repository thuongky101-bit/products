<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Ứng dụng Pomodoro hỗ trợ học tập với tích hợp Gemini AI và giao diện hiện đại." />
    <title>Pomodoro Study App — Tích hợp Gemini AI (Giao diện mới)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — PHIÊN BẢN GIAO DIỆN TẬP TRUNG (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Mặc định) - Cập nhật từ file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Thêm biến RGB cho panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: THÊM CÁC THEME MỚI === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: THÊM CÁC THEME MỚI === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Thêm các quy tắc border cho theme light/pastel */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Sửa đổi: bỏ border mặc định */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Sửa đổi */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Sửa đổi */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Giữ nền trong suốt khi di chuột qua */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Sửa đổi màu */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Sửa đổi màu */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */
    #view-timer .panel-bg hr {
        border: none; /* Bỏ đường viền mặc định */
        height: 1px;  /* Đặt chiều cao cho đường kẻ */
        background-color: var(--muted); /* Sử dụng màu phụ của theme */
        opacity: 0.3; /* Làm cho nó mờ đi, hòa vào nền */
        margin-top: 0; /* Điều chỉnh lại khoảng cách */
    }
    /* === END: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Sửa đổi */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Sửa đổi */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Sửa đổi */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Nâng z-index để nằm trên header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Sửa đổi */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Sửa đổi */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Sửa đổi */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Sửa đổi */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Sửa đổi */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Sửa đổi: chuyển sang nền trắng trong suốt */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Viền trắng mờ */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Tinh chỉnh: sát mẫu hơn */
        border-color: var(--acc);
    }
    /* === START: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Dùng nền đen mờ thay vì trắng mờ */
        border-color: rgba(0, 0, 0, 0.1); /* Viền đen mờ trên theme sáng */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Tăng độ đậm khi focus */
    }
    /* === END: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */

    /* Cải thiện nền và màu chữ cho option trong select theo theme hiện tại */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Sửa đổi */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Giảm/loại bỏ bóng chữ cho theme sáng để tránh nhòe/lóa */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
.method-item[open] summary {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
    [data-theme='light'] .method-item[open] summary,
    [data-theme='pastel'] .method-item[open] summary {
        border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* Method actions inline with summary and show on hover */
    .method-item summary { display: flex; align-items: center; justify-content: space-between; }
    .method-item summary > span { flex: 1; }
    .method-item summary .topic-actions { margin-left: 8px; }
    .method-title { cursor: pointer; }
    .method-item:hover .topic-actions, .method-item:focus-within .topic-actions { opacity: 1; visibility: visible; }

    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Đồng hồ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Đồng hồ</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Chủ đề">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Chủ đề</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Thống kê">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Thống kê</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Kho Tri Thức">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Kho Tri Thức</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Cài đặt">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Cài đặt</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Hướng dẫn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Hướng dẫn</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">Chưa chọn Chủ đề con</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard Tổng quan">📊 Tổng Quan </button>
          <a href="https://forms.gle/EfFqBJFTbFtDo5H4A" target="_blank" rel="noopener noreferrer" class="btn ghost small" title="Gửi phản hồi của bạn">💬 Phản Hồi</a>
          <button class="btn ghost small" id="btnExport" title="Xuất JSON">⬇️ Xuất File</button>
          <label class="btn ghost small" for="importFile" title="Nhập JSON">⬆️ Nhập File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Ẩn/Hiện giao diện">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Toàn màn hình">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Chào mừng đến với Pomodoro Study App!</h3>
                <p>Hãy bắt đầu bằng cách chọn một <strong>Chủ đề con</strong> hoặc tạo Chủ đề/Chủ đề con mới.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Tạo Chủ đề Mới</button>
            </div>
            <div class="presets" role="group" aria-label="Chọn chế độ preset">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">TRẠNG THÁI</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Checklist Hạ nhiệt</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Lưu công việc đang làm (Save/Commit).</li>
                <li>Ghi chú nhanh "Next step".</li>
                <li>Dọn dẹp không gian làm việc.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Bắt đầu (Space)">▶️ Bắt đầu</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="Kết thúc phiên làm việc">🧘 Bắt đầu nghỉ</button>
              <button class="btn" id="btnPause" aria-label="Tạm dừng (Space)">⏸️ Tạm dừng</button>
              <button class="btn" id="btnResume" aria-label="Tiếp tục (Space)">⏵ Tiếp tục</button>
              <button class="btn warn" id="btnSkip" aria-label="Bỏ qua (N)">⏭️ Bỏ qua</button>
              <button class="btn danger" id="btnReset">↺ Đặt lại</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Nghỉ sớm</button>
            </div>
            <div class="tiny">Phím tắt: <strong>Space</strong> = Bắt đầu/Tạm dừng/Tiếp tục, <strong>N</strong> = Tiếp theo/Bỏ qua</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Nhiệm vụ</button>
                <button class="tab-btn" data-tab="notes">Ghi chú</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-do cho chủ đề con này:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Thêm một task mới..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Thêm</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Thêm ghi chú mới..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Thêm ghi chú</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini cho: <span id="currentSubtopicNameChat">(chưa chọn)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Xóa lịch sử">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Giải thích khái niệm chính của chủ đề này">Giải thích khái niệm</button>
                  <button class="btn small ghost" data-prompt="Tạo một dàn ý chi tiết cho chủ đề này">Tạo dàn ý</button>
                  <button class="btn small ghost" data-prompt="Liệt kê 5 câu hỏi ôn tập quan trọng về chủ đề này">Tạo câu hỏi ôn tập</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Hỏi Gemini điều gì đó..." />
                  <button id="btnSendMessage" class="btn acc">Gửi</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Quản lý Chủ đề</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Thêm Chủ đề</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Nhấp mũi tên để mở/đóng danh sách chủ đề con.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Thống kê & Lịch sử — <span id="currentSubtopicName">(chưa chọn)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Tổng thời gian</h4><div class="stat-value" id="statTotal">0 phút</div></div>
              <div class="stat-card"><h4>Phiên</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Nhiệm vụ Hoàn thành</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">Lịch sử (LÀM VIỆC)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Kho Tri Thức Cá Nhân Hóa</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Thêm tri thức</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Nhấp vào từng mục để xem chi tiết.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Khám Phá Pomodoro Study App</h3>
              <p>
                  Chào mừng bạn đến với không gian học tập được thiết kế dành riêng cho sự tập trung và hiệu quả. Hãy cùng khám phá những tính năng sẽ đồng hành cùng bạn trên hành trình chinh phục tri thức.
              </p>

              <h4>🚀 Khởi Đầu Nhanh Chỉ Trong 4 Bước</h4>
              <p>Để hành trình của bạn luôn mạch lạc, mọi thứ trong ứng dụng được sắp xếp theo cấu trúc <strong>Chủ đề Lớn → Chủ đề con</strong>.</p>
              <ol>
                  <li>Mở mục <strong>📚 Chủ đề</strong> từ thanh điều hướng bên cạnh.</li>
                  <li>Nhấn <strong>＋ Thêm Chủ đề</strong> để tạo một lĩnh vực lớn (ví dụ: "Tiếng Anh Giao Tiếp").</li>
                  <li>Bên cạnh chủ đề vừa tạo, nhấn <strong>＋ Thêm</strong> để tạo một chủ đề con, chi tiết hơn (ví dụ: "Bài 1: Luyện phát âm IPA").</li>
                  <li>Chọn chủ đề con đó. Giờ đây, bạn đã sẵn sàng để bắt đầu phiên học đầu tiên của mình!</li>
              </ol>

              <hr />
              <h4>✨ Những Tính Năng Đáng Chú Ý</h4>

              <h4>Các Chế Độ Đồng Hồ Linh Hoạt ⏱️</h4>
              <p>Ứng dụng không chỉ có Pomodoro. Hãy chọn phương pháp phù hợp với công việc của bạn:</p>
              <ul>
                  <li><strong>Pomodoro Cổ Điển (Kiểu A/B):</strong> Làm việc tập trung trong các phiên định sẵn (ví dụ: 25 phút làm, 5 phút nghỉ) để xây dựng kỷ luật và nhịp độ.</li>
                  <li><strong>Chế độ Flowtime (Kiểu 🌊 Flow):</strong> Dành cho công việc cần dòng chảy sâu. Đồng hồ sẽ đếm lên, cho phép bạn làm việc đến khi tự cảm thấy cần nghỉ. Thời gian nghỉ sẽ được đề xuất dựa trên thời gian bạn đã làm việc.</li>
                  <li><strong>Đệm "Hạ nhiệt" (Wind-down):</strong> Một khoảng đệm tùy chỉnh giữa lúc làm và lúc nghỉ, giúp bạn kết thúc công việc đang dở, ghi chú lại "bước tiếp theo" và chuyển trạng thái một cách mượt mà, không bị cắt ngang đột ngột.</li>
              </ul>

              <h4>Kho Tri Thức Cá Nhân Hóa 💡</h4>
              <p>Bạn có thể <strong>Thêm, Sửa, Xóa</strong> các phương pháp và ghi chú quan trọng. Với trình soạn thảo mạnh mẽ, bạn dễ dàng định dạng tiêu đề, in đậm, tạo danh sách và thậm chí chọn màu chữ để làm nổi bật thông tin.</p>

              <h4>Quản Lý Chủ Đề Trực Quan</h4>
              <p>Dễ dàng sắp xếp các mục tiêu học tập của bạn. Sử dụng thao tác <strong>kéo và thả</strong> để sắp xếp lại thứ tự các Chủ đề hoặc di chuyển một Chủ đề con sang một lĩnh vực khác một cách trực quan.</p>

              <h4>Nhiệm Vụ & Ghi Chú Tích Hợp 📝</h4>
              <p>Ngay trong màn hình đồng hồ, bạn có thể tạo danh sách việc cần làm (to-do) cho từng chủ đề con hoặc ghi lại những ý tưởng chợt nảy ra mà không làm gián đoạn dòng chảy công việc.</p>

              <h4>Chế Độ Zen 🧘</h4>
              <p>Khi cần tập trung tuyệt đối, hãy nhấn vào biểu tượng con mắt (👁️). Giao diện sẽ ẩn đi, chỉ để lại hình nền và chiếc đồng hồ. Trong chế độ này, bạn có thể <strong>kéo thả đồng hồ</strong> đến bất kỳ vị trí nào trên màn hình để có một không gian làm việc gọn gàng nhất.</p>

              <h4>Thống Kê & Cột Mốc 🏆</h4>
              <p>Theo dõi hành trình của bạn qua những con số biết nói. Ứng dụng sẽ tự động ghi nhận và chúc mừng khi bạn đạt được những cột mốc quan trọng về thời gian tập trung, biến mỗi nỗ lực thành một thành tựu đáng tự hào.</p>

              <hr />
              <h4>⌨️ Phím Tắt Thông Minh</h4>
              <ul>
                  <li><kbd>Space</kbd>: Bắt đầu / Tạm dừng / Tiếp tục phiên học.</li>
                  <li><kbd>N</kbd>: Bỏ qua phiên làm việc hoặc nghỉ hiện tại.</li>
                  <li><kbd>Esc</kbd>: Đóng các cửa sổ đang mở (như Cài đặt).</li>
              </ul>

              <hr />
              <h4>🛠️ Cài Đặt Nâng Cao & Tích Hợp</h4>

              <h4>Trợ Lý Gemini AI 🧠</h4>
              <p>Biến ứng dụng thành một người bạn đồng hành thông minh. Ngoài việc hỏi đáp, bạn còn có thể:</p>
              <ul>
                  <li><strong>Tự động Định dạng Thông minh:</strong> Khi soạn thảo trong mục "Phương pháp", hãy để AI tự động phân tích và định dạng văn bản thô của bạn—tự nhận diện tiêu đề, các ý chính cần in đậm và danh sách.</li>
                  <li><strong>Thiết lập:</strong> Truy cập Google AI Studio để tạo API Key miễn phí và dán vào ô "Gemini API Key" trong Cài đặt của ứng dụng.</li>
              </ul>

              <h4>Tùy Biến Giao Diện & Âm Thanh 🎨</h4>
              <p>Biến không gian học tập thành của riêng bạn:</p>
              <ul>
                  <li><strong>Nhiều Theme & Hình nền:</strong> Lựa chọn giữa các theme có sẵn (Sáng, Tối, Pastel...) hoặc <strong>tải lên hình nền của riêng bạn</strong> để tạo cảm hứng.</li>
                  <li><strong>Âm báo Tùy chỉnh:</strong> Bạn có thể <strong>tải lên các file âm thanh (.mp3, .wav...) của riêng mình</strong> để sử dụng làm chuông báo cho các phiên làm việc và nghỉ ngơi.</li>
              </ul>

              <h4>Nhạc Nền YouTube 🎶</h4>
              <p>Tạo không gian học tập hoàn hảo bằng cách phát một video hoặc danh sách phát YouTube làm nhạc nền. Dán đường dẫn (URL) vào ô "Nhạc nền YouTube" trong Cài đặt.</p>

              <h4>An Toàn Dữ Liệu: Sao Lưu & Phục Hồi 🛡️</h4>
              <p>Ứng dụng tự động sao lưu tiến trình của bạn mỗi ngày. Bạn có thể tùy chỉnh số ngày lưu giữ bản sao lưu và phục hồi dữ liệu từ một ngày trong quá khứ nếu cần. ⚠️ <strong>Cảnh báo:</strong> Phục hồi sẽ ghi đè toàn bộ dữ liệu hiện tại.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Chúc mừng Bạn!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Tiếp tục hành trình!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Cài đặt</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Đồng hồ</button>
              <button class="tab-btn" data-tab="settings-ui">Giao diện & Âm thanh</button>
              <button class="tab-btn" data-tab="settings-integrations">Tích hợp</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Kiểu A </button>
                      <button class="btn ghost" data-preset-target="B"> Kiểu B </button>
                      <button class="btn ghost" data-preset-target="C"> Kiểu C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Thời lượng Pomodoro</h4>
                      <div class="row">
                          <label>LÀM VIỆC (phút)<input type="number" id="set_work" min="1" /></label>
                          <label>HẠ NHIỆT (phút)<input type="number" id="set_winddown" min="0" /></label>
                          <label>NGHỈ NGẮN (phút)<input type="number" id="set_short" min="1" /></label>
                          <label>NGHỈ DÀI (phút)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Chu kỳ Pomodoro<input type="number" id="set_cycles" min="1" /></label>
                          <label>Chu kỳ nghỉ dài<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Tỷ lệ nghỉ (Làm việc / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Gợi ý: Thời gian nghỉ = tổng thời gian làm việc / X. Mặc định là 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Tự động bắt đầu phiên tiếp theo</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Bật Hạ nhiệt sau phiên làm</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Giao diện</h4>
                      <div class="row">
                          <label>Theme Giao Diện
                                <select id="set_theme_color">
                                    <option value="default">Mặc định (Dark Blue)</option>
                                    <option value="light">Light - Trà Sữa</option>
                                    <option value="pastel">Pastel - Dễ thương</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Chế độ hiển thị nền
                              <select id="set_backgroundMode">
                                  <option value="cover">Lấp đầy (Mặc định)</option>
                                  <option value="contain">Vừa vặn (Sắc nét)</option>
                                  <option value="auto">Kích thước gốc (Lặp lại)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Hình nền
                              <label class="btn small ghost" for="uploadBg">Tải ảnh mới</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Xóa nền</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Độ trong suốt của nền</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Âm thanh</h4>
                      <div class="row">
                          <label>Âm lượng (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Kiểu âm báo
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Tùy chỉnh âm báo</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Âm báo hết LÀM VIỆC</small>
                              <label title="Âm báo hết LÀM VIỆC" class="btn small ghost" for="uploadSoundWork">LÀM VIỆC</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ NGẮN</small>
                              <label title="Âm báo hết NGHỈ NGẮN" class="btn small ghost" for="uploadSoundBreak">NGHỈ NGẮN</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ DÀI</small>
                              <label title="Âm báo hết NGHỈ DÀI" class="btn small ghost" for="uploadSoundLong">NGHỈ DÀI</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Tích hợp AI</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Dán API Key của bạn vào đây..." />
                      </label>
                      <div class="tiny">Cần có để sử dụng các tính năng AI. Lấy key miễn phí tại <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 Nhạc nền YouTube</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Dán link YouTube vào đây..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Dùng ảnh bìa video làm nền</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Dừng sẽ không tự phát lại cho đến khi bạn bấm ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Âm lượng</div>
                  </div>
                  <div>
                      <h4>🛡️ Cài đặt sao lưu</h4>
                      <div class="row">
                          <label>Số ngày sao lưu cần giữ lại
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Phục hồi dữ liệu</h4>
                      <p class="tiny">Phục hồi dữ liệu từ một bản sao lưu tự động hàng ngày. Hành động này sẽ ghi đè lên dữ liệu hiện tại của bạn.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Phục hồi</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Mặc định</button>
              <button class="btn acc" id="btnSaveSettings">Lưu</button>
              <button class="btn" id="btnCloseSettings">Đóng</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Ghi chú cho phiên vừa hoàn thành</h3>
      <div class="row"><textarea id="noteText" placeholder="Bạn học được gì? Khó khăn? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Tóm tắt & Gợi ý</button>
        <button class="btn" id="btnSkipNote">Bỏ qua</button>
        <button class="btn acc" id="btnSaveNote">Lưu ghi chú</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Tiêu đề</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Hủy</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Tổng quan</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Đóng</button>
        </div>
        <p class="tiny">Tổng hợp thời gian và số phiên đã hoàn thành trên tất cả các chủ đề.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Chỉnh-sửa Phương-pháp</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Tiêu-đề<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Nội-dung</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Tiêu-đề nhỏ">H</button>
          <button id="toolBold" class="btn small ghost" title="In đậm">B</button>
          <button id="toolItalic" class="btn small ghost" title="In nghiêng">I</button>
          <button id="toolList" class="btn small ghost" title="Danh-sách">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Danh sách chấm tròn">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Màu chữ">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Màu chữ mặc định"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Màu nhấn mạnh"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Màu tích cực"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Màu cảnh báo"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Màu nguy hiểm"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Màu tím"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="Tính năng này yêu cầu Gemini API Key">✨ Tự động định dạng</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Hủy</button>
          <button class="btn acc" id="btnSaveMethod">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Nhấn "Bật âm thanh" để cho phép phát nhạc nền.</span>
    <button id="btnEnableSound" class="btn small acc">Bật âm thanh</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
    const _0x274cec=_0x48ec;(function(_0x4fdd89,_0x1f3d56){const _0x184aa9=_0x48ec,_0x2674cb=_0x4fdd89();while(!![]){try{const _0x4389f8=parseInt(_0x184aa9(0x170))/0x1*(parseInt(_0x184aa9(0x2c2))/0x2)+-parseInt(_0x184aa9(0x293))/0x3+parseInt(_0x184aa9(0x1b2))/0x4*(-parseInt(_0x184aa9(0x1a0))/0x5)+parseInt(_0x184aa9(0x39a))/0x6+-parseInt(_0x184aa9(0x2b0))/0x7*(parseInt(_0x184aa9(0x476))/0x8)+parseInt(_0x184aa9(0x3fb))/0x9+-parseInt(_0x184aa9(0x3a4))/0xa;if(_0x4389f8===_0x1f3d56)break;else _0x2674cb['push'](_0x2674cb['shift']());}catch(_0x4f2813){_0x2674cb['push'](_0x2674cb['shift']());}}}(_0x13a1,0xa1892),window[_0x274cec(0x36b)](_0x274cec(0x2d7),()=>{try{updateFullscreenButton();}catch(_0x6bbbf){}}));const IS_FILE_PROTOCOL=window[_0x274cec(0x3c4)]['protocol']===_0x274cec(0x2fc);function startYtApiWatchdog(){const _0x45fc87=_0x274cec,_0x14a5fc=document[_0x45fc87(0x35f)](_0x45fc87(0x43e));if(!_0x14a5fc)return;const _0x43a941=setTimeout(()=>{const _0x14be32=_0x45fc87;try{(!window['YT']||!window['YT']['Player'])&&(_0x14a5fc[_0x14be32(0x42d)]=_0x14be32(0x2f5),_0x14a5fc['style'][_0x14be32(0x1b7)]=_0x14be32(0x451));}catch(_0x2e07a4){}},0x5dc),_0x4eef13=setTimeout(()=>{const _0xa376e9=_0x45fc87;try{(!window['YT']||!window['YT'][_0xa376e9(0x213)])&&(_0x14a5fc[_0xa376e9(0x42d)]='Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.',_0x14a5fc['style'][_0xa376e9(0x1b7)]='var(--danger)');}catch(_0x2bc710){}},0x1b58);window[_0x45fc87(0x2c8)]={'cancel'(){clearTimeout(_0x43a941),clearTimeout(_0x4eef13);}};}(function(){const _0x3a8796=_0x274cec,_0x28653b={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>'Chu\x20kỳ\x20'+current+'/'+target,'timer.selectSubtopicPrompt':'Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.'};window['t']=function _0x4d926a(_0x348605,_0x3fb987){const _0xe03747=_0x48ec;try{const _0x41aa80=_0x28653b[_0x348605];if(typeof _0x41aa80===_0xe03747(0x193))return _0x41aa80(_0x3fb987||{});if(typeof _0x41aa80==='string')return _0x41aa80;}catch(_0x3c1177){}return _0x348605;},window[_0x3a8796(0x38d)]=function _0x38ff14(_0x46223a){const _0x1bf37d=_0x3a8796;try{localStorage[_0x1bf37d(0x46b)](_0x1bf37d(0x1e2),_0x46223a||'vi');}catch(_0x51abfb){}return Promise[_0x1bf37d(0x1a5)]();};}());function ensureYouTubeAPI(){const _0x5584b2=_0x274cec;if(IS_FILE_PROTOCOL)return Promise['resolve'](![]);try{if(window['YT']&&window['YT'][_0x5584b2(0x213)])return Promise[_0x5584b2(0x1a5)](!![]);}catch(_0x41da7a){}if(window['__ytApiPromise'])return window['__ytApiPromise'];return startYtApiWatchdog(),window[_0x5584b2(0x25b)]=new Promise((_0x4b62ec,_0x4440f8)=>{const _0x16ffdd=_0x5584b2;try{const _0x180c78=document[_0x16ffdd(0x179)]('script');_0x180c78['src']='https://www.youtube.com/iframe_api',_0x180c78[_0x16ffdd(0x1e3)]=!![],_0x180c78[_0x16ffdd(0x3a6)]=!![],_0x180c78[_0x16ffdd(0x45b)]=()=>_0x4b62ec(!![]),_0x180c78['onerror']=()=>_0x4440f8(new Error(_0x16ffdd(0x182))),document[_0x16ffdd(0x392)][_0x16ffdd(0x234)](_0x180c78);}catch(_0x54fc6c){_0x4440f8(_0x54fc6c);}}),window[_0x5584b2(0x25b)];}const storageManager={'DB_NAME':_0x274cec(0x27a),'DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x2eb232,_0x5dc15b)=>{const _0x2fd8df=_0x48ec;if(this['db'])return _0x2eb232(this['db']);const _0x23e123=indexedDB[_0x2fd8df(0x1e9)](this[_0x2fd8df(0x3eb)],this[_0x2fd8df(0x2bf)]);_0x23e123[_0x2fd8df(0x20d)]=_0x4eb7d2=>{const _0x1a4ad2=_0x2fd8df,_0x154bad=_0x4eb7d2[_0x1a4ad2(0x479)][_0x1a4ad2(0x2fe)];!_0x154bad[_0x1a4ad2(0x3fe)][_0x1a4ad2(0x205)](_0x1a4ad2(0x1e5))&&_0x154bad[_0x1a4ad2(0x482)](_0x1a4ad2(0x1e5));!_0x154bad['objectStoreNames'][_0x1a4ad2(0x205)](_0x1a4ad2(0x3c7))&&_0x154bad['createObjectStore'](_0x1a4ad2(0x3c7),{'keyPath':'id'});if(!_0x154bad[_0x1a4ad2(0x3fe)][_0x1a4ad2(0x205)](_0x1a4ad2(0x1b3))){const _0x542c07=_0x154bad[_0x1a4ad2(0x482)](_0x1a4ad2(0x1b3),{'keyPath':'id'});_0x542c07[_0x1a4ad2(0x21d)]('by_topic',_0x1a4ad2(0x2e7));}!_0x154bad['objectStoreNames'][_0x1a4ad2(0x205)]('backups')&&_0x154bad['createObjectStore'](_0x1a4ad2(0x37b),{'keyPath':_0x1a4ad2(0x2c7)});},_0x23e123['onsuccess']=_0x3c6d31=>{const _0x2458d6=_0x2fd8df;this['db']=_0x3c6d31['target'][_0x2458d6(0x2fe)],console[_0x2458d6(0x309)](_0x2458d6(0x2cd)),_0x2eb232(this['db']);},_0x23e123[_0x2fd8df(0x22a)]=_0x44df22=>{const _0x37b620=_0x2fd8df;console['error']('IndexedDB\x20error:',_0x44df22['target'][_0x37b620(0x418)]),_0x5dc15b(_0x44df22['target'][_0x37b620(0x17c)]);};});},async '_getStore'(_0x507346,_0xf650b0=_0x274cec(0x31e)){const _0x1139fd=_0x274cec;await this[_0x1139fd(0x3d7)]();const _0x185216=this['db'][_0x1139fd(0x168)]([_0x507346],_0xf650b0);return _0x185216['objectStore'](_0x507346);},async 'getSettings'(){const _0x3b0187=_0x274cec,_0x436ec2=await this[_0x3b0187(0x377)](_0x3b0187(0x1e5));return new Promise((_0x4a1210,_0x2857a6)=>{const _0x527528=_0x3b0187,_0x49f96e=_0x436ec2[_0x527528(0x42e)]('main_settings');_0x49f96e[_0x527528(0x22b)]=()=>_0x4a1210(_0x49f96e[_0x527528(0x2fe)]),_0x49f96e['onerror']=()=>_0x2857a6(_0x49f96e[_0x527528(0x17c)]);});},async 'updateSettings'(_0x42d06a){const _0xc49728=_0x274cec,_0x2ad71e=await this[_0xc49728(0x377)](_0xc49728(0x1e5),_0xc49728(0x352));return new Promise((_0x240505,_0x785c34)=>{const _0xf3c369=_0xc49728,_0x3bbfdd=_0x2ad71e[_0xf3c369(0x3e2)](_0x42d06a,_0xf3c369(0x1ec));_0x3bbfdd[_0xf3c369(0x22b)]=()=>_0x240505(_0x3bbfdd[_0xf3c369(0x2fe)]),_0x3bbfdd[_0xf3c369(0x22a)]=()=>_0x785c34(_0x3bbfdd[_0xf3c369(0x17c)]);});},async 'getAll'(_0x49a2d0){const _0x21d35c=_0x274cec,_0x9726cb=await this[_0x21d35c(0x377)](_0x49a2d0);return new Promise((_0x57fa19,_0x1dc847)=>{const _0x5da3d1=_0x21d35c,_0x1fbfca=_0x9726cb['getAll']();_0x1fbfca[_0x5da3d1(0x22b)]=()=>_0x57fa19(_0x1fbfca[_0x5da3d1(0x2fe)]),_0x1fbfca[_0x5da3d1(0x22a)]=()=>_0x1dc847(_0x1fbfca[_0x5da3d1(0x17c)]);});},async 'update'(_0x5b3c49,_0x2ae8fd){const _0x2940f8=_0x274cec,_0xb95850=await this[_0x2940f8(0x377)](_0x5b3c49,_0x2940f8(0x352));return new Promise((_0x3ea25b,_0x136778)=>{const _0x54085a=_0x2940f8,_0x267c86=_0xb95850[_0x54085a(0x3e2)](_0x2ae8fd);_0x267c86[_0x54085a(0x22b)]=()=>_0x3ea25b(_0x267c86[_0x54085a(0x2fe)]),_0x267c86[_0x54085a(0x22a)]=()=>_0x136778(_0x267c86[_0x54085a(0x17c)]);});},async 'add'(_0x192c08,_0x3f3ca9){const _0x61aa37=_0x274cec,_0x43c28d=await this[_0x61aa37(0x377)](_0x192c08,'readwrite');return new Promise((_0x434e08,_0x916a99)=>{const _0x1dd609=_0x61aa37,_0xb3d394=_0x43c28d['add'](_0x3f3ca9);_0xb3d394['onsuccess']=()=>_0x434e08(_0xb3d394[_0x1dd609(0x2fe)]),_0xb3d394[_0x1dd609(0x22a)]=()=>_0x916a99(_0xb3d394[_0x1dd609(0x17c)]);});},async 'delete'(_0x181194,_0x4b55bd){const _0x41eb61=_0x274cec,_0x4ef03d=await this[_0x41eb61(0x377)](_0x181194,'readwrite');return new Promise((_0x5e85e2,_0x235921)=>{const _0x339850=_0x41eb61,_0x45f54b=_0x4ef03d[_0x339850(0x1c9)](_0x4b55bd);_0x45f54b[_0x339850(0x22b)]=()=>_0x5e85e2(_0x45f54b[_0x339850(0x2fe)]),_0x45f54b[_0x339850(0x22a)]=()=>_0x235921(_0x45f54b[_0x339850(0x17c)]);});},async 'save'(_0xdf4333){return await this['initDB'](),new Promise((_0x3df7fd,_0x44620f)=>{const _0x4b426c=_0x48ec,_0x1b1ba3=this['db']['transaction']([_0x4b426c(0x1e5),_0x4b426c(0x3c7),_0x4b426c(0x1b3)],_0x4b426c(0x352)),_0x3520ea=_0x1b1ba3['objectStore']('settings'),_0x4fcc0c=_0x1b1ba3[_0x4b426c(0x327)](_0x4b426c(0x3c7)),_0x21402b=_0x1b1ba3['objectStore'](_0x4b426c(0x1b3));_0x3520ea[_0x4b426c(0x3e2)](_0xdf4333[_0x4b426c(0x1e5)],_0x4b426c(0x1ec)),_0x4fcc0c[_0x4b426c(0x31c)](),_0x21402b[_0x4b426c(0x31c)](),_0xdf4333['topics'][_0x4b426c(0x432)](_0x351615=>{const _0x4ae236=_0x4b426c,{subtopics:_0x1a9e9c,..._0x471515}=_0x351615;_0x4fcc0c[_0x4ae236(0x3e2)](_0x471515),(_0x1a9e9c||[])[_0x4ae236(0x432)](_0x17be05=>_0x21402b['put'](_0x17be05));}),_0x1b1ba3[_0x4b426c(0x311)]=()=>_0x3df7fd(),_0x1b1ba3[_0x4b426c(0x22a)]=_0x19f660=>_0x44620f(_0x19f660[_0x4b426c(0x479)][_0x4b426c(0x17c)]);});},async 'autoBackup'(_0x8b85ce){const _0x335aed=_0x274cec;await this[_0x335aed(0x3d7)]();const _0x5f4bf4=new Date()['toISOString']()['slice'](0x0,0xa),_0x13e705=localStorage[_0x335aed(0x297)](_0x335aed(0x2bc));if(_0x5f4bf4!==_0x13e705){console[_0x335aed(0x309)]('Creating\x20backup\x20for\x20'+_0x5f4bf4+_0x335aed(0x23e));const _0x3bb8d4={'date':_0x5f4bf4,'data':JSON[_0x335aed(0x3f3)](JSON['stringify'](_0x8b85ce))},_0x122026=this['db']['transaction']([_0x335aed(0x37b)],_0x335aed(0x352)),_0x3989e6=_0x122026[_0x335aed(0x327)](_0x335aed(0x37b)),_0x2adad1=_0x3989e6[_0x335aed(0x3e2)](_0x3bb8d4);_0x2adad1['onsuccess']=()=>{const _0x5f23ef=_0x335aed;localStorage['setItem'](_0x5f23ef(0x2bc),_0x5f4bf4),console[_0x5f23ef(0x309)](_0x5f23ef(0x388)),this['cleanupOldBackups'](_0x8b85ce?.['settings']?.['backupDaysToKeep']||0x7);},_0x2adad1[_0x335aed(0x22a)]=_0x1fd3b4=>{const _0x2b4ab6=_0x335aed;console['error'](_0x2b4ab6(0x229),_0x1fd3b4['target'][_0x2b4ab6(0x17c)]);};}},async 'cleanupOldBackups'(_0x5eb97a){const _0x1bfcac=_0x274cec;await this[_0x1bfcac(0x3d7)]();const _0xcf9217=this['db'][_0x1bfcac(0x168)]([_0x1bfcac(0x37b)],_0x1bfcac(0x352)),_0x2cae1a=_0xcf9217[_0x1bfcac(0x327)](_0x1bfcac(0x37b)),_0x5b8b63=_0x2cae1a[_0x1bfcac(0x3d1)]();_0x5b8b63[_0x1bfcac(0x22b)]=()=>{const _0x43e557=_0x1bfcac,_0xa2f55b=_0x5b8b63[_0x43e557(0x2fe)]['sort']()[_0x43e557(0x2a3)]();if(_0xa2f55b[_0x43e557(0x27b)]>_0x5eb97a){const _0x1b7831=_0xa2f55b[_0x43e557(0x1f7)](_0x5eb97a);_0x1b7831[_0x43e557(0x432)](_0x24f1ba=>{const _0x2e14bb=_0x43e557;_0x2cae1a[_0x2e14bb(0x1c9)](_0x24f1ba),console['log'](_0x2e14bb(0x1ee)+_0x24f1ba);});}};},async 'getBackupList'(){const _0x59361e=_0x274cec;return await this[_0x59361e(0x3d7)](),new Promise((_0x97c83b,_0xb8c913)=>{const _0x569e7b=_0x59361e,_0x326634=this['db'][_0x569e7b(0x168)]([_0x569e7b(0x37b)],_0x569e7b(0x31e)),_0x5b30c8=_0x326634[_0x569e7b(0x327)](_0x569e7b(0x37b)),_0x2e59a9=_0x5b30c8['getAll']();_0x2e59a9[_0x569e7b(0x22b)]=()=>_0x97c83b(_0x2e59a9['result'][_0x569e7b(0x222)]((_0x3fd419,_0x131556)=>_0x131556['date'][_0x569e7b(0x33d)](_0x3fd419[_0x569e7b(0x2c7)]))),_0x2e59a9[_0x569e7b(0x22a)]=_0xebbef6=>_0xb8c913(_0xebbef6[_0x569e7b(0x479)]['error']);});},async 'restoreBackup'(_0x49d736){const _0x4aefce=_0x274cec;return await this[_0x4aefce(0x3d7)](),new Promise((_0x30b6fb,_0x190bbc)=>{const _0x114edb=_0x4aefce,_0x364e75=this['db'][_0x114edb(0x168)]([_0x114edb(0x37b)],_0x114edb(0x31e)),_0x1b4a23=_0x364e75[_0x114edb(0x327)]('backups'),_0x415b02=_0x1b4a23[_0x114edb(0x42e)](_0x49d736);_0x415b02['onsuccess']=()=>{const _0x490e81=_0x114edb;_0x415b02['result']&&_0x415b02[_0x490e81(0x2fe)][_0x490e81(0x199)]?(localStorage[_0x490e81(0x46b)](_0x490e81(0x3bd),JSON[_0x490e81(0x428)](_0x415b02[_0x490e81(0x2fe)][_0x490e81(0x199)])),_0x30b6fb(_0x415b02['result'][_0x490e81(0x199)])):_0x190bbc(new Error(_0x490e81(0x305)));},_0x415b02[_0x114edb(0x22a)]=_0x5cfd93=>_0x190bbc(_0x5cfd93[_0x114edb(0x479)][_0x114edb(0x17c)]);});},'exportData'(_0x123adc){const _0x2fc9b6=_0x274cec;let _0x291e50={};try{_0x291e50=JSON[_0x2fc9b6(0x3f3)](JSON[_0x2fc9b6(0x428)](_0x123adc||{}));}catch(_0x104b06){_0x291e50=_0x123adc;}try{if(_0x291e50&&_0x291e50[_0x2fc9b6(0x1e5)])_0x291e50['settings']['apiKey']='';}catch(_0x35b112){}const _0x56f7dc=new Blob([JSON[_0x2fc9b6(0x428)](_0x291e50,null,0x2)],{'type':'application/json'}),_0x455918=document[_0x2fc9b6(0x179)]('a'),_0x194a10=new Date(),_0x2e6b75=_0x2ad78a=>(''+_0x2ad78a)[_0x2fc9b6(0x39c)](0x2,'0');_0x455918[_0x2fc9b6(0x3d8)]=URL[_0x2fc9b6(0x16c)](_0x56f7dc),_0x455918[_0x2fc9b6(0x3a2)]=_0x2fc9b6(0x3cf)+_0x194a10[_0x2fc9b6(0x423)]()+_0x2e6b75(_0x194a10[_0x2fc9b6(0x483)]()+0x1)+_0x2e6b75(_0x194a10[_0x2fc9b6(0x16a)]())+'.json',_0x455918[_0x2fc9b6(0x27e)](),URL[_0x2fc9b6(0x3f5)](_0x455918[_0x2fc9b6(0x3d8)]);},async 'importData'(_0x2fcc83){const _0x243db7=_0x274cec,_0x3ecd93=await _0x2fcc83[_0x243db7(0x18f)](),_0x2fc375=JSON[_0x243db7(0x3f3)](_0x3ecd93);if(!_0x2fc375[_0x243db7(0x30f)]||!_0x2fc375[_0x243db7(0x1e5)]||!Array[_0x243db7(0x458)](_0x2fc375['topics']))throw new Error(_0x243db7(0x329));try{const _0x5181f1=window[_0x243db7(0x199)]&&window[_0x243db7(0x199)][_0x243db7(0x1e5)]&&window['data'][_0x243db7(0x1e5)][_0x243db7(0x433)]||'';(!(_0x243db7(0x433)in _0x2fc375[_0x243db7(0x1e5)])||_0x2fc375[_0x243db7(0x1e5)]['apiKey']==='')&&(_0x2fc375['settings'][_0x243db7(0x433)]=_0x5181f1);}catch(_0x1b65fd){}return localStorage[_0x243db7(0x46b)]('pomodoroData_v11',JSON[_0x243db7(0x428)](_0x2fc375)),_0x2fc375;}},$=(_0x3c53d0,_0x27a760=document)=>_0x27a760['querySelector'](_0x3c53d0),breakSuggestions=['Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.',_0x274cec(0x2aa),'Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.',_0x274cec(0x1eb),_0x274cec(0x344),_0x274cec(0x42c),_0x274cec(0x17a),_0x274cec(0x1f9),_0x274cec(0x31b),_0x274cec(0x242),_0x274cec(0x41c),_0x274cec(0x429),_0x274cec(0x41e),_0x274cec(0x2ff),_0x274cec(0x3bf),_0x274cec(0x296),_0x274cec(0x3b4),_0x274cec(0x28e),'Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.',_0x274cec(0x16d),_0x274cec(0x43b),'Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.',_0x274cec(0x45d),'Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.',_0x274cec(0x3a9),_0x274cec(0x425),_0x274cec(0x370),_0x274cec(0x397),_0x274cec(0x1c3),'Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.','Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!'],$$=(_0x3fd521,_0x4eb3b4=document)=>Array[_0x274cec(0x3a1)](_0x4eb3b4[_0x274cec(0x172)](_0x3fd521));function on(_0x3be30f,_0x3e34be,_0x43508c){const _0x2dfa3d=_0x274cec;if(!_0x3be30f){console[_0x2dfa3d(0x1f6)](_0x2dfa3d(0x366),_0x3e34be);return;}_0x3be30f[_0x2dfa3d(0x36b)](_0x3e34be,_0x43508c);}const formatMMSS=_0x14bdc1=>{const _0x10ee97=_0x274cec,_0xf9b222=Math[_0x10ee97(0x34f)](_0x14bdc1/0x3c)[_0x10ee97(0x2ac)]()[_0x10ee97(0x39c)](0x2,'0'),_0x5eaac1=Math[_0x10ee97(0x34f)](_0x14bdc1%0x3c)[_0x10ee97(0x2ac)]()['padStart'](0x2,'0');return _0xf9b222+':'+_0x5eaac1;},uid=(_0x23916c='id')=>_0x23916c+'_'+Date[_0x274cec(0x307)]()+'_'+Math[_0x274cec(0x376)]()[_0x274cec(0x2ac)](0x24)['slice'](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0x4ce1a5){const _0x491898=_0x274cec;try{const _0x3820b5=_0x4ce1a5['querySelectorAll'](_0x491898(0x456));if(!_0x3820b5[_0x491898(0x27b)])return;const _0x544aed=_0x3820b5[0x0],_0x143597=_0x3820b5[_0x3820b5[_0x491898(0x27b)]-0x1],_0x589499=_0x1140fd=>{const _0x4c5de5=_0x491898;if(_0x1140fd[_0x4c5de5(0x261)]===_0x4c5de5(0x47b)){if(_0x1140fd[_0x4c5de5(0x3b6)]&&document[_0x4c5de5(0x25e)]===_0x544aed)_0x1140fd[_0x4c5de5(0x18a)](),_0x143597[_0x4c5de5(0x32a)]();else!_0x1140fd['shiftKey']&&document['activeElement']===_0x143597&&(_0x1140fd[_0x4c5de5(0x18a)](),_0x544aed['focus']());}};_0x4ce1a5['addEventListener'](_0x491898(0x348),_0x589499),_0x544aed[_0x491898(0x32a)](),__releaseFocusTrap=()=>{const _0x292532=_0x491898;try{_0x4ce1a5[_0x292532(0x373)](_0x292532(0x348),_0x589499);}catch(_0xdcc88d){}};}catch(_0x359eff){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x17b023){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()['toISOString']();function toast(_0x588e8b,_0x4dc302=0xa28){const _0x194e0c=_0x274cec,_0x570f1a=$(_0x194e0c(0x2c1)),_0x5e8e43=document[_0x194e0c(0x179)](_0x194e0c(0x2b3));_0x5e8e43[_0x194e0c(0x176)]=_0x194e0c(0x3cb),_0x5e8e43['textContent']=_0x588e8b,_0x570f1a[_0x194e0c(0x234)](_0x5e8e43),setTimeout(()=>{const _0x484dad=_0x194e0c;_0x5e8e43[_0x484dad(0x364)][_0x484dad(0x169)]='0';},_0x4dc302-0x12c),setTimeout(()=>_0x570f1a[_0x194e0c(0x3f8)](_0x5e8e43),_0x4dc302);}function escapeHTML(_0x3cdbc5){const _0x53a18f=_0x274cec;return _0x3cdbc5['replace'](/[&<>"']/g,_0x294bf2=>({'&':_0x53a18f(0x38b),'<':'&lt;','>':_0x53a18f(0x3dd),'\x22':_0x53a18f(0x1d0),'\x27':_0x53a18f(0x35e)}[_0x294bf2]));}function formatDaysHoursMinutes(_0x447725){const _0x31628c=_0x274cec;if(!_0x447725||_0x447725<0x1)return'0\x20phút';const _0x5cb4f4=Math[_0x31628c(0x34f)](_0x447725/0x3c),_0x28ca3e=_0x447725%0x3c,_0x1898e4=_0x28ca3e[_0x31628c(0x2ac)]()[_0x31628c(0x39c)](0x2,'0');return _0x5cb4f4+_0x31628c(0x250)+_0x1898e4+'\x20phút';}function formatGeminiResponse(_0x10891e){const _0x4ba80a=_0x274cec;return _0x10891e[_0x4ba80a(0x227)](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0xf6307f){const _0x4bb328=_0x274cec,_0x429867=(_0xf6307f||'')[_0x4bb328(0x452)]('\x0a');let _0x49f281='',_0x23a62b=null;const _0x28e73a=()=>{const _0x4a6fb4=_0x4bb328;_0x23a62b&&(_0x49f281+=_0x23a62b==='ol'?_0x4a6fb4(0x3b9):_0x4a6fb4(0x300),_0x23a62b=null);};for(let _0x14a89d of _0x429867){let _0x56b268=(_0x14a89d||'')['trim']();if(!_0x56b268){_0x28e73a();continue;}if(_0x56b268[_0x4bb328(0x241)](_0x4bb328(0x44b)))_0x28e73a(),_0x49f281+=_0x4bb328(0x387)+escapeHTML(_0x56b268[_0x4bb328(0x47c)](0x5))+_0x4bb328(0x324);else{if(/^\d+\.\s/[_0x4bb328(0x275)](_0x56b268)){_0x23a62b!=='ol'&&(_0x28e73a(),_0x49f281+=_0x4bb328(0x469),_0x23a62b='ol');const _0x10e18d=_0x56b268['substring'](_0x56b268[_0x4bb328(0x3ec)]('\x20')+0x1);_0x49f281+='<li>'+escapeHTML(_0x10e18d)+'</li>';}else _0x56b268[_0x4bb328(0x241)]('-\x20')?(_0x23a62b!=='ul'&&(_0x28e73a(),_0x49f281+=_0x4bb328(0x2e5),_0x23a62b='ul'),_0x49f281+='<li>'+escapeHTML(_0x56b268[_0x4bb328(0x47c)](0x2))+'</li>'):(_0x28e73a(),_0x56b268=escapeHTML(_0x56b268)[_0x4bb328(0x227)](/\*\*(.*?)\*\*/g,_0x4bb328(0x331))[_0x4bb328(0x227)](/_(.*?)_/g,_0x4bb328(0x3c5)),_0x49f281+=_0x4bb328(0x1cd)+_0x56b268+_0x4bb328(0x448));}}return _0x28e73a(),_0x49f281;}function wrapTextInMarkdown(_0x176139,_0x4f6223,_0x2f0134=''){const _0x23fca8=_0x274cec;if(!_0x176139)return;const _0xff24af=_0x176139['selectionStart']||0x0,_0x95ba2c=_0x176139[_0x23fca8(0x252)]||0x0,_0x33481a=_0x176139['value'][_0x23fca8(0x47c)](_0xff24af,_0x95ba2c),_0x5d8f24=_0x4f6223+_0x33481a+(_0x2f0134||_0x4f6223);_0x176139[_0x23fca8(0x1f1)](_0x5d8f24,_0xff24af,_0x95ba2c,'end'),_0x176139[_0x23fca8(0x32a)]();}function updateEditorPreview(){const _0x7494a=_0x274cec,_0x3a5fd4=$(_0x7494a(0x1e0)),_0x1ba094=$(_0x7494a(0x1f5));if(!_0x3a5fd4||!_0x1ba094)return;const _0x5265d9=_0x3a5fd4[_0x7494a(0x260)]||'';_0x1ba094['innerHTML']=parseSimpleMarkdown(_0x5265d9);}function normalizeDataStructure(_0xfe74b5){const _0x9aac68=_0x274cec;if(!_0xfe74b5||typeof _0xfe74b5!==_0x9aac68(0x33a))return;const _0x216c75=_0xfe74b5[_0x9aac68(0x1e5)]||{},_0x2560fb={...defaults[_0x9aac68(0x1e5)],..._0x216c75,'durations':{...defaults[_0x9aac68(0x1e5)]['durations'],..._0x216c75[_0x9aac68(0x35d)]||{}}};if(!Array[_0x9aac68(0x458)](_0x2560fb[_0x9aac68(0x3c6)]))_0x2560fb[_0x9aac68(0x3c6)]=[];_0xfe74b5[_0x9aac68(0x1e5)]=_0x2560fb,_0xfe74b5[_0x9aac68(0x3c7)]=Array[_0x9aac68(0x458)](_0xfe74b5[_0x9aac68(0x3c7)])?_0xfe74b5[_0x9aac68(0x3c7)]:[],_0xfe74b5['topics'][_0x9aac68(0x432)](_0x46be04=>{const _0x5a6262=_0x9aac68;_0x46be04['subtopics']=Array[_0x5a6262(0x458)](_0x46be04[_0x5a6262(0x1b3)])?_0x46be04[_0x5a6262(0x1b3)]:[],_0x46be04[_0x5a6262(0x1b3)][_0x5a6262(0x432)](_0x1183d2=>{const _0x172832=_0x5a6262;_0x1183d2[_0x172832(0x1dc)]=_0x1183d2[_0x172832(0x1dc)]||[],_0x1183d2[_0x172832(0x417)]=_0x1183d2[_0x172832(0x417)]||[],_0x1183d2[_0x172832(0x277)]=_0x1183d2['summaries']||[],_0x1183d2[_0x172832(0x45f)]=_0x1183d2[_0x172832(0x45f)]||[],_0x1183d2[_0x172832(0x396)]=_0x1183d2[_0x172832(0x396)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x1183d2[_0x172832(0x31d)]=_0x1183d2[_0x172832(0x31d)]||[],_0x1183d2[_0x172832(0x416)]=_0x1183d2[_0x172832(0x416)]||{'state':'idle','prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x55024c){const _0x56f006=_0x274cec;if(!_0x55024c)return null;const _0x2b662c=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0x3717f7=_0x55024c[_0x56f006(0x34e)](_0x2b662c);return _0x3717f7?_0x3717f7[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x2ec28c=_0x274cec;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x2b0cf9=document[_0x2ec28c(0x35f)](_0x2ec28c(0x20e)),_0x421879=(_0x2b0cf9&&_0x2b0cf9[_0x2ec28c(0x260)]?_0x2b0cf9[_0x2ec28c(0x260)]:'')[_0x2ec28c(0x378)]();return _0x421879;}catch(_0x151284){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function handleYoutubeUrlInput(){const _0x2033a6=_0x274cec,_0x4e03ac=$(_0x2033a6(0x274)),_0x5ecc51=$(_0x2033a6(0x40b)),_0x3702f8=$(_0x2033a6(0x220)),_0x39ed41=_0x4e03ac[_0x2033a6(0x260)][_0x2033a6(0x378)](),_0x58411f=extractYouTubeID(_0x39ed41);if(_0x58411f){_0x5ecc51[_0x2033a6(0x42d)]=_0x2033a6(0x2d2),_0x5ecc51[_0x2033a6(0x364)][_0x2033a6(0x1b7)]=_0x2033a6(0x2f9),_0x3702f8[_0x2033a6(0x36f)]=![],sessionYoutubeUrl=_0x39ed41;try{ytUserPaused=![];}catch(_0x16852e){}try{const _0x3a3b7a=_0x2033a6(0x165)+_0x58411f+'/maxresdefault.jpg',_0x2536dd=new Image();_0x2536dd[_0x2033a6(0x45b)]=async()=>{const _0x3dac00=_0x2033a6;data['settings'][_0x3dac00(0x474)]=_0x3a3b7a;try{await saveData();}catch(_0xd76a61){}applyCustomBg();},_0x2536dd[_0x2033a6(0x22a)]=async()=>{const _0x2a51d3=_0x2033a6,_0x16cb85=_0x2a51d3(0x165)+_0x58411f+_0x2a51d3(0x3ab);data[_0x2a51d3(0x1e5)][_0x2a51d3(0x474)]=_0x16cb85;try{await saveData();}catch(_0x4ba00d){}applyCustomBg();},_0x2536dd[_0x2033a6(0x2b6)]=_0x3a3b7a;}catch(_0x292e72){}try{if(IS_FILE_PROTOCOL){const _0x5ba57b=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x58411f,{'autoplay':0x1,'mute':_0x5ba57b});try{setTimeout(()=>{try{fallbackPostMessage('playVideo');}catch(_0x4a87fd){}},0xfa);}catch(_0x5aca20){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0x39c7d2=_0x2033a6,_0x582c44=document[_0x39c7d2(0x35f)](_0x39c7d2(0x43e));if(_0x582c44)_0x582c44[_0x39c7d2(0x42d)]=_0x39c7d2(0x202);},0x1f4);}catch(_0xc85975){}}else ensureYouTubeAPI()[_0x2033a6(0x24e)](()=>{const _0x4abf34=_0x2033a6;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer['mute']&&ytPlayer['playVideo']&&(ytPlayer[_0x4abf34(0x3fc)](),ytPlayer[_0x4abf34(0x249)](),_ytPrimed=!![],showSoundPermission());}catch(_0x447416){}})[_0x2033a6(0x3f9)](()=>{});}catch(_0x3e8179){}}else{if(_0x39ed41===''){_0x5ecc51['textContent']='',_0x3702f8[_0x2033a6(0x36f)]=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x20b9ce){}else ytPlayer&&ytPlayer[_0x2033a6(0x178)]&&ytPlayer[_0x2033a6(0x178)]();}else _0x5ecc51[_0x2033a6(0x42d)]='❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.',_0x5ecc51[_0x2033a6(0x364)][_0x2033a6(0x1b7)]=_0x2033a6(0x263),_0x3702f8[_0x2033a6(0x36f)]=!![];}}function applyTheme(_0x366b5f){const _0x5f3bbf=_0x274cec,_0x4f9beb=_0x366b5f||data['settings'][_0x5f3bbf(0x2d8)]||'default';document[_0x5f3bbf(0x1e1)][_0x5f3bbf(0x3a0)][_0x5f3bbf(0x2d8)]=_0x4f9beb;const _0x3bae9f=[_0x5f3bbf(0x47e),_0x5f3bbf(0x2ea)][_0x5f3bbf(0x195)](_0x4f9beb),_0x34996e=_0x4f9beb===_0x5f3bbf(0x447)||_0x4f9beb==='pastel',_0x1b783e=data[_0x5f3bbf(0x1e5)]['customBg'],_0x17787b=()=>{const _0x2fbd88=_0x5f3bbf;try{document[_0x2fbd88(0x1e1)]['style'][_0x2fbd88(0x2e0)]='';}catch(_0x23e04e){}};if(_0x1b783e&&!data[_0x5f3bbf(0x1e5)][_0x5f3bbf(0x1c4)])document[_0x5f3bbf(0x1e1)][_0x5f3bbf(0x364)][_0x5f3bbf(0x399)]('--bg-image',_0x5f3bbf(0x3ff)+_0x1b783e+')'),_0x17787b();else{if(_0x1b783e&&data[_0x5f3bbf(0x1e5)]['useYtThumbnailAsBg'])document[_0x5f3bbf(0x1e1)]['style'][_0x5f3bbf(0x399)](_0x5f3bbf(0x259),_0x5f3bbf(0x3ff)+_0x1b783e+')'),_0x17787b();else{if(_0x3bae9f)document[_0x5f3bbf(0x1e1)][_0x5f3bbf(0x364)]['removeProperty'](_0x5f3bbf(0x259)),_0x17787b();else _0x34996e?(document[_0x5f3bbf(0x1e1)][_0x5f3bbf(0x364)][_0x5f3bbf(0x399)](_0x5f3bbf(0x259),_0x5f3bbf(0x1a4)),_0x17787b()):(document['body'][_0x5f3bbf(0x364)]['setProperty']('--bg-image',''),document[_0x5f3bbf(0x1e1)][_0x5f3bbf(0x364)][_0x5f3bbf(0x2e0)]=_0x5f3bbf(0x2c4));}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':_0x274cec(0x37c),'preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x274cec(0x443),'theme':_0x274cec(0x310),'cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x274cec(0x2df),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':'Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','content':_0x274cec(0x41d)},{'id':uid('m'),'title':_0x274cec(0x173),'content':_0x274cec(0x3c1)},{'id':uid('m'),'title':_0x274cec(0x2a4),'content':_0x274cec(0x1a8)},{'id':uid('m'),'title':_0x274cec(0x346),'content':_0x274cec(0x398)},{'id':uid('m'),'title':'Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','content':_0x274cec(0x2a1)}]},'topics':[]};let data,editingPreset='A',AUDIO_CTX=null;function ensureAudio(){const _0x2925dd=_0x274cec;if(!AUDIO_CTX)AUDIO_CTX=new(window[(_0x2925dd(0x281))]||window[(_0x2925dd(0x2ce))])();}function tone(_0x29b2e3=0x370,_0x92add1=0xc8,_0x1a7489=0.2,_0x4b6e0e=_0x274cec(0x233),_0x3dbf93=0x0){const _0x5eceda=_0x274cec;ensureAudio();const _0x77840b=AUDIO_CTX,_0xe39c7=_0x77840b[_0x5eceda(0x175)](),_0x2a7d0e=_0x77840b[_0x5eceda(0x2dc)]();_0xe39c7[_0x5eceda(0x2ad)]=_0x4b6e0e,_0xe39c7[_0x5eceda(0x181)][_0x5eceda(0x260)]=_0x29b2e3,_0xe39c7[_0x5eceda(0x299)](_0x2a7d0e),_0x2a7d0e[_0x5eceda(0x299)](_0x77840b['destination']);const _0x500e63=_0x77840b[_0x5eceda(0x415)]+_0x3dbf93;_0x2a7d0e[_0x5eceda(0x238)][_0x5eceda(0x1b5)](0x0,_0x500e63),_0x2a7d0e[_0x5eceda(0x238)][_0x5eceda(0x2ec)](_0x1a7489,_0x500e63+0.01),_0x2a7d0e['gain'][_0x5eceda(0x1be)](0.0001,_0x500e63+_0x92add1/0x3e8),_0xe39c7[_0x5eceda(0x403)](_0x500e63),_0xe39c7['stop'](_0x500e63+_0x92add1/0x3e8+0.05);}function playSound(_0x2d5dea){const _0x279dce=_0x274cec;if(!data[_0x279dce(0x1e5)][_0x279dce(0x430)])return;const _0x4cb86d=Math[_0x279dce(0x405)](0x0,Math[_0x279dce(0x3dc)](0x1,data[_0x279dce(0x1e5)][_0x279dce(0x235)]??0.8)),_0x30c9b7=data['settings'][_0x279dce(0x2d4)]?.[_0x2d5dea];let _0x381580;if(_0x2d5dea===_0x279dce(0x39b))_0x381580=$(_0x279dce(0x395));else{if(_0x2d5dea===_0x279dce(0x330))_0x381580=$(_0x279dce(0x1fe));else{if(_0x2d5dea===_0x279dce(0x1c6))_0x381580=$(_0x279dce(0x3d0));}}if(_0x30c9b7&&_0x381580){_0x30c9b7[_0x279dce(0x241)](_0x279dce(0x3c0))||_0x30c9b7['startsWith'](_0x279dce(0x3b3))||_0x30c9b7[_0x279dce(0x241)]('blob:')?(_0x381580[_0x279dce(0x2b6)]=_0x30c9b7,_0x381580[_0x279dce(0x235)]=_0x4cb86d,_0x381580[_0x279dce(0x3db)]()[_0x279dce(0x3f9)](_0x2e95b1=>console[_0x279dce(0x17c)](_0x279dce(0x33e),_0x2e95b1))):getStoredFileUrl(_0x30c9b7)[_0x279dce(0x24e)](_0x54c0aa=>{const _0x3f0105=_0x279dce;_0x54c0aa&&(_0x381580[_0x3f0105(0x2b6)]=_0x54c0aa,_0x381580['volume']=_0x4cb86d,_0x381580[_0x3f0105(0x3db)]()['catch'](_0x53313d=>console[_0x3f0105(0x17c)]('Lỗi\x20phát\x20âm\x20thanh:',_0x53313d)));});return;}const _0x16de0e=data[_0x279dce(0x1e5)][_0x279dce(0x35a)]||_0x279dce(0x443);if(_0x16de0e===_0x279dce(0x443)){if(_0x2d5dea===_0x279dce(0x39b))tone(0x370,0xfa,_0x4cb86d),tone(0x294,0xb4,_0x4cb86d*0.8,_0x279dce(0x233),0.22);else{if(_0x2d5dea===_0x279dce(0x330))tone(0x294,0xdc,_0x4cb86d*0.9);else _0x2d5dea===_0x279dce(0x1c6)&&(tone(0x208,0xc8,_0x4cb86d),tone(0x30c,0xc8,_0x4cb86d,_0x279dce(0x233),0.22),tone(0x410,0xdc,_0x4cb86d,'sine',0.44));}}else{if(_0x2d5dea===_0x279dce(0x39b))tone(0x4b0,0xa0,_0x4cb86d*0.9,_0x279dce(0x379)),tone(0x384,0xdc,_0x4cb86d*0.8,_0x279dce(0x379),0.18);else{if(_0x2d5dea===_0x279dce(0x330))tone(0x370,0xf0,_0x4cb86d*0.8,_0x279dce(0x379));else _0x2d5dea===_0x279dce(0x1c6)&&(tone(0x258,0xdc,_0x4cb86d*0.9,_0x279dce(0x379)),tone(0x3b6,0xf0,_0x4cb86d*0.9,_0x279dce(0x379),0.22),tone(0x4b0,0xf0,_0x4cb86d,_0x279dce(0x379),0.44));}}}async function saveData(){const _0x138368=_0x274cec;try{await storageManager[_0x138368(0x338)](data);}catch(_0x4974f7){console[_0x138368(0x17c)](_0x138368(0x380),_0x4974f7),toast(_0x138368(0x3e3)+_0x4974f7['message']);}}async function ensureValidSelection(){const _0x4fe59c=_0x274cec,_0x1dd14e=data[_0x4fe59c(0x1e5)];if(!data[_0x4fe59c(0x3c7)]||data['topics'][_0x4fe59c(0x27b)]===0x0){_0x1dd14e[_0x4fe59c(0x442)]='',_0x1dd14e[_0x4fe59c(0x47f)]='',await saveData();return;}const _0x259576=data['topics']['find'](_0x19cef0=>_0x19cef0['id']===_0x1dd14e[_0x4fe59c(0x442)]),_0xb762a3=_0x259576?.['subtopics'][_0x4fe59c(0x369)](_0xccd593=>_0xccd593['id']===_0x1dd14e[_0x4fe59c(0x47f)]);if(!_0x259576||!_0xb762a3){const _0x19c901=data['topics'][0x0],_0x208fbd=_0x19c901?.['subtopics']?.[0x0];_0x1dd14e[_0x4fe59c(0x442)]=_0x19c901?.['id']||'',_0x1dd14e[_0x4fe59c(0x47f)]=_0x208fbd?.['id']||'',await saveData();}}function showInputModal(_0x2fb2a3,_0x1aad89,_0x5d45f1=''){const _0x543111=_0x274cec;$(_0x543111(0x2fd))[_0x543111(0x42d)]=_0x2fb2a3,$('#genericMessage')[_0x543111(0x463)]['add'](_0x543111(0x219));const _0x268b11=$(_0x543111(0x401));_0x268b11[_0x543111(0x260)]=_0x5d45f1,_0x268b11['classList'][_0x543111(0x455)]('hidden'),$(_0x543111(0x2b1))[_0x543111(0x463)][_0x543111(0x406)]('show');try{trapFocus($(_0x543111(0x2b1)));}catch(_0xfcb08b){}_0x268b11[_0x543111(0x32a)](),_0x268b11['select']();const _0x38fff8=()=>{const _0x405461=_0x543111;_0x1aad89(_0x268b11[_0x405461(0x260)]),_0xc1b00b();},_0x2bcad3=()=>_0xc1b00b(),_0x1f4b25=_0x3efdd8=>{const _0x2257e4=_0x543111;if(_0x3efdd8[_0x2257e4(0x261)]===_0x2257e4(0x1e8))_0x38fff8();if(_0x3efdd8['key']===_0x2257e4(0x2bd))_0x2bcad3();};$(_0x543111(0x402))[_0x543111(0x317)]=_0x38fff8,$(_0x543111(0x18b))[_0x543111(0x317)]=_0x2bcad3,_0x268b11[_0x543111(0x419)]=_0x1f4b25;function _0xc1b00b(){const _0x148346=_0x543111;$(_0x148346(0x2b1))[_0x148346(0x463)][_0x148346(0x455)](_0x148346(0x212)),$(_0x148346(0x402))[_0x148346(0x317)]=null,$(_0x148346(0x18b))[_0x148346(0x317)]=null,_0x268b11['onkeydown']=null;try{releaseFocus();}catch(_0x5618cb){}}}function showConfirmModal(_0x2df16d,_0x10f6f6,_0x40cd16){const _0x275046=_0x274cec;$(_0x275046(0x2fd))[_0x275046(0x42d)]=_0x2df16d;const _0x3598c1=$(_0x275046(0x408));_0x3598c1[_0x275046(0x42d)]=_0x10f6f6,_0x3598c1[_0x275046(0x463)][_0x275046(0x455)](_0x275046(0x219)),$('#genericInput')[_0x275046(0x463)][_0x275046(0x406)](_0x275046(0x219)),$(_0x275046(0x2b1))[_0x275046(0x463)]['add']('show');try{trapFocus($(_0x275046(0x2b1)));}catch(_0x8fc0b8){}const _0x37c677=()=>{_0x40cd16(!![]),_0xc63318();},_0x2c19f5=()=>{_0x40cd16(![]),_0xc63318();};$(_0x275046(0x402))[_0x275046(0x317)]=_0x37c677,$('#btnGenericCancel')[_0x275046(0x317)]=_0x2c19f5;function _0xc63318(){const _0x40a6aa=_0x275046;$('#modalGeneric')[_0x40a6aa(0x463)][_0x40a6aa(0x455)]('show'),$(_0x40a6aa(0x402))[_0x40a6aa(0x317)]=null,$(_0x40a6aa(0x18b))[_0x40a6aa(0x317)]=null;try{releaseFocus();}catch(_0x2d10f4){}}}async function switchView(_0x2e4dc5){const _0x8df67d=_0x274cec;$$(_0x8df67d(0x39d))[_0x8df67d(0x432)](_0x530336=>_0x530336[_0x8df67d(0x463)]['remove'](_0x8df67d(0x2d5))),$('#view-'+_0x2e4dc5)[_0x8df67d(0x463)][_0x8df67d(0x406)]('active'),$$(_0x8df67d(0x462))['forEach'](_0x4c74fd=>_0x4c74fd[_0x8df67d(0x463)][_0x8df67d(0x455)](_0x8df67d(0x2d5)));const _0x3f79c9=$(_0x8df67d(0x2b5)+_0x2e4dc5+'\x22]');if(_0x3f79c9)_0x3f79c9[_0x8df67d(0x463)][_0x8df67d(0x406)]('active');data[_0x8df67d(0x1e5)][_0x8df67d(0x22e)]=_0x2e4dc5,await saveData(),_0x2e4dc5===_0x8df67d(0x396)&&renderDashboard();}function closeAllMenus(){const _0x54fa95=_0x274cec;$$(_0x54fa95(0x231))[_0x54fa95(0x432)](_0x5d28eb=>_0x5d28eb[_0x54fa95(0x463)][_0x54fa95(0x455)]('show'));}function renderTopics(){const _0x27b479=_0x274cec,_0x129f26=$(_0x27b479(0x1d4));if(!_0x129f26)return;_0x129f26[_0x27b479(0x37d)]='';const _0x12a6a4=data[_0x27b479(0x1e5)][_0x27b479(0x214)]||{};data[_0x27b479(0x3c7)][_0x27b479(0x432)](_0x439366=>{const _0x85c1f2=_0x27b479,_0xf76604=document['createElement'](_0x85c1f2(0x2b3));_0xf76604['className']=_0x85c1f2(0x23f),_0xf76604[_0x85c1f2(0x3a0)][_0x85c1f2(0x444)]=_0x439366['id'];const _0x1f853e=document[_0x85c1f2(0x179)](_0x85c1f2(0x2b3));_0x1f853e[_0x85c1f2(0x176)]='topic-header';const _0x2b2d82=!!_0x12a6a4[_0x439366['id']],_0x1b1d16=document[_0x85c1f2(0x179)](_0x85c1f2(0x43c));_0x1b1d16[_0x85c1f2(0x176)]=_0x85c1f2(0x1ef),_0x1b1d16[_0x85c1f2(0x287)](_0x85c1f2(0x184),String(!_0x2b2d82)),_0x1b1d16[_0x85c1f2(0x37d)]='<span\x20class=\x22ico\x22>▾</span>';const _0x1b59e3=document['createElement']('div');_0x1b59e3['className']=_0x85c1f2(0x42b),_0x1b59e3[_0x85c1f2(0x42d)]=_0x439366[_0x85c1f2(0x1c2)];const _0x3a5745=document['createElement'](_0x85c1f2(0x2b3));_0x3a5745[_0x85c1f2(0x176)]=_0x85c1f2(0x1b1);const _0x544eaa=document['createElement'](_0x85c1f2(0x43c));_0x544eaa[_0x85c1f2(0x176)]='btn\x20small',_0x544eaa['innerHTML']=_0x85c1f2(0x41b),_0x544eaa[_0x85c1f2(0x381)]=_0x85c1f2(0x312);const _0x1f35eb=document[_0x85c1f2(0x179)](_0x85c1f2(0x2b3));_0x1f35eb[_0x85c1f2(0x364)]['position']='relative';const _0x153a80=document[_0x85c1f2(0x179)](_0x85c1f2(0x43c));_0x153a80[_0x85c1f2(0x176)]=_0x85c1f2(0x17e),_0x153a80[_0x85c1f2(0x37d)]=_0x85c1f2(0x23e),_0x153a80[_0x85c1f2(0x381)]=_0x85c1f2(0x36a);const _0x10393c=document[_0x85c1f2(0x179)](_0x85c1f2(0x2b3));_0x10393c[_0x85c1f2(0x176)]=_0x85c1f2(0x25a);const _0x1a4a81=document[_0x85c1f2(0x179)](_0x85c1f2(0x43c));_0x1a4a81[_0x85c1f2(0x176)]=_0x85c1f2(0x360),_0x1a4a81[_0x85c1f2(0x37d)]=_0x85c1f2(0x41f);const _0x2cbf30=document[_0x85c1f2(0x179)](_0x85c1f2(0x43c));_0x2cbf30['className']=_0x85c1f2(0x3d2),_0x2cbf30[_0x85c1f2(0x37d)]='Xóa\x20Chủ\x20đề',_0x10393c[_0x85c1f2(0x20b)](_0x1a4a81,_0x2cbf30),_0x1f35eb['append'](_0x153a80,_0x10393c),_0x3a5745[_0x85c1f2(0x20b)](_0x544eaa,_0x1f35eb),_0x1f853e[_0x85c1f2(0x20b)](_0x1b1d16,_0x1b59e3,_0x3a5745),_0x1b1d16['addEventListener'](_0x85c1f2(0x27e),async _0x27d679=>{const _0x42c8ce=_0x85c1f2;_0x27d679['stopPropagation']();const _0x8d612=!!_0x12a6a4[_0x439366['id']];_0x8d612?delete _0x12a6a4[_0x439366['id']]:_0x12a6a4[_0x439366['id']]=!![],data[_0x42c8ce(0x1e5)][_0x42c8ce(0x214)]=_0x12a6a4,await storageManager[_0x42c8ce(0x34a)](data[_0x42c8ce(0x1e5)]),renderTopics();});const _0x463ba0=async()=>{const _0x46ed3c=_0x85c1f2,_0x944ede=!!_0x12a6a4[_0x439366['id']];_0x944ede?delete _0x12a6a4[_0x439366['id']]:_0x12a6a4[_0x439366['id']]=!![],data['settings'][_0x46ed3c(0x214)]=_0x12a6a4,await storageManager[_0x46ed3c(0x34a)](data[_0x46ed3c(0x1e5)]),renderTopics();};_0x1f853e[_0x85c1f2(0x36b)](_0x85c1f2(0x27e),async _0x19acbe=>{const _0x38cdff=_0x85c1f2,_0x52a7f4=_0x19acbe[_0x38cdff(0x479)];if(_0x52a7f4&&_0x52a7f4[_0x38cdff(0x371)]){if(_0x52a7f4['closest']('.actions-menu')||_0x52a7f4['closest'](_0x38cdff(0x28f))||_0x52a7f4['closest']('button')||_0x52a7f4['closest'](_0x38cdff(0x29b)))return;}_0x19acbe[_0x38cdff(0x382)](),await _0x463ba0();}),_0x1b59e3[_0x85c1f2(0x36b)]('click',async _0x48e653=>{const _0x2da7b1=_0x85c1f2;_0x48e653[_0x2da7b1(0x382)](),await _0x463ba0();}),_0xf76604[_0x85c1f2(0x36b)](_0x85c1f2(0x27e),async _0x33030b=>{const _0x766db2=_0x85c1f2,_0x262baa=_0x33030b[_0x766db2(0x479)];if(_0x262baa&&_0x262baa[_0x766db2(0x371)]){if(_0x262baa[_0x766db2(0x371)]('.subtopics'))return;if(_0x262baa[_0x766db2(0x371)](_0x766db2(0x24f))||_0x262baa[_0x766db2(0x371)](_0x766db2(0x28f))||_0x262baa[_0x766db2(0x371)](_0x766db2(0x43c))||_0x262baa[_0x766db2(0x371)](_0x766db2(0x29b)))return;}await _0x463ba0();});const _0xcca465=document['createElement'](_0x85c1f2(0x2b3));_0xcca465[_0x85c1f2(0x176)]=_0x85c1f2(0x1b3)+(_0x2b2d82?_0x85c1f2(0x411):''),_0xcca465[_0x85c1f2(0x3a0)]['tid']=_0x439366['id'],_0x439366['subtopics'][_0x85c1f2(0x432)](_0x4d2b96=>{const _0x5585a8=_0x85c1f2,_0x33477f=document['createElement'](_0x5585a8(0x2b3));_0x33477f[_0x5585a8(0x176)]=_0x5585a8(0x246),_0x33477f['dataset'][_0x5585a8(0x3ca)]=_0x4d2b96['id'];const _0x339653=document[_0x5585a8(0x179)](_0x5585a8(0x43c));_0x339653[_0x5585a8(0x176)]=_0x5585a8(0x3aa),_0x339653[_0x5585a8(0x42d)]='•\x20'+_0x4d2b96['name'],_0x339653[_0x5585a8(0x3a0)][_0x5585a8(0x3ca)]=_0x4d2b96['id'],_0x339653[_0x5585a8(0x3a0)][_0x5585a8(0x444)]=_0x439366['id'];if(data[_0x5585a8(0x1e5)][_0x5585a8(0x47f)]===_0x4d2b96['id'])_0x339653[_0x5585a8(0x463)][_0x5585a8(0x406)](_0x5585a8(0x2d5));const _0x448ef8=document[_0x5585a8(0x179)]('div');_0x448ef8[_0x5585a8(0x176)]=_0x5585a8(0x332);const _0xa624a2=document[_0x5585a8(0x179)]('div');_0xa624a2[_0x5585a8(0x364)]['position']=_0x5585a8(0x230);const _0x19a44f=document['createElement'](_0x5585a8(0x43c));_0x19a44f[_0x5585a8(0x176)]='btn\x20small\x20ghost\x20actions-menu-btn',_0x19a44f['innerHTML']=_0x5585a8(0x23e),_0x19a44f['title']='Thêm\x20tùy\x20chọn';const _0x2c9460=document[_0x5585a8(0x179)]('div');_0x2c9460['className']='actions-menu';const _0x4ce35c=document['createElement']('button');_0x4ce35c[_0x5585a8(0x176)]=_0x5585a8(0x360),_0x4ce35c[_0x5585a8(0x37d)]=_0x5585a8(0x189);const _0x556521=document[_0x5585a8(0x179)](_0x5585a8(0x43c));_0x556521[_0x5585a8(0x176)]='menu-item\x20danger',_0x556521[_0x5585a8(0x37d)]=_0x5585a8(0x2da),_0x2c9460[_0x5585a8(0x20b)](_0x4ce35c,_0x556521),_0xa624a2[_0x5585a8(0x20b)](_0x19a44f,_0x2c9460),_0x448ef8[_0x5585a8(0x20b)](_0xa624a2),_0x33477f[_0x5585a8(0x20b)](_0x339653,_0x448ef8),_0xcca465['appendChild'](_0x33477f),_0x339653[_0x5585a8(0x36b)]('click',()=>selectSubtopic(_0x439366['id'],_0x4d2b96['id'])),_0x19a44f[_0x5585a8(0x36b)](_0x5585a8(0x27e),_0x11ce34=>{const _0x372afb=_0x5585a8;_0x11ce34[_0x372afb(0x382)](),closeAllMenus(),_0x2c9460[_0x372afb(0x463)][_0x372afb(0x1bd)]('show');}),_0x4ce35c[_0x5585a8(0x36b)](_0x5585a8(0x27e),()=>showInputModal(_0x5585a8(0x2c9),async _0x588995=>{const _0x5ddea6=_0x5585a8;if(!_0x588995)return;_0x4d2b96[_0x5ddea6(0x1c2)]=_0x588995,await storageManager['update'](_0x5ddea6(0x1b3),_0x4d2b96),renderAll();},_0x4d2b96[_0x5585a8(0x1c2)])),_0x556521[_0x5585a8(0x36b)](_0x5585a8(0x27e),()=>showConfirmModal(_0x5585a8(0x356),'Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22'+_0x4d2b96[_0x5585a8(0x1c2)]+_0x5585a8(0x2a0),async _0x2b0512=>{const _0xcc9753=_0x5585a8;if(!_0x2b0512)return;_0x439366['subtopics']=_0x439366[_0xcc9753(0x1b3)][_0xcc9753(0x46f)](_0x15ec17=>_0x15ec17['id']!==_0x4d2b96['id']);const _0x192cac=data[_0xcc9753(0x1e5)];_0x192cac[_0xcc9753(0x47f)]===_0x4d2b96['id']&&(_0x192cac[_0xcc9753(0x47f)]='',_0x192cac[_0xcc9753(0x442)]='',ensureValidSelection()),await storageManager[_0xcc9753(0x1c9)](_0xcc9753(0x1b3),_0x4d2b96['id']),renderAll();}));}),_0x153a80['addEventListener']('click',_0x1965db=>{const _0x454397=_0x85c1f2;_0x1965db[_0x454397(0x382)](),closeAllMenus(),_0x10393c['classList'][_0x454397(0x1bd)](_0x454397(0x212));}),_0x544eaa['addEventListener'](_0x85c1f2(0x27e),()=>showInputModal('Tên\x20Chủ\x20đề\x20con\x20mới?',async _0x1db5ca=>{const _0x1d63b8=_0x85c1f2;if(!_0x1db5ca)return;const _0x379482={'id':uid('s'),'topicId':_0x439366['id'],'name':_0x1db5ca,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':_0x1d63b8(0x400),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x439366[_0x1d63b8(0x1b3)][_0x1d63b8(0x3b2)](_0x379482),await storageManager[_0x1d63b8(0x406)](_0x1d63b8(0x1b3),_0x379482),renderTopics();})),_0x1a4a81[_0x85c1f2(0x36b)]('click',()=>showInputModal(_0x85c1f2(0x46c),async _0x355384=>{const _0x5dcaa9=_0x85c1f2;if(!_0x355384)return;_0x439366[_0x5dcaa9(0x1c2)]=_0x355384,await storageManager[_0x5dcaa9(0x3b5)](_0x5dcaa9(0x3c7),_0x439366),renderTopics();},_0x439366['name'])),_0x2cbf30[_0x85c1f2(0x36b)]('click',()=>showConfirmModal(_0x85c1f2(0x356),_0x85c1f2(0x471)+_0x439366['name']+_0x85c1f2(0x314),async _0x5aa0b8=>{const _0x33cab7=_0x85c1f2;if(!_0x5aa0b8)return;data[_0x33cab7(0x3c7)]=data[_0x33cab7(0x3c7)]['filter'](_0x10fcbd=>_0x10fcbd['id']!==_0x439366['id']),delete _0x12a6a4[_0x439366['id']];data[_0x33cab7(0x1e5)][_0x33cab7(0x442)]===_0x439366['id']&&(data[_0x33cab7(0x1e5)][_0x33cab7(0x442)]='',data[_0x33cab7(0x1e5)][_0x33cab7(0x47f)]='',ensureValidSelection());await storageManager['delete']('topics',_0x439366['id']);for(const _0x2fff85 of _0x439366['subtopics']){await storageManager['delete'](_0x33cab7(0x1b3),_0x2fff85['id']);}renderAll();})),_0x544eaa[_0x85c1f2(0x36b)](_0x85c1f2(0x27e),_0x347b96=>_0x347b96[_0x85c1f2(0x382)]()),_0x1a4a81['addEventListener'](_0x85c1f2(0x27e),_0x21c0c6=>_0x21c0c6[_0x85c1f2(0x382)]()),_0x2cbf30['addEventListener'](_0x85c1f2(0x27e),_0x5b3c95=>_0x5b3c95[_0x85c1f2(0x382)]()),_0xf76604[_0x85c1f2(0x20b)](_0x1f853e,_0xcca465),_0x129f26[_0x85c1f2(0x234)](_0xf76604);});if(window[_0x27b479(0x374)]){const _0x27e232=document[_0x27b479(0x35f)](_0x27b479(0x2ab));if(_0x27e232){if(_0x27e232['_sortable'])try{_0x27e232[_0x27b479(0x2e4)][_0x27b479(0x2e8)]();}catch(_0x22d6de){}_0x27e232[_0x27b479(0x2e4)]=new Sortable(_0x27e232,{'animation':0x96,'draggable':_0x27b479(0x3ed),'onEnd':async function(_0x39b5f8){const _0x570d87=_0x27b479;if(_0x39b5f8[_0x570d87(0x38e)]===_0x39b5f8['newIndex'])return;const _0x2cd3b6=data['topics'][_0x570d87(0x1c0)](_0x39b5f8[_0x570d87(0x38e)],0x1)[0x0];data[_0x570d87(0x3c7)][_0x570d87(0x1c0)](_0x39b5f8[_0x570d87(0x21e)],0x0,_0x2cd3b6),await saveData(),renderTopics();}}),_0x27e232['querySelectorAll']('.subtopics')[_0x27b479(0x432)](_0x25140a=>{const _0x3493c0=_0x27b479;new Sortable(_0x25140a,{'group':_0x3493c0(0x341),'animation':0x96,'draggable':_0x3493c0(0x1a7),'onEnd':async function(_0x1f928a){const _0x401953=_0x3493c0,_0x527eb2=_0x1f928a[_0x401953(0x3a1)]?.[_0x401953(0x3a0)]?.[_0x401953(0x444)]||_0x1f928a[_0x401953(0x3a1)]?.[_0x401953(0x371)]('.topic-item')?.[_0x401953(0x3a0)]?.[_0x401953(0x444)],_0x4a78c2=_0x1f928a['to']?.[_0x401953(0x3a0)]?.[_0x401953(0x444)]||_0x1f928a['to']?.[_0x401953(0x371)](_0x401953(0x3ed))?.[_0x401953(0x3a0)]?.[_0x401953(0x444)],_0x381a5d=data[_0x401953(0x3c7)][_0x401953(0x369)](_0x3139cd=>_0x3139cd['id']===_0x527eb2),_0x5aa29f=data[_0x401953(0x3c7)][_0x401953(0x369)](_0x35bb54=>_0x35bb54['id']===_0x4a78c2);if(!_0x381a5d||!_0x5aa29f)return;let _0x2b9863=null;const _0x418d25=_0x1f928a[_0x401953(0x3fd)]?.[_0x401953(0x3a0)]?.[_0x401953(0x3ca)]||_0x1f928a[_0x401953(0x3fd)]?.[_0x401953(0x308)](_0x401953(0x349))?.[_0x401953(0x3a0)]?.[_0x401953(0x3ca)];if(_0x418d25){const _0x419181=_0x381a5d[_0x401953(0x1b3)][_0x401953(0x2a9)](_0x338f85=>_0x338f85['id']===_0x418d25);if(_0x419181>=0x0)_0x2b9863=_0x381a5d[_0x401953(0x1b3)][_0x401953(0x1c0)](_0x419181,0x1)[0x0];}!_0x2b9863&&(_0x2b9863=_0x381a5d[_0x401953(0x1b3)][_0x401953(0x1c0)](_0x1f928a[_0x401953(0x38e)],0x1)[0x0]);if(!_0x2b9863)return;_0x2b9863['topicId']=_0x5aa29f['id'],_0x5aa29f[_0x401953(0x1b3)][_0x401953(0x1c0)](_0x1f928a[_0x401953(0x21e)],0x0,_0x2b9863),data[_0x401953(0x1e5)][_0x401953(0x47f)]===_0x2b9863['id']&&(data[_0x401953(0x1e5)][_0x401953(0x442)]=_0x5aa29f['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x11d083,_0x35e113){const _0x21ccce=_0x274cec,_0x22bc49=$(_0x21ccce(0x1bf)),_0x5b4402=getCurrentSubtopic();_0x5b4402&&timer['state']!==_0x21ccce(0x400)&&(_0x5b4402['timerState']={'state':timer['state'],'prevState':timer[_0x21ccce(0x34c)],'remaining':timer[_0x21ccce(0x290)],'segmentTotal':timer[_0x21ccce(0x221)],'cycleIndex':timer[_0x21ccce(0x239)]}),_0x22bc49[_0x21ccce(0x463)][_0x21ccce(0x406)](_0x21ccce(0x3f1)),setTimeout(async()=>{const _0x4aa3d3=_0x21ccce;data['settings'][_0x4aa3d3(0x442)]=_0x11d083,data[_0x4aa3d3(0x1e5)][_0x4aa3d3(0x47f)]=_0x35e113;const _0x4edef9=getCurrentSubtopic();_0x4edef9['timerState']?(timer[_0x4aa3d3(0x3e4)]=_0x4edef9[_0x4aa3d3(0x416)]['state'],timer[_0x4aa3d3(0x34c)]=_0x4edef9[_0x4aa3d3(0x416)]['prevState']||null,timer[_0x4aa3d3(0x290)]=_0x4edef9['timerState'][_0x4aa3d3(0x290)],timer[_0x4aa3d3(0x221)]=_0x4edef9[_0x4aa3d3(0x416)][_0x4aa3d3(0x221)],timer[_0x4aa3d3(0x239)]=_0x4edef9[_0x4aa3d3(0x416)][_0x4aa3d3(0x239)]):timer[_0x4aa3d3(0x2ed)](),await saveData(),timer[_0x4aa3d3(0x29c)](),renderAll(),switchView(_0x4aa3d3(0x37c)),_0x22bc49[_0x4aa3d3(0x463)][_0x4aa3d3(0x455)](_0x4aa3d3(0x3f1));},0xc8);}function getCurrentSubtopic(){const _0x1b2cc5=_0x274cec,_0x25a8ef=data[_0x1b2cc5(0x1e5)][_0x1b2cc5(0x442)],_0x155d1a=data[_0x1b2cc5(0x1e5)][_0x1b2cc5(0x47f)];if(!_0x25a8ef||!_0x155d1a)return null;const _0x322412=data[_0x1b2cc5(0x3c7)][_0x1b2cc5(0x369)](_0x481f5a=>_0x481f5a['id']===_0x25a8ef);if(!_0x322412)return null;return _0x322412[_0x1b2cc5(0x1b3)][_0x1b2cc5(0x369)](_0x28a4ac=>_0x28a4ac['id']===_0x155d1a)||null;}function renderContextBadge(){const _0x2bf5fa=_0x274cec,_0x3e047f=getCurrentSubtopic(),_0x264f26=_0x3e047f?_0x3e047f[_0x2bf5fa(0x1c2)]:_0x2bf5fa(0x226),_0x4fc894=$(_0x2bf5fa(0x183)),_0x32f977=$(_0x2bf5fa(0x1cf)),_0x12e976=$(_0x2bf5fa(0x386));if(_0x4fc894)_0x4fc894[_0x2bf5fa(0x42d)]=_0x3e047f?_0x2bf5fa(0x25f)+_0x3e047f[_0x2bf5fa(0x1c2)]:_0x2bf5fa(0x30a);if(_0x32f977)_0x32f977['textContent']=_0x264f26;if(_0x12e976)_0x12e976[_0x2bf5fa(0x42d)]=_0x264f26;}function renderSubtopicTasks(){const _0x5cafe0=_0x274cec,_0x24390e=getCurrentSubtopic(),_0x2d5952=$(_0x5cafe0(0x25d)),_0x447798=$(_0x5cafe0(0x481));if(!_0x2d5952||!_0x447798)return;const _0x14c1b9=_0x447798[_0x5cafe0(0x390)];if(!_0x24390e){_0x2d5952[_0x5cafe0(0x37d)]='<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>',_0x14c1b9[_0x5cafe0(0x463)]['add'](_0x5cafe0(0x219));return;}_0x14c1b9['classList'][_0x5cafe0(0x455)](_0x5cafe0(0x219)),_0x2d5952[_0x5cafe0(0x37d)]='';const _0x438659=_0x24390e[_0x5cafe0(0x1dc)]?_0x24390e['tasks'][_0x5cafe0(0x46f)](_0x1f7aff=>!_0x1f7aff[_0x5cafe0(0x45c)]):[];_0x438659[_0x5cafe0(0x27b)]===0x0&&(_0x2d5952[_0x5cafe0(0x37d)]='<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>'),_0x438659[_0x5cafe0(0x432)](_0xf96409=>{const _0x2064e8=_0x5cafe0,_0x573b58=document[_0x2064e8(0x179)]('li');_0x573b58[_0x2064e8(0x37d)]='<input\x20type=\x22checkbox\x22\x20id=\x22'+_0xf96409['id']+_0x2064e8(0x2b7)+_0xf96409['id']+'\x22>'+escapeHTML(_0xf96409[_0x2064e8(0x18f)])+_0x2064e8(0x2f4),_0x573b58[_0x2064e8(0x308)]('input')[_0x2064e8(0x36b)](_0x2064e8(0x253),_0x5d7ded=>toggleSubtopicTask(_0x5d7ded[_0x2064e8(0x479)]['id'],_0x573b58)),_0x2d5952['appendChild'](_0x573b58);});}async function addSubtopicTask(){const _0x5290bb=_0x274cec,_0xbef3b0=getCurrentSubtopic();if(!_0xbef3b0){toast(t(_0x5290bb(0x464)));return;}const _0x2de719=$(_0x5290bb(0x481)),_0x352ce1=_0x2de719[_0x5290bb(0x260)][_0x5290bb(0x378)]();if(_0x352ce1){if(!_0xbef3b0['tasks'])_0xbef3b0[_0x5290bb(0x1dc)]=[];_0xbef3b0[_0x5290bb(0x1dc)][_0x5290bb(0x3b2)]({'id':uid(_0x5290bb(0x316)),'text':_0x352ce1,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x2de719['value']='';}_0x2de719[_0x5290bb(0x32a)]();}async function toggleSubtopicTask(_0xd12312,_0x111c79){const _0x5924d2=_0x274cec,_0x3aeb44=getCurrentSubtopic();if(!_0x3aeb44||!_0x3aeb44[_0x5924d2(0x1dc)])return;const _0xd7b79d=_0x3aeb44[_0x5924d2(0x1dc)]['find'](_0xb9d998=>_0xb9d998['id']===_0xd12312);_0xd7b79d&&(_0xd7b79d[_0x5924d2(0x45c)]=!![],_0x3aeb44[_0x5924d2(0x396)][_0x5924d2(0x43f)]=(_0x3aeb44[_0x5924d2(0x396)][_0x5924d2(0x43f)]||0x0)+0x1,await saveData(),_0x111c79['classList'][_0x5924d2(0x406)](_0x5924d2(0x224)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':_0x274cec(0x400),'prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0x46b5bc,{silent:silent=![]}={}){const _0x6e5620=_0x274cec,_0x288b8d=data[_0x6e5620(0x1e5)];this[_0x6e5620(0x1f4)]=_0x46b5bc,this['cyclesTarget']=_0x46b5bc==='A'?_0x288b8d['cyclesA']:_0x46b5bc==='B'?_0x288b8d['cyclesB']:0x0,_0x288b8d['preset']=_0x46b5bc,await saveData(),this[_0x6e5620(0x3e4)]===_0x6e5620(0x400)&&this['reset']();},'currentDurations'(){const _0x35b29a=_0x274cec,_0x56ee8a=data['settings'][_0x35b29a(0x35d)];if(this[_0x35b29a(0x1f4)]==='A')return{'work':_0x56ee8a['A_work'],'short':_0x56ee8a['A_short'],'long':_0x56ee8a[_0x35b29a(0x26d)],'winddown':_0x56ee8a[_0x35b29a(0x38c)]??0x0};if(this[_0x35b29a(0x1f4)]==='B')return{'work':_0x56ee8a[_0x35b29a(0x453)],'short':_0x56ee8a['B_short'],'long':_0x56ee8a['B_long'],'winddown':_0x56ee8a[_0x35b29a(0x200)]??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x3a9d74=_0x274cec,_0x2d3888=data[_0x3a9d74(0x1e5)];if(this[_0x3a9d74(0x1f4)]==='A')return{'cycles':_0x2d3888[_0x3a9d74(0x291)],'interval':_0x2d3888['longBreakIntervalA']};if(this['mode']==='B')return{'cycles':_0x2d3888[_0x3a9d74(0x21f)],'interval':_0x2d3888[_0x3a9d74(0x35b)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x2f563d=_0x274cec,_0x58e771=$(_0x2f563d(0x3d5)),_0x1d3f5e=$(_0x2f563d(0x257)),_0x5b86bb=$(_0x2f563d(0x1ad));if(!_0x58e771||!_0x1d3f5e||!_0x5b86bb)return;const _0x41938d=this[_0x2f563d(0x1f4)]==='C';$(_0x2f563d(0x3f2))[_0x2f563d(0x463)][_0x2f563d(0x1bd)](_0x2f563d(0x219),this[_0x2f563d(0x3e4)]!=='idle'||_0x41938d&&this[_0x2f563d(0x3e4)]===_0x2f563d(0x40f)),$(_0x2f563d(0x3a5))[_0x2f563d(0x463)][_0x2f563d(0x1bd)](_0x2f563d(0x219),!(_0x41938d&&this['state']===_0x2f563d(0x40f))),$(_0x2f563d(0x334))[_0x2f563d(0x463)][_0x2f563d(0x1bd)](_0x2f563d(0x219),![_0x2f563d(0x40f),_0x2f563d(0x19d),_0x2f563d(0x1da)][_0x2f563d(0x195)](this[_0x2f563d(0x3e4)])),$('#btnResume')['classList'][_0x2f563d(0x1bd)]('hidden',this[_0x2f563d(0x3e4)]!==_0x2f563d(0x294));let _0x1d280b='var(--muted)';if(this[_0x2f563d(0x3e4)]===_0x2f563d(0x40f))_0x58e771[_0x2f563d(0x42d)]=_0x41938d?_0x2f563d(0x32c):_0x2f563d(0x472),_0x58e771['className']=_0x2f563d(0x3e1),_0x1d280b='var(--acc)';else{if(this['state']==='break')_0x58e771[_0x2f563d(0x42d)]='NGHỈ\x20NGẮN',_0x58e771['className']='badge\x20state\x20break',_0x1d280b=_0x2f563d(0x477);else{if(this[_0x2f563d(0x3e4)]===_0x2f563d(0x1da))_0x58e771['textContent']=_0x2f563d(0x2dd),_0x58e771[_0x2f563d(0x176)]=_0x2f563d(0x298),_0x1d280b=_0x2f563d(0x263);else{if(this[_0x2f563d(0x3e4)]===_0x2f563d(0x3c2)){_0x58e771['textContent']=_0x2f563d(0x20c),_0x58e771[_0x2f563d(0x176)]=_0x2f563d(0x3e1),_0x1d280b=_0x2f563d(0x2f9);try{$(_0x2f563d(0x244))[_0x2f563d(0x463)][_0x2f563d(0x455)](_0x2f563d(0x219)),$(_0x2f563d(0x337))[_0x2f563d(0x463)][_0x2f563d(0x455)](_0x2f563d(0x219));}catch(_0xd7d9af){}}else this['state']==='paused'?(_0x58e771['textContent']=_0x2f563d(0x422),_0x58e771[_0x2f563d(0x176)]=_0x2f563d(0x457)):(_0x58e771[_0x2f563d(0x42d)]=_0x2f563d(0x2c5),_0x58e771['className']=_0x2f563d(0x457));}}}[_0x2f563d(0x40f),_0x2f563d(0x19d),_0x2f563d(0x1da),_0x2f563d(0x3c2)][_0x2f563d(0x195)](this[_0x2f563d(0x3e4)])?_0x5b86bb['classList'][_0x2f563d(0x406)](_0x2f563d(0x1dd)):_0x5b86bb[_0x2f563d(0x463)][_0x2f563d(0x455)](_0x2f563d(0x1dd));_0x1d3f5e[_0x2f563d(0x364)][_0x2f563d(0x256)]=_0x1d280b,_0x5b86bb['classList']['remove'](_0x2f563d(0x1b4));const _0x2dd832=$('#timeDisplay');if(_0x2dd832)_0x2dd832['textContent']=formatMMSS(this['remaining']);const _0xd0d56e=_0x1d3f5e['r']['baseVal'][_0x2f563d(0x260)],_0x2df2f9=0x2*Math['PI']*_0xd0d56e,_0x2810c4=this[_0x2f563d(0x221)]>0x0?_0x2df2f9-this[_0x2f563d(0x290)]/this[_0x2f563d(0x221)]*_0x2df2f9:_0x2df2f9;_0x1d3f5e[_0x2f563d(0x364)]['strokeDasharray']=_0x2df2f9,_0x1d3f5e[_0x2f563d(0x364)]['strokeDashoffset']=isNaN(_0x2810c4)?_0x2df2f9:_0x2810c4;const _0x415f03=$(_0x2f563d(0x3ad));if(_0x415f03){const _0x2bd2fc=this['currentConfig']();_0x415f03[_0x2f563d(0x42d)]=t(_0x2f563d(0x278),{'current':this['cycleIndex'],'target':_0x2bd2fc[_0x2f563d(0x45e)]}),_0x415f03[_0x2f563d(0x463)][_0x2f563d(0x1bd)]('hidden',_0x41938d);}const _0x4ca734=$('#breakSuggestionDisplay');_0x4ca734&&_0x4ca734[_0x2f563d(0x463)][_0x2f563d(0x1bd)](_0x2f563d(0x219),_0x41938d&&this[_0x2f563d(0x3e4)]==='work');const _0x4ecc6c=$(_0x2f563d(0x36c));if(_0x4ecc6c)_0x4ecc6c[_0x2f563d(0x42d)]=formatMMSS(this['remaining']);if(this[_0x2f563d(0x3e4)]!==_0x2f563d(0x3c2))try{$(_0x2f563d(0x244))['classList'][_0x2f563d(0x406)](_0x2f563d(0x219)),$(_0x2f563d(0x337))[_0x2f563d(0x463)][_0x2f563d(0x406)](_0x2f563d(0x219));}catch(_0x4e9933){}},'persistTimerState'(_0x5ece7b=![]){const _0x2270f7=_0x274cec;try{const _0x576545=getCurrentSubtopic();if(!_0x576545)return;const _0x54c5ae={'state':this[_0x2270f7(0x3e4)],'prevState':this[_0x2270f7(0x34c)],'remaining':this['remaining'],'segmentTotal':this[_0x2270f7(0x221)],'cycleIndex':this[_0x2270f7(0x239)]};_0x576545[_0x2270f7(0x416)]=_0x54c5ae;try{localStorage[_0x2270f7(0x46b)](_0x2270f7(0x28b)+_0x576545['id'],JSON['stringify'](_0x54c5ae));}catch(_0x562075){}this[_0x2270f7(0x445)]=Date[_0x2270f7(0x307)]();}catch(_0x2c51bd){}},'_startTick'(){const _0x23c116=_0x274cec;if(this[_0x23c116(0x216)])clearInterval(this[_0x23c116(0x216)]);if(this[_0x23c116(0x1f4)]==='C'&&this[_0x23c116(0x3e4)]===_0x23c116(0x40f)){this['tickHandle']=setInterval(()=>{const _0x3189aa=_0x23c116;this[_0x3189aa(0x290)]+=0x1,this[_0x3189aa(0x29c)](),this[_0x3189aa(0x1ab)]();},0x3e8);return;}this[_0x23c116(0x216)]=setInterval(()=>{const _0x45191=_0x23c116;this['remaining']>0x0&&(this[_0x45191(0x290)]-=0x1,this[_0x45191(0x29c)](),this[_0x45191(0x1ab)]()),this[_0x45191(0x290)]<=0x0&&(clearInterval(this[_0x45191(0x216)]),this[_0x45191(0x216)]=null,this[_0x45191(0x26f)]());},0x3e8);},'_onFinishSegment'(){const _0x3965c5=_0x274cec;if(this[_0x3965c5(0x3e4)]===_0x3965c5(0x40f)){const _0x2b2db0=getCurrentSubtopic();if(_0x2b2db0){const _0x2922e2=this[_0x3965c5(0x2fb)]()['work'];_0x2b2db0['stats'][_0x3965c5(0x24a)]=(_0x2b2db0[_0x3965c5(0x396)][_0x3965c5(0x24a)]||0x0)+_0x2922e2,_0x2b2db0['stats'][_0x3965c5(0x30b)]=(_0x2b2db0[_0x3965c5(0x396)][_0x3965c5(0x30b)]||0x0)+0x1;const _0xc8e914={'id':uid(_0x3965c5(0x167)),'dateISO':todayISO(),'durationMinutes':_0x2922e2,'mode':this[_0x3965c5(0x1f4)],'note':''};if(!_0x2b2db0[_0x3965c5(0x31d)])_0x2b2db0['sessions']=[];_0x2b2db0['sessions'][_0x3965c5(0x325)](_0xc8e914),saveData(),renderStatsHistory(),checkAndShowMilestones();}this[_0x3965c5(0x239)]++;}if(typeof data!==_0x3965c5(0x3da)&&data&&data[_0x3965c5(0x1e5)]&&data[_0x3965c5(0x1e5)][_0x3965c5(0x384)]===![]&&this[_0x3965c5(0x3e4)]===_0x3965c5(0x40f))playSound(_0x3965c5(0x39b));else(this[_0x3965c5(0x3e4)]==='wind_down'||this[_0x3965c5(0x3e4)]==='break'||this[_0x3965c5(0x3e4)]===_0x3965c5(0x1da))&&playSound('break_end');const _0x39d249=$(_0x3965c5(0x1ad));if(_0x39d249)_0x39d249['classList']['add'](_0x3965c5(0x1b4));if(data[_0x3965c5(0x1e5)][_0x3965c5(0x375)]){if(this[_0x3965c5(0x3e4)]===_0x3965c5(0x40f))data[_0x3965c5(0x1e5)]['enableWinddown']===![]?this[_0x3965c5(0x2c6)]():this[_0x3965c5(0x302)]();else this[_0x3965c5(0x3e4)]===_0x3965c5(0x3c2)?this[_0x3965c5(0x2c6)]():this[_0x3965c5(0x1d5)]();}else this[_0x3965c5(0x216)]&&(clearInterval(this[_0x3965c5(0x216)]),this['tickHandle']=null),this[_0x3965c5(0x3e4)]=_0x3965c5(0x400),this['prevState']=null,this[_0x3965c5(0x29c)](),toast('Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.');},'beginWindDown'(){const _0x285244=_0x274cec;if(data?.[_0x285244(0x1e5)]?.[_0x285244(0x384)]===![]){this[_0x285244(0x2c6)]();return;}this[_0x285244(0x34c)]=this[_0x285244(0x3e4)],this[_0x285244(0x3e4)]=_0x285244(0x3c2);const _0x659060=(this[_0x285244(0x2fb)]()[_0x285244(0x29d)]||0x0)*0x3c;if(_0x659060<=0x0){this[_0x285244(0x2c6)]();return;}this['segmentTotal']=_0x659060,this[_0x285244(0x290)]=_0x659060;try{playSound(_0x285244(0x330));}catch(_0x39ee20){}try{toast('Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.');}catch(_0x5a232a){}this[_0x285244(0x335)](),this[_0x285244(0x29c)]();},'beginWork'(){const _0x6b3ec5=_0x274cec;this[_0x6b3ec5(0x34c)]=this[_0x6b3ec5(0x3e4)],this[_0x6b3ec5(0x3e4)]=_0x6b3ec5(0x40f);if(this[_0x6b3ec5(0x1f4)]==='C'){this[_0x6b3ec5(0x221)]=0x0;if(this[_0x6b3ec5(0x34c)]!==_0x6b3ec5(0x294))this[_0x6b3ec5(0x290)]=0x0;}else{const _0x32b139=this[_0x6b3ec5(0x2fb)]()['work']*0x3c;this['segmentTotal']=_0x32b139;if(this[_0x6b3ec5(0x34c)]!==_0x6b3ec5(0x294))this[_0x6b3ec5(0x290)]=_0x32b139;}const _0x1b7576=$(_0x6b3ec5(0x24b));_0x1b7576&&(_0x1b7576['textContent']=''),this[_0x6b3ec5(0x335)](),this[_0x6b3ec5(0x29c)]();},'finishFlowSession'(){const _0x277dd3=_0x274cec;if(this[_0x277dd3(0x1f4)]!=='C'||this[_0x277dd3(0x3e4)]!==_0x277dd3(0x40f))return;this[_0x277dd3(0x216)]&&(clearInterval(this[_0x277dd3(0x216)]),this[_0x277dd3(0x216)]=null);const _0x7c0eb3=Math[_0x277dd3(0x405)](0x1,parseInt(data['settings']['flowtimeBreakRatio']??0x5,0xa)),_0x316159=Math[_0x277dd3(0x405)](0x0,this['remaining']|0x0),_0x175447=Math[_0x277dd3(0x405)](0x3c,Math[_0x277dd3(0x34f)](_0x316159/_0x7c0eb3));this[_0x277dd3(0x3e4)]='break',this[_0x277dd3(0x221)]=_0x175447,this[_0x277dd3(0x290)]=_0x175447,this[_0x277dd3(0x335)](),this['updateUI'](),this[_0x277dd3(0x1ab)](!![]);try{toast(_0x277dd3(0x27f)+Math[_0x277dd3(0x209)](_0x175447/0x3c)+_0x277dd3(0x421)+_0x7c0eb3+').');}catch(_0x5ed7f9){}},'beginBreak'(){const _0x1f06fd=_0x274cec;this[_0x1f06fd(0x34c)]=this[_0x1f06fd(0x3e4)];const _0x40cf7b=this[_0x1f06fd(0x2d3)](),_0x4bad7d=this[_0x1f06fd(0x2fb)]();if(this[_0x1f06fd(0x239)]>0x0&&this[_0x1f06fd(0x239)]%_0x40cf7b[_0x1f06fd(0x1fb)]===0x0){this[_0x1f06fd(0x3e4)]=_0x1f06fd(0x1da);const _0x2cdb3f=_0x4bad7d['long']*0x3c;this[_0x1f06fd(0x221)]=_0x2cdb3f;if(this[_0x1f06fd(0x34c)]!==_0x1f06fd(0x294))this[_0x1f06fd(0x290)]=_0x2cdb3f;toast(_0x1f06fd(0x19f));}else{this[_0x1f06fd(0x3e4)]='break';const _0xbe16e3=_0x4bad7d[_0x1f06fd(0x271)]*0x3c;this[_0x1f06fd(0x221)]=_0xbe16e3;if(this[_0x1f06fd(0x34c)]!=='paused')this['remaining']=_0xbe16e3;}const _0x5cac47=$(_0x1f06fd(0x24b));if(_0x5cac47){const _0x3d56cf=Math[_0x1f06fd(0x34f)](Math['random']()*breakSuggestions['length']);_0x5cac47[_0x1f06fd(0x42d)]=_0x1f06fd(0x1df)+breakSuggestions[_0x3d56cf];}this[_0x1f06fd(0x335)](),this[_0x1f06fd(0x29c)]();},async 'start'(){const _0x5a1370=_0x274cec;if(!getCurrentSubtopic()){toast(_0x5a1370(0x285));return;}ensureAudio();if(this[_0x5a1370(0x1f4)]==='C'&&this[_0x5a1370(0x3e4)]===_0x5a1370(0x400))this[_0x5a1370(0x3e4)]=_0x5a1370(0x40f),this['remaining']=0x0,this[_0x5a1370(0x221)]=0x0,this[_0x5a1370(0x239)]=0x0,this[_0x5a1370(0x335)](),this[_0x5a1370(0x29c)]();else{if(this[_0x5a1370(0x3e4)]===_0x5a1370(0x400))this[_0x5a1370(0x239)]=this[_0x5a1370(0x239)]||0x0,this[_0x5a1370(0x1d5)]();else this['state']===_0x5a1370(0x294)&&this['resume']();}await this[_0x5a1370(0x1ab)](!![]);},async 'pause'(){const _0x280cdf=_0x274cec;this[_0x280cdf(0x216)]&&(clearInterval(this['tickHandle']),this[_0x280cdf(0x216)]=null),this[_0x280cdf(0x34c)]=this[_0x280cdf(0x3e4)],this['state']=_0x280cdf(0x294),this['updateUI'](),await this[_0x280cdf(0x1ab)](!![]);},async 'resume'(){const _0x2710e4=_0x274cec;if(this[_0x2710e4(0x3e4)]!==_0x2710e4(0x294))return;this[_0x2710e4(0x3e4)]=this['prevState']||_0x2710e4(0x40f),this[_0x2710e4(0x335)](),this['updateUI'](),await this[_0x2710e4(0x1ab)](!![]);},async 'skip'(){const _0x13b280=_0x274cec;if(this[_0x13b280(0x1f4)]==='C'&&this[_0x13b280(0x3e4)]==='work'){this['finishFlowSession'](),await this[_0x13b280(0x1ab)](!![]);return;}this['state']===_0x13b280(0x40f)?(this[_0x13b280(0x216)]&&(clearInterval(this['tickHandle']),this['tickHandle']=null),this['remaining']=0x0,this['_onFinishSegment']()):(this[_0x13b280(0x290)]=0x0,this[_0x13b280(0x216)]&&(clearInterval(this[_0x13b280(0x216)]),this[_0x13b280(0x216)]=null),this[_0x13b280(0x26f)]()),await this['persistTimerState'](!![]);},async 'reset'(){const _0x15e414=_0x274cec;this[_0x15e414(0x216)]&&(clearInterval(this[_0x15e414(0x216)]),this[_0x15e414(0x216)]=null);this[_0x15e414(0x3e4)]=_0x15e414(0x400),this[_0x15e414(0x34c)]=null,this[_0x15e414(0x290)]=0x0,this['segmentTotal']=0x0,this[_0x15e414(0x239)]=0x0;const _0x4a335e=$('#breakSuggestionDisplay');_0x4a335e&&(_0x4a335e[_0x15e414(0x42d)]=''),this[_0x15e414(0x29c)](),await this['persistTimerState'](!![]);}};async function deleteSummary(_0x76aa7f){const _0x2b7de6=_0x274cec;showConfirmModal(_0x2b7de6(0x356),_0x2b7de6(0x446),async _0x1c6c60=>{const _0x8062f8=_0x2b7de6;if(!_0x1c6c60)return;const _0x179a15=getCurrentSubtopic();if(!_0x179a15||!_0x179a15[_0x8062f8(0x277)])return;const _0x1ece20=[..._0x179a15['summaries']];_0x179a15[_0x8062f8(0x277)]=_0x179a15[_0x8062f8(0x277)]['filter'](_0x476b01=>_0x476b01['id']!==_0x76aa7f);try{await storageManager['update'](_0x8062f8(0x1b3),_0x179a15),renderSummaries(),toast(_0x8062f8(0x437));}catch(_0x583642){console[_0x8062f8(0x17c)](_0x8062f8(0x2a7),_0x583642),_0x179a15['summaries']=_0x1ece20,toast('Không\x20thể\x20lưu\x20thay\x20đổi.');}});}function exportSummary(_0x5db6cc){const _0x461ab5=_0x274cec,_0x4de32c=new Blob([_0x5db6cc[_0x461ab5(0x19c)]],{'type':_0x461ab5(0x1a3)}),_0x259d61=document[_0x461ab5(0x179)]('a'),_0x157479=new Date(_0x5db6cc['createdAt']),_0x17a18f=_0x2e9a73=>(''+_0x2e9a73)[_0x461ab5(0x39c)](0x2,'0');_0x259d61['href']=URL['createObjectURL'](_0x4de32c),_0x259d61['download']='summary_'+_0x157479[_0x461ab5(0x423)]()+_0x17a18f(_0x157479[_0x461ab5(0x483)]()+0x1)+_0x17a18f(_0x157479['getDate']())+_0x461ab5(0x272),_0x259d61[_0x461ab5(0x27e)](),URL['revokeObjectURL'](_0x259d61['href']);}function renderStatsHistory(){const _0x499f09=_0x274cec,_0xadd6db=getCurrentSubtopic(),_0x5bee5a=$(_0x499f09(0x1b9)),_0x4f825e=$('#statSessions'),_0x3a1333=$(_0x499f09(0x3df)),_0xf06237=$(_0x499f09(0x38f));if(!_0x5bee5a||!_0x4f825e||!_0x3a1333||!_0xf06237)return;if(!_0xadd6db){_0x5bee5a[_0x499f09(0x42d)]=_0x499f09(0x267),_0x4f825e[_0x499f09(0x42d)]='0',_0x3a1333[_0x499f09(0x42d)]='0',_0xf06237[_0x499f09(0x37d)]='<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>';return;}const _0xd00fb2=_0xadd6db[_0x499f09(0x396)]&&_0xadd6db[_0x499f09(0x396)][_0x499f09(0x24a)]?_0xadd6db[_0x499f09(0x396)][_0x499f09(0x24a)]:0x0,_0x4d0ff1=_0xadd6db[_0x499f09(0x396)]&&_0xadd6db['stats']['sessionsCompleted']?_0xadd6db[_0x499f09(0x396)][_0x499f09(0x30b)]:0x0,_0x2623f7=_0xadd6db[_0x499f09(0x1dc)]?_0xadd6db['tasks'][_0x499f09(0x46f)](_0x599f51=>_0x599f51[_0x499f09(0x45c)])[_0x499f09(0x27b)]:0x0;_0x5bee5a[_0x499f09(0x42d)]=formatDaysHoursMinutes(_0xd00fb2),_0x4f825e[_0x499f09(0x42d)]=String(_0x4d0ff1),_0x3a1333[_0x499f09(0x42d)]=String(_0x2623f7),_0xf06237[_0x499f09(0x37d)]='';const _0x3646ab=Array[_0x499f09(0x458)](_0xadd6db[_0x499f09(0x31d)])?_0xadd6db[_0x499f09(0x31d)]:[];if(_0x3646ab[_0x499f09(0x27b)]===0x0){_0xf06237['innerHTML']=_0x499f09(0x2b9);return;}_0x3646ab[_0x499f09(0x432)](_0x2e73b3=>{const _0x5edda8=_0x499f09,_0x38c539=document[_0x5edda8(0x179)](_0x5edda8(0x2b3));_0x38c539[_0x5edda8(0x176)]=_0x5edda8(0x441);const _0xd6dd83=document[_0x5edda8(0x179)](_0x5edda8(0x2b3)),_0x3f9cf4=_0x2e73b3[_0x5edda8(0x468)]?new Date(_0x2e73b3[_0x5edda8(0x468)]):new Date(),_0x4db5f2=_0x2e73b3[_0x5edda8(0x1af)]!=null?_0x2e73b3['durationMinutes']:_0x2e73b3[_0x5edda8(0x3d6)]||0x0;_0xd6dd83[_0x5edda8(0x37d)]=_0x5edda8(0x2e9)+_0x3f9cf4[_0x5edda8(0x186)]()+'\x20·\x20'+_0x4db5f2+_0x5edda8(0x46e)+(_0x2e73b3[_0x5edda8(0x1f4)]||'')+_0x5edda8(0x243)+('<div>'+(_0x2e73b3[_0x5edda8(0x225)]?escapeHTML(_0x2e73b3['note']):'<span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span>')+_0x5edda8(0x243)),_0x38c539[_0x5edda8(0x234)](_0xd6dd83),_0xf06237['appendChild'](_0x38c539);});}function renderGeneralNotes(){const _0x5a50e0=_0x274cec,_0x5424ce=$(_0x5a50e0(0x440));if(!_0x5424ce)return;const _0x5cc124=getCurrentSubtopic();if(!_0x5cc124){_0x5424ce[_0x5a50e0(0x37d)]='<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>';return;}_0x5cc124['generalNotes']=_0x5cc124[_0x5a50e0(0x417)]||[];if(_0x5cc124[_0x5a50e0(0x417)][_0x5a50e0(0x27b)]===0x0){_0x5424ce['innerHTML']=_0x5a50e0(0x3ea);return;}_0x5424ce[_0x5a50e0(0x37d)]='',_0x5cc124[_0x5a50e0(0x417)][_0x5a50e0(0x432)](_0x3e72b1=>{const _0x24da76=_0x5a50e0,_0x483983=document[_0x24da76(0x179)](_0x24da76(0x2b3));_0x483983[_0x24da76(0x176)]=_0x24da76(0x3ba);const _0x38db3a=document[_0x24da76(0x179)](_0x24da76(0x2b3));_0x38db3a[_0x24da76(0x176)]=_0x24da76(0x3b7),_0x38db3a['textContent']=typeof _0x3e72b1===_0x24da76(0x326)?_0x3e72b1:_0x3e72b1[_0x24da76(0x18f)]||'';const _0x4bc705=document[_0x24da76(0x179)](_0x24da76(0x2b3));_0x4bc705['className']=_0x24da76(0x25c),_0x4bc705[_0x24da76(0x42d)]=_0x3e72b1[_0x24da76(0x22d)]?new Date(_0x3e72b1[_0x24da76(0x22d)])[_0x24da76(0x186)]():'';const _0x3d94b6=document[_0x24da76(0x179)](_0x24da76(0x2b3)),_0x3ebc41=document['createElement'](_0x24da76(0x43c));_0x3ebc41[_0x24da76(0x176)]=_0x24da76(0x171),_0x3ebc41[_0x24da76(0x42d)]=_0x24da76(0x1a6),_0x3ebc41[_0x24da76(0x317)]=async _0xa606c8=>{const _0x26cd6b=_0x24da76;_0xa606c8[_0x26cd6b(0x382)]();const _0x19d4bf=getCurrentSubtopic();if(!_0x19d4bf)return;_0x19d4bf['generalNotes']=(_0x19d4bf[_0x26cd6b(0x417)]||[])[_0x26cd6b(0x46f)](_0xd9ebd3=>(_0xd9ebd3['id']||_0xd9ebd3)!==(_0x3e72b1['id']||_0x3e72b1)),await saveData(),renderGeneralNotes();},_0x3d94b6[_0x24da76(0x234)](_0x3ebc41);const _0x3b3b4b=document[_0x24da76(0x179)](_0x24da76(0x2b3));_0x3b3b4b[_0x24da76(0x176)]=_0x24da76(0x17d),_0x3b3b4b[_0x24da76(0x20b)](_0x38db3a,_0x4bc705),_0x483983['append'](_0x3b3b4b,_0x3d94b6),_0x5424ce[_0x24da76(0x234)](_0x483983);});}function renderMethods(){const _0x40b894=_0x274cec,_0x45ec3c=document[_0x40b894(0x308)](_0x40b894(0x18c));if(!_0x45ec3c)return;_0x45ec3c['innerHTML']='';const _0x282e29=data?.[_0x40b894(0x1e5)]?.[_0x40b894(0x280)]||[];if(_0x282e29[_0x40b894(0x27b)]===0x0){_0x45ec3c['innerHTML']=_0x40b894(0x342);return;}_0x282e29[_0x40b894(0x432)](_0x1c9cde=>{const _0x5962f7=_0x40b894,_0x53c40a=document['createElement'](_0x5962f7(0x38a));_0x53c40a[_0x5962f7(0x176)]=_0x5962f7(0x466),_0x53c40a[_0x5962f7(0x3a0)][_0x5962f7(0x27c)]=_0x1c9cde['id'];const _0x1b3030=document[_0x5962f7(0x179)]('summary'),_0x2d5b3a=document[_0x5962f7(0x179)](_0x5962f7(0x1f2));_0x2d5b3a[_0x5962f7(0x176)]='method-title',_0x2d5b3a[_0x5962f7(0x42d)]=_0x1c9cde['title']||_0x5962f7(0x1d1),_0x2d5b3a[_0x5962f7(0x36b)]('click',_0x5aab2d=>{const _0x24934f=_0x5962f7;_0x5aab2d[_0x24934f(0x18a)](),_0x5aab2d[_0x24934f(0x382)](),_0x53c40a[_0x24934f(0x1e9)]=!_0x53c40a[_0x24934f(0x1e9)];});const _0x2089bc=document[_0x5962f7(0x179)]('div');_0x2089bc[_0x5962f7(0x176)]=_0x5962f7(0x1b1);const _0x7938d5=document['createElement']('button');_0x7938d5['className']=_0x5962f7(0x1ff),_0x7938d5[_0x5962f7(0x42d)]=_0x5962f7(0x2cf),_0x7938d5[_0x5962f7(0x3a0)]['id']=_0x1c9cde['id'];const _0x2e288e=document['createElement'](_0x5962f7(0x43c));_0x2e288e[_0x5962f7(0x176)]=_0x5962f7(0x359),_0x2e288e['textContent']='Xóa',_0x2e288e[_0x5962f7(0x3a0)]['id']=_0x1c9cde['id'],_0x2089bc[_0x5962f7(0x20b)](_0x7938d5,_0x2e288e),_0x1b3030[_0x5962f7(0x20b)](_0x2d5b3a,_0x2089bc);const _0x5c0533=document[_0x5962f7(0x179)](_0x5962f7(0x2b3));_0x5c0533['className']=_0x5962f7(0x30c),_0x5c0533[_0x5962f7(0x37d)]=_0x1c9cde[_0x5962f7(0x19c)]||'',_0x53c40a[_0x5962f7(0x20b)](_0x1b3030,_0x5c0533),_0x45ec3c[_0x5962f7(0x234)](_0x53c40a),_0x53c40a[_0x5962f7(0x36b)](_0x5962f7(0x27e),_0x15a015=>{const _0x5f24bc=_0x5962f7,_0x57a73b=_0x15a015['target'];if(!_0x57a73b)return;if(_0x57a73b[_0x5f24bc(0x371)]('button')||_0x57a73b[_0x5f24bc(0x371)]('a')||_0x57a73b['closest'](_0x5f24bc(0x198))||_0x57a73b['closest']('.color-palette'))return;if(!_0x53c40a['open'])_0x53c40a[_0x5f24bc(0x1e9)]=!![];});});const _0x409ed7=_0x45ec3c['querySelectorAll']('.method-item');_0x409ed7[_0x40b894(0x432)](_0x29abf6=>{const _0x1629fe=_0x40b894;_0x29abf6[_0x1629fe(0x36b)](_0x1629fe(0x1bd),()=>{const _0x59e995=_0x1629fe;_0x29abf6[_0x59e995(0x1e9)]&&_0x409ed7['forEach'](_0x3f8410=>{if(_0x3f8410!==_0x29abf6)_0x3f8410['open']=![];});});});}function addGeneralNote(){showInputModal('Thêm\x20ghi\x20chú',async _0xd6325=>{const _0x32098a=_0x48ec;if(!_0xd6325)return;const _0xa642bf=getCurrentSubtopic();if(!_0xa642bf){toast(_0x32098a(0x2ba));return;}_0xa642bf[_0x32098a(0x417)]=_0xa642bf['generalNotes']||[],_0xa642bf[_0x32098a(0x417)][_0x32098a(0x325)]({'id':uid('gn'),'text':_0xd6325,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0x3f737b=_0x274cec,_0x26a3e6=getCurrentSubtopic();if(!_0x26a3e6){toast(_0x3f737b(0x1f0));return;}const _0x2b9e2a=(_0x26a3e6[_0x3f737b(0x417)]||[])[_0x3f737b(0x32e)](_0x41d45e=>typeof _0x41d45e==='string'?_0x41d45e:_0x41d45e[_0x3f737b(0x18f)]||'')[_0x3f737b(0x46f)](Boolean);if(_0x2b9e2a[_0x3f737b(0x27b)]===0x0){toast('Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.');return;}const _0x5ad608=$(_0x3f737b(0x2b4));_0x5ad608&&(_0x5ad608[_0x3f737b(0x36f)]=!![],_0x5ad608[_0x3f737b(0x37d)]=_0x3f737b(0x2f1));try{const _0x5dba96='Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a'+_0x2b9e2a[_0x3f737b(0x372)](_0x3f737b(0x248)),_0x11c2c0=await callGeminiAPI(_0x5dba96);if(!_0x26a3e6[_0x3f737b(0x277)])_0x26a3e6[_0x3f737b(0x277)]=[];_0x26a3e6['summaries'][_0x3f737b(0x325)]({'id':uid(_0x3f737b(0x438)),'content':_0x11c2c0||_0x3f737b(0x1fc),'createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x26c948){console['error'](_0x26c948),toast(_0x3f737b(0x284));}finally{_0x5ad608&&(_0x5ad608[_0x3f737b(0x36f)]=![],_0x5ad608[_0x3f737b(0x42d)]=_0x3f737b(0x28d));}}function renderSummaries(){const _0x26a716=_0x274cec,_0x3661cc=$('#summariesList');if(!_0x3661cc)return;const _0x12609e=getCurrentSubtopic();if(!_0x12609e){_0x3661cc[_0x26a716(0x37d)]=_0x26a716(0x3ef);return;}_0x3661cc[_0x26a716(0x37d)]='';if(!_0x12609e[_0x26a716(0x277)]||_0x12609e[_0x26a716(0x277)][_0x26a716(0x27b)]===0x0){_0x3661cc[_0x26a716(0x37d)]=_0x26a716(0x2fa);return;}_0x12609e[_0x26a716(0x277)][_0x26a716(0x432)](_0x3b2510=>{const _0xdf447f=_0x26a716,_0x48f709=document['createElement'](_0xdf447f(0x2b3));_0x48f709[_0xdf447f(0x176)]=_0xdf447f(0x3ba);const _0x218986=document['createElement'](_0xdf447f(0x2b3));_0x218986['className']=_0xdf447f(0x17d);const _0x238ed8=document[_0xdf447f(0x179)](_0xdf447f(0x2b3));_0x238ed8[_0xdf447f(0x176)]='note-content',_0x238ed8[_0xdf447f(0x42d)]=_0x3b2510[_0xdf447f(0x19c)];const _0x142604=document[_0xdf447f(0x179)](_0xdf447f(0x2b3));_0x142604[_0xdf447f(0x176)]=_0xdf447f(0x25c),_0x142604[_0xdf447f(0x42d)]=new Date(_0x3b2510[_0xdf447f(0x22d)])[_0xdf447f(0x186)](),_0x218986['append'](_0x238ed8,_0x142604);const _0x45cd04=document['createElement'](_0xdf447f(0x2b3)),_0x470d03=document[_0xdf447f(0x179)](_0xdf447f(0x43c));_0x470d03[_0xdf447f(0x176)]=_0xdf447f(0x2e6),_0x470d03[_0xdf447f(0x42d)]='Xuất',_0x470d03['onclick']=_0x42eaa5=>{const _0x57d904=_0xdf447f;_0x42eaa5[_0x57d904(0x382)](),exportSummary(_0x3b2510);};const _0xc87ea1=document[_0xdf447f(0x179)](_0xdf447f(0x43c));_0xc87ea1['className']=_0xdf447f(0x171),_0xc87ea1[_0xdf447f(0x42d)]=_0xdf447f(0x1a6),_0xc87ea1[_0xdf447f(0x317)]=_0xb9f434=>{const _0x26af44=_0xdf447f;_0xb9f434[_0x26af44(0x382)](),deleteSummary(_0x3b2510['id']);},_0x45cd04[_0xdf447f(0x20b)](_0x470d03,_0xc87ea1),_0x48f709['append'](_0x218986,_0x45cd04),_0x48f709[_0xdf447f(0x36b)](_0xdf447f(0x27e),()=>_0x238ed8[_0xdf447f(0x463)]['toggle'](_0xdf447f(0x21b))),_0x3661cc[_0xdf447f(0x234)](_0x48f709);});}function loadEditingPresetFields(){const _0x8aad7e=_0x274cec,_0x2ce2ed=data['settings'],_0x223c7a=_0x2ce2ed[_0x8aad7e(0x35d)],_0x3e3292=$(_0x8aad7e(0x2ee)),_0x33a775=$(_0x8aad7e(0x32b));if(_0x3e3292&&_0x33a775){const _0x20b5fc=editingPreset==='C';_0x3e3292[_0x8aad7e(0x463)][_0x8aad7e(0x1bd)](_0x8aad7e(0x219),_0x20b5fc),_0x33a775['classList'][_0x8aad7e(0x1bd)](_0x8aad7e(0x219),!_0x20b5fc);}if(editingPreset==='A'){$(_0x8aad7e(0x1ed))['value']=_0x223c7a[_0x8aad7e(0x207)];if($(_0x8aad7e(0x192)))$('#set_winddown')['value']=_0x223c7a[_0x8aad7e(0x38c)]??0x0;$(_0x8aad7e(0x2be))[_0x8aad7e(0x260)]=_0x223c7a[_0x8aad7e(0x40c)],$('#set_long')[_0x8aad7e(0x260)]=_0x223c7a['A_long'],$(_0x8aad7e(0x322))[_0x8aad7e(0x260)]=_0x2ce2ed['cyclesA'],$('#set_interval')['value']=_0x2ce2ed[_0x8aad7e(0x2f2)];}else{if(editingPreset==='B'){$(_0x8aad7e(0x1ed))[_0x8aad7e(0x260)]=_0x223c7a['B_work'];if($(_0x8aad7e(0x192)))$(_0x8aad7e(0x192))[_0x8aad7e(0x260)]=_0x223c7a[_0x8aad7e(0x200)]??0x0;$(_0x8aad7e(0x2be))[_0x8aad7e(0x260)]=_0x223c7a['B_short'],$(_0x8aad7e(0x303))[_0x8aad7e(0x260)]=_0x223c7a[_0x8aad7e(0x1b0)],$(_0x8aad7e(0x322))[_0x8aad7e(0x260)]=_0x2ce2ed['cyclesB'],$(_0x8aad7e(0x40a))['value']=_0x2ce2ed[_0x8aad7e(0x35b)];}else{if(editingPreset==='C'){const _0x2932d8=$(_0x8aad7e(0x3a8));if(_0x2932d8)_0x2932d8['value']=_0x2ce2ed[_0x8aad7e(0x40d)]??0x5;}}}}function highlightPresetSelector(){const _0x29fc91=_0x274cec;$$('#timerPresetSelector\x20button')[_0x29fc91(0x432)](_0x498791=>{const _0x517fe7=_0x29fc91,_0x331d35=_0x498791[_0x517fe7(0x3a0)][_0x517fe7(0x44a)]===editingPreset;_0x498791[_0x517fe7(0x463)][_0x517fe7(0x1bd)](_0x517fe7(0x1ac),_0x331d35),_0x498791[_0x517fe7(0x463)][_0x517fe7(0x1bd)](_0x517fe7(0x201),!_0x331d35);});}function openSettings(){const _0x5a2e92=_0x274cec,_0x4b0f10=data['settings'];editingPreset=_0x4b0f10['preset'],$(_0x5a2e92(0x47a))[_0x5a2e92(0x260)]=_0x4b0f10['apiKey']||'',loadEditingPresetFields(),highlightPresetSelector(),$(_0x5a2e92(0x2c0))['value']=_0x4b0f10[_0x5a2e92(0x235)]??0.8,$('#set_theme')[_0x5a2e92(0x260)]=_0x4b0f10[_0x5a2e92(0x35a)]||_0x5a2e92(0x443),$(_0x5a2e92(0x268))[_0x5a2e92(0x260)]=_0x4b0f10[_0x5a2e92(0x2d8)]||_0x5a2e92(0x310);const _0x49a394=getActiveYoutubeUrl();$(_0x5a2e92(0x274))[_0x5a2e92(0x260)]=_0x49a394||'';const _0x92c5cf=extractYouTubeID(_0x49a394);$(_0x5a2e92(0x220))[_0x5a2e92(0x36f)]=!_0x92c5cf;$(_0x5a2e92(0x40b))&&($(_0x5a2e92(0x40b))[_0x5a2e92(0x42d)]='');$(_0x5a2e92(0x412))[_0x5a2e92(0x260)]=_0x4b0f10[_0x5a2e92(0x2d9)]||0x50,$('#set_ytThumbAsBg')['checked']=!!_0x4b0f10[_0x5a2e92(0x1c4)],$(_0x5a2e92(0x3f0))[_0x5a2e92(0x260)]=_0x4b0f10[_0x5a2e92(0x3f6)]||0.85;$('#set_backgroundMode')&&($(_0x5a2e92(0x206))[_0x5a2e92(0x260)]=_0x4b0f10[_0x5a2e92(0x2f0)]||_0x5a2e92(0x2df));$('#set_autoStartNext')&&($('#set_autoStartNext')[_0x5a2e92(0x254)]=!!_0x4b0f10[_0x5a2e92(0x375)]);$('#set_enableWinddown')&&($(_0x5a2e92(0x26c))[_0x5a2e92(0x254)]=_0x4b0f10['enableWinddown']!==![]);$(_0x5a2e92(0x295))&&($(_0x5a2e92(0x295))['value']=_0x4b0f10[_0x5a2e92(0x2d1)]||0x7);const _0x18aec9=$(_0x5a2e92(0x279));_0x18aec9&&storageManager[_0x5a2e92(0x29a)]()[_0x5a2e92(0x24e)](_0x27abeb=>{const _0x52ebcf=_0x5a2e92;_0x18aec9[_0x52ebcf(0x37d)]=_0x52ebcf(0x21c),_0x27abeb&&_0x27abeb[_0x52ebcf(0x27b)]>0x0?_0x27abeb[_0x52ebcf(0x432)](_0x13fb81=>{const _0x34943d=_0x52ebcf,_0x2850f5=document['createElement'](_0x34943d(0x2bb));_0x2850f5[_0x34943d(0x260)]=_0x13fb81[_0x34943d(0x2c7)],_0x2850f5['textContent']=_0x34943d(0x2f8)+new Date(_0x13fb81['date'])[_0x34943d(0x2e3)]('vi-VN'),_0x18aec9[_0x34943d(0x234)](_0x2850f5);}):_0x18aec9[_0x52ebcf(0x37d)]=_0x52ebcf(0x43d);});$(_0x5a2e92(0x3b8))[_0x5a2e92(0x463)][_0x5a2e92(0x406)](_0x5a2e92(0x212));try{trapFocus($('#modalSettings'));}catch(_0x203cfc){}}function closeSettings(){const _0x784385=_0x274cec;$(_0x784385(0x3b8))['classList'][_0x784385(0x455)](_0x784385(0x212));try{releaseFocus();}catch(_0x28836a){}}async function setDefaults(){const _0x2316bb=_0x274cec;data['settings']['durations']={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data[_0x2316bb(0x1e5)][_0x2316bb(0x291)]=0x4,data['settings']['longBreakIntervalA']=0x4,data[_0x2316bb(0x1e5)][_0x2316bb(0x21f)]=0x4,data[_0x2316bb(0x1e5)]['longBreakIntervalB']=0x4,data['settings'][_0x2316bb(0x40d)]=0x5,data[_0x2316bb(0x1e5)][_0x2316bb(0x32f)]='A',data[_0x2316bb(0x1e5)][_0x2316bb(0x235)]=0.8,data['settings'][_0x2316bb(0x35a)]='beep',await saveData(),openSettings(),toast(_0x2316bb(0x333));}async function saveSettings(){const _0x5cfe27=_0x274cec,_0x579ad4=data[_0x5cfe27(0x1e5)];_0x579ad4[_0x5cfe27(0x433)]=$(_0x5cfe27(0x47a))[_0x5cfe27(0x260)][_0x5cfe27(0x378)]();const _0x3ec1b5=_0x579ad4[_0x5cfe27(0x35d)];if(editingPreset==='A')_0x3ec1b5[_0x5cfe27(0x207)]=clampInt($(_0x5cfe27(0x1ed))[_0x5cfe27(0x260)],0x1,0x3e7),_0x3ec1b5['A_winddown']=clampInt($(_0x5cfe27(0x192))[_0x5cfe27(0x260)],0x0,0x3e7),_0x3ec1b5[_0x5cfe27(0x40c)]=clampInt($(_0x5cfe27(0x2be))['value'],0x1,0x3e7),_0x3ec1b5[_0x5cfe27(0x26d)]=clampInt($(_0x5cfe27(0x303))[_0x5cfe27(0x260)],0x1,0x3e7),_0x579ad4[_0x5cfe27(0x291)]=clampInt($(_0x5cfe27(0x322))[_0x5cfe27(0x260)],0x1,0xc),_0x579ad4[_0x5cfe27(0x2f2)]=clampInt($('#set_interval')[_0x5cfe27(0x260)],0x2,0xc);else{if(editingPreset==='B')_0x3ec1b5[_0x5cfe27(0x453)]=clampInt($(_0x5cfe27(0x1ed))['value'],0x1,0x3e7),_0x3ec1b5[_0x5cfe27(0x200)]=clampInt($(_0x5cfe27(0x192))[_0x5cfe27(0x260)],0x0,0x3e7),_0x3ec1b5[_0x5cfe27(0x34b)]=clampInt($(_0x5cfe27(0x2be))[_0x5cfe27(0x260)],0x1,0x3e7),_0x3ec1b5[_0x5cfe27(0x1b0)]=clampInt($('#set_long')[_0x5cfe27(0x260)],0x1,0x3e7),_0x579ad4[_0x5cfe27(0x21f)]=clampInt($('#set_cycles')['value'],0x1,0xc),_0x579ad4[_0x5cfe27(0x35b)]=clampInt($('#set_interval')[_0x5cfe27(0x260)],0x2,0xc);else{if(editingPreset==='C'){const _0x15ef77=$(_0x5cfe27(0x3a8));if(_0x15ef77)_0x579ad4[_0x5cfe27(0x40d)]=clampInt(_0x15ef77[_0x5cfe27(0x260)],0x1,0x14);}}}_0x579ad4['volume']=clampFloat($(_0x5cfe27(0x2c0))[_0x5cfe27(0x260)],0x0,0x1,0.8),_0x579ad4[_0x5cfe27(0x35a)]=$('#set_theme')[_0x5cfe27(0x260)]===_0x5cfe27(0x1bb)?_0x5cfe27(0x1bb):_0x5cfe27(0x443),_0x579ad4[_0x5cfe27(0x2d8)]=$(_0x5cfe27(0x268))['value'],_0x579ad4['panelOpacity']=parseFloat($(_0x5cfe27(0x3f0))['value'])||0.85;$(_0x5cfe27(0x206))&&(_0x579ad4[_0x5cfe27(0x2f0)]=$(_0x5cfe27(0x206))[_0x5cfe27(0x260)]);_0x579ad4[_0x5cfe27(0x375)]=!!($(_0x5cfe27(0x264))&&$(_0x5cfe27(0x264))[_0x5cfe27(0x254)]),_0x579ad4[_0x5cfe27(0x384)]=!!($(_0x5cfe27(0x26c))&&$('#set_enableWinddown')[_0x5cfe27(0x254)]);$(_0x5cfe27(0x295))&&(_0x579ad4['backupDaysToKeep']=clampInt($(_0x5cfe27(0x295))[_0x5cfe27(0x260)],0x1,0x1e));_0x579ad4[_0x5cfe27(0x2d8)]===_0x5cfe27(0x447)||_0x579ad4[_0x5cfe27(0x2d8)]==='pastel'?(_0x579ad4['useYtThumbnailAsBg']=![],typeof _0x579ad4[_0x5cfe27(0x474)]===_0x5cfe27(0x326)&&_0x579ad4[_0x5cfe27(0x474)][_0x5cfe27(0x195)](_0x5cfe27(0x3ae))&&(_0x579ad4[_0x5cfe27(0x474)]='')):_0x579ad4[_0x5cfe27(0x1c4)]=!![];const _0x170d47=$(_0x5cfe27(0x274))['value'][_0x5cfe27(0x378)]();_0x579ad4[_0x5cfe27(0x1c4)]=$('#set_ytThumbAsBg')[_0x5cfe27(0x254)],_0x579ad4[_0x5cfe27(0x2d9)]=parseInt($('#ytSoundVolume')[_0x5cfe27(0x260)],0xa),sessionYoutubeUrl=_0x170d47;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer['setVolume'])ytPlayer[_0x5cfe27(0x2af)](_0x579ad4[_0x5cfe27(0x2d9)]);}else try{fallbackPostMessage(_0x5cfe27(0x2af),[_0x579ad4[_0x5cfe27(0x2d9)]]);}catch(_0x40ac0a){}}catch(_0x3328bb){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x5cfe27(0x36d)](_0x579ad4['preset'],{'silent':!![]}),closeSettings(),toast(_0x5cfe27(0x391));}function _0x13a1(){const _0x5ad0f8=['#modalGeneric','Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.','div','#btnSummarize','.nav-btn[data-view=\x22','src','\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22','requestFullscreen','<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>','Chọn\x20một\x20chủ\x20đề\x20con\x20trước.','option','lastBackupDate','Escape','#set_short','DB_VERSION','#set_volume','#toasts','10030WpqxWK','Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','SẴN\x20SÀNG','beginBreak','date','__ytApiWatchdog','Đổi\x20tên\x20Chủ\x20đề\x20con','Lỗi:\x20','50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.','<tr><td>','IndexedDB\x20initialized\x20successfully.','webkitAudioContext','Sửa','#modalMethodEditor','backupDaysToKeep','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','currentConfig','customSounds','active','Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!','load','theme','youtubeVolume','Xóa\x20Chủ\x20đề\x20con','Âm\x20thanh\x20đã\x20được\x20bật!','createGain','NGHỈ\x20DÀI','#uploadSoundLong','cover','backgroundImage','#btnSaveMethod','Lỗi\x20lưu\x20file.','toLocaleDateString','_sortable','<ul>','btn\x20small','topicId','destroy','<div\x20class=\x22hist-meta\x22>','space','#btnResume','linearRampToValueAtTime','reset','#settings-pomodoro','#toolH4','backgroundMode','<div\x20class=\x22spinner\x22></div>','longBreakIntervalA','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','</label>','Đang\x20tải\x20API\x20YouTube...','#btnSkip','#chatInput','Bản\x20sao\x20lưu\x20ngày:\x20','var(--acc-2)','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','currentDurations','file:','#genericTitle','result','Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.','</ul>','insertUnorderedList','beginWindDown','#set_long','position','Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.','https://www.youtube.com','now','querySelector','log','Chưa\x20chọn\x20Chủ\x20đề\x20con','sessionsCompleted','method-content','Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!','promptFeedback','version','default','oncomplete','Thêm\x20Chủ\x20đề\x20con','files','\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','auto','task','onclick','Thêm\x20Tri\x20thức\x20mới','json','#methodEditorId','Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.','clear','sessions','readonly','.presets\x20button','backgroundRepeat','</td></tr>','#set_cycles','#uploadSoundWork','</h4>','unshift','string','objectStore','height','Tệp\x20không\x20đúng\x20định\x20dạng','focus','#settings-flowtime','LÀM\x20VIỆC\x20(FLOW)','autoBackup','map','preset','break_end','<strong>$1</strong>','actions','Đã\x20khôi\x20phục\x20mặc\x20định','#btnPause','_startTick','#toolColor','#btnBreakEarly','save','Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.','object','Gemini\x20API\x20Error:','Ẩn\x20giao\x20diện','localeCompare','Lỗi\x20phát\x20âm\x20thanh:','Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22','http:','subtopics-group','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20được\x20thêm\x20vào.</p>','.modal','Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.','AI\x20đã\x20định\x20dạng\x20xong!','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','getAll','keydown','.subtopic-btn','updateSettings','B_short','prevState','onYouTubeIframeAPIReady','match','floor','left','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>','readwrite','.color-palette','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','POST','Xác\x20nhận\x20xóa','#btnSaveNote','Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.','btn\x20small\x20danger\x20method-delete','soundTheme','longBreakIntervalB','Toàn\x20màn\x20hình','durations','&#39;','getElementById','menu-item','reduce','pauseVideo','pomodoro_files','style','mouseup','Missing\x20element','#btnFullscreen','#view-timer','find','Thêm\x20tùy\x20chọn','addEventListener','#draggableTimer','setPreset','#btnEnableSound','disabled','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','closest','join','removeEventListener','Sortable','autoStartNext','random','_getStore','trim','triangle','<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20','backups','timer','innerHTML','display','#btnAutoFormat','Failed\x20to\x20save\x20data:','title','stopPropagation','foreColor','enableWinddown','#btnToggleBg','#currentSubtopicNameChat','<h4>','Daily\x20backup\x20successful.','#milestoneTitle','details','&amp;','A_winddown','loadLanguage','oldIndex','#historyList','parentElement','Đã\x20lưu\x20cài\x20đặt','head','subtopic','sound_unlocked','#audioWorkEnd','stats','Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.','<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>','setProperty','4760172ECNado','work_end','padStart','.view','.tab-btn','Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...','dataset','from','download','repeat','15363120yBlAGj','#btnFinishFlow','defer','block','#set_flowRatio','Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.','btn\x20subtopic-btn','/hqdefault.jpg','Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.','#cycleInfo','img.youtube.com/vi/','formatBlock','Đã\x20dừng\x20nhạc\x20nền.','values','push','http','Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','update','shiftKey','note-content','#modalSettings','</ol>','note-item','#toolBullet','removeProperty','pomodoroData_v11','innerHeight','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.','data:','<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>','wind_down','Đã\x20chuyển\x20sang\x20Kiểu\x20','location','<i>$1</i>','achievedMilestones','topics','Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.','topic','sid','toast','Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.','offsetWidth','insertOrderedList','pomodoro_backup_','#audioLongEnd','getAllKeys','menu-item\x20danger','Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','#stateBadge','workMinutes','initDB','href','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','undefined','play','min','&gt;','offsetHeight','#statTasks','#btnPresetC','badge\x20state\x20work','put','Lỗi\x20lưu\x20dữ\x20liệu:\x20','state','message','#btnPresetB','pastel','Xác\x20nhận\x20phục\x20hồi','clientY','<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>','DB_NAME','indexOf','.topic-item','beforeunload','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>','#set_panelOpacity','reloading','#btnStart','parse','Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.','revokeObjectURL','panelOpacity','#btnExport','removeChild','catch','scrollHeight','10274724rYRDST','mute','item','objectStoreNames','url(','idle','#genericInput','#btnGenericOk','start','#btnAddMethod','max','add','allow','#genericMessage','Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','#set_interval','#ytUrlFeedback','A_short','flowtimeBreakRatio','user','work','#btnAddTopic','\x20hidden','#ytSoundVolume','Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.','pointerdown','currentTime','timerState','generalNotes','errorCode','onkeydown','skip','＋\x20Thêm','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','Sửa\x20tên\x20Chủ\x20đề','Chỉnh-sửa\x20Tri\x20thức','\x20phút\x20theo\x20Flowtime\x20(','TẠM\x20DỪNG','getFullYear','#milestoneMessage','Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.','#importFile','/maxresdefault.jpg','stringify','Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.','iframe','topic-title','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.','textContent','get','exportData','soundOn','bottom','forEach','apiKey','pause','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>','#uploadBg','Đã\x20xóa\x20tóm\x20tắt.','sum','Xóa\x20tri\x20thức\x20\x22','#btnClearBg','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','button','<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>','ytUrlFeedback','tasksCompleted','#generalNotesList','hist-item','selectedTopicId','beep','tid','lastPersist','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?','light','</p>','</td><td>','presetTarget','####\x20','#btnSkipNote','Hiện\x20giao\x20diện','https://www.youtube.com/embed/','abs','.method-delete','var(--sub)','split','B_work','no-subtopic-selected','remove','button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])','badge','isArray','hours','#modalMilestone','onload','isCompleted','Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!','cycles','chatHistory','Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22','5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.','.nav-btn','classList','timer.selectSubtopicPrompt','fullscreenchange','method-item','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?','dateISO','<ol>','PlayerState','setItem','Đổi\x20tên\x20Chủ\x20đề','ArrowUp','\x27\x20·\x20Mode\x20','filter','unMute','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22','LÀM\x20VIỆC','view','customBg','transition','8BUsVNz','var(--warn)','#customSoundsContainer','target','#set_apiKey','Tab','substring','getBoundingClientRect','lofi','selectedSubtopicId','fixed','#newSubtopicTaskInput','createObjectStore','getMonth','https://img.youtube.com/vi/','#btnAddSubtopicTask','sess','transaction','opacity','getDate','#btnHelpCreateTopic','createObjectURL','Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.','Đã\x20cập\x20nhật\x20hình\x20nền.','btnToggleYtSound','233ufDKhw','btn\x20small\x20danger','querySelectorAll','Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','createOscillator','className','blockReason','stopVideo','createElement','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','file','error','note-content-wrapper','btn\x20small\x20ghost\x20actions-menu-btn','mousedown','italic','frequency','Failed\x20to\x20load\x20YouTube\x20API','#selectedContext','aria-expanded','getVolume','toLocaleString','application/json','right','Sửa\x20tên\x20Chủ\x20đề\x20con','preventDefault','#btnGenericCancel','#view-methods\x20.methods-container','no-repeat','select','text','parts','#btnTestSound','#set_winddown','function','.nav-btn[data-view]','includes','prompt','Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.','.color-picker-wrapper','data','width','</tbody></table>','content','break','finishFlowSession','Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.','2729955IvfHAa','absolute','.tab-content','text/plain','none','resolve','Xóa','.sub-row','<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.','persistTimerState','acc','.timer-circle-container','#timerPresetSelector\x20button','durationMinutes','B_long','topic-actions','4ccFwnX','subtopics','finished','setValueAtTime','#btnSettings','color','innerWidth','#statTotal','#btnMilestoneClose','chime','statusText','toggle','exponentialRampToValueAtTime','.app-content','splice','postMessage','name','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','useYtThumbnailAsBg','ArrowRight','long_end','Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.','?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.','delete','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','#view-methods','status','<p>','Lỗi\x20từ\x20Gemini:\x20','#currentSubtopicName','&quot;','Chưa\x20có\x20tiêu\x20đề','Lỗi\x20khởi\x20tạo:\x20','Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.','#topicsList','beginWork','#dashboardContent','#modalDashboard','Đang\x20phát\x20nhạc\x20nền...','#toolBold','long_break','blob:','tasks','breathing','BUFFERING','💡\x20Gợi\x20ý:\x20','#methodEditorContentInput','body','lang','async','#chatMessages','settings','Nội\x20dung\x20bị\x20chặn\x20vì:\x20','#btnDefaults','Enter','open','Space','Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.','main_settings','#set_work','Deleted\x20old\x20backup:\x20','chev\x20btn\x20small\x20ghost','Chọn\x20chủ\x20đề\x20con\x20trước.','setRangeText','span','#methodEditorTitle','mode','#editorPreview','warn','slice','textarea','Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','.aux-panel,\x20.modal-card','interval','(Không\x20tạo\x20được\x20tóm\x20tắt)','#uploadSoundBreak','#audioBreakEnd','btn\x20small\x20ghost\x20method-edit','B_winddown','ghost','Đang\x20phát','isNaN','Lỗi\x20HTTP:\x20','contains','#set_backgroundMode','A_work','candidates','round','getPlayerState','append','HẠ\x20NHIỆT','onupgradeneeded','set_youtubeUrl','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','mousemove','soundPermissionBar','show','Player','collapsedTopics','contentWindow','tickHandle','resume','#set_ytThumbAsBg','hidden','Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','expanded','<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>','createIndex','newIndex','cyclesB','#btnToggleYtSound','segmentTotal','sort','exitFullscreen','removing','note','(chưa\x20chọn)','replace','toLowerCase','Backup\x20failed:','onerror','onsuccess','top','createdAt','currentView','documentElement','relative','.actions-menu.show','#methodEditorTitleInput','sine','appendChild','volume','execCommand','Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.','gain','cycleIndex','.color-swatch','bold','#btnCloseSettings','#noteText','...','topic-item','getPropertyValue','startsWith','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','</div>','#windDownChecklist','protocol','sub-row','Gửi','\x0a-\x20','playVideo','totalMinutes','#breakSuggestionDisplay','<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>','aria-pressed','then','.actions-menu','\x20tiếng\x20','youtube-player-container','selectionEnd','change','checked','🌊\x20Flow','stroke','.timer-circle-progress','Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','--bg-image','actions-menu','__ytApiPromise','note-meta','#subtopicTasksList','activeElement','Chủ\x20đề\x20con:\x20','value','key','ENDED','var(--danger)','#set_autoStartNext','Initialization\x20error:','scrollTop','0\x20phút','#set_theme_color','reload','AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.','#btnSendMessage','#set_enableWinddown','A_long','PLAYING','_onFinishSegment','clientX','short','.txt','ArrowLeft','#set_youtubeUrl','test','#btnCloseDashboard','summaries','timer.cycleInfo','#backupList','PomodoroAppDB','length','methodId','cueVideoById','click','Nghỉ\x20','methods','AudioContext','getIframe','autoplay;\x20encrypted-media;\x20picture-in-picture','Tóm\x20tắt\x20thất\x20bại.','Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu','importData','setAttribute','Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.','API\x20response\x20structure\x20is\x20unexpected:','Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.','timerState_','-9999px','Tóm\x20tắt','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.','.actions-menu-btn','remaining','cyclesA','bg-view-mode','249201CeZoYx','paused','#set_backupDays','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','getItem','badge\x20state\x20long','connect','getBackupList','input,select,textarea','updateUI','winddown','#toolList','input','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>','code','reverse','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','Lỗi\x20khi\x20gọi\x20Gemini\x20API:','#btnClearChat','Failed\x20to\x20delete\x20summary:','cancel','findIndex','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','topicsList','toString','type','✨\x20Tự\x20động\x20định\x20dạng','setVolume','1935311bqBSBk'];_0x13a1=function(){return _0x5ad0f8;};return _0x13a1();}function clampInt(_0x41c783,_0x4be596,_0x14fc7f){const _0x3cefd3=_0x274cec;_0x41c783=parseInt(_0x41c783||0x0,0xa);if(isNaN(_0x41c783))_0x41c783=_0x4be596;return Math[_0x3cefd3(0x405)](_0x4be596,Math['min'](_0x14fc7f,_0x41c783));}function clampFloat(_0x1683f5,_0x21b4d4,_0x39d301,_0x42b70b){const _0x23c0d7=_0x274cec;_0x1683f5=parseFloat(_0x1683f5);if(Number[_0x23c0d7(0x203)](_0x1683f5))_0x1683f5=_0x42b70b;return Math[_0x23c0d7(0x405)](_0x21b4d4,Math[_0x23c0d7(0x3dc)](_0x39d301,_0x1683f5));}const dbPromise=new Promise((_0x514911,_0x2c6b50)=>{const _0x52d4f7=_0x274cec,_0x5aa3d6=indexedDB[_0x52d4f7(0x1e9)](_0x52d4f7(0x363),0x1);_0x5aa3d6[_0x52d4f7(0x20d)]=_0x2cffff=>_0x2cffff[_0x52d4f7(0x479)][_0x52d4f7(0x2fe)][_0x52d4f7(0x482)](_0x52d4f7(0x313)),_0x5aa3d6[_0x52d4f7(0x22b)]=_0x38193e=>_0x514911(_0x38193e[_0x52d4f7(0x479)][_0x52d4f7(0x2fe)]),_0x5aa3d6['onerror']=_0x2ea128=>_0x2c6b50(_0x2ea128);}),fileCache={};function handleFileUpload(_0x1ac8dc,_0x2a2b72){const _0x22d63b=_0x274cec;if(!_0x1ac8dc)return;dbPromise[_0x22d63b(0x24e)](_0x468c2e=>{const _0x3bbf7c=_0x22d63b,_0x47c60b=uid(_0x3bbf7c(0x17b)),_0x1fe8f6=_0x468c2e[_0x3bbf7c(0x168)]('files','readwrite');_0x1fe8f6[_0x3bbf7c(0x327)]('files')[_0x3bbf7c(0x3e2)](_0x1ac8dc,_0x47c60b),_0x1fe8f6[_0x3bbf7c(0x311)]=()=>_0x2a2b72(_0x47c60b),_0x1fe8f6['onerror']=()=>toast(_0x3bbf7c(0x2e2));});}function getStoredFileUrl(_0x182834){const _0x45506c=_0x274cec;if(!_0x182834)return Promise[_0x45506c(0x1a5)]('');if(fileCache[_0x182834])return Promise['resolve'](fileCache[_0x182834]);return dbPromise[_0x45506c(0x24e)](_0x21286c=>new Promise(_0x4e3bd5=>{const _0x1e0666=_0x45506c,_0x28e6b8=_0x21286c[_0x1e0666(0x168)](_0x1e0666(0x313),_0x1e0666(0x31e)),_0x631b32=_0x28e6b8[_0x1e0666(0x327)](_0x1e0666(0x313))[_0x1e0666(0x42e)](_0x182834);_0x631b32[_0x1e0666(0x22b)]=_0x9749d2=>{const _0x51f652=_0x1e0666,_0x2a1181=_0x9749d2['target'][_0x51f652(0x2fe)];if(_0x2a1181){const _0x231ea0=URL['createObjectURL'](_0x2a1181);fileCache[_0x182834]=_0x231ea0,_0x4e3bd5(_0x231ea0);}else _0x4e3bd5('');},_0x631b32[_0x1e0666(0x22a)]=()=>_0x4e3bd5('');}));}function applyCustomBg(){const _0x25322f=_0x274cec,_0x1e9372=data['settings'],_0x1165f0=_0x1e9372[_0x25322f(0x474)],_0x56e5f2=_0x1e9372['theme'],_0x37fbb2=[_0x25322f(0x47e),_0x25322f(0x2ea)][_0x25322f(0x195)](_0x56e5f2),_0x4dd2d9=_0x56e5f2===_0x25322f(0x447)||_0x56e5f2==='pastel',_0x28c4d2=_0x1e9372[_0x25322f(0x2f0)]||_0x25322f(0x2df);document[_0x25322f(0x1e1)][_0x25322f(0x364)]['backgroundSize']=_0x28c4d2,document[_0x25322f(0x1e1)]['style'][_0x25322f(0x320)]=_0x28c4d2===_0x25322f(0x315)?_0x25322f(0x3a3):_0x25322f(0x18d);const _0x243536=()=>{const _0x3e6d62=_0x25322f;try{document[_0x3e6d62(0x1e1)]['style'][_0x3e6d62(0x2e0)]='';}catch(_0x6a7f53){}};if(_0x1165f0){const _0x5537eb=_0x1165f0[_0x25322f(0x241)](_0x25322f(0x3c0))||_0x1165f0[_0x25322f(0x241)](_0x25322f(0x3b3))||_0x1165f0[_0x25322f(0x241)](_0x25322f(0x1db))?Promise[_0x25322f(0x1a5)](_0x1165f0):getStoredFileUrl(_0x1165f0);_0x5537eb['then'](_0x1a3a15=>{const _0x53971a=_0x25322f;_0x1a3a15?document[_0x53971a(0x1e1)][_0x53971a(0x364)][_0x53971a(0x399)]('--bg-image',_0x53971a(0x3ff)+_0x1a3a15+')'):document['body']['style'][_0x53971a(0x399)](_0x53971a(0x259),_0x4dd2d9?_0x53971a(0x1a4):''),_0x243536();});}else!_0x37fbb2?_0x4dd2d9?(document['body'][_0x25322f(0x364)][_0x25322f(0x399)](_0x25322f(0x259),_0x25322f(0x1a4)),_0x243536()):document['body'][_0x25322f(0x364)][_0x25322f(0x399)](_0x25322f(0x259),_0x25322f(0x2c4)):(document[_0x25322f(0x1e1)]['style'][_0x25322f(0x3bc)](_0x25322f(0x259)),_0x243536());}function applyPanelOpacity(){const _0x38efa9=_0x274cec;document[_0x38efa9(0x22f)][_0x38efa9(0x364)][_0x38efa9(0x399)]('--panel-opacity',data[_0x38efa9(0x1e5)][_0x38efa9(0x3f6)]);}function renderDashboard(){const _0x36424d=_0x274cec,_0xe8887f=data[_0x36424d(0x3c7)]['flatMap'](_0x3a931b=>_0x3a931b[_0x36424d(0x1b3)][_0x36424d(0x32e)](_0x1a1ba6=>({'topic':_0x3a931b[_0x36424d(0x1c2)],'subtopic':_0x1a1ba6[_0x36424d(0x1c2)],'m':_0x1a1ba6[_0x36424d(0x396)][_0x36424d(0x24a)]||0x0,'c':_0x1a1ba6[_0x36424d(0x396)][_0x36424d(0x30b)]||0x0,'t':_0x1a1ba6[_0x36424d(0x396)][_0x36424d(0x43f)]||0x0}))),_0x479ffe=_0xe8887f[_0x36424d(0x361)]((_0x3d0195,_0x9f206c)=>_0x3d0195+_0x9f206c['m'],0x0),_0x5ec377=_0xe8887f[_0x36424d(0x361)]((_0x32cb46,_0xa61616)=>_0x32cb46+_0xa61616['c'],0x0),_0x457437=_0xe8887f[_0x36424d(0x361)]((_0x253d14,_0x18ec4a)=>_0x253d14+_0x18ec4a['t'],0x0);let _0x44472a=_0x36424d(0x37a)+formatDaysHoursMinutes(_0x479ffe)+'\x20|\x20<strong>Tổng\x20phiên:</strong>\x20'+_0x5ec377+_0x36424d(0x1ca)+_0x457437+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>';_0xe8887f['forEach'](_0x71d5bd=>{const _0x31a523=_0x36424d;_0x44472a+=_0x31a523(0x2cc)+escapeHTML(_0x71d5bd[_0x31a523(0x3c9)])+_0x31a523(0x449)+escapeHTML(_0x71d5bd[_0x31a523(0x393)])+_0x31a523(0x449)+formatDaysHoursMinutes(_0x71d5bd['m'])+'</td><td>'+_0x71d5bd['c']+_0x31a523(0x449)+_0x71d5bd['t']+_0x31a523(0x321);}),_0x44472a+=_0x36424d(0x19b);const _0x410655=$(_0x36424d(0x1d6));if(_0x410655)_0x410655['innerHTML']=_0x44472a;}function getMilestones(){const _0xa3a510=_0x274cec;return[{'hours':0x5,'title':_0xa3a510(0x258),'message':_0xa3a510(0x30d)},{'hours':0x14,'title':_0xa3a510(0x20f),'message':_0xa3a510(0x358)},{'hours':0x32,'title':_0xa3a510(0x3d3),'message':_0xa3a510(0x2cb)},{'hours':0x64,'title':'Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','message':'100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.'},{'hours':0xfa,'title':_0xa3a510(0x3d4),'message':_0xa3a510(0x3d9)},{'hours':0x1f4,'title':'Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','message':_0xa3a510(0x197)},{'hours':0x3e8,'title':_0xa3a510(0x409),'message':_0xa3a510(0x2c3)},{'hours':0x1388,'title':_0xa3a510(0x21a),'message':_0xa3a510(0x461)}][_0xa3a510(0x222)]((_0x4f5b9c,_0x4241df)=>_0x4241df[_0xa3a510(0x459)]-_0x4f5b9c['hours']);}async function checkAndShowMilestones(){const _0x2bbe9e=_0x274cec;if(!data||!data[_0x2bbe9e(0x1e5)])return;if(!Array['isArray'](data['settings'][_0x2bbe9e(0x3c6)]))data[_0x2bbe9e(0x1e5)][_0x2bbe9e(0x3c6)]=[];const _0x19e5be=data[_0x2bbe9e(0x3c7)]['reduce']((_0x3dd2bc,_0x1a2c53)=>{const _0x13efda=_0x2bbe9e;return _0x3dd2bc+_0x1a2c53[_0x13efda(0x1b3)]['reduce']((_0x3ecf98,_0x4037c6)=>{const _0x252d15=_0x13efda;return _0x3ecf98+(_0x4037c6[_0x252d15(0x396)][_0x252d15(0x24a)]||0x0);},0x0);},0x0),_0x36a8a2=_0x19e5be/0x3c,_0x48eba7=getMilestones(),_0x42bef8=Array['isArray'](data[_0x2bbe9e(0x1e5)][_0x2bbe9e(0x3c6)])?data[_0x2bbe9e(0x1e5)][_0x2bbe9e(0x3c6)]:[],_0x2080c2=_0x48eba7[_0x2bbe9e(0x46f)](_0x44bd85=>_0x36a8a2>=_0x44bd85[_0x2bbe9e(0x459)]&&!_0x42bef8[_0x2bbe9e(0x195)](_0x44bd85[_0x2bbe9e(0x459)]));if(_0x2080c2['length']===0x0)return![];const _0x4cb157=_0x2080c2[_0x2bbe9e(0x361)]((_0x3480aa,_0x4de1f5)=>_0x3480aa&&_0x3480aa['hours']>_0x4de1f5[_0x2bbe9e(0x459)]?_0x3480aa:_0x4de1f5,null);if(!_0x4cb157)return![];$(_0x2bbe9e(0x389))['textContent']=_0x4cb157[_0x2bbe9e(0x381)],$(_0x2bbe9e(0x424))[_0x2bbe9e(0x42d)]=_0x4cb157[_0x2bbe9e(0x3e5)],$(_0x2bbe9e(0x45a))['classList']['add'](_0x2bbe9e(0x212));try{trapFocus($('#modalMilestone'));}catch(_0x4108cd){}return data[_0x2bbe9e(0x1e5)][_0x2bbe9e(0x3c6)]['push'](_0x4cb157['hours']),await saveData(),!![];}async function seedAchievedMilestones(){const _0x3a15e5=_0x274cec;if(!data||!data[_0x3a15e5(0x1e5)])return;!Array[_0x3a15e5(0x458)](data[_0x3a15e5(0x1e5)]['achievedMilestones'])&&(data[_0x3a15e5(0x1e5)][_0x3a15e5(0x3c6)]=[],await saveData());}async function handleSendMessage(){const _0x20271f=_0x274cec,_0x36fb98=$('#btnSendMessage'),_0x49acb5=$(_0x20271f(0x2f7)),_0x5ced03=_0x49acb5[_0x20271f(0x260)][_0x20271f(0x378)](),_0x1850a8=getCurrentSubtopic();if(!_0x5ced03)return;if(!_0x1850a8){toast(t(_0x20271f(0x464)));return;}_0x49acb5[_0x20271f(0x260)]='',_0x36fb98[_0x20271f(0x36f)]=!![],_0x36fb98[_0x20271f(0x37d)]=_0x20271f(0x2f1),_0x1850a8['chatHistory'][_0x20271f(0x3b2)]({'role':_0x20271f(0x40e),'text':_0x5ced03}),renderChat();const _0x5c610e=await callGeminiAPI(_0x5ced03);_0x5c610e&&(_0x1850a8[_0x20271f(0x45f)]['push']({'role':'model','text':_0x5c610e}),await saveData(),renderChat()),_0x36fb98[_0x20271f(0x36f)]=![],_0x36fb98[_0x20271f(0x37d)]=_0x20271f(0x247);}function renderChat(){const _0x4377ce=_0x274cec,_0x532e6d=getCurrentSubtopic(),_0x8ef05e=$(_0x4377ce(0x1e4)),_0x434dd3=$(_0x4377ce(0x2f7)),_0x2438ad=$(_0x4377ce(0x26b));if(!_0x8ef05e||!_0x434dd3||!_0x2438ad)return;if(!_0x532e6d){_0x8ef05e['innerHTML']=_0x4377ce(0x24c),_0x434dd3[_0x4377ce(0x36f)]=!![],_0x2438ad[_0x4377ce(0x36f)]=!![];return;}_0x434dd3[_0x4377ce(0x36f)]=![],_0x2438ad[_0x4377ce(0x36f)]=![],_0x8ef05e[_0x4377ce(0x37d)]='';if(!_0x532e6d[_0x4377ce(0x45f)]||_0x532e6d['chatHistory'][_0x4377ce(0x27b)]===0x0){_0x8ef05e[_0x4377ce(0x37d)]=_0x4377ce(0x354);return;}_0x532e6d['chatHistory'][_0x4377ce(0x432)](_0xf4e098=>{const _0x473918=_0x4377ce,_0x1210ab=document[_0x473918(0x179)](_0x473918(0x2b3));_0x1210ab[_0x473918(0x176)]='chat-msg\x20'+_0xf4e098['role'],_0x1210ab['textContent']=_0xf4e098[_0x473918(0x18f)],_0x8ef05e[_0x473918(0x234)](_0x1210ab);}),_0x8ef05e[_0x4377ce(0x266)]=_0x8ef05e[_0x4377ce(0x3fa)];}async function handleSummarizeNote(){const _0x5da39a=_0x274cec,_0x2e9afa=$('#btnSummarizeNote'),_0x3e7e22=$(_0x5da39a(0x23d)),_0x17a6ef=_0x3e7e22[_0x5da39a(0x260)]['trim'](),_0x3b8b2f=getCurrentSubtopic();if(!_0x17a6ef){toast(_0x5da39a(0x1d3));return;}const _0x44191d=_0x2e9afa[_0x5da39a(0x37d)];_0x2e9afa['innerHTML']=_0x5da39a(0x2f1),_0x2e9afa['disabled']=!![];const _0x50d5bd=_0x5da39a(0x33f)+(_0x3b8b2f?.[_0x5da39a(0x1c2)]||'không\x20rõ')+'\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22'+_0x17a6ef+'\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]',_0x56f24f=await callGeminiAPI(_0x50d5bd);_0x56f24f&&(_0x3e7e22[_0x5da39a(0x260)]+='\x0a\x0a'+_0x56f24f),_0x2e9afa[_0x5da39a(0x37d)]=_0x44191d,_0x2e9afa[_0x5da39a(0x36f)]=![];}function clearChat(){const _0x4d68fc=_0x274cec,_0x37fbb9=getCurrentSubtopic();if(!_0x37fbb9){toast(t(_0x4d68fc(0x464)));return;}showConfirmModal(_0x4d68fc(0x356),_0x4d68fc(0x467),async _0xe951d9=>{const _0x236f37=_0x4d68fc;_0xe951d9&&(_0x37fbb9[_0x236f37(0x45f)]=[],await saveData(),renderChat(),toast('Đã\x20xóa\x20lịch\x20sử\x20chat.'));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0x2b04cc,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x10fbcf=_0x274cec,_0x3a36f5=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0x2b04cc,'enablejsapi':'1','origin':_0x10fbcf(0x306)})[_0x10fbcf(0x2ac)]();return _0x10fbcf(0x44e)+_0x2b04cc+'?'+_0x3a36f5;}function ensureFallbackFrame(){const _0x5d7b91=_0x274cec,_0x5df58a=document[_0x5d7b91(0x35f)]('youtube-player-container');if(!_0x5df58a)return null;if(ytFallbackFrame&&ytFallbackFrame['isConnected'])return ytFallbackFrame;const _0x5bf844=document[_0x5d7b91(0x179)](_0x5d7b91(0x42a));return _0x5bf844['id']='yt-fallback',_0x5bf844[_0x5d7b91(0x19a)]='1',_0x5bf844['height']='1',_0x5bf844['style'][_0x5d7b91(0x304)]=_0x5d7b91(0x1a1),_0x5bf844[_0x5d7b91(0x364)]['top']=_0x5d7b91(0x28c),_0x5bf844[_0x5d7b91(0x364)][_0x5d7b91(0x350)]=_0x5d7b91(0x28c),_0x5bf844['allow']=_0x5d7b91(0x283),_0x5df58a[_0x5d7b91(0x37d)]='',_0x5df58a[_0x5d7b91(0x234)](_0x5bf844),ytFallbackFrame=_0x5bf844,_0x5bf844;}function fallbackLoadVideo(_0x56672d,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x392444=_0x274cec,_0x3e6438=document[_0x392444(0x35f)]('youtube-player-container');if(!_0x3e6438)return;_0x3e6438['innerHTML']='';const _0x5bd0af=document[_0x392444(0x179)]('iframe');_0x5bd0af['id']='yt-fallback',_0x5bd0af['width']='1',_0x5bd0af[_0x392444(0x328)]='1',_0x5bd0af[_0x392444(0x364)][_0x392444(0x304)]=_0x392444(0x1a1),_0x5bd0af[_0x392444(0x364)][_0x392444(0x22c)]=_0x392444(0x28c),_0x5bd0af[_0x392444(0x364)]['left']='-9999px',_0x5bd0af['allow']=_0x392444(0x283),_0x5bd0af[_0x392444(0x2b6)]=buildFallbackSrc(_0x56672d,{'autoplay':autoplay,'mute':mute}),_0x3e6438[_0x392444(0x234)](_0x5bd0af),ytFallbackFrame=_0x5bd0af,ytFallbackIsPlaying=!!autoplay;try{const _0x114bc2=document[_0x392444(0x35f)]('btnToggleYtSound');if(_0x114bc2)_0x114bc2[_0x392444(0x42d)]=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x59cbd9){}}function fallbackPostMessage(_0x4c538d,_0x558ca9=[]){const _0x57897e=_0x274cec;try{if(!ytFallbackFrame||!ytFallbackFrame[_0x57897e(0x215)])return;ytFallbackFrame[_0x57897e(0x215)][_0x57897e(0x1c1)](JSON[_0x57897e(0x428)]({'event':'command','func':_0x4c538d,'args':_0x558ca9}),_0x57897e(0x306));}catch(_0x235ca2){}}function fallbackPlay(){const _0x2997=_0x274cec;fallbackPostMessage(_0x2997(0x249));}function _0x48ec(_0x387383,_0x26db00){const _0x13a1d8=_0x13a1();return _0x48ec=function(_0x48ec42,_0x4ff6ac){_0x48ec42=_0x48ec42-0x165;let _0x516288=_0x13a1d8[_0x48ec42];return _0x516288;},_0x48ec(_0x387383,_0x26db00);}function fallbackStop(){const _0x46c6d0=_0x274cec;try{ytFallbackFrame&&(ytFallbackFrame[_0x46c6d0(0x2b6)]='about:blank',ytFallbackIsPlaying=![]);}catch(_0xbe85cb){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){fallbackPostMessage('unMute');}function fallbackMute(){const _0x466739=_0x274cec;fallbackPostMessage(_0x466739(0x3fc));}window[_0x274cec(0x34d)]=function(){const _0x5175c0=_0x274cec;if(IS_FILE_PROTOCOL){try{window['__ytApiWatchdog']&&window[_0x5175c0(0x2c8)]['cancel']();}catch(_0x460a62){}return;}const _0x308f68={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0x5175c0(0x306)};(window['location'][_0x5175c0(0x245)]===_0x5175c0(0x340)||window[_0x5175c0(0x3c4)][_0x5175c0(0x245)]==='https:')&&(_0x308f68['origin']=window['location']['origin']);ytPlayer=new YT[(_0x5175c0(0x213))](_0x5175c0(0x251),_0x308f68);try{window[_0x5175c0(0x2c8)]&&window[_0x5175c0(0x2c8)][_0x5175c0(0x2a8)]();const _0xd132f0=document['getElementById'](_0x5175c0(0x43e));_0xd132f0&&(_0xd132f0[_0x5175c0(0x42d)]='');}catch(_0x36a36c){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x274cec(0x297)]('sound_unlocked')==='1';}catch(_0x474a34){}function showSoundPermission(){const _0x2e35d0=_0x274cec,_0x3f9302=document[_0x2e35d0(0x35f)](_0x2e35d0(0x211));if(!_0x3f9302)return;if(_ytUnlocked){_0x3f9302[_0x2e35d0(0x463)][_0x2e35d0(0x455)](_0x2e35d0(0x212));return;}_0x3f9302[_0x2e35d0(0x463)][_0x2e35d0(0x406)](_0x2e35d0(0x212));}function hideSoundPermission(){const _0x15c09e=_0x274cec,_0x317bfc=document['getElementById'](_0x15c09e(0x211));if(!_0x317bfc)return;_0x317bfc['classList'][_0x15c09e(0x455)](_0x15c09e(0x212));}function unlockAudioChain(){const _0x1189b6=_0x274cec;try{if(AUDIO_CTX&&typeof AUDIO_CTX[_0x1189b6(0x217)]===_0x1189b6(0x193))AUDIO_CTX[_0x1189b6(0x217)]();}catch(_0x43f556){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer['unMute']&&(ytPlayer['unMute'](),ytPlayer[_0x1189b6(0x249)]());}catch(_0x74597b){}_ytUnlocked=!![];try{localStorage['setItem'](_0x1189b6(0x394),'1');}catch(_0xef31bf){}hideSoundPermission(),toast(_0x1189b6(0x2db));}function onPlayerReady(_0x53dc82){const _0x6d0fa4=_0x274cec;try{const _0x1dbfd1=ytPlayer&&ytPlayer[_0x6d0fa4(0x282)]?ytPlayer[_0x6d0fa4(0x282)]():null;_0x1dbfd1&&_0x1dbfd1['setAttribute'](_0x6d0fa4(0x407),'autoplay;\x20encrypted-media;\x20picture-in-picture');}catch(_0x6ab104){}try{if(ytPlayer&&ytPlayer[_0x6d0fa4(0x2af)])ytPlayer[_0x6d0fa4(0x2af)](data&&data[_0x6d0fa4(0x1e5)]&&data[_0x6d0fa4(0x1e5)][_0x6d0fa4(0x2d9)]||0x50);}catch(_0x2e9a9f){}try{const _0x52b1de=getActiveVideoId&&getActiveVideoId();if(_0x52b1de&&ytPlayer&&ytPlayer[_0x6d0fa4(0x3fc)]&&ytPlayer[_0x6d0fa4(0x249)]){ytPlayer[_0x6d0fa4(0x3fc)](),ytPlayer[_0x6d0fa4(0x249)](),_ytPrimed=!![];const _0x417a94=()=>{const _0x5ac33d=_0x6d0fa4;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x1d5a77){}window[_0x5ac33d(0x373)](_0x5ac33d(0x414),_0x417a94,!![]),window[_0x5ac33d(0x373)]('keydown',_0x417a94,!![]);};window[_0x6d0fa4(0x36b)](_0x6d0fa4(0x414),_0x417a94,!![]),window[_0x6d0fa4(0x36b)](_0x6d0fa4(0x348),_0x417a94,!![]),showSoundPermission();}}catch(_0x37eddf){}updateYouTubePlayer();}function onPlayerStateChange(_0x39dfa6){const _0x3ff1b8=_0x274cec,_0x5c581c=$(_0x3ff1b8(0x220));_0x39dfa6[_0x3ff1b8(0x199)]==YT[_0x3ff1b8(0x46a)][_0x3ff1b8(0x26e)]?(_0x5c581c[_0x3ff1b8(0x42d)]='⏸️',hideSoundPermission()):_0x5c581c['textContent']='▶️';if(_0x39dfa6['data']===YT[_0x3ff1b8(0x46a)][_0x3ff1b8(0x262)]){if(!ytUserPaused)ytPlayer[_0x3ff1b8(0x249)]();}}async function ytFadeTo(_0x5a0c52,_0x6383bd=0xfa){const _0x38cbf7=_0x274cec;try{if(!ytPlayer||!ytPlayer[_0x38cbf7(0x185)]||!ytPlayer['setVolume'])return;ytPlayer[_0x38cbf7(0x470)]();const _0x10285c=ytPlayer[_0x38cbf7(0x185)](),_0x590eb1=_0x5a0c52-_0x10285c;if(Math[_0x38cbf7(0x44f)](_0x590eb1)<0x1||_0x6383bd<=0x0){ytPlayer['setVolume'](_0x5a0c52);return;}const _0x3ecc18=performance[_0x38cbf7(0x307)]();await new Promise(_0x588055=>{const _0x45bad0=_0x156d79=>{const _0x5f0c64=Math['min'](0x1,(_0x156d79-_0x3ecc18)/_0x6383bd),_0x2587e7=Math['round'](_0x10285c+_0x590eb1*_0x5f0c64);ytPlayer['setVolume'](_0x2587e7);if(_0x5f0c64<0x1)requestAnimationFrame(_0x45bad0);else _0x588055();};requestAnimationFrame(_0x45bad0);});}catch(_0x3935c8){}}async function ytFadeInPlay(_0x294bf9=0xdc){const _0x376796=_0x274cec;try{const _0x5893e5=Math[_0x376796(0x405)](0x0,Math['min'](0x64,data&&data['settings']&&data[_0x376796(0x1e5)]['youtubeVolume']||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer['unMute'](),ytPlayer[_0x376796(0x249)]();try{ytPlayer['setVolume'](0x0);}catch(_0x27a745){}await ytFadeTo(_0x5893e5,_0x294bf9);}else{const _0x24299d=getActiveVideoId();_0x24299d&&fallbackLoadVideo(_0x24299d,{'autoplay':0x1,'mute':0x0});}}catch(_0x43db0e){}}async function ytFadeOutPause(_0x2118f7=0xb4){const _0x3e6927=_0x274cec;try{const _0x201514=Math[_0x3e6927(0x405)](0x0,Math[_0x3e6927(0x3dc)](0x64,data&&data[_0x3e6927(0x1e5)]&&data['settings'][_0x3e6927(0x2d9)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0x2118f7);try{ytPlayer['pauseVideo'](),ytPlayer[_0x3e6927(0x2af)](_0x201514);}catch(_0x240932){}}else try{fallbackPause();}catch(_0x303d7b){}}catch(_0x36cfb6){}}async function updateYouTubePlayer(){const _0x510cc6=_0x274cec,_0x282ff3=getActiveVideoId();if(data[_0x510cc6(0x1e5)]['useYtThumbnailAsBg']&&_0x282ff3){const _0x4f3f2d=_0x510cc6(0x165)+_0x282ff3+_0x510cc6(0x427),_0x2e069d=new Image();_0x2e069d[_0x510cc6(0x45b)]=async()=>{const _0xb29f28=_0x510cc6;data[_0xb29f28(0x1e5)][_0xb29f28(0x474)]=_0x4f3f2d,await saveData(),applyCustomBg();},_0x2e069d['onerror']=async()=>{const _0xedb3be=_0x510cc6,_0x33cc1d=_0xedb3be(0x165)+_0x282ff3+_0xedb3be(0x3ab);data['settings'][_0xedb3be(0x474)]=_0x33cc1d,await saveData(),applyCustomBg();},_0x2e069d[_0x510cc6(0x2b6)]=_0x4f3f2d;}else!_0x282ff3&&(data[_0x510cc6(0x1e5)][_0x510cc6(0x474)]='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0x282ff3){fallbackStop(),hideSoundPermission();return;}const _0x5a4592=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x282ff3,{'autoplay':0x1,'mute':_0x5a4592});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer[_0x510cc6(0x27d)]){try{ensureYouTubeAPI();}catch(_0x523f07){}return;}if(!_0x282ff3){if(ytPlayer[_0x510cc6(0x178)])ytPlayer[_0x510cc6(0x178)]();hideSoundPermission();return;}ytPlayer['cueVideoById'](_0x282ff3),ytPlayer[_0x510cc6(0x2af)](data['settings'][_0x510cc6(0x2d9)]);}function toggleYtSound(){const _0x5af4ac=_0x274cec;if(!_ytUnlocked){try{ensureAudio();}catch(_0x1947c2){}try{unlockAudioChain();}catch(_0x4e3b14){}return;}if(IS_FILE_PROTOCOL){const _0x531d31=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame['isConnected']){if(!_0x531d31){toast(_0x5af4ac(0x288));return;}fallbackLoadVideo(_0x531d31,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x10bb4a=document[_0x5af4ac(0x35f)](_0x5af4ac(0x16f));if(_0x10bb4a)_0x10bb4a[_0x5af4ac(0x42d)]='⏸️';}catch(_0x5603d1){}toast(_0x5af4ac(0x1d8));return;}if(ytFallbackIsPlaying)fallbackPostMessage(_0x5af4ac(0x362)),ytFallbackIsPlaying=![],toast('Đã\x20dừng\x20nhạc\x20nền.');else{if(!_0x531d31){toast(_0x5af4ac(0x288));return;}fallbackPostMessage(_0x5af4ac(0x249)),ytFallbackIsPlaying=!![],toast(_0x5af4ac(0x1d8));}try{const _0x132e25=document[_0x5af4ac(0x35f)](_0x5af4ac(0x16f));if(_0x132e25)_0x132e25['textContent']=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x3977c8){}return;}if(!ytPlayer||typeof ytPlayer[_0x5af4ac(0x20a)]!==_0x5af4ac(0x193)){try{ensureYouTubeAPI();}catch(_0xddd68b){}return;}const _0x21b0fa=ytPlayer['getPlayerState']();_0x21b0fa===YT['PlayerState'][_0x5af4ac(0x26e)]||_0x21b0fa===YT[_0x5af4ac(0x46a)][_0x5af4ac(0x1de)]?(ytFadeOutPause(),ytUserPaused=!![],toast(_0x5af4ac(0x3b0))):(ytFadeInPlay(),ytUserPaused=![],toast(_0x5af4ac(0x1d8)));}function bindEvents(){const _0x1eb245=_0x274cec;try{const _0x2359be=document[_0x1eb245(0x308)]('#welcomePanel\x20p');_0x2359be&&(_0x2359be[_0x1eb245(0x37d)]=_0x1eb245(0x237));}catch(_0x23e2df){}on($('#btnToggleBg'),_0x1eb245(0x27e),toggleBackgroundView),on($(_0x1eb245(0x1ba)),'click',()=>{const _0x178bed=_0x1eb245;$(_0x178bed(0x45a))[_0x178bed(0x463)][_0x178bed(0x455)](_0x178bed(0x212));try{releaseFocus();}catch(_0x51cdae){}}),on($(_0x1eb245(0x410)),'click',()=>showInputModal('Tên\x20Chủ\x20đề\x20mới?',async _0x20ff85=>{const _0x49bf5e=_0x1eb245;if(!_0x20ff85)return;data[_0x49bf5e(0x3c7)][_0x49bf5e(0x3b2)]({'id':uid('t'),'name':_0x20ff85,'subtopics':[]}),await saveData(),renderTopics();})),on($(_0x1eb245(0x3f7)),_0x1eb245(0x27e),()=>storageManager[_0x1eb245(0x42f)](data)),on($(_0x1eb245(0x426)),'change',_0x5485eb=>{const _0x25ed14=_0x1eb245,_0x34b1b3=_0x5485eb[_0x25ed14(0x479)]['files'][0x0];if(!_0x34b1b3)return;storageManager[_0x25ed14(0x286)](_0x34b1b3)[_0x25ed14(0x24e)](async _0x52c381=>{const _0x92e57=_0x25ed14;data=_0x52c381,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast(_0x92e57(0x2d6)),renderAll();})[_0x25ed14(0x3f9)](_0x58aeed=>toast('Nhập\x20thất\x20bại:\x20'+_0x58aeed[_0x25ed14(0x3e5)])),_0x5485eb[_0x25ed14(0x479)][_0x25ed14(0x260)]=null;}),on($('#btnRestoreBackup'),'click',()=>{const _0x1996a8=_0x1eb245,_0x38af14=$(_0x1996a8(0x279)),_0x597f11=_0x38af14?_0x38af14[_0x1996a8(0x260)]:'';if(!_0x597f11){toast(_0x1996a8(0x3cc));return;}showConfirmModal(_0x1996a8(0x3e8),'Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20'+new Date(_0x597f11)['toLocaleDateString']()+_0x1996a8(0x1c8),_0x183183=>{const _0x4e4f3c=_0x1996a8;_0x183183&&storageManager['restoreBackup'](_0x597f11)[_0x4e4f3c(0x24e)](_0x3a1af3=>{const _0x25b85f=_0x4e4f3c;data=_0x3a1af3,toast(_0x25b85f(0x39f)),setTimeout(()=>window[_0x25b85f(0x3c4)][_0x25b85f(0x269)](),0x5dc);})['catch'](_0x21996f=>{const _0xc5fc01=_0x4e4f3c;toast(_0xc5fc01(0x2ca)+_0x21996f['message']);});});}),on($(_0x1eb245(0x268)),_0x1eb245(0x29f),_0x3a13f2=>{const _0x23a87b=_0x1eb245,_0x33812d=_0x3a13f2[_0x23a87b(0x479)][_0x23a87b(0x260)];applyTheme(_0x33812d);if(_0x33812d===_0x23a87b(0x447)||_0x33812d===_0x23a87b(0x3e7)){const _0x81cde8=$(_0x23a87b(0x218));_0x81cde8&&(_0x81cde8['checked']=![],toast('Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.',0x7d0));try{document[_0x23a87b(0x1e1)][_0x23a87b(0x364)]['setProperty'](_0x23a87b(0x259),'none');}catch(_0xa7084a){}}else{const _0x2b5b3f=$(_0x23a87b(0x218));_0x2b5b3f&&(_0x2b5b3f[_0x23a87b(0x254)]=!![]);try{updateYouTubePlayer();}catch(_0x105a71){}}}),on($(_0x1eb245(0x1b6)),_0x1eb245(0x27e),openSettings),on($(_0x1eb245(0x16b)),_0x1eb245(0x27e),()=>{const _0xf35417=_0x1eb245;switchView(_0xf35417(0x3c7)),$(_0xf35417(0x410))[_0xf35417(0x27e)]();}),on($('#btnDashboard'),_0x1eb245(0x27e),()=>{const _0x345629=_0x1eb245;renderDashboard(),$(_0x345629(0x1d7))[_0x345629(0x463)][_0x345629(0x406)]('show');}),on($(_0x1eb245(0x276)),'click',()=>{const _0x35db08=_0x1eb245;$(_0x35db08(0x1d7))[_0x35db08(0x463)][_0x35db08(0x455)](_0x35db08(0x212));}),on($(_0x1eb245(0x23c)),_0x1eb245(0x27e),closeSettings),on($('#btnSaveSettings'),_0x1eb245(0x27e),saveSettings),on($(_0x1eb245(0x1e7)),'click',setDefaults),on($(_0x1eb245(0x191)),_0x1eb245(0x27e),()=>{const _0x20eeaf=_0x1eb245;ensureAudio(),playSound(_0x20eeaf(0x39b));}),on($('#btnToggleCustomSounds'),_0x1eb245(0x27e),_0x2a0d57=>{const _0xfbc0a0=_0x1eb245;_0x2a0d57['preventDefault']();const _0x267277=$(_0xfbc0a0(0x478));if(_0x267277)_0x267277['classList']['toggle'](_0xfbc0a0(0x219));}),on($(_0x1eb245(0x357)),_0x1eb245(0x27e),async()=>{const _0x11423e=_0x1eb245,_0x3d167e=getCurrentSubtopic();if(!_0x3d167e)return;const _0x21ea26=pendingNoteSessionId,_0x29bebb=_0x3d167e[_0x11423e(0x31d)][_0x11423e(0x369)](_0x1f0143=>_0x1f0143['id']===_0x21ea26);_0x29bebb&&(_0x29bebb[_0x11423e(0x225)]=$('#noteText')[_0x11423e(0x260)]['trim'](),await saveData(),renderStatsHistory(),toast('Đã\x20lưu\x20ghi\x20chú')),closeNoteModal();}),on($(_0x1eb245(0x44c)),_0x1eb245(0x27e),()=>closeNoteModal()),on($('#btnAddGeneralNote'),'click',addGeneralNote),on($('#btnSummarizeNote'),_0x1eb245(0x27e),handleSummarizeNote),on($(_0x1eb245(0x26b)),_0x1eb245(0x27e),handleSendMessage),on($(_0x1eb245(0x2f7)),_0x1eb245(0x348),_0x4c616a=>{if(_0x4c616a['key']==='Enter')handleSendMessage();}),$$('#aiPromptSuggestions\x20button')[_0x1eb245(0x432)](_0x40a75c=>{const _0xba821f=_0x1eb245;on(_0x40a75c,_0xba821f(0x27e),()=>{const _0x3275a5=_0xba821f,_0x5d94b6=_0x40a75c[_0x3275a5(0x3a0)][_0x3275a5(0x196)];$(_0x3275a5(0x2f7))[_0x3275a5(0x260)]=_0x5d94b6,$(_0x3275a5(0x2f7))[_0x3275a5(0x32a)]();});}),on($(_0x1eb245(0x2a6)),_0x1eb245(0x27e),clearChat),on($(_0x1eb245(0x166)),_0x1eb245(0x27e),addSubtopicTask),on($('#newSubtopicTaskInput'),_0x1eb245(0x348),_0x190b3b=>{if(_0x190b3b['key']==='Enter')addSubtopicTask();}),on($(_0x1eb245(0x220)),_0x1eb245(0x27e),toggleYtSound),on($(_0x1eb245(0x36e)),'click',()=>{ensureAudio(),unlockAudioChain();}),on($(_0x1eb245(0x412)),_0x1eb245(0x29f),_0x45ac81=>{const _0x8fceb6=_0x1eb245,_0x2e8f93=parseInt(_0x45ac81[_0x8fceb6(0x479)][_0x8fceb6(0x260)],0xa);ytPlayer&&ytPlayer['setVolume']&&ytPlayer['setVolume'](_0x2e8f93);}),on($(_0x1eb245(0x274)),_0x1eb245(0x29f),handleYoutubeUrlInput),$$(_0x1eb245(0x194))[_0x1eb245(0x432)](_0x39a83b=>{_0x39a83b['addEventListener']('click',()=>{const _0x2c9471=_0x48ec,_0x249cc2=_0x39a83b['dataset'][_0x2c9471(0x473)],_0x38a80f=data?.['settings']?.[_0x2c9471(0x22e)]||_0x2c9471(0x37c);if(_0x38a80f===_0x249cc2&&_0x249cc2!==_0x2c9471(0x37c))switchView(_0x2c9471(0x37c));else switchView(_0x249cc2);});}),$$(_0x1eb245(0x39e))[_0x1eb245(0x432)](_0x1a42ff=>{const _0x5deeed=_0x1eb245;_0x1a42ff['addEventListener'](_0x5deeed(0x27e),()=>{const _0x2fac46=_0x5deeed,_0x3a8f98=_0x1a42ff[_0x2fac46(0x3a0)]['tab'],_0x4c4232=_0x1a42ff[_0x2fac46(0x371)](_0x2fac46(0x1fa));if(!_0x4c4232)return;_0x4c4232[_0x2fac46(0x172)](_0x2fac46(0x39e))[_0x2fac46(0x432)](_0x2bd8ee=>_0x2bd8ee[_0x2fac46(0x463)][_0x2fac46(0x455)](_0x2fac46(0x2d5))),_0x1a42ff[_0x2fac46(0x463)][_0x2fac46(0x406)]('active'),_0x4c4232[_0x2fac46(0x172)](_0x2fac46(0x1a2))[_0x2fac46(0x432)](_0x34014e=>{const _0x36c5c4=_0x2fac46;_0x34014e['classList'][_0x36c5c4(0x455)](_0x36c5c4(0x2d5)),_0x34014e[_0x36c5c4(0x364)][_0x36c5c4(0x37e)]=_0x36c5c4(0x1a4);});const _0x5b4802=_0x4c4232[_0x2fac46(0x308)]('#'+_0x3a8f98);_0x5b4802&&(_0x5b4802[_0x2fac46(0x463)]['add'](_0x2fac46(0x2d5)),_0x5b4802[_0x2fac46(0x364)][_0x2fac46(0x37e)]=_0x2fac46(0x3a7),_0x4c4232[_0x2fac46(0x371)](_0x2fac46(0x3b8))&&(_0x5b4802[_0x2fac46(0x364)]['display']='flex'));});});const _0x3c51a9=$(_0x1eb245(0x1e0));function _0xa38734(_0x57cbb1,_0x4d9639=null){const _0xf8e250=_0x1eb245;try{document[_0xf8e250(0x236)]('styleWithCSS',![],!![]);}catch(_0x420429){}try{document['execCommand'](_0x57cbb1,![],_0x4d9639);}catch(_0x2eee39){}if(_0x3c51a9)_0x3c51a9[_0xf8e250(0x32a)]();}on($(_0x1eb245(0x1d9)),_0x1eb245(0x27e),()=>_0xa38734(_0x1eb245(0x23b))),on($('#toolItalic'),_0x1eb245(0x27e),()=>_0xa38734(_0x1eb245(0x180))),on($(_0x1eb245(0x2ef)),_0x1eb245(0x27e),()=>_0xa38734(_0x1eb245(0x3af),_0x1eb245(0x387))),on($(_0x1eb245(0x29e)),'click',()=>_0xa38734(_0x1eb245(0x3ce))),on($(_0x1eb245(0x3bb)),_0x1eb245(0x27e),()=>_0xa38734(_0x1eb245(0x301)));const _0x11e01a=$(_0x1eb245(0x198)),_0x2baab9=$(_0x1eb245(0x353));on($(_0x1eb245(0x336)),_0x1eb245(0x27e),_0x56cacf=>{const _0x377009=_0x1eb245;if(!_0x2baab9)return;_0x56cacf['stopPropagation'](),_0x2baab9['classList'][_0x377009(0x1bd)](_0x377009(0x219));}),$$(_0x1eb245(0x23a))[_0x1eb245(0x432)](_0xb928ac=>{const _0x43e8ec=_0x1eb245;on(_0xb928ac,_0x43e8ec(0x27e),_0x400263=>{const _0x5ee249=_0x43e8ec;_0x400263['preventDefault']();const _0x59f4a3=_0xb928ac[_0x5ee249(0x3a0)]['color']||'';let _0x382b24=_0x59f4a3;try{const _0x5b8bb8=_0x59f4a3[_0x5ee249(0x34e)](/--[a-zA-Z0-9_-]+/);if(_0x5b8bb8)_0x382b24=getComputedStyle(document[_0x5ee249(0x1e1)])[_0x5ee249(0x240)](_0x5b8bb8[0x0])['trim']();}catch(_0xf5af4b){}_0xa38734(_0x5ee249(0x383),_0x382b24);if(_0x2baab9)_0x2baab9[_0x5ee249(0x463)][_0x5ee249(0x406)](_0x5ee249(0x219));});}),on(document,'click',_0x407d22=>{const _0xb8168d=_0x1eb245;if(!_0x11e01a||!_0x2baab9)return;!_0x11e01a['contains'](_0x407d22[_0xb8168d(0x479)])&&!_0x2baab9['classList'][_0xb8168d(0x205)](_0xb8168d(0x219))&&_0x2baab9[_0xb8168d(0x463)]['add'](_0xb8168d(0x219));});function _0x42483(_0x398583){const _0x2c8241=_0x1eb245,_0x218de9=data?.[_0x2c8241(0x1e5)]?.[_0x2c8241(0x280)]||[],_0xdea1de=_0x398583?_0x218de9[_0x2c8241(0x369)](_0x13fba6=>_0x13fba6['id']===_0x398583):null;$(_0x2c8241(0x31a))['value']=_0xdea1de&&_0xdea1de['id']||'',$(_0x2c8241(0x1f3))[_0x2c8241(0x42d)]=_0xdea1de?_0x2c8241(0x420):_0x2c8241(0x318),$('#methodEditorTitleInput')['value']=_0xdea1de&&_0xdea1de['title']||'';const _0x4e5732=$(_0x2c8241(0x1e0));if(_0x4e5732)_0x4e5732[_0x2c8241(0x37d)]=_0xdea1de&&_0xdea1de['content']||'';$(_0x2c8241(0x2d0))[_0x2c8241(0x463)]['add']('show');try{trapFocus($(_0x2c8241(0x2d0)));}catch(_0x3a350c){}try{const _0x2125a0=$(_0x2c8241(0x37f));if(_0x2125a0){const _0x1dd7eb=!!(data?.['settings']?.[_0x2c8241(0x433)]&&data[_0x2c8241(0x1e5)]['apiKey'][_0x2c8241(0x378)]());_0x2125a0[_0x2c8241(0x36f)]=!_0x1dd7eb,_0x2125a0[_0x2c8241(0x381)]=_0x1dd7eb?_0x2c8241(0x2f3):_0x2c8241(0x413);}}catch(_0x5d6c8a){}}on($('#btnCancelMethodEditor'),_0x1eb245(0x27e),()=>{const _0x1f656f=_0x1eb245;$(_0x1f656f(0x2d0))[_0x1f656f(0x463)]['remove'](_0x1f656f(0x212));try{releaseFocus();}catch(_0xb14ba0){}}),on($(_0x1eb245(0x2e1)),'click',async()=>{const _0x268cb8=_0x1eb245,_0x324d81=$('#methodEditorId')[_0x268cb8(0x260)]||uid('m'),_0x3032f5=($(_0x268cb8(0x232))[_0x268cb8(0x260)]||'')[_0x268cb8(0x378)](),_0x28947a=$(_0x268cb8(0x1e0)),_0x18c1e2=_0x28947a?_0x28947a[_0x268cb8(0x37d)]||'':'';if(!Array[_0x268cb8(0x458)](data[_0x268cb8(0x1e5)][_0x268cb8(0x280)]))data[_0x268cb8(0x1e5)][_0x268cb8(0x280)]=[];const _0x2a286c=data[_0x268cb8(0x1e5)]['methods']['findIndex'](_0x3485b4=>_0x3485b4['id']===_0x324d81),_0x155c9b={'id':_0x324d81,'title':_0x3032f5,'content':_0x18c1e2};if(_0x2a286c>=0x0)data[_0x268cb8(0x1e5)][_0x268cb8(0x280)][_0x2a286c]=_0x155c9b;else data[_0x268cb8(0x1e5)][_0x268cb8(0x280)][_0x268cb8(0x325)](_0x155c9b);await storageManager[_0x268cb8(0x34a)](data['settings']),renderMethods(),$(_0x268cb8(0x2d0))['classList'][_0x268cb8(0x455)]('show');try{releaseFocus();}catch(_0x2d7819){}}),on($(_0x1eb245(0x37f)),_0x1eb245(0x27e),async()=>{const _0x1ce307=_0x1eb245,_0x5a0b82=$(_0x1ce307(0x1e0));if(!_0x5a0b82)return;const _0x13377c=(_0x5a0b82[_0x1ce307(0x42d)]||'')[_0x1ce307(0x378)]();if(!_0x13377c||_0x13377c['length']<0x14){toast(_0x1ce307(0x3c8));return;}const _0x315e35=$('#btnAutoFormat');_0x315e35&&(_0x315e35['disabled']=!![],_0x315e35[_0x1ce307(0x37d)]=_0x1ce307(0x2f1));const _0x129c5b=_0x1ce307(0x460)+_0x13377c+'\x22',_0x5128a7=await callGeminiAPI(_0x129c5b);_0x5128a7?(_0x5a0b82['innerHTML']=_0x5128a7,toast(_0x1ce307(0x345))):toast(_0x1ce307(0x26a)),_0x315e35&&(_0x315e35[_0x1ce307(0x36f)]=![],_0x315e35[_0x1ce307(0x37d)]=_0x1ce307(0x2ae));}),on($(_0x1eb245(0x404)),_0x1eb245(0x27e),()=>_0x42483());const _0x19dd0b=document['querySelector'](_0x1eb245(0x1cb));_0x19dd0b&&_0x19dd0b[_0x1eb245(0x36b)]('click',_0x355113=>{const _0x150868=_0x1eb245,_0x1aea9e=_0x355113[_0x150868(0x479)][_0x150868(0x371)]&&_0x355113['target'][_0x150868(0x371)]('.method-edit'),_0x28e347=!_0x1aea9e&&_0x355113[_0x150868(0x479)][_0x150868(0x371)]&&_0x355113['target']['closest'](_0x150868(0x450));if(_0x1aea9e){_0x355113[_0x150868(0x18a)](),_0x355113[_0x150868(0x382)]();const _0xeb4021=_0x1aea9e['dataset']['id'];if(_0xeb4021)_0x42483(_0xeb4021);return;}if(_0x28e347){_0x355113[_0x150868(0x18a)](),_0x355113[_0x150868(0x382)]();const _0x37ca75=_0x28e347[_0x150868(0x3a0)]['id'];if(!_0x37ca75)return;const _0x2fa1a2=data?.[_0x150868(0x1e5)]?.[_0x150868(0x280)]||[],_0x397f7c=_0x2fa1a2['find'](_0x3d9b11=>_0x3d9b11['id']===_0x37ca75);if(!_0x397f7c)return;showConfirmModal(_0x150868(0x356),_0x150868(0x439)+(_0x397f7c[_0x150868(0x381)]||'')+'\x22?',async _0x2c5638=>{const _0x528e12=_0x150868;if(!_0x2c5638)return;data[_0x528e12(0x1e5)][_0x528e12(0x280)]=_0x2fa1a2[_0x528e12(0x46f)](_0x8d32da=>_0x8d32da['id']!==_0x37ca75),await storageManager[_0x528e12(0x34a)](data[_0x528e12(0x1e5)]),renderMethods();});}});$$(_0x1eb245(0x1ae))[_0x1eb245(0x432)](_0x417ba1=>{const _0x3a9534=_0x1eb245;_0x417ba1[_0x3a9534(0x36b)]('click',()=>{const _0x57f3c2=_0x3a9534;editingPreset=_0x417ba1[_0x57f3c2(0x3a0)]['presetTarget'],highlightPresetSelector(),loadEditingPresetFields();});}),$$(_0x1eb245(0x31f))[_0x1eb245(0x432)](_0x23bc6b=>{_0x23bc6b['addEventListener']('click',_0xfd5f17=>{const _0x28048c=_0x48ec,_0x41aa39=_0xfd5f17['target'][_0x28048c(0x3a0)]['preset'],_0x15cb31=data[_0x28048c(0x1e5)]['preset'];if(_0x41aa39===_0x15cb31)return;timer[_0x28048c(0x3e4)]!==_0x28048c(0x400)?showConfirmModal('Xác\x20nhận\x20chuyển\x20đổi','Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20'+_0x41aa39+'?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.',_0xc2971e=>{const _0x3cbdd0=_0x28048c;_0xc2971e&&(timer[_0x3cbdd0(0x2ed)](),timer['setPreset'](_0x41aa39),renderAll(),toast(_0x3cbdd0(0x3c3)+_0x41aa39+'.'));}):(timer[_0x28048c(0x36d)](_0x41aa39),renderAll(),toast('Đã\x20chuyển\x20sang\x20Kiểu\x20'+_0x41aa39+'.'));});}),on($(_0x1eb245(0x3f2)),_0x1eb245(0x27e),()=>timer['start']()),on($('#btnFinishFlow'),'click',()=>timer[_0x1eb245(0x19e)]()),on($(_0x1eb245(0x334)),'click',()=>timer['pause']()),on($(_0x1eb245(0x2eb)),_0x1eb245(0x27e),()=>timer[_0x1eb245(0x217)]()),on($(_0x1eb245(0x2f6)),_0x1eb245(0x27e),()=>timer[_0x1eb245(0x41a)]()),on($('#btnReset'),_0x1eb245(0x27e),()=>timer[_0x1eb245(0x2ed)]()),on($(_0x1eb245(0x337)),_0x1eb245(0x27e),()=>timer[_0x1eb245(0x2c6)]()),on($(_0x1eb245(0x436)),_0x1eb245(0x253),_0x2d6fc6=>{const _0xe1b385=_0x1eb245;handleFileUpload(_0x2d6fc6[_0xe1b385(0x479)][_0xe1b385(0x313)][0x0],async _0x56a755=>{const _0x205bdd=_0xe1b385;data[_0x205bdd(0x1e5)][_0x205bdd(0x474)]=_0x56a755,await saveData(),applyCustomBg(),toast(_0x205bdd(0x16e));}),_0x2d6fc6[_0xe1b385(0x479)][_0xe1b385(0x260)]=null;}),on($(_0x1eb245(0x43a)),_0x1eb245(0x27e),async()=>{const _0x4d0854=_0x1eb245;data['settings']['customBg']='',data[_0x4d0854(0x1e5)]['useYtThumbnailAsBg']=![],await saveData(),applyCustomBg(),toast(_0x4d0854(0x3f4)),$(_0x4d0854(0x3b8))[_0x4d0854(0x463)][_0x4d0854(0x205)](_0x4d0854(0x212))&&openSettings();}),on($(_0x1eb245(0x323)),_0x1eb245(0x253),_0x20e4a1=>{const _0x2dc8d3=_0x1eb245;handleFileUpload(_0x20e4a1[_0x2dc8d3(0x479)][_0x2dc8d3(0x313)][0x0],async _0x204292=>{const _0x151e55=_0x2dc8d3;data[_0x151e55(0x1e5)][_0x151e55(0x2d4)][_0x151e55(0x39b)]=_0x204292,await saveData(),toast(_0x151e55(0x1c7));}),_0x20e4a1['target'][_0x2dc8d3(0x260)]=null;}),on($(_0x1eb245(0x1fd)),'change',_0x30e727=>{const _0x587225=_0x1eb245;handleFileUpload(_0x30e727['target']['files'][0x0],async _0x1c5f16=>{const _0x350d22=_0x48ec;data['settings'][_0x350d22(0x2d4)][_0x350d22(0x330)]=_0x1c5f16,await saveData(),toast(_0x350d22(0x1aa));}),_0x30e727[_0x587225(0x479)]['value']=null;}),on($(_0x1eb245(0x2de)),_0x1eb245(0x253),_0x2385ad=>{const _0x5e4a48=_0x1eb245;handleFileUpload(_0x2385ad['target'][_0x5e4a48(0x313)][0x0],async _0x1f24de=>{const _0x1d00f6=_0x5e4a48;data[_0x1d00f6(0x1e5)][_0x1d00f6(0x2d4)][_0x1d00f6(0x1c6)]=_0x1f24de,await saveData(),toast(_0x1d00f6(0x1a9));}),_0x2385ad[_0x5e4a48(0x479)]['value']=null;}),on($(_0x1eb245(0x367)),'click',toggleFullScreen),document[_0x1eb245(0x36b)](_0x1eb245(0x465),updateFullscreenButton),window[_0x1eb245(0x36b)](_0x1eb245(0x348),_0x349a56=>{const _0x55562d=_0x1eb245,_0x4a8fda=(_0x349a56['target']['tagName']||'')[_0x55562d(0x228)](),_0x1b03cc=['input',_0x55562d(0x1f8),_0x55562d(0x18e)]['includes'](_0x4a8fda);if(_0x349a56[_0x55562d(0x2a2)]===_0x55562d(0x1ea)&&!_0x1b03cc){_0x349a56['preventDefault']();if(timer[_0x55562d(0x3e4)]==='idle'||timer['state']===_0x55562d(0x294))timer['start']();else timer[_0x55562d(0x434)]();}(_0x349a56[_0x55562d(0x261)]==='n'||_0x349a56[_0x55562d(0x261)]==='N')&&(!_0x1b03cc&&(_0x349a56['preventDefault'](),timer[_0x55562d(0x41a)]()));if(_0x349a56[_0x55562d(0x261)]==='Escape'){$$(_0x55562d(0x343))[_0x55562d(0x432)](_0x312ff2=>_0x312ff2[_0x55562d(0x463)][_0x55562d(0x455)]('show'));try{releaseFocus();}catch(_0x4308c3){}}if(_0x349a56['altKey']&&!_0x1b03cc){if(_0x349a56[_0x55562d(0x261)]===_0x55562d(0x46d))_0x349a56['preventDefault'](),_0x572a6d(0x0,-0xa);else{if(_0x349a56[_0x55562d(0x261)]==='ArrowDown')_0x349a56[_0x55562d(0x18a)](),_0x572a6d(0x0,0xa);else{if(_0x349a56[_0x55562d(0x261)]===_0x55562d(0x273))_0x349a56[_0x55562d(0x18a)](),_0x572a6d(-0xa,0x0);else _0x349a56[_0x55562d(0x261)]===_0x55562d(0x1c5)&&(_0x349a56[_0x55562d(0x18a)](),_0x572a6d(0xa,0x0));}}}}),$$('.modal')[_0x1eb245(0x432)](_0x1d1688=>_0x1d1688[_0x1eb245(0x36b)]('click',_0x302667=>{const _0x5691be=_0x1eb245;if(_0x302667&&_0x302667[_0x5691be(0x479)]&&_0x302667['target']['id']==='modalMethodEditor')return;if(_0x302667[_0x5691be(0x479)]===_0x1d1688){_0x1d1688[_0x5691be(0x463)][_0x5691be(0x455)]('show');try{releaseFocus();}catch(_0x5ae7be){}}})),window[_0x1eb245(0x36b)](_0x1eb245(0x27e),_0x33f9ce=>{const _0x36429b=_0x1eb245;!_0x33f9ce[_0x36429b(0x479)][_0x36429b(0x371)]('.actions-menu-btn')&&!_0x33f9ce[_0x36429b(0x479)][_0x36429b(0x371)](_0x36429b(0x24f))&&closeAllMenus();}),window['addEventListener'](_0x1eb245(0x3ee),()=>timer[_0x1eb245(0x1ab)](!![]));try{const _0x1dab48=Array[_0x1eb245(0x3a1)](document[_0x1eb245(0x172)]('#view-methods\x20.method-item'));_0x1dab48[_0x1eb245(0x27b)]&&_0x1dab48[_0x1eb245(0x432)](_0x172aed=>{const _0x501018=_0x1eb245;_0x172aed[_0x501018(0x36b)](_0x501018(0x1bd),()=>{const _0x5c3604=_0x501018;_0x172aed[_0x5c3604(0x1e9)]&&_0x1dab48[_0x5c3604(0x432)](_0x5dcb0c=>{const _0x1c2b43=_0x5c3604;if(_0x5dcb0c!==_0x172aed)_0x5dcb0c[_0x1c2b43(0x1e9)]=![];});});});}catch(_0x106b43){}const _0x1914d6=$('#draggableTimer');let _0x3eb0dd=![],_0x2fb993,_0x3a4b60;_0x1914d6&&(_0x1914d6['addEventListener'](_0x1eb245(0x17f),_0x160f67=>{const _0x474b80=_0x1eb245;_0x3eb0dd=!![];const _0x3fba42=_0x1914d6[_0x474b80(0x47d)]();_0x2fb993=_0x160f67['clientX']-_0x3fba42[_0x474b80(0x350)],_0x3a4b60=_0x160f67[_0x474b80(0x3e9)]-_0x3fba42[_0x474b80(0x22c)],_0x1914d6[_0x474b80(0x364)][_0x474b80(0x475)]='none';}),document[_0x1eb245(0x36b)](_0x1eb245(0x210),_0x55b5f3=>{const _0x4e337b=_0x1eb245;if(!_0x3eb0dd)return;let _0x555c9d=_0x55b5f3[_0x4e337b(0x270)]-_0x2fb993,_0x8153e8=_0x55b5f3['clientY']-_0x3a4b60;const _0x4c125d=window[_0x4e337b(0x1b8)]-_0x1914d6[_0x4e337b(0x3cd)],_0x376032=window[_0x4e337b(0x3be)]-_0x1914d6[_0x4e337b(0x3de)];_0x555c9d=Math[_0x4e337b(0x405)](0x0,Math['min'](_0x555c9d,_0x4c125d)),_0x8153e8=Math['max'](0x0,Math[_0x4e337b(0x3dc)](_0x8153e8,_0x376032)),_0x1914d6['style'][_0x4e337b(0x350)]=_0x555c9d+'px',_0x1914d6['style'][_0x4e337b(0x22c)]=_0x8153e8+'px',_0x1914d6[_0x4e337b(0x364)]['bottom']='auto',_0x1914d6['style'][_0x4e337b(0x188)]=_0x4e337b(0x315);}),document[_0x1eb245(0x36b)](_0x1eb245(0x365),()=>{const _0x454687=_0x1eb245;if(!_0x3eb0dd)return;_0x3eb0dd=![],_0x1914d6[_0x454687(0x364)]['transition']='';}));function _0x1b3d67(_0x3b1f55){const _0x366a6b=_0x1eb245,_0x42fd74=$('#draggableTimer');if(!_0x42fd74)return;_0x42fd74[_0x366a6b(0x364)]['position']=_0x366a6b(0x480),_0x42fd74['style']['transition']='',_0x42fd74['style'][_0x366a6b(0x350)]='auto',_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x22c)]=_0x366a6b(0x315),_0x42fd74['style'][_0x366a6b(0x188)]=_0x366a6b(0x315),_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x431)]='auto';const _0x3c0569=0x10;_0x3b1f55==='tl'&&(_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x350)]=_0x3c0569+'px',_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x22c)]=_0x3c0569+'px'),_0x3b1f55==='tr'&&(_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x188)]=_0x3c0569+'px',_0x42fd74['style']['top']=_0x3c0569+'px'),_0x3b1f55==='bl'&&(_0x42fd74['style']['left']=_0x3c0569+'px',_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x431)]=_0x3c0569+'px'),_0x3b1f55==='br'&&(_0x42fd74[_0x366a6b(0x364)][_0x366a6b(0x188)]=_0x3c0569+'px',_0x42fd74['style'][_0x366a6b(0x431)]=_0x3c0569+'px');}function _0x572a6d(_0x19349f,_0xdd2f66){const _0x314822=_0x1eb245,_0x1fd894=$(_0x314822(0x36c));if(!_0x1fd894)return;const _0x5dad7b=_0x1fd894[_0x314822(0x47d)](),_0x50e8ba=Math[_0x314822(0x405)](0x0,Math[_0x314822(0x3dc)](_0x5dad7b[_0x314822(0x350)]+_0x19349f,window[_0x314822(0x1b8)]-_0x1fd894[_0x314822(0x3cd)])),_0x623b89=Math['max'](0x0,Math[_0x314822(0x3dc)](_0x5dad7b[_0x314822(0x22c)]+_0xdd2f66,window[_0x314822(0x3be)]-_0x1fd894['offsetHeight']));_0x1fd894['style'][_0x314822(0x350)]=_0x50e8ba+'px',_0x1fd894['style']['top']=_0x623b89+'px',_0x1fd894[_0x314822(0x364)][_0x314822(0x188)]=_0x314822(0x315),_0x1fd894['style']['bottom']=_0x314822(0x315);}}function toggleBackgroundView(){const _0xb013ec=_0x274cec,_0x12b497=document[_0xb013ec(0x1e1)];_0x12b497[_0xb013ec(0x463)][_0xb013ec(0x1bd)](_0xb013ec(0x292));const _0x1b86f5=_0x12b497[_0xb013ec(0x463)]['contains'](_0xb013ec(0x292)),_0x37e2e1=$(_0xb013ec(0x385));if(!_0x37e2e1)return;_0x1b86f5?(_0x37e2e1[_0xb013ec(0x381)]=_0xb013ec(0x44d),_0x37e2e1[_0xb013ec(0x37d)]=_0xb013ec(0x351)):(_0x37e2e1[_0xb013ec(0x381)]=_0xb013ec(0x33c),_0x37e2e1['innerHTML']=_0xb013ec(0x435));}function updateMainViewVisibility(){const _0x4fdf80=_0x274cec,_0x4bba9=!!getCurrentSubtopic(),_0x158e1e=$(_0x4fdf80(0x368)),_0x160fd8=$('#welcomePanel');_0x160fd8&&_0x160fd8[_0x4fdf80(0x463)][_0x4fdf80(0x1bd)](_0x4fdf80(0x219),_0x4bba9),_0x158e1e&&(_0x4bba9?_0x158e1e[_0x4fdf80(0x463)][_0x4fdf80(0x455)]('no-subtopic-selected'):_0x158e1e[_0x4fdf80(0x463)][_0x4fdf80(0x406)](_0x4fdf80(0x454)));}function updatePresetButtonsText(){const _0x9f20f9=_0x274cec,_0x3d6123=data[_0x9f20f9(0x1e5)],_0x2707e6=_0x3d6123['cyclesA'],_0x43cd5b=_0x3d6123[_0x9f20f9(0x21f)],_0x5ace72=_0x3d6123[_0x9f20f9(0x35d)][_0x9f20f9(0x207)],_0x9998e3=_0x3d6123[_0x9f20f9(0x35d)][_0x9f20f9(0x453)],_0x4db30a=$('#btnPresetA'),_0x466b36=$(_0x9f20f9(0x3e6)),_0x2765ee=$(_0x9f20f9(0x3e0));_0x4db30a&&(_0x4db30a[_0x9f20f9(0x42d)]=_0x2707e6+'×'+_0x5ace72+'\x20(A)'),_0x466b36&&(_0x466b36[_0x9f20f9(0x42d)]=_0x43cd5b+'×'+_0x9998e3+'\x20(B)'),_0x2765ee&&(_0x2765ee['textContent']=_0x9f20f9(0x255));}function renderAll(){const _0xaf9d2f=_0x274cec;updatePresetButtonsText();const _0x3ff769=data[_0xaf9d2f(0x1e5)][_0xaf9d2f(0x32f)];$$(_0xaf9d2f(0x31f))[_0xaf9d2f(0x432)](_0xdf77f2=>{const _0x3a6fff=_0xaf9d2f,_0x3da677=_0xdf77f2[_0x3a6fff(0x3a0)][_0x3a6fff(0x32f)]===_0x3ff769;_0xdf77f2[_0x3a6fff(0x463)]['toggle']('acc',_0x3da677),_0xdf77f2[_0x3a6fff(0x463)][_0x3a6fff(0x1bd)]('ghost',!_0x3da677),_0xdf77f2[_0x3a6fff(0x287)](_0x3a6fff(0x24d),_0x3da677);}),updateMainViewVisibility(),timer['setPreset'](data[_0xaf9d2f(0x1e5)][_0xaf9d2f(0x32f)],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data[_0xaf9d2f(0x1e5)][_0xaf9d2f(0x22e)]);}function toggleFullScreen(){const _0x273f3a=_0x274cec;!document['fullscreenElement']?document[_0x273f3a(0x22f)][_0x273f3a(0x2b8)]()['catch'](_0x56a116=>{const _0x11a3c7=_0x273f3a;toast('Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20'+_0x56a116[_0x11a3c7(0x3e5)]);}):document[_0x273f3a(0x223)]&&document['exitFullscreen']();}function updateFullscreenButton(){const _0xea1a82=_0x274cec,_0x3cad55=$('#btnFullscreen');document['fullscreenElement']?(_0x3cad55[_0xea1a82(0x37d)]='↙️',_0x3cad55[_0xea1a82(0x381)]='Thoát\x20toàn\x20màn\x20hình'):(_0x3cad55[_0xea1a82(0x37d)]='↗️',_0x3cad55[_0xea1a82(0x381)]=_0xea1a82(0x35c));}async function initializeApp(){const _0xa1fa30=_0x274cec;try{await storageManager[_0xa1fa30(0x3d7)]();const [_0x545d96,_0xa659a0,_0x4c92ce]=await Promise['all']([storageManager['getSettings'](),storageManager[_0xa1fa30(0x347)](_0xa1fa30(0x3c7)),storageManager['getAll'](_0xa1fa30(0x1b3))]);let _0x3d0192;if(!_0x545d96){const _0x519c78=JSON[_0xa1fa30(0x3f3)](JSON['stringify'](defaults));await storageManager[_0xa1fa30(0x34a)](_0x519c78[_0xa1fa30(0x1e5)]);for(const _0x4f3b70 of _0x519c78['topics']){const {subtopics:_0x21f70c,..._0xdf06c1}=_0x4f3b70;await storageManager[_0xa1fa30(0x406)](_0xa1fa30(0x3c7),_0xdf06c1);for(const _0x272de9 of _0x21f70c){await storageManager[_0xa1fa30(0x406)](_0xa1fa30(0x1b3),{..._0x272de9,'topicId':_0x4f3b70['id']});}}_0x3d0192=_0x519c78;}else{const _0x221de1={};for(const _0x83b884 of _0xa659a0)_0x221de1[_0x83b884['id']]={..._0x83b884,'subtopics':[]};for(const _0x5a6e6a of _0x4c92ce)_0x221de1[_0x5a6e6a[_0xa1fa30(0x2e7)]]?.[_0xa1fa30(0x1b3)]['push'](_0x5a6e6a);_0x3d0192={'version':defaults['version'],'settings':_0x545d96,'topics':Object[_0xa1fa30(0x3b1)](_0x221de1)};}data=window[_0xa1fa30(0x199)]=_0x3d0192,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0xa1fa30(0x32d)](data);}catch(_0x31b497){console[_0xa1fa30(0x1f6)]('AutoBackup\x20error:',_0x31b497);}bindEvents(),applyTheme();}catch(_0x350c3b){console['error'](_0xa1fa30(0x265),_0x350c3b),toast(_0xa1fa30(0x1d2)+_0x350c3b['message']);}}callGeminiAPI=async function(_0x467ddc,_0x3d1a72=0x3,_0x28b163=0x3e8){const _0x3387c7=_0x274cec,_0x2a343c=data?.[_0x3387c7(0x1e5)]?.['apiKey']||'';if(!_0x2a343c)return toast(_0x3387c7(0x3ac)),null;const _0x5f01ba='https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key='+_0x2a343c,_0x542fd0={'contents':[{'role':_0x3387c7(0x40e),'parts':[{'text':_0x467ddc}]}]};try{const _0x5de8e6=await fetch(_0x5f01ba,{'method':_0x3387c7(0x355),'headers':{'Content-Type':_0x3387c7(0x187)},'body':JSON[_0x3387c7(0x428)](_0x542fd0)});if(!_0x5de8e6['ok']){if(_0x5de8e6[_0x3387c7(0x1cc)]===0x1ad&&_0x3d1a72>0x0)return await new Promise(_0x6f1234=>setTimeout(_0x6f1234,_0x28b163)),callGeminiAPI(_0x467ddc,_0x3d1a72-0x1,_0x28b163*0x2);let _0x3bcf60=null;try{_0x3bcf60=await _0x5de8e6[_0x3387c7(0x319)]();}catch(_0x3b99a9){}let _0x588786=_0x3387c7(0x204)+_0x5de8e6[_0x3387c7(0x1cc)];if(_0x5de8e6['status']===0x190)_0x588786='Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.';else{if(_0x5de8e6[_0x3387c7(0x1cc)]===0x1ad)_0x588786=_0x3387c7(0x28a);else _0x3bcf60?.[_0x3387c7(0x17c)]?.[_0x3387c7(0x3e5)]&&(_0x588786=_0x3387c7(0x1ce)+_0x3bcf60['error']['message']);}return toast(_0x588786,0xfa0),console[_0x3387c7(0x17c)](_0x3387c7(0x33b),_0x3bcf60||_0x5de8e6[_0x3387c7(0x1bc)]),null;}const _0x5e59db=await _0x5de8e6[_0x3387c7(0x319)]();if(_0x5e59db[_0x3387c7(0x208)]&&_0x5e59db[_0x3387c7(0x208)][0x0]?.['content']?.[_0x3387c7(0x190)]?.[0x0]?.[_0x3387c7(0x18f)])return formatGeminiResponse(_0x5e59db[_0x3387c7(0x208)][0x0][_0x3387c7(0x19c)][_0x3387c7(0x190)][0x0]['text']);else{console['error'](_0x3387c7(0x289),_0x5e59db);if(_0x5e59db[_0x3387c7(0x30e)]?.['blockReason'])return _0x3387c7(0x1e6)+_0x5e59db[_0x3387c7(0x30e)][_0x3387c7(0x177)]+_0x3387c7(0x174);return _0x3387c7(0x2b2);}}catch(_0x229f10){return console[_0x3387c7(0x17c)](_0x3387c7(0x2a5),_0x229f10),toast(_0x3387c7(0x339),0xfa0),null;}},loadLanguage(localStorage[_0x274cec(0x297)]('lang')||'vi')[_0x274cec(0x24e)](initializeApp);
    </script>
</body>
</html>

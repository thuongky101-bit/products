<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Ứng dụng Pomodoro hỗ trợ học tập với tích hợp Gemini AI và giao diện hiện đại." />
    <title>Pomodoro Study App — Tích hợp Gemini AI (Giao diện mới)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — PHIÊN BẢN GIAO DIỆN TẬP TRUNG (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Mặc định) - Cập nhật từ file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Thêm biến RGB cho panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: THÊM CÁC THEME MỚI === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: THÊM CÁC THEME MỚI === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Thêm các quy tắc border cho theme light/pastel */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Sửa đổi: bỏ border mặc định */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Sửa đổi */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    /* Nâng khối đang mở menu lên trên các khối khác */
    .topic-item.menu-active { position: relative; z-index: 20; }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Sửa đổi */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Giữ nền trong suốt khi di chuột qua */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Sửa đổi màu */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Sửa đổi màu */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */
    #view-timer .panel-bg hr {
        border: none; /* Bỏ đường viền mặc định */
        height: 1px;  /* Đặt chiều cao cho đường kẻ */
        background-color: var(--muted); /* Sử dụng màu phụ của theme */
        opacity: 0.3; /* Làm cho nó mờ đi, hòa vào nền */
        margin-top: 0; /* Điều chỉnh lại khoảng cách */
    }
    /* === END: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Sửa đổi */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Sửa đổi */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Sửa đổi */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Nâng z-index để nằm trên header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Sửa đổi */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Sửa đổi */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; flex-direction: column; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Sửa đổi */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
        /* Giới hạn chiều rộng để tiêu đề gọn hơn */
        max-width: 50%;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Sửa đổi */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Sửa đổi */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Sửa đổi: chuyển sang nền trắng trong suốt */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Viền trắng mờ */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Tinh chỉnh: sát mẫu hơn */
        border-color: var(--acc);
    }
    /* === START: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Dùng nền đen mờ thay vì trắng mờ */
        border-color: rgba(0, 0, 0, 0.1); /* Viền đen mờ trên theme sáng */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Tăng độ đậm khi focus */
    }
    /* === END: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */

    /* Cải thiện nền và màu chữ cho option trong select theo theme hiện tại */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Sửa đổi */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Giảm/loại bỏ bóng chữ cho theme sáng để tránh nhòe/lóa */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
/* Khi nội dung mở, thêm đường phân cách ở trên nội dung */
.method-item > .method-content:not([hidden]) {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    /* margin-top: 8px;  <-- Đã xóa */
    padding-top: 8px; /* <-- Giữ lại một chút padding để nội dung không dính vào đường kẻ */
}
    [data-theme='light'] .method-item > .method-content:not([hidden]),
    [data-theme='pastel'] .method-item > .method-content:not([hidden]) {
        border-top-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* ========================================================= */
    /* START: CẬP NHẬT GIAO DIỆN TIÊU ĐỀ KHO TRI THỨC            */
    /* ========================================================= */

    /* Sử dụng Flexbox để căn chỉnh tiêu đề và các nút trên cùng một hàng */
    .method-item > div:first-child {
        display: flex;
        align-items: center;
        justify-content: space-between; /* Đẩy tiêu đề và các nút về hai phía */
        gap: 8px;
        width: 100%; /* Đảm bảo hàng tiêu đề chiếm đủ chiều rộng */
    }

    /* Cho phép tiêu đề co giãn để chiếm không gian và xử lý text dài */
    .method-item .method-title {
        flex: 1; /* Quan trọng: Cho phép tiêu đề chiếm hết không gian trống */
        min-width: 0;
        word-break: break-word;
        overflow-wrap: break-word;
        cursor: pointer;
    }

    /* Giữ lại quy tắc ẩn/hiện các nút hành động khi di chuột */
    .method-item .topic-actions {
        margin-left: 8px; /* Thêm một chút khoảng đệm bên trái */
    }

    .method-item:hover .topic-actions,
    .method-item:focus-within .topic-actions {
        opacity: 1;
        visibility: visible;
    }
    /* ========================================================= */
    /* END: CẬP NHẬT GIAO DIỆN                                  */
    /* ========================================================= */

    /* ========================================================= */
    /* START: SỬA LỖI TRÀN GIAO DIỆN VỚI VĂN BẢN DÀI (FLEXBOX FIX) */
    /* ========================================================= */
    .topic-title,
    .subtopic-btn,
    .note-content-wrapper,
    .subtopic-todo-list label,
    .method-title,
    .method-item > div:first-child { /* <--- Cho phép header Kho Tri Thức co lại */
        min-width: 0; /* Cho phép phần tử co lại nhỏ hơn nội dung của nó */
    }

    .topic-title,
    .subtopic-btn,
    .note-content,
    .subtopic-todo-list label,
    .hist-item > div,
    .method-title { /* <--- Bổ sung cho Kho Tri Thức */
        word-break: break-word;      /* Tự động ngắt các từ quá dài */
        overflow-wrap: break-word; /* Đảm bảo ngắt dòng cho chuỗi dài */
    }
    /* ========================================================= */
    /* END: SỬA LỖI TRÀN GIAO DIỆN VỚI VĂN BẢN DÀI (FLEXBOX FIX) */

    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Đồng hồ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Đồng hồ</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Chủ đề">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Chủ đề</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Thống kê">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Thống kê</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Kho Tri Thức">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Kho Tri Thức</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Cài đặt">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Cài đặt</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Hướng dẫn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Hướng dẫn</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">Chưa chọn Chủ đề con</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard Tổng quan">📊 Tổng Quan </button>
          <a href="https://forms.gle/EfFqBJFTbFtDo5H4A" target="_blank" rel="noopener noreferrer" class="btn ghost small" title="Gửi phản hồi của bạn">💬 Phản Hồi</a>
          <button class="btn ghost small" id="btnExport" title="Xuất JSON">⬇️ Xuất File</button>
          <label class="btn ghost small" for="importFile" title="Nhập JSON">⬆️ Nhập File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Ẩn/Hiện giao diện">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Toàn màn hình">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Chào mừng đến với Pomodoro Study App!</h3>
                <p>Hãy bắt đầu bằng cách chọn một <strong>Chủ đề con</strong> hoặc tạo Chủ đề/Chủ đề con mới.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Tạo Chủ đề Mới</button>
            </div>
            <div class="presets" role="group" aria-label="Chọn chế độ preset">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">TRẠNG THÁI</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Checklist Hạ nhiệt</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Lưu công việc đang làm (Save/Commit).</li>
                <li>Ghi chú nhanh "Next step".</li>
                <li>Dọn dẹp không gian làm việc.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Bắt đầu (Space)">▶️ Bắt đầu</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="Kết thúc phiên làm việc">🧘 Bắt đầu nghỉ</button>
              <button class="btn" id="btnPause" aria-label="Tạm dừng (Space)">⏸️ Tạm dừng</button>
              <button class="btn" id="btnResume" aria-label="Tiếp tục (Space)">⏵ Tiếp tục</button>
              <button class="btn warn" id="btnSkip" aria-label="Bỏ qua (N)">⏭️ Bỏ qua</button>
              <button class="btn danger" id="btnReset">↺ Đặt lại</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Nghỉ sớm</button>
            </div>
            <div class="tiny">Phím tắt: <strong>Space</strong> = Bắt đầu/Tạm dừng/Tiếp tục, <strong>N</strong> = Tiếp theo/Bỏ qua</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Nhiệm vụ</button>
                <button class="tab-btn" data-tab="notes">Ghi chú</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-do cho chủ đề con này:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Thêm một task mới..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Thêm</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Thêm ghi chú mới..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Thêm ghi chú</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini cho: <span id="currentSubtopicNameChat">(chưa chọn)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Xóa lịch sử">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Giải thích khái niệm chính của chủ đề này">Giải thích khái niệm</button>
                  <button class="btn small ghost" data-prompt="Tạo một dàn ý chi tiết cho chủ đề này">Tạo dàn ý</button>
                  <button class="btn small ghost" data-prompt="Liệt kê 5 câu hỏi ôn tập quan trọng về chủ đề này">Tạo câu hỏi ôn tập</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Hỏi Gemini điều gì đó..." />
                  <button id="btnSendMessage" class="btn acc">Gửi</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Quản lý Chủ đề</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Thêm Chủ đề</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Nhấp mũi tên để mở/đóng danh sách chủ đề con.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
      <script>
        window.addEventListener('DOMContentLoaded', () => {
          try {
            const topicsView = document.querySelector('#view-topics');
            if (!topicsView) return;
            const header = topicsView.querySelector('.row h3');
            if (header) header.textContent = 'Quản lý Chủ đề';
            const addBtn = topicsView.querySelector('#btnAddTopic');
            if (addBtn) addBtn.textContent = '+ Thêm Chủ đề';
            const note = topicsView.querySelector('.footer-note');
            if (note) note.textContent = 'Nhấp mũi tên để mở/đóng danh sách chủ đề con.';
          } catch (e) {}
        });
      </script>
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Thống kê & Lịch sử — <span id="currentSubtopicName">(chưa chọn)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Tổng thời gian</h4><div class="stat-value" id="statTotal">0 phút</div></div>
              <div class="stat-card"><h4>Phiên</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Nhiệm vụ Hoàn thành</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">Lịch sử (LÀM VIỆC)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Kho Tri Thức Cá Nhân Hóa</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Thêm tri thức</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Nhấp vào từng mục để xem chi tiết.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Khám Phá Pomodoro Study App</h3>
              <p>
                  Chào mừng bạn đến với không gian học tập được thiết kế dành riêng cho sự tập trung và hiệu quả. Hãy cùng khám phá những tính năng sẽ đồng hành cùng bạn trên hành trình chinh phục tri thức.
              </p>

              <h4>🚀 Khởi Đầu Nhanh Chỉ Trong 4 Bước</h4>
              <p>Để hành trình của bạn luôn mạch lạc, mọi thứ trong ứng dụng được sắp xếp theo cấu trúc <strong>Chủ đề Lớn → Chủ đề con</strong>.</p>
              <ol>
                  <li>Mở mục <strong>📚 Chủ đề</strong> từ thanh điều hướng bên cạnh.</li>
                  <li>Nhấn <strong>＋ Thêm Chủ đề</strong> để tạo một lĩnh vực lớn (ví dụ: "Tiếng Anh Giao Tiếp").</li>
                  <li>Bên cạnh chủ đề vừa tạo, nhấn <strong>＋ Thêm</strong> để tạo một chủ đề con, chi tiết hơn (ví dụ: "Bài 1: Luyện phát âm IPA").</li>
                  <li>Chọn chủ đề con đó. Giờ đây, bạn đã sẵn sàng để bắt đầu phiên học đầu tiên của mình!</li>
              </ol>

              <hr />
              <h4>✨ Những Tính Năng Đáng Chú Ý</h4>

              <h4>Các Chế Độ Đồng Hồ Linh Hoạt ⏱️</h4>
              <p>Ứng dụng không chỉ có Pomodoro. Hãy chọn phương pháp phù hợp với công việc của bạn:</p>
              <ul>
                  <li><strong>Pomodoro Cổ Điển (Kiểu A/B):</strong> Làm việc tập trung trong các phiên định sẵn (ví dụ: 25 phút làm, 5 phút nghỉ) để xây dựng kỷ luật và nhịp độ.</li>
                  <li><strong>Chế độ Flowtime (Kiểu 🌊 Flow):</strong> Dành cho công việc cần dòng chảy sâu. Đồng hồ sẽ đếm lên, cho phép bạn làm việc đến khi tự cảm thấy cần nghỉ. Thời gian nghỉ sẽ được đề xuất dựa trên thời gian bạn đã làm việc.</li>
                  <li><strong>Đệm "Hạ nhiệt" (Wind-down):</strong> Một khoảng đệm tùy chỉnh giữa lúc làm và lúc nghỉ, giúp bạn kết thúc công việc đang dở, ghi chú lại "bước tiếp theo" và chuyển trạng thái một cách mượt mà, không bị cắt ngang đột ngột.</li>
              </ul> 
              <h4>Kho Tri Thức Theo Từng Chủ Đề Con 💡</h4>
<p>
    Mỗi một <strong>Chủ đề con</strong> giờ đây sẽ có một "Kho Tri Thức" hoàn toàn riêng biệt. Tính năng này cho phép bạn xây dựng một thư viện kiến thức chuyên sâu, chỉ liên quan đến lĩnh vực bạn đang học.
</p>
<p>
    Ví dụ, các ghi chú và phương pháp học "Tiếng Anh Giao Tiếp" sẽ chỉ xuất hiện khi bạn chọn chủ đề con đó, và sẽ không bị lẫn với các công thức trong chủ đề con "Giải tích Toán học".
</p>
<p>
    Với trình soạn thảo mạnh mẽ, bạn vẫn có thể dễ dàng định dạng tiêu đề, in đậm, tạo danh sách và làm nổi bật những thông tin quan trọng nhất cho từng môn học của mình.
</p>

              <h4>Quản Lý Chủ Đề Trực Quan</h4>
              <p>Dễ dàng sắp xếp các mục tiêu học tập của bạn. Sử dụng thao tác <strong>kéo và thả</strong> để sắp xếp lại thứ tự các Chủ đề hoặc di chuyển một Chủ đề con sang một lĩnh vực khác một cách trực quan.</p>

              <h4>Nhiệm Vụ & Ghi Chú Tích Hợp 📝</h4>
              <p>Ngay trong màn hình đồng hồ, bạn có thể tạo danh sách việc cần làm (to-do) cho từng chủ đề con hoặc ghi lại những ý tưởng chợt nảy ra mà không làm gián đoạn dòng chảy công việc.</p>

              <h4>Chế Độ Zen 🧘</h4>
              <p>Khi cần tập trung tuyệt đối, hãy nhấn vào biểu tượng con mắt (👁️). Giao diện sẽ ẩn đi, chỉ để lại hình nền và chiếc đồng hồ. Trong chế độ này, bạn có thể <strong>kéo thả đồng hồ</strong> đến bất kỳ vị trí nào trên màn hình để có một không gian làm việc gọn gàng nhất.</p>

              <h4>Thống Kê & Cột Mốc 🏆</h4>
              <p>Theo dõi hành trình của bạn qua những con số biết nói. Ứng dụng sẽ tự động ghi nhận và chúc mừng khi bạn đạt được những cột mốc quan trọng về thời gian tập trung, biến mỗi nỗ lực thành một thành tựu đáng tự hào.</p>

              <hr />
              <h4>⌨️ Phím Tắt Thông Minh</h4>
              <ul>
                  <li><kbd>Space</kbd>: Bắt đầu / Tạm dừng / Tiếp tục phiên học.</li>
                  <li><kbd>N</kbd>: Bỏ qua phiên làm việc hoặc nghỉ hiện tại.</li>
                  <li><kbd>Esc</kbd>: Đóng các cửa sổ đang mở (như Cài đặt).</li>
              </ul>

              <hr />
              <h4>🛠️ Cài Đặt Nâng Cao & Tích Hợp</h4>

              <h4>Trợ Lý Gemini AI 🧠</h4>
              <p>Biến ứng dụng thành một người bạn đồng hành thông minh. Ngoài việc hỏi đáp, bạn còn có thể:</p>
              <ul>
                  <li><strong>Tự động Định dạng Thông minh:</strong> Khi soạn thảo trong mục "Phương pháp", hãy để AI tự động phân tích và định dạng văn bản thô của bạn—tự nhận diện tiêu đề, các ý chính cần in đậm và danh sách.</li>
                  <li><strong>Thiết lập:</strong> Truy cập Google AI Studio để tạo API Key miễn phí và dán vào ô "Gemini API Key" trong Cài đặt của ứng dụng.</li>
              </ul>

              <h4>Tùy Biến Giao Diện & Âm Thanh 🎨</h4>
              <p>Biến không gian học tập thành của riêng bạn:</p>
              <ul>
                  <li><strong>Nhiều Theme & Hình nền:</strong> Lựa chọn giữa các theme có sẵn (Sáng, Tối, Pastel...) hoặc <strong>tải lên hình nền của riêng bạn</strong> để tạo cảm hứng.</li>
                  <li><strong>Âm báo Tùy chỉnh:</strong> Bạn có thể <strong>tải lên các file âm thanh (.mp3, .wav...) của riêng mình</strong> để sử dụng làm chuông báo cho các phiên làm việc và nghỉ ngơi.</li>
              </ul>

              <h4>Nhạc Nền YouTube 🎶</h4>
              <p>Tạo không gian học tập hoàn hảo bằng cách phát một video hoặc danh sách phát YouTube làm nhạc nền. Dán đường dẫn (URL) vào ô "Nhạc nền YouTube" trong Cài đặt.</p>

              <h4>An Toàn Dữ Liệu: Sao Lưu & Phục Hồi 🛡️</h4>
              <p>Ứng dụng tự động sao lưu tiến trình của bạn mỗi ngày. Bạn có thể tùy chỉnh số ngày lưu giữ bản sao lưu và phục hồi dữ liệu từ một ngày trong quá khứ nếu cần. ⚠️ <strong>Cảnh báo:</strong> Phục hồi sẽ ghi đè toàn bộ dữ liệu hiện tại.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Chúc mừng Bạn!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Tiếp tục hành trình!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Cài đặt</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Đồng hồ</button>
              <button class="tab-btn" data-tab="settings-ui">Giao diện & Âm thanh</button>
              <button class="tab-btn" data-tab="settings-integrations">Tích hợp</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Kiểu A </button>
                      <button class="btn ghost" data-preset-target="B"> Kiểu B </button>
                      <button class="btn ghost" data-preset-target="C"> Kiểu C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Thời lượng Pomodoro</h4>
                      <div class="row">
                          <label>LÀM VIỆC (phút)<input type="number" id="set_work" min="1" /></label>
                          <label>HẠ NHIỆT (phút)<input type="number" id="set_winddown" min="0" /></label>
                          <label>NGHỈ NGẮN (phút)<input type="number" id="set_short" min="1" /></label>
                          <label>NGHỈ DÀI (phút)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Chu kỳ Pomodoro<input type="number" id="set_cycles" min="1" /></label>
                          <label>Chu kỳ nghỉ dài<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Tỷ lệ nghỉ (Làm việc / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Gợi ý: Thời gian nghỉ = tổng thời gian làm việc / X. Mặc định là 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Tự động bắt đầu phiên tiếp theo</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Bật Hạ nhiệt sau phiên làm</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableSessionNotes">Nhắc ghi chú sau mỗi phiên</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableSessionNotes">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Giao diện</h4>
                      <div class="row">
                          <label>Theme Giao Diện
                                <select id="set_theme_color">
                                    <option value="default">Mặc định (Dark Blue)</option>
                                    <option value="light">Light - Trà Sữa</option>
                                    <option value="pastel">Pastel - Dễ thương</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Chế độ hiển thị nền
                              <select id="set_backgroundMode">
                                  <option value="cover">Lấp đầy (Mặc định)</option>
                                  <option value="contain">Vừa vặn (Sắc nét)</option>
                                  <option value="auto">Kích thước gốc (Lặp lại)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Hình nền
                              <label class="btn small ghost" for="uploadBg">Tải ảnh mới</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Xóa nền</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Độ trong suốt của nền</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Âm thanh</h4>
                      <div class="row">
                          <label>Âm lượng (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Kiểu âm báo
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Tùy chỉnh âm báo</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Âm báo hết LÀM VIỆC</small>
                              <label title="Âm báo hết LÀM VIỆC" class="btn small ghost" for="uploadSoundWork">LÀM VIỆC</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ NGẮN</small>
                              <label title="Âm báo hết NGHỈ NGẮN" class="btn small ghost" for="uploadSoundBreak">NGHỈ NGẮN</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ DÀI</small>
                              <label title="Âm báo hết NGHỈ DÀI" class="btn small ghost" for="uploadSoundLong">NGHỈ DÀI</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Tích hợp AI</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Dán API Key của bạn vào đây..." />
                      </label>
                      <div class="tiny">Cần có để sử dụng các tính năng AI. Lấy key miễn phí tại <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 Nhạc nền YouTube</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Dán link YouTube vào đây..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Dùng ảnh bìa video làm nền</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Dừng sẽ không tự phát lại cho đến khi bạn bấm ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Âm lượng</div>
                  </div>
                  <div>
                      <h4>🛡️ Cài đặt sao lưu</h4>
                      <div class="row">
                          <label>Số ngày sao lưu cần giữ lại
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Phục hồi dữ liệu</h4>
                      <p class="tiny">Phục hồi dữ liệu từ một bản sao lưu tự động hàng ngày. Hành động này sẽ ghi đè lên dữ liệu hiện tại của bạn.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Phục hồi</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Mặc định</button>
              <button class="btn acc" id="btnSaveSettings">Lưu</button>
              <button class="btn" id="btnCloseSettings">Đóng</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Ghi chú cho phiên vừa hoàn thành</h3>
      <div class="row"><textarea id="noteText" placeholder="Bạn học được gì? Khó khăn? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Tóm tắt & Gợi ý</button>
        <button class="btn" id="btnSkipNote">Bỏ qua</button>
        <button class="btn acc" id="btnSaveNote">Lưu ghi chú</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Tiêu đề</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Hủy</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Tổng quan</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Đóng</button>
        </div>
        <p class="tiny">Tổng hợp thời gian và số phiên đã hoàn thành trên tất cả các chủ đề.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Chỉnh-sửa Phương-pháp</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Tiêu-đề<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Nội-dung</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Tiêu-đề nhỏ">H</button>
          <button id="toolBold" class="btn small ghost" title="In đậm">B</button>
          <button id="toolItalic" class="btn small ghost" title="In nghiêng">I</button>
          <button id="toolList" class="btn small ghost" title="Danh-sách">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Danh sách chấm tròn">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Màu chữ">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Màu chữ mặc định"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Màu nhấn mạnh"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Màu tích cực"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Màu cảnh báo"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Màu nguy hiểm"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Màu tím"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="Tính năng này yêu cầu Gemini API Key">✨ Tự động định dạng</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Hủy</button>
          <button class="btn acc" id="btnSaveMethod">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Nhấn "Bật âm thanh" để cho phép phát nhạc nền.</span>
    <button id="btnEnableSound" class="btn small acc">Bật âm thanh</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
    const _0x287dc7=_0xbc78;(function(_0x21199b,_0x20e13d){const _0x1ff553=_0xbc78,_0xdc5686=_0x21199b();while(!![]){try{const _0x49088c=parseInt(_0x1ff553(0x3cb))/0x1+-parseInt(_0x1ff553(0x136))/0x2+-parseInt(_0x1ff553(0x215))/0x3*(parseInt(_0x1ff553(0x337))/0x4)+parseInt(_0x1ff553(0x1a6))/0x5+-parseInt(_0x1ff553(0x3b7))/0x6+-parseInt(_0x1ff553(0x40f))/0x7+parseInt(_0x1ff553(0x37b))/0x8*(parseInt(_0x1ff553(0x16e))/0x9);if(_0x49088c===_0x20e13d)break;else _0xdc5686['push'](_0xdc5686['shift']());}catch(_0x423601){_0xdc5686['push'](_0xdc5686['shift']());}}}(_0x5aa0,0x884d4),window['addEventListener'](_0x287dc7(0x312),()=>{try{updateFullscreenButton();}catch(_0x1c86be){}}));const IS_FILE_PROTOCOL=window[_0x287dc7(0x28d)][_0x287dc7(0x379)]==='file:';function startYtApiWatchdog(){const _0x4745af=_0x287dc7,_0xe9b244=document[_0x4745af(0x1d7)]('ytUrlFeedback');if(!_0xe9b244)return;const _0x43b262=setTimeout(()=>{const _0x4983fa=_0x4745af;try{(!window['YT']||!window['YT']['Player'])&&(_0xe9b244['textContent']=_0x4983fa(0x16f),_0xe9b244[_0x4983fa(0x44b)]['color']=_0x4983fa(0x400));}catch(_0x476d68){}},0x5dc),_0x37c881=setTimeout(()=>{const _0x380a73=_0x4745af;try{(!window['YT']||!window['YT'][_0x380a73(0x2dd)])&&(_0xe9b244[_0x380a73(0x181)]=_0x380a73(0x1f7),_0xe9b244[_0x380a73(0x44b)][_0x380a73(0x3aa)]='var(--danger)');}catch(_0x1e4877){}},0x1b58);window[_0x4745af(0x18d)]={'cancel'(){clearTimeout(_0x43b262),clearTimeout(_0x37c881);}};}(function(){const _0x1f0c9c=_0x287dc7,_0xdfd87c={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>_0x1f0c9c(0x3f9)+current+'/'+target,'timer.selectSubtopicPrompt':_0x1f0c9c(0x2b9)};window['t']=function _0x238304(_0x199063,_0x694d3b){const _0x476829=_0x1f0c9c;try{const _0x5134d4=_0xdfd87c[_0x199063];if(typeof _0x5134d4===_0x476829(0x425))return _0x5134d4(_0x694d3b||{});if(typeof _0x5134d4===_0x476829(0x436))return _0x5134d4;}catch(_0x2bb4cc){}return _0x199063;},window['loadLanguage']=function _0x2d8cbb(_0x4dc2a8){const _0x18dcda=_0x1f0c9c;try{localStorage[_0x18dcda(0x2e0)]('lang',_0x4dc2a8||'vi');}catch(_0x6c3b6d){}return Promise[_0x18dcda(0x240)]();};}());function ensureYouTubeAPI(){const _0x590a2a=_0x287dc7;if(IS_FILE_PROTOCOL)return Promise[_0x590a2a(0x240)](![]);try{if(window['YT']&&window['YT'][_0x590a2a(0x2dd)])return Promise[_0x590a2a(0x240)](!![]);}catch(_0xeb51c){}if(window[_0x590a2a(0x30b)])return window[_0x590a2a(0x30b)];return startYtApiWatchdog(),window[_0x590a2a(0x30b)]=new Promise((_0x5f0376,_0x224638)=>{const _0xf902de=_0x590a2a;try{const _0x25e98e=document['createElement'](_0xf902de(0x19f));_0x25e98e[_0xf902de(0x28c)]=_0xf902de(0x35d),_0x25e98e['async']=!![],_0x25e98e['defer']=!![],_0x25e98e['onload']=()=>_0x5f0376(!![]),_0x25e98e[_0xf902de(0x1a9)]=()=>_0x224638(new Error(_0xf902de(0x3fd))),document[_0xf902de(0x39f)][_0xf902de(0x22f)](_0x25e98e);}catch(_0x4c9349){_0x224638(_0x4c9349);}}),window[_0x590a2a(0x30b)];}const storageManager={'DB_NAME':_0x287dc7(0x1e0),'DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x250e4f,_0x4a4eb3)=>{const _0x1f6e8c=_0xbc78;if(this['db'])return _0x250e4f(this['db']);const _0x4231a4=indexedDB['open'](this['DB_NAME'],this[_0x1f6e8c(0x354)]);_0x4231a4[_0x1f6e8c(0x327)]=_0x364f06=>{const _0x433ede=_0x1f6e8c,_0x3c2c33=_0x364f06[_0x433ede(0x402)][_0x433ede(0x1e4)];!_0x3c2c33[_0x433ede(0x432)]['contains'](_0x433ede(0x3e8))&&_0x3c2c33[_0x433ede(0x1fb)](_0x433ede(0x3e8));!_0x3c2c33[_0x433ede(0x432)]['contains'](_0x433ede(0x309))&&_0x3c2c33[_0x433ede(0x1fb)](_0x433ede(0x309),{'keyPath':'id'});if(!_0x3c2c33[_0x433ede(0x432)]['contains'](_0x433ede(0x1cd))){const _0x2a935a=_0x3c2c33[_0x433ede(0x1fb)]('subtopics',{'keyPath':'id'});_0x2a935a[_0x433ede(0x187)]('by_topic',_0x433ede(0x2a5));}!_0x3c2c33[_0x433ede(0x432)][_0x433ede(0x14d)]('backups')&&_0x3c2c33[_0x433ede(0x1fb)](_0x433ede(0x1e5),{'keyPath':_0x433ede(0x2f3)});},_0x4231a4[_0x1f6e8c(0x3b1)]=_0x5e7d3=>{const _0x429428=_0x1f6e8c;this['db']=_0x5e7d3[_0x429428(0x402)][_0x429428(0x1e4)],console[_0x429428(0x158)](_0x429428(0x1f8)),_0x250e4f(this['db']);},_0x4231a4['onerror']=_0x51f15b=>{const _0x11f3d7=_0x1f6e8c;console[_0x11f3d7(0x206)](_0x11f3d7(0x433),_0x51f15b[_0x11f3d7(0x402)]['errorCode']),_0x4a4eb3(_0x51f15b['target'][_0x11f3d7(0x206)]);};});},async '_getStore'(_0x5b81bc,_0x59c222=_0x287dc7(0x381)){const _0x570bc3=_0x287dc7;await this[_0x570bc3(0x160)]();const _0x11092e=this['db'][_0x570bc3(0x277)]([_0x5b81bc],_0x59c222);return _0x11092e[_0x570bc3(0x297)](_0x5b81bc);},async 'getSettings'(){const _0x2e1de8=_0x287dc7,_0x425525=await this[_0x2e1de8(0x1da)]('settings');return new Promise((_0x2d8532,_0x3eafb4)=>{const _0x4ac4d2=_0x2e1de8,_0x374a89=_0x425525['get'](_0x4ac4d2(0x35e));_0x374a89[_0x4ac4d2(0x3b1)]=()=>_0x2d8532(_0x374a89[_0x4ac4d2(0x1e4)]),_0x374a89[_0x4ac4d2(0x1a9)]=()=>_0x3eafb4(_0x374a89[_0x4ac4d2(0x206)]);});},async 'updateSettings'(_0x407d7d){const _0x475197=_0x287dc7,_0x10e33c=await this[_0x475197(0x1da)](_0x475197(0x3e8),_0x475197(0x3f0));return new Promise((_0x2d1b38,_0x396d65)=>{const _0xa7304d=_0x475197,_0x58c9e0=_0x10e33c['put'](_0x407d7d,'main_settings');_0x58c9e0[_0xa7304d(0x3b1)]=()=>_0x2d1b38(_0x58c9e0[_0xa7304d(0x1e4)]),_0x58c9e0[_0xa7304d(0x1a9)]=()=>_0x396d65(_0x58c9e0[_0xa7304d(0x206)]);});},async 'getAll'(_0x3214af){const _0x528e51=_0x287dc7,_0x154a40=await this[_0x528e51(0x1da)](_0x3214af);return new Promise((_0x1e3853,_0x2dc5f3)=>{const _0x1bee68=_0x528e51,_0xd71cda=_0x154a40['getAll']();_0xd71cda[_0x1bee68(0x3b1)]=()=>_0x1e3853(_0xd71cda[_0x1bee68(0x1e4)]),_0xd71cda[_0x1bee68(0x1a9)]=()=>_0x2dc5f3(_0xd71cda[_0x1bee68(0x206)]);});},async 'update'(_0x44e712,_0x49dee1){const _0x252cb6=await this['_getStore'](_0x44e712,'readwrite');return new Promise((_0x424c08,_0x574634)=>{const _0x1dca36=_0xbc78,_0x478101=_0x252cb6['put'](_0x49dee1);_0x478101['onsuccess']=()=>_0x424c08(_0x478101[_0x1dca36(0x1e4)]),_0x478101[_0x1dca36(0x1a9)]=()=>_0x574634(_0x478101[_0x1dca36(0x206)]);});},async 'add'(_0x156de0,_0x3132c9){const _0x29030c=_0x287dc7,_0x5d113e=await this[_0x29030c(0x1da)](_0x156de0,_0x29030c(0x3f0));return new Promise((_0x47846b,_0x292b27)=>{const _0x577701=_0x29030c,_0x2019ce=_0x5d113e[_0x577701(0x347)](_0x3132c9);_0x2019ce[_0x577701(0x3b1)]=()=>_0x47846b(_0x2019ce['result']),_0x2019ce[_0x577701(0x1a9)]=()=>_0x292b27(_0x2019ce['error']);});},async 'delete'(_0x3ce07f,_0x4b3a36){const _0x322310=_0x287dc7,_0x4c391f=await this['_getStore'](_0x3ce07f,_0x322310(0x3f0));return new Promise((_0x2484b1,_0x23c4df)=>{const _0x4c82d7=_0x322310,_0x24569d=_0x4c391f[_0x4c82d7(0x153)](_0x4b3a36);_0x24569d[_0x4c82d7(0x3b1)]=()=>_0x2484b1(_0x24569d[_0x4c82d7(0x1e4)]),_0x24569d['onerror']=()=>_0x23c4df(_0x24569d['error']);});},async 'save'(_0x20d13e){return await this['initDB'](),new Promise((_0x47f7a9,_0x50777f)=>{const _0x3f4070=_0xbc78,_0x4513a5=this['db'][_0x3f4070(0x277)]([_0x3f4070(0x3e8),'topics','subtopics'],_0x3f4070(0x3f0)),_0x4fbfab=_0x4513a5[_0x3f4070(0x297)](_0x3f4070(0x3e8)),_0x4112e1=_0x4513a5['objectStore']('topics'),_0x408b34=_0x4513a5['objectStore']('subtopics');_0x4fbfab[_0x3f4070(0x250)](_0x20d13e[_0x3f4070(0x3e8)],_0x3f4070(0x35e)),_0x4112e1['clear'](),_0x408b34[_0x3f4070(0x3a0)](),_0x20d13e[_0x3f4070(0x309)][_0x3f4070(0x1a1)](_0x4d4269=>{const _0x1f27cf=_0x3f4070,{subtopics:_0x46167b,..._0x4ac4cc}=_0x4d4269;_0x4112e1[_0x1f27cf(0x250)](_0x4ac4cc),(_0x46167b||[])[_0x1f27cf(0x1a1)](_0x7b6176=>_0x408b34[_0x1f27cf(0x250)](_0x7b6176));}),_0x4513a5[_0x3f4070(0x16b)]=()=>_0x47f7a9(),_0x4513a5[_0x3f4070(0x1a9)]=_0x47c88d=>_0x50777f(_0x47c88d['target']['error']);});},async 'autoBackup'(_0x1bad21){const _0x5aa7e5=_0x287dc7;await this['initDB']();const _0x2bb78e=new Date()[_0x5aa7e5(0x185)]()[_0x5aa7e5(0x355)](0x0,0xa),_0x3768b0=localStorage['getItem']('lastBackupDate');if(_0x2bb78e!==_0x3768b0){console[_0x5aa7e5(0x158)](_0x5aa7e5(0x15a)+_0x2bb78e+_0x5aa7e5(0x1b0));const _0x27b6d7={'date':_0x2bb78e,'data':JSON[_0x5aa7e5(0x23b)](JSON[_0x5aa7e5(0x194)](_0x1bad21))},_0x4f02aa=this['db'][_0x5aa7e5(0x277)](['backups'],_0x5aa7e5(0x3f0)),_0x1b0e45=_0x4f02aa['objectStore'](_0x5aa7e5(0x1e5)),_0x1fa6d5=_0x1b0e45[_0x5aa7e5(0x250)](_0x27b6d7);_0x1fa6d5['onsuccess']=()=>{const _0x3509d8=_0x5aa7e5;localStorage[_0x3509d8(0x2e0)](_0x3509d8(0x358),_0x2bb78e),console[_0x3509d8(0x158)](_0x3509d8(0x1c8)),this['cleanupOldBackups'](_0x1bad21?.[_0x3509d8(0x3e8)]?.[_0x3509d8(0x287)]||0x7);},_0x1fa6d5['onerror']=_0x37b42f=>{const _0x10c898=_0x5aa7e5;console[_0x10c898(0x206)](_0x10c898(0x245),_0x37b42f[_0x10c898(0x402)]['error']);};}},async 'cleanupOldBackups'(_0x5d7494){const _0x105732=_0x287dc7;await this['initDB']();const _0x5d900e=this['db'][_0x105732(0x277)]([_0x105732(0x1e5)],_0x105732(0x3f0)),_0xbd7db7=_0x5d900e[_0x105732(0x297)](_0x105732(0x1e5)),_0x17c374=_0xbd7db7['getAllKeys']();_0x17c374[_0x105732(0x3b1)]=()=>{const _0x21a7d5=_0x105732,_0x4e9ebf=_0x17c374[_0x21a7d5(0x1e4)]['sort']()[_0x21a7d5(0x232)]();if(_0x4e9ebf[_0x21a7d5(0x2ae)]>_0x5d7494){const _0x422f9a=_0x4e9ebf[_0x21a7d5(0x355)](_0x5d7494);_0x422f9a['forEach'](_0x391dec=>{const _0x5240bf=_0x21a7d5;_0xbd7db7['delete'](_0x391dec),console[_0x5240bf(0x158)](_0x5240bf(0x3a9)+_0x391dec);});}};},async 'getBackupList'(){const _0x2e21bb=_0x287dc7;return await this[_0x2e21bb(0x160)](),new Promise((_0x339c52,_0x493fde)=>{const _0x60ded8=_0x2e21bb,_0x30df8e=this['db'][_0x60ded8(0x277)](['backups'],_0x60ded8(0x381)),_0x30df3c=_0x30df8e[_0x60ded8(0x297)](_0x60ded8(0x1e5)),_0x329c9d=_0x30df3c['getAll']();_0x329c9d['onsuccess']=()=>_0x339c52(_0x329c9d['result']['sort']((_0x349843,_0x2b3e69)=>_0x2b3e69['date']['localeCompare'](_0x349843['date']))),_0x329c9d['onerror']=_0x134abe=>_0x493fde(_0x134abe[_0x60ded8(0x402)][_0x60ded8(0x206)]);});},async 'restoreBackup'(_0x382506){const _0x5dbf6e=_0x287dc7;return await this[_0x5dbf6e(0x160)](),new Promise((_0x3ae8f4,_0x41a81a)=>{const _0x2de595=_0x5dbf6e,_0x446172=this['db'][_0x2de595(0x277)](['backups'],_0x2de595(0x381)),_0xbddf9f=_0x446172['objectStore'](_0x2de595(0x1e5)),_0x403986=_0xbddf9f[_0x2de595(0x132)](_0x382506);_0x403986[_0x2de595(0x3b1)]=()=>{const _0xae3351=_0x2de595;_0x403986[_0xae3351(0x1e4)]&&_0x403986[_0xae3351(0x1e4)][_0xae3351(0x308)]?(localStorage[_0xae3351(0x2e0)](_0xae3351(0x21f),JSON[_0xae3351(0x194)](_0x403986[_0xae3351(0x1e4)][_0xae3351(0x308)])),_0x3ae8f4(_0x403986[_0xae3351(0x1e4)][_0xae3351(0x308)])):_0x41a81a(new Error(_0xae3351(0x1db)));},_0x403986['onerror']=_0x87d127=>_0x41a81a(_0x87d127[_0x2de595(0x402)]['error']);});},'exportData'(_0x4cf2cb){const _0x578e2a=_0x287dc7;let _0x3b178e={};try{_0x3b178e=JSON[_0x578e2a(0x23b)](JSON['stringify'](_0x4cf2cb||{}));}catch(_0x4e552b){_0x3b178e=_0x4cf2cb;}try{if(_0x3b178e&&_0x3b178e[_0x578e2a(0x3e8)])_0x3b178e[_0x578e2a(0x3e8)]['apiKey']='';}catch(_0x4ffc3a){}const _0x55a792=new Blob([JSON[_0x578e2a(0x194)](_0x3b178e,null,0x2)],{'type':_0x578e2a(0x166)}),_0x5b0d76=document[_0x578e2a(0x290)]('a'),_0x4d7735=new Date(),_0x305839=_0x586e8a=>(''+_0x586e8a)[_0x578e2a(0x147)](0x2,'0');_0x5b0d76[_0x578e2a(0x2ab)]=URL[_0x578e2a(0x237)](_0x55a792),_0x5b0d76['download']=_0x578e2a(0x43b)+_0x4d7735[_0x578e2a(0x3a1)]()+_0x305839(_0x4d7735['getMonth']()+0x1)+_0x305839(_0x4d7735[_0x578e2a(0x1fe)]())+'.json',_0x5b0d76[_0x578e2a(0x443)](),URL[_0x578e2a(0x218)](_0x5b0d76['href']);},async 'importData'(_0x13c113){const _0x390a70=_0x287dc7,_0x3056a2=await _0x13c113[_0x390a70(0x13a)](),_0x79affb=JSON[_0x390a70(0x23b)](_0x3056a2);if(!_0x79affb[_0x390a70(0x227)]||!_0x79affb['settings']||!Array[_0x390a70(0x164)](_0x79affb[_0x390a70(0x309)]))throw new Error(_0x390a70(0x221));try{const _0x3c5ae3=window['data']&&window[_0x390a70(0x308)][_0x390a70(0x3e8)]&&window[_0x390a70(0x308)]['settings'][_0x390a70(0x41b)]||'';(!(_0x390a70(0x41b)in _0x79affb['settings'])||_0x79affb[_0x390a70(0x3e8)][_0x390a70(0x41b)]==='')&&(_0x79affb[_0x390a70(0x3e8)]['apiKey']=_0x3c5ae3);}catch(_0x546e20){}return localStorage['setItem'](_0x390a70(0x21f),JSON[_0x390a70(0x194)](_0x79affb)),_0x79affb;}},$=(_0x6cb06,_0x316d2e=document)=>_0x316d2e[_0x287dc7(0x253)](_0x6cb06),breakSuggestions=[_0x287dc7(0x3d3),_0x287dc7(0x2f5),_0x287dc7(0x266),'Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.',_0x287dc7(0x2c7),_0x287dc7(0x2ca),_0x287dc7(0x1e2),_0x287dc7(0x1e6),_0x287dc7(0x28e),_0x287dc7(0x32f),_0x287dc7(0x3f2),'Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.',_0x287dc7(0x23e),_0x287dc7(0x364),_0x287dc7(0x38b),_0x287dc7(0x35a),_0x287dc7(0x17e),_0x287dc7(0x2c5),_0x287dc7(0x3f7),_0x287dc7(0x440),_0x287dc7(0x3de),_0x287dc7(0x230),_0x287dc7(0x2c9),_0x287dc7(0x296),_0x287dc7(0x352),_0x287dc7(0x3ff),'Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.',_0x287dc7(0x12e),_0x287dc7(0x199),_0x287dc7(0x29c),_0x287dc7(0x1bc),'Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!'],$$=(_0x28864b,_0x5a0e69=document)=>Array['from'](_0x5a0e69[_0x287dc7(0x145)](_0x28864b));function on(_0x4fe240,_0x3924b9,_0x5aec75){const _0x47e880=_0x287dc7;if(!_0x4fe240){console['warn'](_0x47e880(0x32b),_0x3924b9);return;}_0x4fe240[_0x47e880(0x399)](_0x3924b9,_0x5aec75);}const formatMMSS=_0x297cc6=>{const _0x5ae91b=_0x287dc7,_0x533ab0=Math[_0x5ae91b(0x163)](_0x297cc6/0x3c)[_0x5ae91b(0x33e)]()[_0x5ae91b(0x147)](0x2,'0'),_0x5b5fe2=Math['floor'](_0x297cc6%0x3c)['toString']()[_0x5ae91b(0x147)](0x2,'0');return _0x533ab0+':'+_0x5b5fe2;},uid=(_0x4fd80b='id')=>_0x4fd80b+'_'+Date[_0x287dc7(0x447)]()+'_'+Math[_0x287dc7(0x20a)]()[_0x287dc7(0x33e)](0x24)['slice'](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0x538937){const _0x5e5136=_0x287dc7;try{const _0x112224=_0x538937[_0x5e5136(0x145)](_0x5e5136(0x2dc));if(!_0x112224[_0x5e5136(0x2ae)])return;const _0x60bf2=_0x112224[0x0],_0x53c404=_0x112224[_0x112224[_0x5e5136(0x2ae)]-0x1],_0x1fc3e3=_0x4c38b2=>{const _0x38a610=_0x5e5136;if(_0x4c38b2[_0x38a610(0x3f1)]===_0x38a610(0x275)){if(_0x4c38b2[_0x38a610(0x2da)]&&document[_0x38a610(0x2df)]===_0x60bf2)_0x4c38b2[_0x38a610(0x23a)](),_0x53c404[_0x38a610(0x171)]();else!_0x4c38b2['shiftKey']&&document[_0x38a610(0x2df)]===_0x53c404&&(_0x4c38b2[_0x38a610(0x23a)](),_0x60bf2[_0x38a610(0x171)]());}};_0x538937['addEventListener']('keydown',_0x1fc3e3),_0x60bf2[_0x5e5136(0x171)](),__releaseFocusTrap=()=>{const _0x3c0cd8=_0x5e5136;try{_0x538937[_0x3c0cd8(0x14b)](_0x3c0cd8(0x1cc),_0x1fc3e3);}catch(_0x277620){}};}catch(_0x4f1100){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x4283da){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()[_0x287dc7(0x185)]();function toast(_0x205fcf,_0xb96177=0xa28){const _0x3a0da2=_0x287dc7,_0x161882=$(_0x3a0da2(0x3e5)),_0x3d158f=document['createElement'](_0x3a0da2(0x2aa));_0x3d158f['className']=_0x3a0da2(0x2f0),_0x3d158f[_0x3a0da2(0x181)]=_0x205fcf,_0x161882[_0x3a0da2(0x22f)](_0x3d158f),setTimeout(()=>{const _0x4eb26d=_0x3a0da2;_0x3d158f[_0x4eb26d(0x44b)]['opacity']='0';},_0xb96177-0x12c),setTimeout(()=>_0x161882[_0x3a0da2(0x3c2)](_0x3d158f),_0xb96177);}function escapeHTML(_0x5a8777){const _0x33c986=_0x287dc7;return _0x5a8777['replace'](/[&<>"']/g,_0x194212=>({'&':_0x33c986(0x437),'<':'&lt;','>':_0x33c986(0x19a),'\x22':'&quot;','\x27':_0x33c986(0x13c)}[_0x194212]));}function formatDaysHoursMinutes(_0x1c5037){const _0x57a658=_0x287dc7;if(!_0x1c5037||_0x1c5037<0x1)return'0\x20phút';const _0x9b9d8f=Math[_0x57a658(0x163)](_0x1c5037/0x3c),_0xf839a2=_0x1c5037%0x3c,_0x8d4e2d=_0xf839a2[_0x57a658(0x33e)]()[_0x57a658(0x147)](0x2,'0');return _0x9b9d8f+_0x57a658(0x417)+_0x8d4e2d+_0x57a658(0x19b);}function formatGeminiResponse(_0x456bcb){const _0x5deb0d=_0x287dc7;return _0x456bcb[_0x5deb0d(0x2c1)](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0xd0b567){const _0xcc6f4d=_0x287dc7,_0x25f8fc=(_0xd0b567||'')['split']('\x0a');let _0x5d0f12='',_0x38fcec=null;const _0x32f6a8=()=>{const _0x5c533a=_0xbc78;_0x38fcec&&(_0x5d0f12+=_0x38fcec==='ol'?_0x5c533a(0x1b3):_0x5c533a(0x43d),_0x38fcec=null);};for(let _0x1d5eef of _0x25f8fc){let _0x327c0a=(_0x1d5eef||'')[_0xcc6f4d(0x13e)]();if(!_0x327c0a){_0x32f6a8();continue;}if(_0x327c0a[_0xcc6f4d(0x339)](_0xcc6f4d(0x268)))_0x32f6a8(),_0x5d0f12+=_0xcc6f4d(0x135)+escapeHTML(_0x327c0a['substring'](0x5))+'</h4>';else{if(/^\d+\.\s/[_0xcc6f4d(0x438)](_0x327c0a)){_0x38fcec!=='ol'&&(_0x32f6a8(),_0x5d0f12+=_0xcc6f4d(0x3f4),_0x38fcec='ol');const _0x1c680c=_0x327c0a['substring'](_0x327c0a[_0xcc6f4d(0x24c)]('\x20')+0x1);_0x5d0f12+='<li>'+escapeHTML(_0x1c680c)+_0xcc6f4d(0x397);}else _0x327c0a[_0xcc6f4d(0x339)]('-\x20')?(_0x38fcec!=='ul'&&(_0x32f6a8(),_0x5d0f12+=_0xcc6f4d(0x3c5),_0x38fcec='ul'),_0x5d0f12+=_0xcc6f4d(0x2e5)+escapeHTML(_0x327c0a[_0xcc6f4d(0x40e)](0x2))+_0xcc6f4d(0x397)):(_0x32f6a8(),_0x327c0a=escapeHTML(_0x327c0a)[_0xcc6f4d(0x2c1)](/\*\*(.*?)\*\*/g,_0xcc6f4d(0x1f3))[_0xcc6f4d(0x2c1)](/_(.*?)_/g,_0xcc6f4d(0x29b)),_0x5d0f12+='<p>'+_0x327c0a+_0xcc6f4d(0x26a));}}return _0x32f6a8(),_0x5d0f12;}function wrapTextInMarkdown(_0x133ee3,_0x1c867b,_0x314d02=''){const _0xeb47c9=_0x287dc7;if(!_0x133ee3)return;const _0x40fa27=_0x133ee3[_0xeb47c9(0x39e)]||0x0,_0x14bed2=_0x133ee3[_0xeb47c9(0x284)]||0x0,_0x3b3a9b=_0x133ee3['value'][_0xeb47c9(0x40e)](_0x40fa27,_0x14bed2),_0x2b6534=_0x1c867b+_0x3b3a9b+(_0x314d02||_0x1c867b);_0x133ee3[_0xeb47c9(0x131)](_0x2b6534,_0x40fa27,_0x14bed2,_0xeb47c9(0x267)),_0x133ee3[_0xeb47c9(0x171)]();}function updateEditorPreview(){const _0x510435=_0x287dc7,_0x46e811=$(_0x510435(0x363)),_0x51a444=$(_0x510435(0x217));if(!_0x46e811||!_0x51a444)return;const _0x2f648e=_0x46e811[_0x510435(0x1ae)]||'';_0x51a444[_0x510435(0x382)]=parseSimpleMarkdown(_0x2f648e);}function normalizeDataStructure(_0x6105b0){const _0xf150ed=_0x287dc7;if(!_0x6105b0||typeof _0x6105b0!=='object')return;const _0x55f4cd=_0x6105b0[_0xf150ed(0x3e8)]||{},_0x195106={...defaults[_0xf150ed(0x3e8)],..._0x55f4cd,'durations':{...defaults[_0xf150ed(0x3e8)]['durations'],..._0x55f4cd[_0xf150ed(0x22a)]||{}}};if(!Array[_0xf150ed(0x164)](_0x195106[_0xf150ed(0x19d)]))_0x195106[_0xf150ed(0x19d)]=[];_0x6105b0[_0xf150ed(0x3e8)]=_0x195106,_0x6105b0[_0xf150ed(0x309)]=Array['isArray'](_0x6105b0['topics'])?_0x6105b0[_0xf150ed(0x309)]:[],_0x6105b0[_0xf150ed(0x309)][_0xf150ed(0x1a1)](_0x3b6d0a=>{const _0x322ffa=_0xf150ed;_0x3b6d0a[_0x322ffa(0x1cd)]=Array[_0x322ffa(0x164)](_0x3b6d0a[_0x322ffa(0x1cd)])?_0x3b6d0a['subtopics']:[],_0x3b6d0a['subtopics'][_0x322ffa(0x1a1)](_0x3c3fa2=>{const _0x120246=_0x322ffa;_0x3c3fa2['tasks']=_0x3c3fa2[_0x120246(0x27e)]||[],_0x3c3fa2['generalNotes']=_0x3c3fa2[_0x120246(0x157)]||[],_0x3c3fa2[_0x120246(0x2fb)]=_0x3c3fa2[_0x120246(0x2fb)]||[],_0x3c3fa2[_0x120246(0x435)]=_0x3c3fa2['chatHistory']||[],_0x3c3fa2[_0x120246(0x34c)]=Array[_0x120246(0x164)](_0x3c3fa2[_0x120246(0x34c)])?_0x3c3fa2[_0x120246(0x34c)]:[],_0x3c3fa2['stats']=_0x3c3fa2[_0x120246(0x3df)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x3c3fa2[_0x120246(0x423)]=_0x3c3fa2[_0x120246(0x423)]||[],_0x3c3fa2[_0x120246(0x210)]=_0x3c3fa2[_0x120246(0x210)]||{'state':_0x120246(0x1d5),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x2d8f53){const _0x14fbf6=_0x287dc7;if(!_0x2d8f53)return null;const _0x4273c6=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0x16c320=_0x2d8f53[_0x14fbf6(0x150)](_0x4273c6);return _0x16c320?_0x16c320[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x4e4dd3=_0x287dc7;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x16277a=document[_0x4e4dd3(0x1d7)](_0x4e4dd3(0x396)),_0x1fc6fe=(_0x16277a&&_0x16277a[_0x4e4dd3(0x1ae)]?_0x16277a['value']:'')[_0x4e4dd3(0x13e)]();return _0x1fc6fe;}catch(_0x17a8d7){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function handleYoutubeUrlInput(){const _0x1f4777=_0x287dc7,_0x488ced=$(_0x1f4777(0x3d4)),_0x318d90=$(_0x1f4777(0x2d2)),_0x5ef367=$(_0x1f4777(0x15e)),_0x55852f=_0x488ced['value'][_0x1f4777(0x13e)](),_0xe0a59d=extractYouTubeID(_0x55852f);if(_0xe0a59d){_0x318d90[_0x1f4777(0x181)]=_0x1f4777(0x3ea),_0x318d90[_0x1f4777(0x44b)][_0x1f4777(0x3aa)]=_0x1f4777(0x2d5),_0x5ef367['disabled']=![],sessionYoutubeUrl=_0x55852f;try{ytUserPaused=![];}catch(_0x62a0cf){}try{const _0x336566='https://img.youtube.com/vi/'+_0xe0a59d+_0x1f4777(0x32d),_0x4c0c5b=new Image();_0x4c0c5b[_0x1f4777(0x329)]=async()=>{const _0x4a6f61=_0x1f4777;data[_0x4a6f61(0x3e8)][_0x4a6f61(0x3b2)]=_0x336566;try{await saveData();}catch(_0x5956b6){}applyCustomBg();},_0x4c0c5b['onerror']=async()=>{const _0x55f770=_0x1f4777,_0x48b582='https://img.youtube.com/vi/'+_0xe0a59d+_0x55f770(0x182);data[_0x55f770(0x3e8)][_0x55f770(0x3b2)]=_0x48b582;try{await saveData();}catch(_0x169d89){}applyCustomBg();},_0x4c0c5b[_0x1f4777(0x28c)]=_0x336566;}catch(_0x4813c7){}try{if(IS_FILE_PROTOCOL){const _0x2451aa=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0xe0a59d,{'autoplay':0x1,'mute':_0x2451aa});try{setTimeout(()=>{const _0x1ec06e=_0x1f4777;try{fallbackPostMessage(_0x1ec06e(0x43e));}catch(_0x27a855){}},0xfa);}catch(_0x3a02bf){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0x1d40a3=_0x1f4777,_0x2ad2dc=document[_0x1d40a3(0x1d7)]('ytUrlFeedback');if(_0x2ad2dc)_0x2ad2dc[_0x1d40a3(0x181)]=_0x1d40a3(0x36e);},0x1f4);}catch(_0x442091){}}else ensureYouTubeAPI()[_0x1f4777(0x32e)](()=>{const _0x2105b8=_0x1f4777;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer[_0x2105b8(0x24a)]&&ytPlayer[_0x2105b8(0x43e)]&&(ytPlayer[_0x2105b8(0x24a)](),ytPlayer['playVideo'](),_ytPrimed=!![],showSoundPermission());}catch(_0x39fbb8){}})[_0x1f4777(0x2db)](()=>{});}catch(_0x501e62){}}else{if(_0x55852f===''){_0x318d90['textContent']='',_0x5ef367[_0x1f4777(0x146)]=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x2e9d4e){}else ytPlayer&&ytPlayer['stopVideo']&&ytPlayer[_0x1f4777(0x139)]();}else _0x318d90[_0x1f4777(0x181)]=_0x1f4777(0x14c),_0x318d90['style']['color']=_0x1f4777(0x420),_0x5ef367[_0x1f4777(0x146)]=!![];}}function applyTheme(_0x304e51){const _0x27c092=_0x287dc7,_0x34a67f=_0x304e51||data[_0x27c092(0x3e8)][_0x27c092(0x370)]||_0x27c092(0x3e4);document[_0x27c092(0x192)][_0x27c092(0x44e)][_0x27c092(0x370)]=_0x34a67f;const _0x3d74b8=[_0x27c092(0x189),_0x27c092(0x36b)][_0x27c092(0x2ce)](_0x34a67f),_0x39dbfd=_0x34a67f===_0x27c092(0x356)||_0x34a67f===_0x27c092(0x1f5),_0x1b5b09=data[_0x27c092(0x3e8)][_0x27c092(0x3b2)],_0x64346c=()=>{const _0x1c97af=_0x27c092;try{document['body'][_0x1c97af(0x44b)][_0x1c97af(0x188)]='';}catch(_0x1ec32a){}};if(_0x1b5b09&&!data[_0x27c092(0x3e8)]['useYtThumbnailAsBg'])document[_0x27c092(0x192)][_0x27c092(0x44b)]['setProperty'](_0x27c092(0x149),_0x27c092(0x42e)+_0x1b5b09+')'),_0x64346c();else{if(_0x1b5b09&&data['settings'][_0x27c092(0x448)])document[_0x27c092(0x192)][_0x27c092(0x44b)]['setProperty'](_0x27c092(0x149),_0x27c092(0x42e)+_0x1b5b09+')'),_0x64346c();else{if(_0x3d74b8)document[_0x27c092(0x192)]['style']['removeProperty']('--bg-image'),_0x64346c();else _0x39dbfd?(document[_0x27c092(0x192)]['style'][_0x27c092(0x13d)](_0x27c092(0x149),_0x27c092(0x1cf)),_0x64346c()):(document[_0x27c092(0x192)][_0x27c092(0x44b)][_0x27c092(0x13d)](_0x27c092(0x149),''),document[_0x27c092(0x192)]['style'][_0x27c092(0x188)]=_0x27c092(0x179));}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':_0x287dc7(0x3cd),'preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x287dc7(0x270),'theme':'default','cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'enableSessionNotes':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x287dc7(0x2b5),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':_0x287dc7(0x197),'content':_0x287dc7(0x2cc)},{'id':uid('m'),'title':_0x287dc7(0x3fc),'content':_0x287dc7(0x258)},{'id':uid('m'),'title':_0x287dc7(0x2d4),'content':_0x287dc7(0x256)},{'id':uid('m'),'title':_0x287dc7(0x180),'content':'<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>'},{'id':uid('m'),'title':_0x287dc7(0x2e3),'content':'<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>'}]},'topics':[]};try{delete defaults[_0x287dc7(0x3e8)]['methods'];}catch(_0x34c170){}let data,editingPreset='A',AUDIO_CTX=null;function ensureAudio(){const _0x283b10=_0x287dc7;if(!AUDIO_CTX)AUDIO_CTX=new(window[(_0x283b10(0x23f))]||window['webkitAudioContext'])();}function tone(_0x37a7d1=0x370,_0x5d657d=0xc8,_0x2aea66=0.2,_0x5c7631=_0x287dc7(0x294),_0x403b60=0x0){const _0x5bd7bb=_0x287dc7;ensureAudio();const _0x34b74b=AUDIO_CTX,_0x2e62f7=_0x34b74b[_0x5bd7bb(0x24b)](),_0x383507=_0x34b74b[_0x5bd7bb(0x1f9)]();_0x2e62f7[_0x5bd7bb(0x374)]=_0x5c7631,_0x2e62f7[_0x5bd7bb(0x3b3)][_0x5bd7bb(0x1ae)]=_0x37a7d1,_0x2e62f7[_0x5bd7bb(0x1a2)](_0x383507),_0x383507[_0x5bd7bb(0x1a2)](_0x34b74b[_0x5bd7bb(0x37f)]);const _0x24ed54=_0x34b74b[_0x5bd7bb(0x2bc)]+_0x403b60;_0x383507[_0x5bd7bb(0x378)][_0x5bd7bb(0x2e1)](0x0,_0x24ed54),_0x383507[_0x5bd7bb(0x378)][_0x5bd7bb(0x3ae)](_0x2aea66,_0x24ed54+0.01),_0x383507[_0x5bd7bb(0x378)]['exponentialRampToValueAtTime'](0.0001,_0x24ed54+_0x5d657d/0x3e8),_0x2e62f7[_0x5bd7bb(0x315)](_0x24ed54),_0x2e62f7[_0x5bd7bb(0x441)](_0x24ed54+_0x5d657d/0x3e8+0.05);}function playSound(_0x51a368){const _0x9b79b8=_0x287dc7;if(!data['settings'][_0x9b79b8(0x1dc)])return;const _0x53071c=Math[_0x9b79b8(0x344)](0x0,Math[_0x9b79b8(0x445)](0x1,data['settings'][_0x9b79b8(0x205)]??0.8)),_0x349c7c=data[_0x9b79b8(0x3e8)]['customSounds']?.[_0x51a368];let _0x20e187;if(_0x51a368===_0x9b79b8(0x2e9))_0x20e187=$(_0x9b79b8(0x2d1));else{if(_0x51a368===_0x9b79b8(0x392))_0x20e187=$(_0x9b79b8(0x1c6));else{if(_0x51a368===_0x9b79b8(0x1bd))_0x20e187=$('#audioLongEnd');}}if(_0x349c7c&&_0x20e187){_0x349c7c[_0x9b79b8(0x339)](_0x9b79b8(0x183))||_0x349c7c['startsWith']('http')||_0x349c7c['startsWith']('blob:')?(_0x20e187[_0x9b79b8(0x28c)]=_0x349c7c,_0x20e187[_0x9b79b8(0x205)]=_0x53071c,_0x20e187['play']()[_0x9b79b8(0x2db)](_0x31aa21=>console[_0x9b79b8(0x206)]('Lỗi\x20phát\x20âm\x20thanh:',_0x31aa21))):getStoredFileUrl(_0x349c7c)[_0x9b79b8(0x32e)](_0x380a88=>{const _0x728e59=_0x9b79b8;_0x380a88&&(_0x20e187[_0x728e59(0x28c)]=_0x380a88,_0x20e187[_0x728e59(0x205)]=_0x53071c,_0x20e187[_0x728e59(0x26e)]()[_0x728e59(0x2db)](_0x5badd6=>console[_0x728e59(0x206)]('Lỗi\x20phát\x20âm\x20thanh:',_0x5badd6)));});return;}const _0x3e9092=data[_0x9b79b8(0x3e8)]['soundTheme']||'beep';if(_0x3e9092==='beep'){if(_0x51a368===_0x9b79b8(0x2e9))tone(0x370,0xfa,_0x53071c),tone(0x294,0xb4,_0x53071c*0.8,_0x9b79b8(0x294),0.22);else{if(_0x51a368===_0x9b79b8(0x392))tone(0x294,0xdc,_0x53071c*0.9);else _0x51a368===_0x9b79b8(0x1bd)&&(tone(0x208,0xc8,_0x53071c),tone(0x30c,0xc8,_0x53071c,_0x9b79b8(0x294),0.22),tone(0x410,0xdc,_0x53071c,_0x9b79b8(0x294),0.44));}}else{if(_0x51a368===_0x9b79b8(0x2e9))tone(0x4b0,0xa0,_0x53071c*0.9,'triangle'),tone(0x384,0xdc,_0x53071c*0.8,_0x9b79b8(0x154),0.18);else{if(_0x51a368===_0x9b79b8(0x392))tone(0x370,0xf0,_0x53071c*0.8,_0x9b79b8(0x154));else _0x51a368===_0x9b79b8(0x1bd)&&(tone(0x258,0xdc,_0x53071c*0.9,_0x9b79b8(0x154)),tone(0x3b6,0xf0,_0x53071c*0.9,_0x9b79b8(0x154),0.22),tone(0x4b0,0xf0,_0x53071c,_0x9b79b8(0x154),0.44));}}}async function saveData(){const _0x38a411=_0x287dc7;try{await storageManager['save'](data);}catch(_0x542621){console['error']('Failed\x20to\x20save\x20data:',_0x542621),toast('Lỗi\x20lưu\x20dữ\x20liệu:\x20'+_0x542621[_0x38a411(0x2fc)]);}}async function ensureValidSelection(){const _0x40c473=_0x287dc7,_0x29d753=data['settings'];if(!data['topics']||data[_0x40c473(0x309)][_0x40c473(0x2ae)]===0x0){_0x29d753[_0x40c473(0x404)]='',_0x29d753[_0x40c473(0x424)]='',await saveData();return;}const _0x13292e=data['topics'][_0x40c473(0x137)](_0x356d42=>_0x356d42['id']===_0x29d753['selectedTopicId']),_0x2144e8=_0x13292e?.[_0x40c473(0x1cd)][_0x40c473(0x137)](_0x2c8d00=>_0x2c8d00['id']===_0x29d753['selectedSubtopicId']);if(!_0x13292e||!_0x2144e8){const _0x2770a2=data['topics'][0x0],_0x4e9a22=_0x2770a2?.[_0x40c473(0x1cd)]?.[0x0];_0x29d753[_0x40c473(0x404)]=_0x2770a2?.['id']||'',_0x29d753['selectedSubtopicId']=_0x4e9a22?.['id']||'',await saveData();}}function showInputModal(_0x3c584b,_0x25a8d4,_0x2963df=''){const _0x47fbc3=_0x287dc7;$(_0x47fbc3(0x351))[_0x47fbc3(0x181)]=_0x3c584b,$(_0x47fbc3(0x2b3))[_0x47fbc3(0x1de)][_0x47fbc3(0x347)](_0x47fbc3(0x280));const _0x3f5824=$(_0x47fbc3(0x2bd));_0x3f5824[_0x47fbc3(0x1ae)]=_0x2963df,_0x3f5824['classList'][_0x47fbc3(0x178)](_0x47fbc3(0x280)),$(_0x47fbc3(0x222))[_0x47fbc3(0x1de)][_0x47fbc3(0x347)](_0x47fbc3(0x384));try{trapFocus($(_0x47fbc3(0x222)));}catch(_0x20ab59){}_0x3f5824['focus'](),_0x3f5824[_0x47fbc3(0x3d5)]();const _0x51dfce=()=>{_0x25a8d4(_0x3f5824['value']),_0x2b4b1f();},_0x151eb8=()=>_0x2b4b1f(),_0x5f10f3=_0x144051=>{const _0x196aa1=_0x47fbc3;if(_0x144051[_0x196aa1(0x3f1)]===_0x196aa1(0x289))_0x51dfce();if(_0x144051[_0x196aa1(0x3f1)]==='Escape')_0x151eb8();};$(_0x47fbc3(0x1d9))['onclick']=_0x51dfce,$(_0x47fbc3(0x2bf))['onclick']=_0x151eb8,_0x3f5824[_0x47fbc3(0x254)]=_0x5f10f3;function _0x2b4b1f(){const _0x3b6831=_0x47fbc3;$('#modalGeneric')[_0x3b6831(0x1de)]['remove']('show'),$(_0x3b6831(0x1d9))[_0x3b6831(0x29f)]=null,$(_0x3b6831(0x2bf))['onclick']=null,_0x3f5824[_0x3b6831(0x254)]=null;try{releaseFocus();}catch(_0x42fe40){}}}function showConfirmModal(_0xa1deaf,_0x2b2f65,_0x398cd9){const _0xebb068=_0x287dc7;$('#genericTitle')['textContent']=_0xa1deaf;const _0x572e6c=$(_0xebb068(0x2b3));_0x572e6c[_0xebb068(0x181)]=_0x2b2f65,_0x572e6c[_0xebb068(0x1de)]['remove'](_0xebb068(0x280)),$('#genericInput')['classList'][_0xebb068(0x347)](_0xebb068(0x280)),$(_0xebb068(0x222))[_0xebb068(0x1de)][_0xebb068(0x347)](_0xebb068(0x384));try{trapFocus($(_0xebb068(0x222)));}catch(_0x3727b6){}const _0xc2c920=()=>{_0x398cd9(!![]),_0x4483df();},_0x51838a=()=>{_0x398cd9(![]),_0x4483df();};$(_0xebb068(0x1d9))[_0xebb068(0x29f)]=_0xc2c920,$(_0xebb068(0x2bf))[_0xebb068(0x29f)]=_0x51838a;function _0x4483df(){const _0x244cb7=_0xebb068;$('#modalGeneric')[_0x244cb7(0x1de)][_0x244cb7(0x178)](_0x244cb7(0x384)),$(_0x244cb7(0x1d9))[_0x244cb7(0x29f)]=null,$(_0x244cb7(0x2bf))[_0x244cb7(0x29f)]=null;try{releaseFocus();}catch(_0x1a8e57){}}}let pendingNoteSessionId=null;function openNoteModal(_0x5799c6){const _0x407a53=_0x287dc7;pendingNoteSessionId=_0x5799c6||null;const _0xfe08e1=$(_0x407a53(0x2fd));if(!_0xfe08e1)return;const _0x1718ab=$('#noteText');if(_0x1718ab)try{_0x1718ab[_0x407a53(0x1ae)]='';}catch(_0x445792){}_0xfe08e1[_0x407a53(0x1de)][_0x407a53(0x347)]('show');try{trapFocus(_0xfe08e1);}catch(_0x159473){}}function closeNoteModal(){const _0xbdeeac=_0x287dc7,_0xf70588=$(_0xbdeeac(0x2fd));if(!_0xf70588)return;_0xf70588[_0xbdeeac(0x1de)][_0xbdeeac(0x178)](_0xbdeeac(0x384)),pendingNoteSessionId=null;try{releaseFocus();}catch(_0x59573a){}}async function switchView(_0x2a2a4e){const _0x303229=_0x287dc7;$$('.view')[_0x303229(0x1a1)](_0x51f274=>_0x51f274[_0x303229(0x1de)][_0x303229(0x178)](_0x303229(0x371))),$(_0x303229(0x413)+_0x2a2a4e)[_0x303229(0x1de)][_0x303229(0x347)](_0x303229(0x371)),$$(_0x303229(0x142))['forEach'](_0x465416=>_0x465416[_0x303229(0x1de)][_0x303229(0x178)]('active'));const _0x458ca0=$(_0x303229(0x3e9)+_0x2a2a4e+'\x22]');if(_0x458ca0)_0x458ca0[_0x303229(0x1de)][_0x303229(0x347)](_0x303229(0x371));data['settings'][_0x303229(0x24d)]=_0x2a2a4e,await saveData(),_0x2a2a4e===_0x303229(0x3df)&&renderDashboard();}function closeAllMenus(){const _0x2b3568=_0x287dc7;$$(_0x2b3568(0x34a))[_0x2b3568(0x1a1)](_0x37c948=>_0x37c948['classList'][_0x2b3568(0x178)](_0x2b3568(0x384))),$$(_0x2b3568(0x3ab))[_0x2b3568(0x1a1)](_0xbaedfc=>_0xbaedfc[_0x2b3568(0x1de)]['remove'](_0x2b3568(0x373)));}function renderTopics(){const _0x10102a=_0x287dc7,_0x46704c=$('#topicsList');if(!_0x46704c)return;_0x46704c[_0x10102a(0x382)]='';const _0x58bb69=data[_0x10102a(0x3e8)][_0x10102a(0x3b0)]||{};data[_0x10102a(0x309)][_0x10102a(0x1a1)](_0x275d13=>{const _0x31c202=_0x10102a,_0x58f31d=document['createElement'](_0x31c202(0x2aa));_0x58f31d[_0x31c202(0x255)]=_0x31c202(0x257),_0x58f31d['dataset'][_0x31c202(0x225)]=_0x275d13['id'];const _0x23ae4e=document[_0x31c202(0x290)](_0x31c202(0x2aa));_0x23ae4e[_0x31c202(0x255)]='topic-header';const _0x4550a3=!!_0x58bb69[_0x275d13['id']],_0x47f3f5=document[_0x31c202(0x290)]('button');_0x47f3f5[_0x31c202(0x255)]=_0x31c202(0x2bb),_0x47f3f5[_0x31c202(0x286)](_0x31c202(0x34b),String(!_0x4550a3)),_0x47f3f5[_0x31c202(0x382)]=_0x31c202(0x442);const _0x366737=document[_0x31c202(0x290)]('div');_0x366737['className']='topic-title',_0x366737[_0x31c202(0x181)]=_0x275d13[_0x31c202(0x332)];const _0x20165d=document[_0x31c202(0x290)]('div');_0x20165d[_0x31c202(0x255)]=_0x31c202(0x259);const _0x4e6ca5=document[_0x31c202(0x290)](_0x31c202(0x1df));_0x4e6ca5[_0x31c202(0x255)]=_0x31c202(0x31c),_0x4e6ca5['innerHTML']=_0x31c202(0x3e1),_0x4e6ca5[_0x31c202(0x44a)]=_0x31c202(0x421);const _0x3421a6=document[_0x31c202(0x290)]('div');_0x3421a6[_0x31c202(0x44b)]['position']=_0x31c202(0x234);const _0x4e0b0e=document[_0x31c202(0x290)]('button');_0x4e0b0e['className']=_0x31c202(0x41c),_0x4e0b0e[_0x31c202(0x382)]=_0x31c202(0x1b0),_0x4e0b0e[_0x31c202(0x44a)]='Thêm\x20tùy\x20chọn';const _0x19db3a=document[_0x31c202(0x290)]('div');_0x19db3a[_0x31c202(0x255)]=_0x31c202(0x31e);const _0x4d7561=document[_0x31c202(0x290)](_0x31c202(0x1df));_0x4d7561[_0x31c202(0x255)]=_0x31c202(0x27c),_0x4d7561[_0x31c202(0x382)]=_0x31c202(0x410);const _0x409187=document[_0x31c202(0x290)](_0x31c202(0x1df));_0x409187[_0x31c202(0x255)]=_0x31c202(0x3c8),_0x409187[_0x31c202(0x382)]=_0x31c202(0x203),_0x19db3a['append'](_0x4d7561,_0x409187),_0x3421a6['append'](_0x4e0b0e,_0x19db3a),_0x20165d[_0x31c202(0x1bf)](_0x4e6ca5,_0x3421a6),_0x23ae4e[_0x31c202(0x1bf)](_0x47f3f5,_0x366737,_0x20165d),_0x47f3f5['addEventListener'](_0x31c202(0x443),async _0x125912=>{const _0x570bf4=_0x31c202;_0x125912['stopPropagation']();const _0x51eea1=!!_0x58bb69[_0x275d13['id']];_0x51eea1?delete _0x58bb69[_0x275d13['id']]:_0x58bb69[_0x275d13['id']]=!![],data['settings'][_0x570bf4(0x3b0)]=_0x58bb69,await storageManager['updateSettings'](data[_0x570bf4(0x3e8)]),renderTopics();});const _0x5990bc=async()=>{const _0xa10a06=_0x31c202,_0x3887eb=!!_0x58bb69[_0x275d13['id']];_0x3887eb?delete _0x58bb69[_0x275d13['id']]:_0x58bb69[_0x275d13['id']]=!![],data[_0xa10a06(0x3e8)]['collapsedTopics']=_0x58bb69,await storageManager[_0xa10a06(0x12d)](data[_0xa10a06(0x3e8)]),renderTopics();};_0x23ae4e[_0x31c202(0x399)]('click',async _0x48834f=>{const _0x36637b=_0x31c202,_0x244815=_0x48834f[_0x36637b(0x402)];if(_0x244815&&_0x244815[_0x36637b(0x366)]){if(_0x244815[_0x36637b(0x366)](_0x36637b(0x263))||_0x244815[_0x36637b(0x366)](_0x36637b(0x34d))||_0x244815[_0x36637b(0x366)](_0x36637b(0x1df))||_0x244815[_0x36637b(0x366)](_0x36637b(0x26c)))return;}_0x48834f[_0x36637b(0x220)](),await _0x5990bc();}),_0x366737[_0x31c202(0x399)]('click',async _0x156d93=>{const _0x48aa2d=_0x31c202;_0x156d93[_0x48aa2d(0x220)](),await _0x5990bc();}),_0x58f31d[_0x31c202(0x399)]('click',async _0x180cc9=>{const _0x2354c3=_0x31c202,_0x789443=_0x180cc9[_0x2354c3(0x402)];if(_0x789443&&_0x789443[_0x2354c3(0x366)]){if(_0x789443[_0x2354c3(0x366)]('.subtopics'))return;if(_0x789443['closest'](_0x2354c3(0x263))||_0x789443[_0x2354c3(0x366)](_0x2354c3(0x34d))||_0x789443[_0x2354c3(0x366)](_0x2354c3(0x1df))||_0x789443[_0x2354c3(0x366)]('input,select,textarea'))return;}await _0x5990bc();});const _0x3e61aa=document[_0x31c202(0x290)](_0x31c202(0x2aa));_0x3e61aa[_0x31c202(0x255)]=_0x31c202(0x1cd)+(_0x4550a3?_0x31c202(0x17c):''),_0x3e61aa[_0x31c202(0x44e)][_0x31c202(0x225)]=_0x275d13['id'],_0x275d13[_0x31c202(0x1cd)][_0x31c202(0x1a1)](_0x4fbfa3=>{const _0x54cc7f=_0x31c202,_0x13f083=document[_0x54cc7f(0x290)](_0x54cc7f(0x2aa));_0x13f083[_0x54cc7f(0x255)]=_0x54cc7f(0x2ac),_0x13f083[_0x54cc7f(0x44e)][_0x54cc7f(0x292)]=_0x4fbfa3['id'];const _0x4b6220=document[_0x54cc7f(0x290)](_0x54cc7f(0x1df));_0x4b6220[_0x54cc7f(0x255)]=_0x54cc7f(0x449),_0x4b6220[_0x54cc7f(0x382)]='<span>•\x20'+escapeHTML(_0x4fbfa3[_0x54cc7f(0x332)])+_0x54cc7f(0x3c1),_0x4b6220['dataset'][_0x54cc7f(0x292)]=_0x4fbfa3['id'],_0x4b6220['dataset'][_0x54cc7f(0x225)]=_0x275d13['id'];if(data['settings'][_0x54cc7f(0x424)]===_0x4fbfa3['id'])_0x4b6220[_0x54cc7f(0x1de)][_0x54cc7f(0x347)]('active');const _0x2acccc=document[_0x54cc7f(0x290)](_0x54cc7f(0x2aa));_0x2acccc['className']=_0x54cc7f(0x169);const _0xaee167=document['createElement'](_0x54cc7f(0x2aa));_0xaee167[_0x54cc7f(0x44b)][_0x54cc7f(0x306)]=_0x54cc7f(0x234);const _0x3a0e7b=document[_0x54cc7f(0x290)](_0x54cc7f(0x1df));_0x3a0e7b[_0x54cc7f(0x255)]=_0x54cc7f(0x41c),_0x3a0e7b['innerHTML']=_0x54cc7f(0x1b0),_0x3a0e7b[_0x54cc7f(0x44a)]='Thêm\x20tùy\x20chọn';const _0x30f10d=document[_0x54cc7f(0x290)](_0x54cc7f(0x2aa));_0x30f10d[_0x54cc7f(0x255)]=_0x54cc7f(0x31e);const _0x360f39=document[_0x54cc7f(0x290)](_0x54cc7f(0x1df));_0x360f39[_0x54cc7f(0x255)]=_0x54cc7f(0x27c),_0x360f39[_0x54cc7f(0x382)]=_0x54cc7f(0x167);const _0x358a34=document[_0x54cc7f(0x290)](_0x54cc7f(0x1df));_0x358a34['className']=_0x54cc7f(0x3c8),_0x358a34['innerHTML']=_0x54cc7f(0x389),_0x30f10d[_0x54cc7f(0x1bf)](_0x360f39,_0x358a34),_0xaee167[_0x54cc7f(0x1bf)](_0x3a0e7b,_0x30f10d),_0x2acccc[_0x54cc7f(0x1bf)](_0xaee167),_0x13f083[_0x54cc7f(0x1bf)](_0x4b6220,_0x2acccc),_0x3e61aa['appendChild'](_0x13f083),_0x4b6220[_0x54cc7f(0x399)]('click',()=>selectSubtopic(_0x275d13['id'],_0x4fbfa3['id'])),_0x3a0e7b['addEventListener']('click',_0x465812=>{const _0x32abc4=_0x54cc7f;_0x465812[_0x32abc4(0x220)]();const _0x338d88=_0x30f10d[_0x32abc4(0x1de)][_0x32abc4(0x14d)](_0x32abc4(0x384));closeAllMenus(),_0x338d88?_0x58f31d[_0x32abc4(0x1de)][_0x32abc4(0x178)](_0x32abc4(0x373)):(_0x30f10d['classList'][_0x32abc4(0x347)](_0x32abc4(0x384)),_0x58f31d[_0x32abc4(0x1de)][_0x32abc4(0x347)](_0x32abc4(0x373)));}),_0x360f39[_0x54cc7f(0x399)](_0x54cc7f(0x443),()=>showInputModal('Đổi\x20tên\x20Chủ\x20đề\x20con',async _0x5a2d38=>{const _0x270bbb=_0x54cc7f;if(!_0x5a2d38)return;_0x4fbfa3[_0x270bbb(0x332)]=_0x5a2d38,await storageManager[_0x270bbb(0x38c)](_0x270bbb(0x1cd),_0x4fbfa3),renderAll();},_0x4fbfa3[_0x54cc7f(0x332)])),_0x358a34['addEventListener']('click',()=>showConfirmModal(_0x54cc7f(0x1d8),_0x54cc7f(0x152)+_0x4fbfa3[_0x54cc7f(0x332)]+_0x54cc7f(0x32a),async _0x13146a=>{const _0x13a50a=_0x54cc7f;if(!_0x13146a)return;_0x275d13[_0x13a50a(0x1cd)]=_0x275d13[_0x13a50a(0x1cd)][_0x13a50a(0x273)](_0x2bdfdc=>_0x2bdfdc['id']!==_0x4fbfa3['id']);const _0x55c183=data[_0x13a50a(0x3e8)];_0x55c183[_0x13a50a(0x424)]===_0x4fbfa3['id']&&(_0x55c183[_0x13a50a(0x424)]='',_0x55c183[_0x13a50a(0x404)]='',ensureValidSelection()),await storageManager['delete']('subtopics',_0x4fbfa3['id']),renderAll();}));}),_0x4e0b0e['addEventListener'](_0x31c202(0x443),_0x49b6cf=>{const _0x4d857c=_0x31c202;_0x49b6cf[_0x4d857c(0x220)]();const _0x4f33af=_0x19db3a[_0x4d857c(0x1de)]['contains'](_0x4d857c(0x384));closeAllMenus(),_0x4f33af?_0x58f31d[_0x4d857c(0x1de)][_0x4d857c(0x178)](_0x4d857c(0x373)):(_0x19db3a[_0x4d857c(0x1de)][_0x4d857c(0x347)](_0x4d857c(0x384)),_0x58f31d[_0x4d857c(0x1de)][_0x4d857c(0x347)](_0x4d857c(0x373)));}),_0x4e6ca5['addEventListener'](_0x31c202(0x443),()=>showInputModal(_0x31c202(0x1a5),async _0x13f17a=>{const _0x183954=_0x31c202;if(!_0x13f17a)return;const _0x4a83b0={'id':uid('s'),'topicId':_0x275d13['id'],'name':_0x13f17a,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'methods':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':'idle','prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x275d13[_0x183954(0x1cd)][_0x183954(0x207)](_0x4a83b0),await storageManager[_0x183954(0x347)](_0x183954(0x1cd),_0x4a83b0),renderTopics();})),_0x4d7561[_0x31c202(0x399)](_0x31c202(0x443),()=>showInputModal(_0x31c202(0x1b2),async _0x46aed2=>{const _0x4deb83=_0x31c202;if(!_0x46aed2)return;_0x275d13[_0x4deb83(0x332)]=_0x46aed2,await storageManager[_0x4deb83(0x38c)](_0x4deb83(0x309),_0x275d13),renderTopics();},_0x275d13[_0x31c202(0x332)])),_0x409187[_0x31c202(0x399)]('click',()=>showConfirmModal('Xác\x20nhận\x20xóa',_0x31c202(0x3bd)+_0x275d13['name']+_0x31c202(0x3d9),async _0x3c03d4=>{const _0x36f66e=_0x31c202;if(!_0x3c03d4)return;data['topics']=data['topics'][_0x36f66e(0x273)](_0x4a709a=>_0x4a709a['id']!==_0x275d13['id']),delete _0x58bb69[_0x275d13['id']];data[_0x36f66e(0x3e8)][_0x36f66e(0x404)]===_0x275d13['id']&&(data[_0x36f66e(0x3e8)][_0x36f66e(0x404)]='',data[_0x36f66e(0x3e8)]['selectedSubtopicId']='',ensureValidSelection());await storageManager[_0x36f66e(0x153)](_0x36f66e(0x309),_0x275d13['id']);for(const _0x388860 of _0x275d13['subtopics']){await storageManager[_0x36f66e(0x153)](_0x36f66e(0x1cd),_0x388860['id']);}renderAll();})),_0x4e6ca5[_0x31c202(0x399)]('click',_0x82f049=>_0x82f049[_0x31c202(0x220)]()),_0x4d7561[_0x31c202(0x399)](_0x31c202(0x443),_0x2f3b8a=>_0x2f3b8a[_0x31c202(0x220)]()),_0x409187[_0x31c202(0x399)]('click',_0x3a4824=>_0x3a4824[_0x31c202(0x220)]()),_0x58f31d[_0x31c202(0x1bf)](_0x23ae4e,_0x3e61aa),_0x46704c[_0x31c202(0x22f)](_0x58f31d);});if(window[_0x10102a(0x307)]){const _0x593d5c=document[_0x10102a(0x1d7)](_0x10102a(0x2b0));if(_0x593d5c){if(_0x593d5c['_sortable'])try{_0x593d5c[_0x10102a(0x224)][_0x10102a(0x1a0)]();}catch(_0x15b19b){}_0x593d5c['_sortable']=new Sortable(_0x593d5c,{'animation':0x96,'draggable':_0x10102a(0x1fd),'onEnd':async function(_0x567e07){const _0x4404e9=_0x10102a;if(_0x567e07[_0x4404e9(0x39b)]===_0x567e07[_0x4404e9(0x165)])return;const _0x9e4fdd=data['topics'][_0x4404e9(0x2d6)](_0x567e07[_0x4404e9(0x39b)],0x1)[0x0];data[_0x4404e9(0x309)][_0x4404e9(0x2d6)](_0x567e07[_0x4404e9(0x165)],0x0,_0x9e4fdd),await saveData(),renderTopics();}}),_0x593d5c['querySelectorAll'](_0x10102a(0x411))[_0x10102a(0x1a1)](_0x3d2949=>{const _0x13b52c=_0x10102a;new Sortable(_0x3d2949,{'group':_0x13b52c(0x3da),'animation':0x96,'draggable':'.sub-row','onEnd':async function(_0x2feeb9){const _0x169a17=_0x13b52c,_0x1add6f=_0x2feeb9[_0x169a17(0x17f)]?.[_0x169a17(0x44e)]?.['tid']||_0x2feeb9['from']?.['closest'](_0x169a17(0x1fd))?.['dataset']?.[_0x169a17(0x225)],_0x213fea=_0x2feeb9['to']?.[_0x169a17(0x44e)]?.[_0x169a17(0x225)]||_0x2feeb9['to']?.[_0x169a17(0x366)]('.topic-item')?.['dataset']?.[_0x169a17(0x225)],_0x30350c=data['topics']['find'](_0x5c56dd=>_0x5c56dd['id']===_0x1add6f),_0x12c07c=data[_0x169a17(0x309)][_0x169a17(0x137)](_0x52a316=>_0x52a316['id']===_0x213fea);if(!_0x30350c||!_0x12c07c)return;let _0xf817d=null;const _0x2debfa=_0x2feeb9[_0x169a17(0x394)]?.[_0x169a17(0x44e)]?.[_0x169a17(0x292)]||_0x2feeb9[_0x169a17(0x394)]?.[_0x169a17(0x253)](_0x169a17(0x1ba))?.[_0x169a17(0x44e)]?.[_0x169a17(0x292)];if(_0x2debfa){const _0x6d0522=_0x30350c[_0x169a17(0x1cd)]['findIndex'](_0x41d480=>_0x41d480['id']===_0x2debfa);if(_0x6d0522>=0x0)_0xf817d=_0x30350c[_0x169a17(0x1cd)][_0x169a17(0x2d6)](_0x6d0522,0x1)[0x0];}!_0xf817d&&(_0xf817d=_0x30350c[_0x169a17(0x1cd)][_0x169a17(0x2d6)](_0x2feeb9[_0x169a17(0x39b)],0x1)[0x0]);if(!_0xf817d)return;_0xf817d[_0x169a17(0x2a5)]=_0x12c07c['id'],_0x12c07c['subtopics'][_0x169a17(0x2d6)](_0x2feeb9['newIndex'],0x0,_0xf817d),data['settings']['selectedSubtopicId']===_0xf817d['id']&&(data[_0x169a17(0x3e8)]['selectedTopicId']=_0x12c07c['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x8fe67,_0x45d424){const _0x1858c4=_0x287dc7,_0x5914d7=$('.app-content'),_0x26ab4b=getCurrentSubtopic();_0x26ab4b&&timer[_0x1858c4(0x184)]!=='idle'&&(_0x26ab4b[_0x1858c4(0x210)]={'state':timer[_0x1858c4(0x184)],'prevState':timer[_0x1858c4(0x24f)],'remaining':timer['remaining'],'segmentTotal':timer[_0x1858c4(0x14e)],'cycleIndex':timer[_0x1858c4(0x2ea)]}),_0x5914d7[_0x1858c4(0x1de)][_0x1858c4(0x347)](_0x1858c4(0x190)),setTimeout(async()=>{const _0x4a0c06=_0x1858c4;data[_0x4a0c06(0x3e8)][_0x4a0c06(0x404)]=_0x8fe67,data[_0x4a0c06(0x3e8)][_0x4a0c06(0x424)]=_0x45d424;const _0x17eac4=getCurrentSubtopic();_0x17eac4[_0x4a0c06(0x210)]?(timer[_0x4a0c06(0x184)]=_0x17eac4[_0x4a0c06(0x210)][_0x4a0c06(0x184)],timer[_0x4a0c06(0x24f)]=_0x17eac4[_0x4a0c06(0x210)][_0x4a0c06(0x24f)]||null,timer[_0x4a0c06(0x1ec)]=_0x17eac4[_0x4a0c06(0x210)][_0x4a0c06(0x1ec)],timer['segmentTotal']=_0x17eac4['timerState']['segmentTotal'],timer[_0x4a0c06(0x2ea)]=_0x17eac4[_0x4a0c06(0x210)][_0x4a0c06(0x2ea)]):timer[_0x4a0c06(0x18a)](),await saveData(),timer[_0x4a0c06(0x320)](),renderAll(),switchView(_0x4a0c06(0x3cd)),_0x5914d7['classList'][_0x4a0c06(0x178)]('reloading');},0xc8);}function getCurrentSubtopic(){const _0x155bd4=_0x287dc7,_0x577a6c=data['settings'][_0x155bd4(0x404)],_0x57e7e0=data[_0x155bd4(0x3e8)]['selectedSubtopicId'];if(!_0x577a6c||!_0x57e7e0)return null;const _0x49e923=data[_0x155bd4(0x309)]['find'](_0x4cad68=>_0x4cad68['id']===_0x577a6c);if(!_0x49e923)return null;return _0x49e923['subtopics'][_0x155bd4(0x137)](_0x5ca1f2=>_0x5ca1f2['id']===_0x57e7e0)||null;}function renderContextBadge(){const _0x66acea=_0x287dc7,_0x211841=getCurrentSubtopic(),_0x8bfed2=_0x211841?_0x211841[_0x66acea(0x332)]:_0x66acea(0x3e0),_0x2de335=$(_0x66acea(0x3b4)),_0x577b49=$(_0x66acea(0x248)),_0x4bb3ab=$(_0x66acea(0x434));if(_0x2de335)_0x2de335[_0x66acea(0x181)]=_0x211841?_0x66acea(0x3a5)+_0x211841[_0x66acea(0x332)]:_0x66acea(0x156);if(_0x577b49)_0x577b49[_0x66acea(0x181)]=_0x8bfed2;if(_0x4bb3ab)_0x4bb3ab['textContent']=_0x8bfed2;}function _0xbc78(_0x3dcd63,_0x3dccc6){const _0x5aa02a=_0x5aa0();return _0xbc78=function(_0xbc7803,_0x3d22fb){_0xbc7803=_0xbc7803-0x12c;let _0x623168=_0x5aa02a[_0xbc7803];return _0x623168;},_0xbc78(_0x3dcd63,_0x3dccc6);}function renderSubtopicTasks(){const _0x1acdfc=_0x287dc7,_0x5426fe=getCurrentSubtopic(),_0x701d91=$('#subtopicTasksList'),_0x159638=$('#newSubtopicTaskInput');if(!_0x701d91||!_0x159638)return;const _0x312f5d=_0x159638['parentElement'];if(!_0x5426fe){_0x701d91['innerHTML']=_0x1acdfc(0x1d4),_0x312f5d[_0x1acdfc(0x1de)][_0x1acdfc(0x347)](_0x1acdfc(0x280));return;}_0x312f5d[_0x1acdfc(0x1de)][_0x1acdfc(0x178)](_0x1acdfc(0x280)),_0x701d91[_0x1acdfc(0x382)]='';const _0x1f4f15=_0x5426fe[_0x1acdfc(0x27e)]?_0x5426fe[_0x1acdfc(0x27e)][_0x1acdfc(0x273)](_0x2e3bfc=>!_0x2e3bfc[_0x1acdfc(0x161)]):[];_0x1f4f15[_0x1acdfc(0x2ae)]===0x0&&(_0x701d91[_0x1acdfc(0x382)]='<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>'),_0x1f4f15[_0x1acdfc(0x1a1)](_0x251db0=>{const _0x1c9a9a=_0x1acdfc,_0x4ddc87=document[_0x1c9a9a(0x290)]('li');_0x4ddc87[_0x1c9a9a(0x382)]=_0x1c9a9a(0x249)+_0x251db0['id']+_0x1c9a9a(0x2c4)+_0x251db0['id']+'\x22>'+escapeHTML(_0x251db0[_0x1c9a9a(0x13a)])+_0x1c9a9a(0x3b9),_0x4ddc87[_0x1c9a9a(0x253)](_0x1c9a9a(0x214))[_0x1c9a9a(0x399)](_0x1c9a9a(0x304),_0x26325a=>toggleSubtopicTask(_0x26325a[_0x1c9a9a(0x402)]['id'],_0x4ddc87)),_0x701d91[_0x1c9a9a(0x22f)](_0x4ddc87);});}async function addSubtopicTask(){const _0x294b80=_0x287dc7,_0x27f2ec=getCurrentSubtopic();if(!_0x27f2ec){toast(t(_0x294b80(0x3d7)));return;}const _0x46e79f=$(_0x294b80(0x162)),_0xef48d7=_0x46e79f[_0x294b80(0x1ae)][_0x294b80(0x13e)]();if(_0xef48d7){if(!_0x27f2ec[_0x294b80(0x27e)])_0x27f2ec['tasks']=[];_0x27f2ec['tasks']['push']({'id':uid('task'),'text':_0xef48d7,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x46e79f[_0x294b80(0x1ae)]='';}_0x46e79f[_0x294b80(0x171)]();}async function toggleSubtopicTask(_0x1f1426,_0x560dac){const _0x181a51=_0x287dc7,_0x3fdebd=getCurrentSubtopic();if(!_0x3fdebd||!_0x3fdebd['tasks'])return;const _0x3c3a33=_0x3fdebd[_0x181a51(0x27e)][_0x181a51(0x137)](_0x2281e4=>_0x2281e4['id']===_0x1f1426);_0x3c3a33&&(_0x3c3a33[_0x181a51(0x161)]=!![],_0x3fdebd[_0x181a51(0x3df)]['tasksCompleted']=(_0x3fdebd[_0x181a51(0x3df)][_0x181a51(0x20c)]||0x0)+0x1,await saveData(),_0x560dac[_0x181a51(0x1de)]['add'](_0x181a51(0x2c2)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':'idle','prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0x52b914,{silent:silent=![]}={}){const _0x28e602=_0x287dc7,_0x45c02d=data[_0x28e602(0x3e8)];this[_0x28e602(0x175)]=_0x52b914,this[_0x28e602(0x319)]=_0x52b914==='A'?_0x45c02d['cyclesA']:_0x52b914==='B'?_0x45c02d[_0x28e602(0x2a0)]:0x0,_0x45c02d[_0x28e602(0x3db)]=_0x52b914,await saveData(),this[_0x28e602(0x184)]===_0x28e602(0x1d5)&&this[_0x28e602(0x18a)]();},'currentDurations'(){const _0x1ccec7=_0x287dc7,_0x1241fc=data['settings'][_0x1ccec7(0x22a)];if(this[_0x1ccec7(0x175)]==='A')return{'work':_0x1241fc[_0x1ccec7(0x228)],'short':_0x1241fc['A_short'],'long':_0x1241fc[_0x1ccec7(0x336)],'winddown':_0x1241fc[_0x1ccec7(0x1b8)]??0x0};if(this[_0x1ccec7(0x175)]==='B')return{'work':_0x1241fc[_0x1ccec7(0x22d)],'short':_0x1241fc[_0x1ccec7(0x310)],'long':_0x1241fc[_0x1ccec7(0x1ee)],'winddown':_0x1241fc[_0x1ccec7(0x386)]??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x58c0e5=_0x287dc7,_0x4cce1a=data[_0x58c0e5(0x3e8)];if(this[_0x58c0e5(0x175)]==='A')return{'cycles':_0x4cce1a[_0x58c0e5(0x1a7)],'interval':_0x4cce1a[_0x58c0e5(0x219)]};if(this[_0x58c0e5(0x175)]==='B')return{'cycles':_0x4cce1a['cyclesB'],'interval':_0x4cce1a[_0x58c0e5(0x44c)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x2aa907=_0x287dc7,_0x5d8ae5=$('#stateBadge'),_0x52adf9=$(_0x2aa907(0x409)),_0x227db1=$(_0x2aa907(0x2e6));if(!_0x5d8ae5||!_0x52adf9||!_0x227db1)return;const _0x1f35ff=this[_0x2aa907(0x175)]==='C';$(_0x2aa907(0x28a))[_0x2aa907(0x1de)]['toggle']('hidden',this['state']!==_0x2aa907(0x1d5)||_0x1f35ff&&this[_0x2aa907(0x184)]===_0x2aa907(0x298)),$('#btnFinishFlow')[_0x2aa907(0x1de)][_0x2aa907(0x331)](_0x2aa907(0x280),!(_0x1f35ff&&this[_0x2aa907(0x184)]==='work')),$(_0x2aa907(0x3fa))['classList'][_0x2aa907(0x331)](_0x2aa907(0x280),![_0x2aa907(0x298),_0x2aa907(0x216),_0x2aa907(0x3ad)][_0x2aa907(0x2ce)](this['state'])),$('#btnResume')[_0x2aa907(0x1de)][_0x2aa907(0x331)](_0x2aa907(0x280),this[_0x2aa907(0x184)]!==_0x2aa907(0x35b));let _0x59387b='var(--muted)';if(this[_0x2aa907(0x184)]==='work')_0x5d8ae5[_0x2aa907(0x181)]=_0x1f35ff?_0x2aa907(0x2a2):'LÀM\x20VIỆC',_0x5d8ae5[_0x2aa907(0x255)]=_0x2aa907(0x2ef),_0x59387b='var(--acc)';else{if(this['state']==='break')_0x5d8ae5['textContent']=_0x2aa907(0x3bf),_0x5d8ae5[_0x2aa907(0x255)]='badge\x20state\x20break',_0x59387b=_0x2aa907(0x301);else{if(this['state']===_0x2aa907(0x3ad))_0x5d8ae5[_0x2aa907(0x181)]='NGHỈ\x20DÀI',_0x5d8ae5[_0x2aa907(0x255)]='badge\x20state\x20long',_0x59387b='var(--danger)';else{if(this[_0x2aa907(0x184)]===_0x2aa907(0x33c)){_0x5d8ae5[_0x2aa907(0x181)]='HẠ\x20NHIỆT',_0x5d8ae5[_0x2aa907(0x255)]=_0x2aa907(0x2ef),_0x59387b=_0x2aa907(0x2d5);try{$(_0x2aa907(0x186))[_0x2aa907(0x1de)][_0x2aa907(0x178)]('hidden'),$('#btnBreakEarly')['classList'][_0x2aa907(0x178)](_0x2aa907(0x280));}catch(_0x20e24f){}}else this[_0x2aa907(0x184)]==='paused'?(_0x5d8ae5[_0x2aa907(0x181)]='TẠM\x20DỪNG',_0x5d8ae5[_0x2aa907(0x255)]=_0x2aa907(0x3fb)):(_0x5d8ae5[_0x2aa907(0x181)]=_0x2aa907(0x291),_0x5d8ae5['className']=_0x2aa907(0x3fb));}}}[_0x2aa907(0x298),_0x2aa907(0x216),'long_break',_0x2aa907(0x33c)]['includes'](this['state'])?_0x227db1[_0x2aa907(0x1de)]['add'](_0x2aa907(0x1e7)):_0x227db1[_0x2aa907(0x1de)][_0x2aa907(0x178)]('breathing');_0x52adf9[_0x2aa907(0x44b)]['stroke']=_0x59387b,_0x227db1['classList'][_0x2aa907(0x178)]('finished');const _0x57ed38=$(_0x2aa907(0x247));if(_0x57ed38)_0x57ed38[_0x2aa907(0x181)]=formatMMSS(this[_0x2aa907(0x1ec)]);const _0x2badd2=_0x52adf9['r'][_0x2aa907(0x1d2)][_0x2aa907(0x1ae)],_0x387485=0x2*Math['PI']*_0x2badd2,_0x14ad11=this[_0x2aa907(0x14e)]>0x0?_0x387485-this['remaining']/this[_0x2aa907(0x14e)]*_0x387485:_0x387485;_0x52adf9[_0x2aa907(0x44b)][_0x2aa907(0x3d6)]=_0x387485,_0x52adf9[_0x2aa907(0x44b)][_0x2aa907(0x1c2)]=isNaN(_0x14ad11)?_0x387485:_0x14ad11;const _0x35878d=$(_0x2aa907(0x32c));if(_0x35878d){const _0x4adb7e=this[_0x2aa907(0x40b)]();_0x35878d[_0x2aa907(0x181)]=t(_0x2aa907(0x383),{'current':this[_0x2aa907(0x2ea)],'target':_0x4adb7e[_0x2aa907(0x288)]}),_0x35878d[_0x2aa907(0x1de)][_0x2aa907(0x331)](_0x2aa907(0x280),_0x1f35ff);}const _0x1027c0=$('#breakSuggestionDisplay');_0x1027c0&&_0x1027c0['classList'][_0x2aa907(0x331)](_0x2aa907(0x280),_0x1f35ff&&this[_0x2aa907(0x184)]===_0x2aa907(0x298));const _0x232c33=$(_0x2aa907(0x403));if(_0x232c33)_0x232c33[_0x2aa907(0x181)]=formatMMSS(this['remaining']);if(this['state']!==_0x2aa907(0x33c))try{$(_0x2aa907(0x186))[_0x2aa907(0x1de)][_0x2aa907(0x347)](_0x2aa907(0x280)),$(_0x2aa907(0x2e7))[_0x2aa907(0x1de)][_0x2aa907(0x347)](_0x2aa907(0x280));}catch(_0x599f25){}},'persistTimerState'(_0x52529e=![]){const _0x15c5bb=_0x287dc7;try{const _0xae1da9=getCurrentSubtopic();if(!_0xae1da9)return;const _0x11e002={'state':this[_0x15c5bb(0x184)],'prevState':this[_0x15c5bb(0x24f)],'remaining':this[_0x15c5bb(0x1ec)],'segmentTotal':this['segmentTotal'],'cycleIndex':this[_0x15c5bb(0x2ea)]};_0xae1da9['timerState']=_0x11e002;try{localStorage['setItem'](_0x15c5bb(0x1b4)+_0xae1da9['id'],JSON[_0x15c5bb(0x194)](_0x11e002));}catch(_0x19bfbb){}this['lastPersist']=Date['now']();}catch(_0x34ce14){}},'_startTick'(){const _0x28c383=_0x287dc7;if(this[_0x28c383(0x419)])clearInterval(this['tickHandle']);if(this[_0x28c383(0x175)]==='C'&&this[_0x28c383(0x184)]==='work'){this[_0x28c383(0x419)]=setInterval(()=>{const _0x3013e7=_0x28c383;this[_0x3013e7(0x1ec)]+=0x1,this[_0x3013e7(0x320)](),this[_0x3013e7(0x42f)]();},0x3e8);return;}this['tickHandle']=setInterval(()=>{const _0x5e1d44=_0x28c383;this[_0x5e1d44(0x1ec)]>0x0&&(this['remaining']-=0x1,this['updateUI'](),this[_0x5e1d44(0x42f)]()),this[_0x5e1d44(0x1ec)]<=0x0&&(clearInterval(this[_0x5e1d44(0x419)]),this[_0x5e1d44(0x419)]=null,this['_onFinishSegment']());},0x3e8);},'_onFinishSegment'(){const _0x47996e=_0x287dc7;if(this[_0x47996e(0x184)]===_0x47996e(0x298)){const _0x2f40b1=getCurrentSubtopic();if(_0x2f40b1){const _0x2b8c4c=this[_0x47996e(0x195)]()['work'];_0x2f40b1[_0x47996e(0x3df)][_0x47996e(0x395)]=(_0x2f40b1[_0x47996e(0x3df)][_0x47996e(0x395)]||0x0)+_0x2b8c4c,_0x2f40b1[_0x47996e(0x3df)][_0x47996e(0x2fa)]=(_0x2f40b1['stats']['sessionsCompleted']||0x0)+0x1;const _0x5869e7={'id':uid(_0x47996e(0x35f)),'dateISO':todayISO(),'durationMinutes':_0x2b8c4c,'mode':this[_0x47996e(0x175)],'note':''};if(!_0x2f40b1['sessions'])_0x2f40b1[_0x47996e(0x423)]=[];_0x2f40b1[_0x47996e(0x423)][_0x47996e(0x446)](_0x5869e7);if(data?.[_0x47996e(0x3e8)]?.[_0x47996e(0x262)]!==![])try{openNoteModal(_0x5869e7['id']);}catch(_0x387ca4){}saveData(),renderStatsHistory(),checkAndShowMilestones();}this[_0x47996e(0x2ea)]++;}if(typeof data!==_0x47996e(0x3f5)&&data&&data['settings']&&data[_0x47996e(0x3e8)][_0x47996e(0x368)]===![]&&this[_0x47996e(0x184)]==='work')playSound(_0x47996e(0x2e9));else(this['state']==='wind_down'||this[_0x47996e(0x184)]===_0x47996e(0x216)||this[_0x47996e(0x184)]==='long_break')&&playSound(_0x47996e(0x392));const _0x5ada7b=$(_0x47996e(0x2e6));if(_0x5ada7b)_0x5ada7b['classList'][_0x47996e(0x347)](_0x47996e(0x193));if(data[_0x47996e(0x3e8)]['autoStartNext']){if(this['state']===_0x47996e(0x298))data['settings'][_0x47996e(0x368)]===![]?this[_0x47996e(0x20d)]():this[_0x47996e(0x15f)]();else this['state']===_0x47996e(0x33c)?this['beginBreak']():this[_0x47996e(0x26f)]();}else this['tickHandle']&&(clearInterval(this[_0x47996e(0x419)]),this[_0x47996e(0x419)]=null),this['state']=_0x47996e(0x1d5),this[_0x47996e(0x24f)]=null,this[_0x47996e(0x320)](),toast(_0x47996e(0x33f));},'beginWindDown'(){const _0x1c29e5=_0x287dc7;if(data?.[_0x1c29e5(0x3e8)]?.['enableWinddown']===![]){this[_0x1c29e5(0x20d)]();return;}this[_0x1c29e5(0x24f)]=this[_0x1c29e5(0x184)],this[_0x1c29e5(0x184)]=_0x1c29e5(0x33c);const _0x3c1951=(this[_0x1c29e5(0x195)]()[_0x1c29e5(0x3ba)]||0x0)*0x3c;if(_0x3c1951<=0x0){this['beginBreak']();return;}this[_0x1c29e5(0x14e)]=_0x3c1951,this[_0x1c29e5(0x1ec)]=_0x3c1951;try{playSound(_0x1c29e5(0x392));}catch(_0x58640b){}try{toast(_0x1c29e5(0x1b6));}catch(_0x452d10){}this['_startTick'](),this[_0x1c29e5(0x320)]();},'beginWork'(){const _0x443576=_0x287dc7;this['prevState']=this[_0x443576(0x184)],this[_0x443576(0x184)]=_0x443576(0x298);if(this['mode']==='C'){this[_0x443576(0x14e)]=0x0;if(this[_0x443576(0x24f)]!==_0x443576(0x35b))this[_0x443576(0x1ec)]=0x0;}else{const _0xe4b234=this['currentDurations']()[_0x443576(0x298)]*0x3c;this['segmentTotal']=_0xe4b234;if(this[_0x443576(0x24f)]!=='paused')this['remaining']=_0xe4b234;}const _0x12ddd6=$(_0x443576(0x23c));_0x12ddd6&&(_0x12ddd6[_0x443576(0x181)]=''),this[_0x443576(0x23d)](),this['updateUI']();},'finishFlowSession'(){const _0x934c0c=_0x287dc7;if(this[_0x934c0c(0x175)]!=='C'||this[_0x934c0c(0x184)]!==_0x934c0c(0x298))return;this[_0x934c0c(0x419)]&&(clearInterval(this[_0x934c0c(0x419)]),this['tickHandle']=null);const _0x5f3a47=Math[_0x934c0c(0x344)](0x1,parseInt(data['settings']['flowtimeBreakRatio']??0x5,0xa)),_0x32fc9b=Math[_0x934c0c(0x344)](0x0,this['remaining']|0x0),_0x1d0781=Math[_0x934c0c(0x344)](0x3c,Math['floor'](_0x32fc9b/_0x5f3a47));try{const _0x23e847=getCurrentSubtopic();if(_0x23e847){const _0x5e9e39=Math[_0x934c0c(0x344)](0x1,Math[_0x934c0c(0x16d)](_0x32fc9b/0x3c));_0x23e847[_0x934c0c(0x3df)][_0x934c0c(0x395)]=(_0x23e847[_0x934c0c(0x3df)][_0x934c0c(0x395)]||0x0)+_0x5e9e39,_0x23e847[_0x934c0c(0x3df)]['sessionsCompleted']=(_0x23e847[_0x934c0c(0x3df)]['sessionsCompleted']||0x0)+0x1;const _0x39fd30={'id':uid('sess'),'dateISO':todayISO(),'durationMinutes':_0x5e9e39,'mode':this[_0x934c0c(0x175)],'note':''};if(!_0x23e847[_0x934c0c(0x423)])_0x23e847[_0x934c0c(0x423)]=[];_0x23e847[_0x934c0c(0x423)][_0x934c0c(0x446)](_0x39fd30),saveData(),renderStatsHistory(),data?.['settings']?.[_0x934c0c(0x262)]!==![]&&openNoteModal(_0x39fd30['id']);}}catch(_0xb307a8){}this[_0x934c0c(0x184)]=_0x934c0c(0x216),this[_0x934c0c(0x14e)]=_0x1d0781,this['remaining']=_0x1d0781,this['_startTick'](),this[_0x934c0c(0x320)](),this[_0x934c0c(0x42f)](!![]);try{toast(_0x934c0c(0x39c)+Math[_0x934c0c(0x16d)](_0x1d0781/0x3c)+'\x20phút\x20theo\x20Flowtime\x20('+_0x5f3a47+').');}catch(_0x279148){}},'beginBreak'(){const _0x210407=_0x287dc7;this[_0x210407(0x24f)]=this[_0x210407(0x184)];const _0x2765c8=this[_0x210407(0x40b)](),_0x18afae=this[_0x210407(0x195)]();if(this[_0x210407(0x2ea)]>0x0&&this[_0x210407(0x2ea)]%_0x2765c8['interval']===0x0){this[_0x210407(0x184)]='long_break';const _0x40db47=_0x18afae[_0x210407(0x299)]*0x3c;this['segmentTotal']=_0x40db47;if(this['prevState']!==_0x210407(0x35b))this[_0x210407(0x1ec)]=_0x40db47;toast(_0x210407(0x1aa));}else{this[_0x210407(0x184)]=_0x210407(0x216);const _0x29ca13=_0x18afae[_0x210407(0x429)]*0x3c;this[_0x210407(0x14e)]=_0x29ca13;if(this[_0x210407(0x24f)]!==_0x210407(0x35b))this[_0x210407(0x1ec)]=_0x29ca13;}const _0x40e77e=$('#breakSuggestionDisplay');if(_0x40e77e){const _0xa8c8c8=Math[_0x210407(0x163)](Math['random']()*breakSuggestions['length']);_0x40e77e[_0x210407(0x181)]='💡\x20Gợi\x20ý:\x20'+breakSuggestions[_0xa8c8c8];}this['_startTick'](),this[_0x210407(0x320)]();},async 'start'(){const _0x2f698f=_0x287dc7;if(!getCurrentSubtopic()){toast('Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu');return;}ensureAudio();if(this[_0x2f698f(0x175)]==='C'&&this[_0x2f698f(0x184)]===_0x2f698f(0x1d5))this['state']=_0x2f698f(0x298),this[_0x2f698f(0x1ec)]=0x0,this[_0x2f698f(0x14e)]=0x0,this['cycleIndex']=0x0,this['_startTick'](),this['updateUI']();else{if(this['state']===_0x2f698f(0x1d5))this['cycleIndex']=this[_0x2f698f(0x2ea)]||0x0,this[_0x2f698f(0x26f)]();else this[_0x2f698f(0x184)]===_0x2f698f(0x35b)&&this['resume']();}await this['persistTimerState'](!![]);},async 'pause'(){const _0x4902f0=_0x287dc7;this[_0x4902f0(0x419)]&&(clearInterval(this[_0x4902f0(0x419)]),this[_0x4902f0(0x419)]=null),this[_0x4902f0(0x24f)]=this[_0x4902f0(0x184)],this['state']=_0x4902f0(0x35b),this[_0x4902f0(0x320)](),await this['persistTimerState'](!![]);},async 'resume'(){const _0x51a1ab=_0x287dc7;if(this[_0x51a1ab(0x184)]!=='paused')return;this['state']=this[_0x51a1ab(0x24f)]||'work',this['_startTick'](),this[_0x51a1ab(0x320)](),await this[_0x51a1ab(0x42f)](!![]);},async 'skip'(){const _0x25b87c=_0x287dc7;if(this[_0x25b87c(0x175)]==='C'&&this[_0x25b87c(0x184)]===_0x25b87c(0x298)){this['finishFlowSession'](),await this[_0x25b87c(0x42f)](!![]);return;}this['state']===_0x25b87c(0x298)?(this[_0x25b87c(0x419)]&&(clearInterval(this[_0x25b87c(0x419)]),this['tickHandle']=null),this[_0x25b87c(0x1ec)]=0x0,this[_0x25b87c(0x3a4)]()):(this[_0x25b87c(0x1ec)]=0x0,this[_0x25b87c(0x419)]&&(clearInterval(this['tickHandle']),this[_0x25b87c(0x419)]=null),this[_0x25b87c(0x3a4)]()),await this[_0x25b87c(0x42f)](!![]);},async 'reset'(){const _0x3506d6=_0x287dc7;this['tickHandle']&&(clearInterval(this[_0x3506d6(0x419)]),this[_0x3506d6(0x419)]=null);this[_0x3506d6(0x184)]=_0x3506d6(0x1d5),this[_0x3506d6(0x24f)]=null,this['remaining']=0x0,this['segmentTotal']=0x0,this[_0x3506d6(0x2ea)]=0x0;const _0xade5f3=$(_0x3506d6(0x23c));_0xade5f3&&(_0xade5f3['textContent']=''),this[_0x3506d6(0x320)](),await this['persistTimerState'](!![]);}};async function deleteSummary(_0x15b019){const _0x37d276=_0x287dc7;showConfirmModal('Xác\x20nhận\x20xóa',_0x37d276(0x416),async _0x5c9f0b=>{const _0x1c1c84=_0x37d276;if(!_0x5c9f0b)return;const _0x242376=getCurrentSubtopic();if(!_0x242376||!_0x242376[_0x1c1c84(0x2fb)])return;const _0x2efb1d=[..._0x242376[_0x1c1c84(0x2fb)]];_0x242376[_0x1c1c84(0x2fb)]=_0x242376['summaries'][_0x1c1c84(0x273)](_0x466791=>_0x466791['id']!==_0x15b019);try{await storageManager[_0x1c1c84(0x38c)](_0x1c1c84(0x1cd),_0x242376),renderSummaries(),toast(_0x1c1c84(0x144));}catch(_0x3af9c9){console[_0x1c1c84(0x206)](_0x1c1c84(0x323),_0x3af9c9),_0x242376['summaries']=_0x2efb1d,toast(_0x1c1c84(0x177));}});}function exportSummary(_0x561a36){const _0xa3731b=_0x287dc7,_0x347cc8=new Blob([_0x561a36['content']],{'type':_0xa3731b(0x285)}),_0x2f1630=document[_0xa3731b(0x290)]('a'),_0x27fc61=new Date(_0x561a36['createdAt']),_0x3068c1=_0x30e810=>(''+_0x30e810)[_0xa3731b(0x147)](0x2,'0');_0x2f1630[_0xa3731b(0x2ab)]=URL['createObjectURL'](_0x347cc8),_0x2f1630[_0xa3731b(0x334)]=_0xa3731b(0x303)+_0x27fc61[_0xa3731b(0x3a1)]()+_0x3068c1(_0x27fc61[_0xa3731b(0x36c)]()+0x1)+_0x3068c1(_0x27fc61[_0xa3731b(0x1fe)]())+_0xa3731b(0x1dd),_0x2f1630[_0xa3731b(0x443)](),URL[_0xa3731b(0x218)](_0x2f1630[_0xa3731b(0x2ab)]);}function renderStatsHistory(){const _0x33c560=_0x287dc7,_0x232bb3=getCurrentSubtopic(),_0x1df601=$(_0x33c560(0x1b7)),_0x133e1e=$(_0x33c560(0x343)),_0x3e1c4e=$('#statTasks'),_0x1f2520=$('#historyList');if(!_0x1df601||!_0x133e1e||!_0x3e1c4e||!_0x1f2520)return;if(!_0x232bb3){_0x1df601['textContent']=_0x33c560(0x316),_0x133e1e[_0x33c560(0x181)]='0',_0x3e1c4e[_0x33c560(0x181)]='0',_0x1f2520['innerHTML']=_0x33c560(0x3af);return;}const _0x23b82c=_0x232bb3[_0x33c560(0x3df)]&&_0x232bb3[_0x33c560(0x3df)][_0x33c560(0x395)]?_0x232bb3[_0x33c560(0x3df)]['totalMinutes']:0x0,_0x3ccc0b=_0x232bb3['stats']&&_0x232bb3[_0x33c560(0x3df)]['sessionsCompleted']?_0x232bb3[_0x33c560(0x3df)][_0x33c560(0x2fa)]:0x0,_0x28eb0b=_0x232bb3[_0x33c560(0x27e)]?_0x232bb3[_0x33c560(0x27e)]['filter'](_0x160af4=>_0x160af4[_0x33c560(0x161)])[_0x33c560(0x2ae)]:0x0;_0x1df601[_0x33c560(0x181)]=formatDaysHoursMinutes(_0x23b82c),_0x133e1e[_0x33c560(0x181)]=String(_0x3ccc0b),_0x3e1c4e[_0x33c560(0x181)]=String(_0x28eb0b),_0x1f2520['innerHTML']='';const _0xfb2f1a=Array['isArray'](_0x232bb3[_0x33c560(0x423)])?_0x232bb3[_0x33c560(0x423)]:[];if(_0xfb2f1a[_0x33c560(0x2ae)]===0x0){_0x1f2520[_0x33c560(0x382)]=_0x33c560(0x264);return;}_0xfb2f1a[_0x33c560(0x1a1)](_0x527d7a=>{const _0x257296=_0x33c560,_0x32da99=document[_0x257296(0x290)](_0x257296(0x2aa));_0x32da99[_0x257296(0x255)]='hist-item';const _0x38e321=document['createElement'](_0x257296(0x2aa)),_0x1ffa02=_0x527d7a['dateISO']?new Date(_0x527d7a['dateISO']):new Date(),_0x33e39e=_0x527d7a[_0x257296(0x24e)]!=null?_0x527d7a[_0x257296(0x24e)]:_0x527d7a['workMinutes']||0x0,_0x563768='<div\x20class=\x22hist-meta\x22>'+_0x1ffa02['toLocaleString']()+'\x20·\x20'+_0x33e39e+_0x257296(0x3c0)+(_0x527d7a[_0x257296(0x175)]||'')+_0x257296(0x30a);let _0x4377d1='';if(_0x527d7a[_0x257296(0x200)])_0x4377d1=_0x257296(0x2a6)+escapeHTML(_0x527d7a[_0x257296(0x200)])+_0x257296(0x30a);else data?.[_0x257296(0x3e8)]?.['enableSessionNotes']!==![]&&(_0x4377d1=_0x257296(0x360));_0x38e321[_0x257296(0x382)]=_0x563768+_0x4377d1,_0x32da99['appendChild'](_0x38e321),_0x1f2520[_0x257296(0x22f)](_0x32da99);});}function renderGeneralNotes(){const _0x381da0=_0x287dc7,_0x39c41a=$('#generalNotesList');if(!_0x39c41a)return;const _0x197bbe=getCurrentSubtopic();if(!_0x197bbe){_0x39c41a[_0x381da0(0x382)]=_0x381da0(0x155);return;}_0x197bbe[_0x381da0(0x157)]=_0x197bbe[_0x381da0(0x157)]||[];if(_0x197bbe[_0x381da0(0x157)][_0x381da0(0x2ae)]===0x0){_0x39c41a[_0x381da0(0x382)]=_0x381da0(0x265);return;}_0x39c41a[_0x381da0(0x382)]='',_0x197bbe['generalNotes'][_0x381da0(0x1a1)](_0x2cdc21=>{const _0x3a9c78=_0x381da0,_0x5a1ca3=document[_0x3a9c78(0x290)](_0x3a9c78(0x2aa));_0x5a1ca3[_0x3a9c78(0x255)]='note-item';const _0x456e33=document[_0x3a9c78(0x290)](_0x3a9c78(0x2aa));_0x456e33[_0x3a9c78(0x255)]=_0x3a9c78(0x31d),_0x456e33['textContent']=typeof _0x2cdc21===_0x3a9c78(0x436)?_0x2cdc21:_0x2cdc21['text']||'';const _0x185afe=document[_0x3a9c78(0x290)]('div');_0x185afe[_0x3a9c78(0x255)]=_0x3a9c78(0x28f),_0x185afe['textContent']=_0x2cdc21[_0x3a9c78(0x2af)]?new Date(_0x2cdc21[_0x3a9c78(0x2af)])[_0x3a9c78(0x148)]():'';const _0x43795f=document[_0x3a9c78(0x290)]('div'),_0x2d0693=document[_0x3a9c78(0x290)](_0x3a9c78(0x1df));_0x2d0693['className']=_0x3a9c78(0x21d),_0x2d0693['textContent']=_0x3a9c78(0x12c),_0x2d0693['onclick']=async _0x5697e3=>{const _0xe6f8a4=_0x3a9c78;_0x5697e3['stopPropagation']();const _0x586de5=getCurrentSubtopic();if(!_0x586de5)return;_0x586de5[_0xe6f8a4(0x157)]=(_0x586de5['generalNotes']||[])[_0xe6f8a4(0x273)](_0x210398=>(_0x210398['id']||_0x210398)!==(_0x2cdc21['id']||_0x2cdc21)),await saveData(),renderGeneralNotes();},_0x43795f[_0x3a9c78(0x22f)](_0x2d0693);const _0x2a8ca4=document[_0x3a9c78(0x290)](_0x3a9c78(0x2aa));_0x2a8ca4['className']='note-content-wrapper',_0x2a8ca4[_0x3a9c78(0x1bf)](_0x456e33,_0x185afe),_0x5a1ca3[_0x3a9c78(0x1bf)](_0x2a8ca4,_0x43795f),_0x39c41a[_0x3a9c78(0x22f)](_0x5a1ca3);});}function renderMethods(){const _0x495f7d=_0x287dc7,_0x2ff00c=document[_0x495f7d(0x253)](_0x495f7d(0x238));if(!_0x2ff00c)return;_0x2ff00c[_0x495f7d(0x382)]='';const _0x40e7eb=getCurrentSubtopic();if(!_0x40e7eb){_0x2ff00c[_0x495f7d(0x382)]=_0x495f7d(0x2fe);return;}const _0x32a1f5=Array[_0x495f7d(0x164)](_0x40e7eb[_0x495f7d(0x34c)])?_0x40e7eb[_0x495f7d(0x34c)]:[];if(_0x32a1f5['length']===0x0){_0x2ff00c[_0x495f7d(0x382)]=_0x495f7d(0x3c3);return;}_0x32a1f5[_0x495f7d(0x1a1)](_0x1e4a7e=>{const _0x4b3c97=_0x495f7d,_0x241680=document[_0x4b3c97(0x290)]('div');_0x241680[_0x4b3c97(0x255)]='method-item',_0x241680[_0x4b3c97(0x44e)][_0x4b3c97(0x27b)]=_0x1e4a7e['id'];const _0x2da183=document['createElement'](_0x4b3c97(0x2aa)),_0x2a26b1=document['createElement'](_0x4b3c97(0x1d1));_0x2a26b1['className']=_0x4b3c97(0x380),_0x2a26b1[_0x4b3c97(0x181)]=_0x1e4a7e[_0x4b3c97(0x44a)]||_0x4b3c97(0x14f),_0x2a26b1[_0x4b3c97(0x399)]('click',_0x25ecb9=>{const _0x2f7b10=_0x4b3c97;_0x25ecb9[_0x2f7b10(0x23a)](),_0x25ecb9[_0x2f7b10(0x220)]();const _0x3f02a9=_0x241680[_0x2f7b10(0x253)]('.method-content');if(!_0x3f02a9)return;const _0x381fea=_0x3f02a9['hidden'];_0x2ff00c[_0x2f7b10(0x145)](_0x2f7b10(0x2c8))[_0x2f7b10(0x1a1)](_0x2432d1=>{const _0x32cdf8=_0x2f7b10;_0x2432d1[_0x32cdf8(0x280)]=!![];}),_0x3f02a9['hidden']=!_0x381fea;});const _0x389697=document[_0x4b3c97(0x290)](_0x4b3c97(0x2aa));_0x389697[_0x4b3c97(0x255)]=_0x4b3c97(0x259);const _0x44d0fe=document[_0x4b3c97(0x290)](_0x4b3c97(0x1df));_0x44d0fe[_0x4b3c97(0x255)]=_0x4b3c97(0x318),_0x44d0fe[_0x4b3c97(0x181)]=_0x4b3c97(0x414),_0x44d0fe['dataset']['id']=_0x1e4a7e['id'];const _0x3eb969=document[_0x4b3c97(0x290)]('button');_0x3eb969[_0x4b3c97(0x255)]=_0x4b3c97(0x27d),_0x3eb969[_0x4b3c97(0x181)]='Xóa',_0x3eb969[_0x4b3c97(0x44e)]['id']=_0x1e4a7e['id'],_0x389697['append'](_0x44d0fe,_0x3eb969),_0x2da183[_0x4b3c97(0x1bf)](_0x2a26b1,_0x389697);const _0xdea480=document[_0x4b3c97(0x290)]('div');_0xdea480[_0x4b3c97(0x255)]='method-content',_0xdea480[_0x4b3c97(0x382)]=_0x1e4a7e[_0x4b3c97(0x1e9)]||'',_0xdea480[_0x4b3c97(0x280)]=!![],_0x241680[_0x4b3c97(0x1bf)](_0x2da183,_0xdea480),_0x2ff00c['appendChild'](_0x241680),_0x241680[_0x4b3c97(0x399)](_0x4b3c97(0x443),_0x235132=>{const _0x3651aa=_0x4b3c97,_0x1874dc=_0x235132[_0x3651aa(0x402)];if(!_0x1874dc)return;if(_0x1874dc[_0x3651aa(0x366)]('button')||_0x1874dc[_0x3651aa(0x366)]('a')||_0x1874dc[_0x3651aa(0x366)](_0x3651aa(0x246))||_0x1874dc['closest']('.color-palette'))return;const _0x4d4fce=_0xdea480['hidden'];_0x2ff00c[_0x3651aa(0x145)](_0x3651aa(0x2c8))['forEach'](_0x122f47=>{const _0x56c46b=_0x3651aa;_0x122f47[_0x56c46b(0x280)]=!![];}),_0xdea480['hidden']=!_0x4d4fce;});});const _0x4dbfe0=_0x2ff00c[_0x495f7d(0x145)]('.method-item');_0x4dbfe0[_0x495f7d(0x1a1)](_0x16e05e=>{const _0x2d2112=_0x495f7d;_0x16e05e[_0x2d2112(0x399)]('toggle',()=>{const _0x543c8b=_0x2d2112;_0x16e05e['open']&&_0x4dbfe0[_0x543c8b(0x1a1)](_0x148498=>{const _0x131b0c=_0x543c8b;if(_0x148498!==_0x16e05e)_0x148498[_0x131b0c(0x18e)]=![];});});}),window[_0x495f7d(0x307)]&&new Sortable(_0x2ff00c,{'animation':0x96,'draggable':_0x495f7d(0x235),'onEnd':async function(_0xe25909){const _0xf9aeae=_0x495f7d;if(_0xe25909[_0xf9aeae(0x39b)]===_0xe25909['newIndex'])return;const _0x2bd64b=getCurrentSubtopic();if(!_0x2bd64b||!Array[_0xf9aeae(0x164)](_0x2bd64b[_0xf9aeae(0x34c)]))return;const _0x37c409=_0x2bd64b[_0xf9aeae(0x34c)][_0xf9aeae(0x2d6)](_0xe25909[_0xf9aeae(0x39b)],0x1)[0x0];_0x2bd64b['methods']['splice'](_0xe25909[_0xf9aeae(0x165)],0x0,_0x37c409),await saveData();}});}function addGeneralNote(){showInputModal('Thêm\x20ghi\x20chú',async _0x1b0da6=>{const _0x2eb6d0=_0xbc78;if(!_0x1b0da6)return;const _0xe09ad7=getCurrentSubtopic();if(!_0xe09ad7){toast(_0x2eb6d0(0x3cf));return;}_0xe09ad7[_0x2eb6d0(0x157)]=_0xe09ad7[_0x2eb6d0(0x157)]||[],_0xe09ad7['generalNotes'][_0x2eb6d0(0x446)]({'id':uid('gn'),'text':_0x1b0da6,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0xedef27=_0x287dc7,_0x425758=getCurrentSubtopic();if(!_0x425758){toast(_0xedef27(0x407));return;}const _0x3ad5c8=(_0x425758[_0xedef27(0x157)]||[])['map'](_0x149973=>typeof _0x149973===_0xedef27(0x436)?_0x149973:_0x149973['text']||'')[_0xedef27(0x273)](Boolean);if(_0x3ad5c8['length']===0x0){toast(_0xedef27(0x30c));return;}const _0x59864d=$(_0xedef27(0x44d));_0x59864d&&(_0x59864d[_0xedef27(0x146)]=!![],_0x59864d[_0xedef27(0x382)]=_0xedef27(0x231));try{const _0x3e3671=_0xedef27(0x41e)+_0x3ad5c8[_0xedef27(0x2ff)](_0xedef27(0x3f8)),_0x373523=await callGeminiAPI(_0x3e3671);if(!_0x425758['summaries'])_0x425758[_0xedef27(0x2fb)]=[];_0x425758[_0xedef27(0x2fb)]['unshift']({'id':uid(_0xedef27(0x272)),'content':_0x373523||_0xedef27(0x376),'createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x258b74){console[_0xedef27(0x206)](_0x258b74),toast('Tóm\x20tắt\x20thất\x20bại.');}finally{_0x59864d&&(_0x59864d[_0xedef27(0x146)]=![],_0x59864d[_0xedef27(0x181)]=_0xedef27(0x325));}}function renderSummaries(){const _0x15d772=_0x287dc7,_0x2cc935=$(_0x15d772(0x191));if(!_0x2cc935)return;const _0x4e2343=getCurrentSubtopic();if(!_0x4e2343){_0x2cc935[_0x15d772(0x382)]=_0x15d772(0x405);return;}_0x2cc935['innerHTML']='';if(!_0x4e2343['summaries']||_0x4e2343[_0x15d772(0x2fb)][_0x15d772(0x2ae)]===0x0){_0x2cc935[_0x15d772(0x382)]=_0x15d772(0x2e8);return;}_0x4e2343[_0x15d772(0x2fb)]['forEach'](_0x481719=>{const _0x4caa46=_0x15d772,_0x4b7a47=document[_0x4caa46(0x290)](_0x4caa46(0x2aa));_0x4b7a47['className']=_0x4caa46(0x19e);const _0x4ac9a9=document['createElement'](_0x4caa46(0x2aa));_0x4ac9a9[_0x4caa46(0x255)]=_0x4caa46(0x415);const _0x8ba456=document[_0x4caa46(0x290)](_0x4caa46(0x2aa));_0x8ba456[_0x4caa46(0x255)]='note-content',_0x8ba456[_0x4caa46(0x181)]=_0x481719[_0x4caa46(0x1e9)];const _0x4114bf=document[_0x4caa46(0x290)](_0x4caa46(0x2aa));_0x4114bf[_0x4caa46(0x255)]=_0x4caa46(0x28f),_0x4114bf[_0x4caa46(0x181)]=new Date(_0x481719[_0x4caa46(0x2af)])['toLocaleString'](),_0x4ac9a9[_0x4caa46(0x1bf)](_0x8ba456,_0x4114bf);const _0x498bfe=document[_0x4caa46(0x290)](_0x4caa46(0x2aa)),_0x3fe623=document[_0x4caa46(0x290)](_0x4caa46(0x1df));_0x3fe623[_0x4caa46(0x255)]=_0x4caa46(0x31c),_0x3fe623[_0x4caa46(0x181)]=_0x4caa46(0x3b5),_0x3fe623[_0x4caa46(0x29f)]=_0x1fb25a=>{_0x1fb25a['stopPropagation'](),exportSummary(_0x481719);};const _0x5c5f90=document['createElement'](_0x4caa46(0x1df));_0x5c5f90['className']=_0x4caa46(0x21d),_0x5c5f90[_0x4caa46(0x181)]=_0x4caa46(0x12c),_0x5c5f90[_0x4caa46(0x29f)]=_0x80559e=>{const _0x14309d=_0x4caa46;_0x80559e[_0x14309d(0x220)](),deleteSummary(_0x481719['id']);},_0x498bfe[_0x4caa46(0x1bf)](_0x3fe623,_0x5c5f90),_0x4b7a47[_0x4caa46(0x1bf)](_0x4ac9a9,_0x498bfe),_0x4b7a47[_0x4caa46(0x399)](_0x4caa46(0x443),()=>_0x8ba456[_0x4caa46(0x1de)]['toggle']('expanded')),_0x2cc935[_0x4caa46(0x22f)](_0x4b7a47);});}function loadEditingPresetFields(){const _0x13da08=_0x287dc7,_0x224deb=data[_0x13da08(0x3e8)],_0x594a2a=_0x224deb['durations'],_0x837060=$(_0x13da08(0x3b6)),_0x3a6b5f=$(_0x13da08(0x353));if(_0x837060&&_0x3a6b5f){const _0x77740d=editingPreset==='C';_0x837060[_0x13da08(0x1de)]['toggle'](_0x13da08(0x280),_0x77740d),_0x3a6b5f[_0x13da08(0x1de)][_0x13da08(0x331)](_0x13da08(0x280),!_0x77740d);}if(editingPreset==='A'){$('#set_work')[_0x13da08(0x1ae)]=_0x594a2a[_0x13da08(0x228)];if($('#set_winddown'))$(_0x13da08(0x223))[_0x13da08(0x1ae)]=_0x594a2a['A_winddown']??0x0;$('#set_short')[_0x13da08(0x1ae)]=_0x594a2a[_0x13da08(0x2a3)],$(_0x13da08(0x196))[_0x13da08(0x1ae)]=_0x594a2a['A_long'],$('#set_cycles')[_0x13da08(0x1ae)]=_0x224deb[_0x13da08(0x1a7)],$('#set_interval')[_0x13da08(0x1ae)]=_0x224deb[_0x13da08(0x219)];}else{if(editingPreset==='B'){$(_0x13da08(0x1ad))[_0x13da08(0x1ae)]=_0x594a2a[_0x13da08(0x22d)];if($(_0x13da08(0x223)))$('#set_winddown')[_0x13da08(0x1ae)]=_0x594a2a[_0x13da08(0x386)]??0x0;$(_0x13da08(0x365))[_0x13da08(0x1ae)]=_0x594a2a[_0x13da08(0x310)],$('#set_long')[_0x13da08(0x1ae)]=_0x594a2a[_0x13da08(0x1ee)],$(_0x13da08(0x1e1))[_0x13da08(0x1ae)]=_0x224deb[_0x13da08(0x2a0)],$('#set_interval')[_0x13da08(0x1ae)]=_0x224deb['longBreakIntervalB'];}else{if(editingPreset==='C'){const _0x56605b=$(_0x13da08(0x2cf));if(_0x56605b)_0x56605b[_0x13da08(0x1ae)]=_0x224deb[_0x13da08(0x236)]??0x5;}}}}function highlightPresetSelector(){const _0x1bea14=_0x287dc7;$$(_0x1bea14(0x1cb))[_0x1bea14(0x1a1)](_0x280860=>{const _0x3a972b=_0x1bea14,_0x34e649=_0x280860[_0x3a972b(0x44e)][_0x3a972b(0x133)]===editingPreset;_0x280860[_0x3a972b(0x1de)][_0x3a972b(0x331)](_0x3a972b(0x31f),_0x34e649),_0x280860[_0x3a972b(0x1de)][_0x3a972b(0x331)](_0x3a972b(0x18c),!_0x34e649);});}function openSettings(){const _0x3c747b=_0x287dc7,_0xd09014=data[_0x3c747b(0x3e8)];editingPreset=_0xd09014[_0x3c747b(0x3db)],$('#set_apiKey')[_0x3c747b(0x1ae)]=_0xd09014['apiKey']||'',loadEditingPresetFields(),highlightPresetSelector(),$(_0x3c747b(0x430))['value']=_0xd09014[_0x3c747b(0x205)]??0.8,$('#set_theme')[_0x3c747b(0x1ae)]=_0xd09014[_0x3c747b(0x38f)]||_0x3c747b(0x270),$(_0x3c747b(0x314))['value']=_0xd09014[_0x3c747b(0x370)]||_0x3c747b(0x3e4);const _0x164f26=getActiveYoutubeUrl();$(_0x3c747b(0x3d4))[_0x3c747b(0x1ae)]=_0x164f26||'';const _0x2146ca=extractYouTubeID(_0x164f26);$(_0x3c747b(0x15e))[_0x3c747b(0x146)]=!_0x2146ca;$(_0x3c747b(0x2d2))&&($(_0x3c747b(0x2d2))['textContent']='');$(_0x3c747b(0x3ef))['value']=_0xd09014[_0x3c747b(0x37d)]||0x50,$(_0x3c747b(0x278))[_0x3c747b(0x269)]=!!_0xd09014['useYtThumbnailAsBg'],$(_0x3c747b(0x35c))[_0x3c747b(0x1ae)]=_0xd09014[_0x3c747b(0x21a)]||0.85;$(_0x3c747b(0x33d))&&($(_0x3c747b(0x33d))['value']=_0xd09014[_0x3c747b(0x3e6)]||_0x3c747b(0x2b5));$(_0x3c747b(0x1be))&&($(_0x3c747b(0x1be))[_0x3c747b(0x269)]=!!_0xd09014['autoStartNext']);$(_0x3c747b(0x276))&&($(_0x3c747b(0x276))['checked']=_0xd09014[_0x3c747b(0x368)]!==![]);$(_0x3c747b(0x1ce))&&($(_0x3c747b(0x1ce))[_0x3c747b(0x269)]=_0xd09014[_0x3c747b(0x262)]!==![]);$(_0x3c747b(0x1f1))&&($(_0x3c747b(0x1f1))[_0x3c747b(0x1ae)]=_0xd09014[_0x3c747b(0x287)]||0x7);const _0x11b891=$(_0x3c747b(0x328));_0x11b891&&storageManager['getBackupList']()['then'](_0x1edda1=>{const _0x312c20=_0x3c747b;_0x11b891[_0x312c20(0x382)]=_0x312c20(0x130),_0x1edda1&&_0x1edda1[_0x312c20(0x2ae)]>0x0?_0x1edda1['forEach'](_0x5a22f8=>{const _0x34524e=_0x312c20,_0x7cdcd0=document['createElement'](_0x34524e(0x2a7));_0x7cdcd0[_0x34524e(0x1ae)]=_0x5a22f8[_0x34524e(0x2f3)],_0x7cdcd0[_0x34524e(0x181)]='Bản\x20sao\x20lưu\x20ngày:\x20'+new Date(_0x5a22f8[_0x34524e(0x2f3)])[_0x34524e(0x39d)](_0x34524e(0x3f3)),_0x11b891[_0x34524e(0x22f)](_0x7cdcd0);}):_0x11b891['innerHTML']=_0x312c20(0x3c6);});$('#modalSettings')[_0x3c747b(0x1de)][_0x3c747b(0x347)](_0x3c747b(0x384));try{trapFocus($(_0x3c747b(0x36a)));}catch(_0x536da3){}}function closeSettings(){const _0x13add8=_0x287dc7;$('#modalSettings')[_0x13add8(0x1de)][_0x13add8(0x178)]('show');try{releaseFocus();}catch(_0x45bd99){}}async function setDefaults(){const _0x2c53=_0x287dc7;data[_0x2c53(0x3e8)][_0x2c53(0x22a)]={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data[_0x2c53(0x3e8)]['cyclesA']=0x4,data[_0x2c53(0x3e8)]['longBreakIntervalA']=0x4,data[_0x2c53(0x3e8)][_0x2c53(0x2a0)]=0x4,data['settings'][_0x2c53(0x44c)]=0x4,data[_0x2c53(0x3e8)]['flowtimeBreakRatio']=0x5,data['settings'][_0x2c53(0x3db)]='A',data['settings'][_0x2c53(0x205)]=0.8,data[_0x2c53(0x3e8)][_0x2c53(0x38f)]='beep',await saveData(),openSettings(),toast(_0x2c53(0x1fc));}async function saveSettings(){const _0x31fa96=_0x287dc7,_0x41b92b=data[_0x31fa96(0x3e8)];_0x41b92b[_0x31fa96(0x41b)]=$(_0x31fa96(0x1c1))['value'][_0x31fa96(0x13e)]();const _0x5b411f=_0x41b92b[_0x31fa96(0x22a)];if(editingPreset==='A')_0x5b411f[_0x31fa96(0x228)]=clampInt($(_0x31fa96(0x1ad))[_0x31fa96(0x1ae)],0x1,0x3e7),_0x5b411f[_0x31fa96(0x1b8)]=clampInt($(_0x31fa96(0x223))[_0x31fa96(0x1ae)],0x0,0x3e7),_0x5b411f[_0x31fa96(0x2a3)]=clampInt($(_0x31fa96(0x365))['value'],0x1,0x3e7),_0x5b411f['A_long']=clampInt($(_0x31fa96(0x196))[_0x31fa96(0x1ae)],0x1,0x3e7),_0x41b92b['cyclesA']=clampInt($(_0x31fa96(0x1e1))[_0x31fa96(0x1ae)],0x1,0xc),_0x41b92b[_0x31fa96(0x219)]=clampInt($(_0x31fa96(0x260))[_0x31fa96(0x1ae)],0x2,0xc);else{if(editingPreset==='B')_0x5b411f[_0x31fa96(0x22d)]=clampInt($(_0x31fa96(0x1ad))[_0x31fa96(0x1ae)],0x1,0x3e7),_0x5b411f[_0x31fa96(0x386)]=clampInt($('#set_winddown')[_0x31fa96(0x1ae)],0x0,0x3e7),_0x5b411f[_0x31fa96(0x310)]=clampInt($(_0x31fa96(0x365))[_0x31fa96(0x1ae)],0x1,0x3e7),_0x5b411f[_0x31fa96(0x1ee)]=clampInt($('#set_long')[_0x31fa96(0x1ae)],0x1,0x3e7),_0x41b92b[_0x31fa96(0x2a0)]=clampInt($('#set_cycles')['value'],0x1,0xc),_0x41b92b[_0x31fa96(0x44c)]=clampInt($(_0x31fa96(0x260))[_0x31fa96(0x1ae)],0x2,0xc);else{if(editingPreset==='C'){const _0x2329c9=$(_0x31fa96(0x2cf));if(_0x2329c9)_0x41b92b[_0x31fa96(0x236)]=clampInt(_0x2329c9['value'],0x1,0x14);}}}_0x41b92b[_0x31fa96(0x205)]=clampFloat($('#set_volume')['value'],0x0,0x1,0.8),_0x41b92b['soundTheme']=$(_0x31fa96(0x37e))['value']==='chime'?_0x31fa96(0x1f2):_0x31fa96(0x270),_0x41b92b[_0x31fa96(0x370)]=$('#set_theme_color')[_0x31fa96(0x1ae)],_0x41b92b[_0x31fa96(0x21a)]=parseFloat($(_0x31fa96(0x35c))[_0x31fa96(0x1ae)])||0.85;$(_0x31fa96(0x33d))&&(_0x41b92b[_0x31fa96(0x3e6)]=$(_0x31fa96(0x33d))[_0x31fa96(0x1ae)]);_0x41b92b[_0x31fa96(0x3be)]=!!($('#set_autoStartNext')&&$('#set_autoStartNext')[_0x31fa96(0x269)]),_0x41b92b[_0x31fa96(0x368)]=!!($(_0x31fa96(0x276))&&$(_0x31fa96(0x276))[_0x31fa96(0x269)]),_0x41b92b[_0x31fa96(0x262)]=!!($(_0x31fa96(0x1ce))&&$(_0x31fa96(0x1ce))['checked']);$(_0x31fa96(0x1f1))&&(_0x41b92b[_0x31fa96(0x287)]=clampInt($('#set_backupDays')[_0x31fa96(0x1ae)],0x1,0x1e));_0x41b92b[_0x31fa96(0x370)]===_0x31fa96(0x356)||_0x41b92b['theme']===_0x31fa96(0x1f5)?(_0x41b92b[_0x31fa96(0x448)]=![],typeof _0x41b92b[_0x31fa96(0x3b2)]===_0x31fa96(0x436)&&_0x41b92b[_0x31fa96(0x3b2)][_0x31fa96(0x2ce)](_0x31fa96(0x311))&&(_0x41b92b[_0x31fa96(0x3b2)]='')):_0x41b92b[_0x31fa96(0x448)]=!![];const _0x568539=$(_0x31fa96(0x3d4))['value'][_0x31fa96(0x13e)]();_0x41b92b[_0x31fa96(0x448)]=$(_0x31fa96(0x278))[_0x31fa96(0x269)],_0x41b92b['youtubeVolume']=parseInt($('#ytSoundVolume')['value'],0xa),sessionYoutubeUrl=_0x568539;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer[_0x31fa96(0x422)])ytPlayer[_0x31fa96(0x422)](_0x41b92b[_0x31fa96(0x37d)]);}else try{fallbackPostMessage(_0x31fa96(0x422),[_0x41b92b[_0x31fa96(0x37d)]]);}catch(_0x30a381){}}catch(_0x9f3555){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x31fa96(0x198)](_0x41b92b['preset'],{'silent':!![]}),closeSettings(),toast(_0x31fa96(0x348));}function clampInt(_0x2ac3e8,_0x50827f,_0x25fb12){const _0x2e7c97=_0x287dc7;_0x2ac3e8=parseInt(_0x2ac3e8||0x0,0xa);if(isNaN(_0x2ac3e8))_0x2ac3e8=_0x50827f;return Math[_0x2e7c97(0x344)](_0x50827f,Math[_0x2e7c97(0x445)](_0x25fb12,_0x2ac3e8));}function clampFloat(_0x1335e0,_0x587fb8,_0x5dc342,_0x38ce02){const _0x28bff8=_0x287dc7;_0x1335e0=parseFloat(_0x1335e0);if(Number[_0x28bff8(0x3ec)](_0x1335e0))_0x1335e0=_0x38ce02;return Math[_0x28bff8(0x344)](_0x587fb8,Math[_0x28bff8(0x445)](_0x5dc342,_0x1335e0));}const dbPromise=new Promise((_0x716331,_0x4f3805)=>{const _0x151714=_0x287dc7,_0x4d4fb5=indexedDB['open'](_0x151714(0x1ac),0x1);_0x4d4fb5[_0x151714(0x327)]=_0x426533=>_0x426533[_0x151714(0x402)][_0x151714(0x1e4)][_0x151714(0x1fb)](_0x151714(0x241)),_0x4d4fb5['onsuccess']=_0x524e07=>_0x716331(_0x524e07[_0x151714(0x402)][_0x151714(0x1e4)]),_0x4d4fb5['onerror']=_0x49ff1d=>_0x4f3805(_0x49ff1d);}),fileCache={};function handleFileUpload(_0x2656b3,_0x2e0848){const _0x23ba59=_0x287dc7;if(!_0x2656b3)return;dbPromise[_0x23ba59(0x32e)](_0xc2bb8a=>{const _0x32f9c5=_0x23ba59,_0x5f43c6=uid('file'),_0x4dd1ba=_0xc2bb8a['transaction'](_0x32f9c5(0x241),_0x32f9c5(0x3f0));_0x4dd1ba[_0x32f9c5(0x297)](_0x32f9c5(0x241))[_0x32f9c5(0x250)](_0x2656b3,_0x5f43c6),_0x4dd1ba['oncomplete']=()=>_0x2e0848(_0x5f43c6),_0x4dd1ba[_0x32f9c5(0x1a9)]=()=>toast(_0x32f9c5(0x1d0));});}function getStoredFileUrl(_0x3082b){const _0xa7dc4e=_0x287dc7;if(!_0x3082b)return Promise[_0xa7dc4e(0x240)]('');if(fileCache[_0x3082b])return Promise[_0xa7dc4e(0x240)](fileCache[_0x3082b]);return dbPromise[_0xa7dc4e(0x32e)](_0x405712=>new Promise(_0x5b0002=>{const _0x396a5d=_0xa7dc4e,_0x524b36=_0x405712['transaction'](_0x396a5d(0x241),_0x396a5d(0x381)),_0x137c70=_0x524b36[_0x396a5d(0x297)](_0x396a5d(0x241))[_0x396a5d(0x132)](_0x3082b);_0x137c70[_0x396a5d(0x3b1)]=_0x4ea3fc=>{const _0x2260c6=_0x396a5d,_0x256bb4=_0x4ea3fc[_0x2260c6(0x402)][_0x2260c6(0x1e4)];if(_0x256bb4){const _0x32bf4d=URL[_0x2260c6(0x237)](_0x256bb4);fileCache[_0x3082b]=_0x32bf4d,_0x5b0002(_0x32bf4d);}else _0x5b0002('');},_0x137c70[_0x396a5d(0x1a9)]=()=>_0x5b0002('');}));}function applyCustomBg(){const _0xe06615=_0x287dc7,_0x43abcc=data[_0xe06615(0x3e8)],_0x11b181=_0x43abcc[_0xe06615(0x3b2)],_0x51135d=_0x43abcc[_0xe06615(0x370)],_0x1da81f=['lofi',_0xe06615(0x36b)]['includes'](_0x51135d),_0x208448=_0x51135d===_0xe06615(0x356)||_0x51135d==='pastel',_0x24e0c5=_0x43abcc[_0xe06615(0x3e6)]||_0xe06615(0x2b5);document[_0xe06615(0x192)][_0xe06615(0x44b)]['backgroundSize']=_0x24e0c5,document[_0xe06615(0x192)][_0xe06615(0x44b)][_0xe06615(0x40a)]=_0x24e0c5===_0xe06615(0x341)?_0xe06615(0x361):'no-repeat';const _0x2643f8=()=>{const _0x5e8e5a=_0xe06615;try{document[_0x5e8e5a(0x192)][_0x5e8e5a(0x44b)][_0x5e8e5a(0x188)]='';}catch(_0x4f535f){}};if(_0x11b181){const _0x2e7b3e=_0x11b181[_0xe06615(0x339)](_0xe06615(0x183))||_0x11b181[_0xe06615(0x339)]('http')||_0x11b181[_0xe06615(0x339)](_0xe06615(0x412))?Promise[_0xe06615(0x240)](_0x11b181):getStoredFileUrl(_0x11b181);_0x2e7b3e['then'](_0x1464ab=>{const _0x1275ed=_0xe06615;_0x1464ab?document[_0x1275ed(0x192)][_0x1275ed(0x44b)][_0x1275ed(0x13d)]('--bg-image',_0x1275ed(0x42e)+_0x1464ab+')'):document[_0x1275ed(0x192)][_0x1275ed(0x44b)]['setProperty'](_0x1275ed(0x149),_0x208448?_0x1275ed(0x1cf):''),_0x2643f8();});}else!_0x1da81f?_0x208448?(document[_0xe06615(0x192)]['style'][_0xe06615(0x13d)](_0xe06615(0x149),_0xe06615(0x1cf)),_0x2643f8()):document[_0xe06615(0x192)]['style'][_0xe06615(0x13d)](_0xe06615(0x149),_0xe06615(0x179)):(document[_0xe06615(0x192)][_0xe06615(0x44b)][_0xe06615(0x342)](_0xe06615(0x149)),_0x2643f8());}function applyPanelOpacity(){const _0xa7a9ff=_0x287dc7;document[_0xa7a9ff(0x204)]['style'][_0xa7a9ff(0x13d)]('--panel-opacity',data[_0xa7a9ff(0x3e8)][_0xa7a9ff(0x21a)]);}function renderDashboard(){const _0x1027b9=_0x287dc7,_0x42dabf=data[_0x1027b9(0x309)][_0x1027b9(0x21b)](_0x6a3ebd=>_0x6a3ebd[_0x1027b9(0x1cd)][_0x1027b9(0x300)](_0x2f3dd8=>({'topic':_0x6a3ebd[_0x1027b9(0x332)],'subtopic':_0x2f3dd8['name'],'m':_0x2f3dd8['stats'][_0x1027b9(0x395)]||0x0,'c':_0x2f3dd8[_0x1027b9(0x3df)][_0x1027b9(0x2fa)]||0x0,'t':_0x2f3dd8[_0x1027b9(0x3df)]['tasksCompleted']||0x0}))),_0x2a8bee=_0x42dabf[_0x1027b9(0x338)]((_0x2cbd79,_0x26f26f)=>_0x2cbd79+_0x26f26f['m'],0x0),_0x4d5f59=_0x42dabf[_0x1027b9(0x338)]((_0x21300d,_0x2de9b7)=>_0x21300d+_0x2de9b7['c'],0x0),_0x422cd7=_0x42dabf['reduce']((_0x418961,_0x371912)=>_0x418961+_0x371912['t'],0x0);let _0x2f9685=_0x1027b9(0x27a)+formatDaysHoursMinutes(_0x2a8bee)+_0x1027b9(0x2cd)+_0x4d5f59+_0x1027b9(0x18f)+_0x422cd7+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>';_0x42dabf[_0x1027b9(0x1a1)](_0x205579=>{const _0x1c1d18=_0x1027b9;_0x2f9685+=_0x1c1d18(0x1ef)+escapeHTML(_0x205579[_0x1c1d18(0x274)])+'</td><td>'+escapeHTML(_0x205579[_0x1c1d18(0x340)])+_0x1c1d18(0x346)+formatDaysHoursMinutes(_0x205579['m'])+'</td><td>'+_0x205579['c']+'</td><td>'+_0x205579['t']+_0x1c1d18(0x321);}),_0x2f9685+='</tbody></table>';const _0x4a10ff=$(_0x1027b9(0x41f));if(_0x4a10ff)_0x4a10ff['innerHTML']=_0x2f9685;}function getMilestones(){const _0x2d35fa=_0x287dc7;return[{'hours':0x5,'title':_0x2d35fa(0x1c4),'message':_0x2d35fa(0x3c4)},{'hours':0x14,'title':_0x2d35fa(0x408),'message':_0x2d35fa(0x2b6)},{'hours':0x32,'title':_0x2d35fa(0x38d),'message':_0x2d35fa(0x2c0)},{'hours':0x64,'title':_0x2d35fa(0x372),'message':_0x2d35fa(0x335)},{'hours':0xfa,'title':_0x2d35fa(0x385),'message':_0x2d35fa(0x1c7)},{'hours':0x1f4,'title':'Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','message':_0x2d35fa(0x212)},{'hours':0x3e8,'title':_0x2d35fa(0x3f6),'message':_0x2d35fa(0x2b8)},{'hours':0x1388,'title':_0x2d35fa(0x3fe),'message':_0x2d35fa(0x29d)}][_0x2d35fa(0x1d3)]((_0x4341e9,_0x23c1ab)=>_0x23c1ab[_0x2d35fa(0x151)]-_0x4341e9[_0x2d35fa(0x151)]);}async function checkAndShowMilestones(){const _0x4eb700=_0x287dc7;if(!data||!data[_0x4eb700(0x3e8)])return;if(!Array['isArray'](data[_0x4eb700(0x3e8)][_0x4eb700(0x19d)]))data[_0x4eb700(0x3e8)][_0x4eb700(0x19d)]=[];const _0x3cd6e9=data['topics'][_0x4eb700(0x338)]((_0xb725fc,_0x552cde)=>{const _0x5d3889=_0x4eb700;return _0xb725fc+_0x552cde[_0x5d3889(0x1cd)]['reduce']((_0x14df3f,_0x2f68ee)=>{return _0x14df3f+(_0x2f68ee['stats']['totalMinutes']||0x0);},0x0);},0x0),_0xca8976=_0x3cd6e9/0x3c,_0x11b050=getMilestones(),_0x38188e=Array[_0x4eb700(0x164)](data['settings'][_0x4eb700(0x19d)])?data[_0x4eb700(0x3e8)][_0x4eb700(0x19d)]:[],_0x1183e3=_0x11b050[_0x4eb700(0x273)](_0x1bec75=>_0xca8976>=_0x1bec75[_0x4eb700(0x151)]&&!_0x38188e['includes'](_0x1bec75[_0x4eb700(0x151)]));if(_0x1183e3['length']===0x0)return![];const _0x105a8a=_0x1183e3[_0x4eb700(0x338)]((_0x297108,_0x19e133)=>_0x297108&&_0x297108['hours']>_0x19e133[_0x4eb700(0x151)]?_0x297108:_0x19e133,null);if(!_0x105a8a)return![];$(_0x4eb700(0x282))['textContent']=_0x105a8a[_0x4eb700(0x44a)],$(_0x4eb700(0x42a))[_0x4eb700(0x181)]=_0x105a8a[_0x4eb700(0x2fc)],$(_0x4eb700(0x345))[_0x4eb700(0x1de)][_0x4eb700(0x347)](_0x4eb700(0x384));try{trapFocus($(_0x4eb700(0x345)));}catch(_0x4bc413){}return data[_0x4eb700(0x3e8)][_0x4eb700(0x19d)][_0x4eb700(0x207)](_0x105a8a[_0x4eb700(0x151)]),await saveData(),!![];}function _0x5aa0(){const _0x1053f6=['#modalDashboard','display','div','href','sub-row','scroll','length','createdAt','topicsList','#toolBold','blockReason','#genericMessage','Lỗi:\x20','cover','Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.','Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.','Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.','Đã\x20cập\x20nhật\x20hình\x20nền.','chev\x20btn\x20small\x20ghost','currentTime','#genericInput','getBoundingClientRect','#btnGenericCancel','50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.','replace','removing','statusText','\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.','.modal','Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.','.method-item\x20.method-content','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.','Đã\x20chuyển\x20sang\x20Kiểu\x20','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','\x20|\x20<strong>Tổng\x20phiên:</strong>\x20','includes','#set_flowRatio','width','#audioWorkEnd','#ytUrlFeedback','Thêm\x20Tri\x20thức\x20mới','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','var(--acc-2)','splice','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>','https://www.youtube.com','allow','shiftKey','catch','button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])','Player','getVolume','activeElement','setItem','setValueAtTime','#btnReset','Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','#welcomePanel','<li>','.timer-circle-container','#btnBreakEarly','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','work_end','cycleIndex','Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','https://img.youtube.com/vi/','cueVideoById','badge\x20state\x20work','toast','customSounds','.method-delete','date','scrollHeight','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','Nhập\x20thất\x20bại:\x20','AutoBackup\x20error:','#btnDefaults','btnToggleYtSound','sessionsCompleted','summaries','message','#modalNote','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20để\x20xem\x20Kho\x20Tri\x20Thức.</p>','join','map','var(--warn)','cancel','summary_','change','Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.','position','Sortable','data','topics','</div>','__ytApiPromise','Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.','view','code','modalMethodEditor','B_short','img.youtube.com/vi/','load','\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22','#set_theme_color','start','0\x20phút','styleWithCSS','btn\x20small\x20ghost\x20method-edit','cyclesTarget','.nav-btn[data-view]','Âm\x20thanh\x20đã\x20được\x20bật!','btn\x20small','note-content','actions-menu','acc','updateUI','</td></tr>','autoplay;\x20encrypted-media;\x20picture-in-picture','Failed\x20to\x20delete\x20summary:','mousedown','Tóm\x20tắt','không\x20rõ','onupgradeneeded','#backupList','onload','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','Missing\x20element','#cycleInfo','/maxresdefault.jpg','then','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','toggle','name','Đã\x20lưu\x20ghi\x20chú','download','100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.','A_long','3846196aHRIHk','reduce','startsWith','Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.','#btnSaveMethod','wind_down','#set_backgroundMode','toString','Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.','subtopic','auto','removeProperty','#statSessions','max','#modalMilestone','</td><td>','add','Đã\x20lưu\x20cài\x20đặt','restoreBackup','.actions-menu.show','aria-expanded','methods','.actions-menu-btn','candidates','#btnPresetB','fullscreenElement','#genericTitle','Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.','#settings-flowtime','DB_VERSION','slice','light','#uploadSoundWork','lastBackupDate','no-subtopic-selected','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','paused','#set_panelOpacity','https://www.youtube.com/iframe_api','main_settings','sess','<div><span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span></div>','repeat','#toolBullet','#methodEditorContentInput','Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.','#set_short','closest','#btnAddMethod','enableWinddown','Ẩn\x20giao\x20diện','#modalSettings','space','getMonth','clientY','Đang\x20phát','#btnMilestoneClose','theme','active','Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','menu-active','type','innerHeight','(Không\x20tạo\x20được\x20tóm\x20tắt)','yt-fallback','gain','protocol','offsetWidth','96BoXKJA','#btnSendMessage','youtubeVolume','#set_theme','destination','method-title','readonly','innerHTML','timer.cycleInfo','show','Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','B_winddown','#chatInput','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?','Xóa\x20Chủ\x20đề\x20con','#chatMessages','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.','update','Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','youtube-player-container','soundTheme','right','beforeunload','break_end','#toolH4','item','totalMinutes','set_youtubeUrl','</li>','getAll','addEventListener','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','oldIndex','Nghỉ\x20','toLocaleDateString','selectionStart','head','clear','getFullYear','parts','model','_onFinishSegment','Chủ\x20đề\x20con:\x20','chat-msg\x20','pointerdown','#btnSettings','Deleted\x20old\x20backup:\x20','color','.topic-item.menu-active','importData','long_break','linearRampToValueAtTime','<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>','collapsedTopics','onsuccess','customBg','frequency','#selectedContext','Xuất','#settings-pomodoro','4714014sjfiuM','#btnAddTopic','</label>','winddown','innerWidth','#btnAddGeneralNote','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22','autoStartNext','NGHỈ\x20NGẮN','\x27\x20·\x20Mode\x20','</span>','removeChild','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20trong\x20Chủ\x20đề\x20con\x20này.</p>','Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!','<ul>','<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>','Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!','menu-item\x20danger','-9999px','API\x20response\x20structure\x20is\x20unexpected:','486075billdo','ArrowUp','timer','Initialization\x20error:','Chọn\x20một\x20chủ\x20đề\x20con\x20trước.','Xóa\x20tri\x20thức\x20\x22','#view-methods','#btnSkipNote','Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.','#set_youtubeUrl','select','strokeDasharray','timer.selectSubtopicPrompt','isContentEditable','\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','subtopics-group','preset','#btnSaveSettings','#btnAutoFormat','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','stats','(chưa\x20chọn)','＋\x20Thêm','bg-view-mode','POST','default','#toasts','backgroundMode','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.','settings','.nav-btn[data-view=\x22','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','#btnFullscreen','isNaN','Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.','toLowerCase','#ytSoundVolume','readwrite','key','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','vi-VN','<ol>','undefined','Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.','\x0a-\x20','Chu\x20kỳ\x20','#btnPause','badge','Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','Failed\x20to\x20load\x20YouTube\x20API','Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.','var(--sub)','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>','target','#draggableTimer','selectedTopicId','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>','fixed','Chọn\x20chủ\x20đề\x20con\x20trước.','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','.timer-circle-progress','backgroundRepeat','currentConfig','Tên\x20Chủ\x20đề\x20mới?','insertUnorderedList','substring','4925179MCURsX','Sửa\x20tên\x20Chủ\x20đề','.subtopics','blob:','#view-','Sửa','note-content-wrapper','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?','\x20tiếng\x20','Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20','tickHandle','#view-timer','apiKey','btn\x20small\x20ghost\x20actions-menu-btn','.presets\x20button','Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a','#dashboardContent','var(--danger)','Thêm\x20Chủ\x20đề\x20con','setVolume','sessions','selectedSubtopicId','function','#btnAddSubtopicTask','Hiện\x20giao\x20diện','Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.','short','#milestoneMessage','#btnHelpCreateTopic','transition','ArrowDown','url(','persistTimerState','#set_volume','scrollTop','objectStoreNames','IndexedDB\x20error:','#currentSubtopicNameChat','chatHistory','string','&amp;','test','.aux-panel,\x20.modal-card','PLAYING','pomodoro_backup_','Escape','</ul>','playVideo','#importFile','Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.','stop','<span\x20class=\x22ico\x22>▾</span>','click','Toàn\x20màn\x20hình','min','unshift','now','useYtThumbnailAsBg','btn\x20subtopic-btn','title','style','longBreakIntervalB','#btnSummarize','dataset','BUFFERING','ENDED','Xóa','updateSettings','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','height','<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>','setRangeText','get','presetTarget','#toolItalic','<h4>','940744eHaWjJ','find','Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.','stopVideo','text','#btnResume','&#39;','setProperty','trim','origin','getIframe','#view-methods\x20.method-item','.nav-btn','#btnToggleCustomSounds','Đã\x20xóa\x20tóm\x20tắt.','querySelectorAll','disabled','padStart','toLocaleString','--bg-image','#methodEditorTitle','removeEventListener','❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.','contains','segmentTotal','Chưa\x20có\x20tiêu\x20đề','match','hours','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22','delete','triangle','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>','Chưa\x20chọn\x20Chủ\x20đề\x20con','generalNotes','log','onYouTubeIframeAPIReady','Creating\x20backup\x20for\x20','tagName','\x20(A)','json','#btnToggleYtSound','beginWindDown','initDB','isCompleted','#newSubtopicTaskInput','floor','isArray','newIndex','application/json','Sửa\x20tên\x20Chủ\x20đề\x20con','finishFlowSession','actions','Chỉnh-sửa\x20Tri\x20thức','oncomplete','#btnToggleBg','round','1602486VYZFAb','Đang\x20tải\x20API\x20YouTube...','#toolList','focus','https:','#btnClearBg','Lỗi\x20khi\x20gọi\x20Gemini\x20API:','mode','abs','Không\x20thể\x20lưu\x20thay\x20đổi.','remove','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','Đang\x20phát\x20nhạc\x20nền...','🌊\x20Flow','\x20hidden','formatBlock','Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','from','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','textContent','/hqdefault.jpg','data:','state','toISOString','#windDownChecklist','createIndex','backgroundImage','lofi','reset','unMute','ghost','__ytApiWatchdog','open','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','reloading','#summariesList','body','finished','stringify','currentDurations','#set_long','Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','setPreset','Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.','&gt;','\x20phút','#customSoundsContainer','achievedMilestones','note-item','script','destroy','forEach','connect','Nội\x20dung\x20bị\x20chặn\x20vì:\x20','#btnCloseSettings','Tên\x20Chủ\x20đề\x20con\x20mới?','4283780ZzLbip','cyclesA','pauseVideo','onerror','Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.','isConnected','pomodoro_files','#set_work','value','resume','...','command','Đổi\x20tên\x20Chủ\x20đề','</ol>','timerState_','Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.','Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.','#statTotal','A_winddown','Lỗi\x20từ\x20Gemini:\x20','.subtopic-btn','Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.','Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.','long_end','#set_autoStartNext','append','user','#set_apiKey','strokeDashoffset','Lỗi\x20HTTP:\x20','Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','Xác\x20nhận\x20chuyển\x20đổi','#audioBreakEnd','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','Daily\x20backup\x20successful.','altKey','contentWindow','#timerPresetSelector\x20button','keydown','subtopics','#set_enableSessionNotes','none','Lỗi\x20lưu\x20file.','span','baseVal','sort','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>','idle','#methodEditorTitleInput','getElementById','Xác\x20nhận\x20xóa','#btnGenericOk','_getStore','Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.','soundOn','.txt','classList','button','PomodoroAppDB','#set_cycles','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','getPropertyValue','result','backups','Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','breathing','getItem','content','#btnTestSound','tab','remaining','getSettings','B_long','<tr><td>','postMessage','#set_backupDays','chime','<strong>$1</strong>','getPlayerState','pastel','about:blank','Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.','IndexedDB\x20initialized\x20successfully.','createGain','#btnClearChat','createObjectStore','Đã\x20khôi\x20phục\x20mặc\x20định','.topic-item','getDate','?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.','note','reload','sound_unlocked','Xóa\x20Chủ\x20đề','documentElement','volume','error','push','execCommand','\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]','random','top','tasksCompleted','beginBreak','?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.','PlayerState','timerState','bottom','Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.','clientX','input','3ooAulr','break','#editorPreview','revokeObjectURL','longBreakIntervalA','panelOpacity','flatMap','#btnSummarizeNote','btn\x20small\x20danger','autoBackup','pomodoroData_v11','stopPropagation','Tệp\x20không\x20đúng\x20định\x20dạng','#modalGeneric','#set_winddown','_sortable','tid','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước.','version','A_work','Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20','durations','exitFullscreen','ytUrlFeedback','B_work','#uploadSoundLong','appendChild','Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.','<div\x20class=\x22spinner\x22></div>','reverse','offsetHeight','relative','.method-item','flowtimeBreakRatio','createObjectURL','#view-methods\x20.methods-container','promptFeedback','preventDefault','parse','#breakSuggestionDisplay','_startTick','Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','AudioContext','resolve','files','lang','Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...','Xác\x20nhận\x20phục\x20hồi','Backup\x20failed:','.color-picker-wrapper','#timeDisplay','#currentSubtopicName','<input\x20type=\x22checkbox\x22\x20id=\x22','mute','createOscillator','indexOf','currentView','durationMinutes','prevState','put','italic','iframe','querySelector','onkeydown','className','<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>','topic-item','<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>','topic-actions','#aiPromptSuggestions\x20button','Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22','status','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=','Đã\x20dừng\x20nhạc\x20nền.','#modalMethodEditor','#set_interval','role','enableSessionNotes','.actions-menu','<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>','<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>','Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.','end','####\x20','checked','</p>','Thoát\x20toàn\x20màn\x20hình','input,select,textarea','Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20','play','beginWork','beep','#welcomePanel\x20p','sum','filter','topic','Tab','#set_enableWinddown','transaction','#set_ytThumbAsBg','Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.','<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20','methodId','menu-item','btn\x20small\x20danger\x20method-delete','tasks','pause','hidden','prompt','#milestoneTitle','#btnSkip','selectionEnd','text/plain','setAttribute','backupDaysToKeep','cycles','Enter','#btnStart','absolute','src','location','Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.','note-meta','createElement','SẴN\x20SÀNG','sid','mousemove','sine','soundPermissionBar','Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!','objectStore','work','long','left','<i>$1</i>','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.','Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.','onclick','cyclesB','#btnPresetC','LÀM\x20VIỆC\x20(FLOW)','A_short','.tab-btn','topicId','<div>','option'];_0x5aa0=function(){return _0x1053f6;};return _0x5aa0();}async function seedAchievedMilestones(){const _0x591214=_0x287dc7;if(!data||!data[_0x591214(0x3e8)])return;!Array[_0x591214(0x164)](data[_0x591214(0x3e8)][_0x591214(0x19d)])&&(data[_0x591214(0x3e8)]['achievedMilestones']=[],await saveData());}async function handleSendMessage(){const _0x3a153f=_0x287dc7,_0x10ce9c=$(_0x3a153f(0x37c)),_0x6fab64=$(_0x3a153f(0x387)),_0x6b3a80=_0x6fab64[_0x3a153f(0x1ae)]['trim'](),_0x61df3c=getCurrentSubtopic();if(!_0x6b3a80)return;if(!_0x61df3c){toast(t('timer.selectSubtopicPrompt'));return;}_0x6fab64[_0x3a153f(0x1ae)]='',_0x10ce9c['disabled']=!![],_0x10ce9c[_0x3a153f(0x382)]=_0x3a153f(0x231),_0x61df3c[_0x3a153f(0x435)]['push']({'role':'user','text':_0x6b3a80}),renderChat();const _0x2af9ad=await callGeminiAPI(_0x6b3a80);_0x2af9ad&&(_0x61df3c[_0x3a153f(0x435)]['push']({'role':_0x3a153f(0x3a3),'text':_0x2af9ad}),await saveData(),renderChat()),_0x10ce9c[_0x3a153f(0x146)]=![],_0x10ce9c[_0x3a153f(0x382)]='Gửi';}function renderChat(){const _0x1d50ff=_0x287dc7,_0x54900b=getCurrentSubtopic(),_0x1dcce7=$(_0x1d50ff(0x38a)),_0x2b35bc=$('#chatInput'),_0x152b0a=$(_0x1d50ff(0x37c));if(!_0x1dcce7||!_0x2b35bc||!_0x152b0a)return;if(!_0x54900b){_0x1dcce7[_0x1d50ff(0x382)]='<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>',_0x2b35bc[_0x1d50ff(0x146)]=!![],_0x152b0a[_0x1d50ff(0x146)]=!![];return;}_0x2b35bc[_0x1d50ff(0x146)]=![],_0x152b0a['disabled']=![],_0x1dcce7[_0x1d50ff(0x382)]='';if(!_0x54900b['chatHistory']||_0x54900b[_0x1d50ff(0x435)][_0x1d50ff(0x2ae)]===0x0){_0x1dcce7[_0x1d50ff(0x382)]=_0x1d50ff(0x330);return;}_0x54900b[_0x1d50ff(0x435)][_0x1d50ff(0x1a1)](_0x5dc494=>{const _0x259899=_0x1d50ff,_0x43337f=document[_0x259899(0x290)]('div');_0x43337f[_0x259899(0x255)]=_0x259899(0x3a6)+_0x5dc494[_0x259899(0x261)],_0x43337f[_0x259899(0x181)]=_0x5dc494[_0x259899(0x13a)],_0x1dcce7[_0x259899(0x22f)](_0x43337f);}),_0x1dcce7[_0x1d50ff(0x431)]=_0x1dcce7[_0x1d50ff(0x2f4)];}async function handleSummarizeNote(){const _0x3ff23d=_0x287dc7,_0x1d1783=$(_0x3ff23d(0x21c)),_0x10cae0=$('#noteText'),_0x44c3c6=_0x10cae0['value']['trim'](),_0xf396c9=getCurrentSubtopic();if(!_0x44c3c6){toast(_0x3ff23d(0x3ed));return;}const _0x483885=_0x1d1783[_0x3ff23d(0x382)];_0x1d1783[_0x3ff23d(0x382)]=_0x3ff23d(0x231),_0x1d1783[_0x3ff23d(0x146)]=!![];const _0x76beeb=_0x3ff23d(0x25b)+(_0xf396c9?.['name']||_0x3ff23d(0x326))+_0x3ff23d(0x313)+_0x44c3c6+_0x3ff23d(0x209),_0x515593=await callGeminiAPI(_0x76beeb);_0x515593&&(_0x10cae0[_0x3ff23d(0x1ae)]+='\x0a\x0a'+_0x515593),_0x1d1783[_0x3ff23d(0x382)]=_0x483885,_0x1d1783[_0x3ff23d(0x146)]=![];}function clearChat(){const _0x4c96d3=_0x287dc7,_0x3e4c3a=getCurrentSubtopic();if(!_0x3e4c3a){toast(t(_0x4c96d3(0x3d7)));return;}showConfirmModal(_0x4c96d3(0x1d8),_0x4c96d3(0x388),async _0x13f065=>{const _0x285bd5=_0x4c96d3;_0x13f065&&(_0x3e4c3a[_0x285bd5(0x435)]=[],await saveData(),renderChat(),toast('Đã\x20xóa\x20lịch\x20sử\x20chat.'));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0x233298,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0xf8b3b=_0x287dc7,_0x46c73a=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0x233298,'enablejsapi':'1','origin':_0xf8b3b(0x2d8)})[_0xf8b3b(0x33e)]();return'https://www.youtube.com/embed/'+_0x233298+'?'+_0x46c73a;}function ensureFallbackFrame(){const _0x205bf1=_0x287dc7,_0x57810b=document[_0x205bf1(0x1d7)]('youtube-player-container');if(!_0x57810b)return null;if(ytFallbackFrame&&ytFallbackFrame[_0x205bf1(0x1ab)])return ytFallbackFrame;const _0x41f3ef=document[_0x205bf1(0x290)](_0x205bf1(0x252));return _0x41f3ef['id']=_0x205bf1(0x377),_0x41f3ef[_0x205bf1(0x2d0)]='1',_0x41f3ef[_0x205bf1(0x12f)]='1',_0x41f3ef[_0x205bf1(0x44b)]['position']=_0x205bf1(0x28b),_0x41f3ef[_0x205bf1(0x44b)][_0x205bf1(0x20b)]=_0x205bf1(0x3c9),_0x41f3ef[_0x205bf1(0x44b)][_0x205bf1(0x29a)]='-9999px',_0x41f3ef[_0x205bf1(0x2d9)]=_0x205bf1(0x322),_0x57810b[_0x205bf1(0x382)]='',_0x57810b['appendChild'](_0x41f3ef),ytFallbackFrame=_0x41f3ef,_0x41f3ef;}function fallbackLoadVideo(_0x2452de,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x2e33b9=_0x287dc7,_0x7d8581=document[_0x2e33b9(0x1d7)](_0x2e33b9(0x38e));if(!_0x7d8581)return;_0x7d8581[_0x2e33b9(0x382)]='';const _0xc1a884=document[_0x2e33b9(0x290)](_0x2e33b9(0x252));_0xc1a884['id']='yt-fallback',_0xc1a884[_0x2e33b9(0x2d0)]='1',_0xc1a884[_0x2e33b9(0x12f)]='1',_0xc1a884['style'][_0x2e33b9(0x306)]=_0x2e33b9(0x28b),_0xc1a884[_0x2e33b9(0x44b)][_0x2e33b9(0x20b)]=_0x2e33b9(0x3c9),_0xc1a884[_0x2e33b9(0x44b)][_0x2e33b9(0x29a)]=_0x2e33b9(0x3c9),_0xc1a884[_0x2e33b9(0x2d9)]=_0x2e33b9(0x322),_0xc1a884[_0x2e33b9(0x28c)]=buildFallbackSrc(_0x2452de,{'autoplay':autoplay,'mute':mute}),_0x7d8581['appendChild'](_0xc1a884),ytFallbackFrame=_0xc1a884,ytFallbackIsPlaying=!!autoplay;try{const _0x398a11=document[_0x2e33b9(0x1d7)]('btnToggleYtSound');if(_0x398a11)_0x398a11['textContent']=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x2af24b){}}function fallbackPostMessage(_0x429a9f,_0x3c48ed=[]){const _0x550c44=_0x287dc7;try{if(!ytFallbackFrame||!ytFallbackFrame[_0x550c44(0x1ca)])return;ytFallbackFrame[_0x550c44(0x1ca)][_0x550c44(0x1f0)](JSON[_0x550c44(0x194)]({'event':_0x550c44(0x1b1),'func':_0x429a9f,'args':_0x3c48ed}),_0x550c44(0x2d8));}catch(_0x310165){}}function fallbackPlay(){const _0x298844=_0x287dc7;fallbackPostMessage(_0x298844(0x43e));}function fallbackStop(){const _0xa43776=_0x287dc7;try{ytFallbackFrame&&(ytFallbackFrame[_0xa43776(0x28c)]=_0xa43776(0x1f6),ytFallbackIsPlaying=![]);}catch(_0x5423b4){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){fallbackPostMessage('unMute');}function fallbackMute(){const _0x44ef2b=_0x287dc7;fallbackPostMessage(_0x44ef2b(0x24a));}window[_0x287dc7(0x159)]=function(){const _0x3cea7e=_0x287dc7;if(IS_FILE_PROTOCOL){try{window[_0x3cea7e(0x18d)]&&window[_0x3cea7e(0x18d)]['cancel']();}catch(_0x12b4a9){}return;}const _0x1b8226={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0x3cea7e(0x2d8)};(window[_0x3cea7e(0x28d)][_0x3cea7e(0x379)]==='http:'||window['location']['protocol']===_0x3cea7e(0x172))&&(_0x1b8226[_0x3cea7e(0x13f)]=window[_0x3cea7e(0x28d)][_0x3cea7e(0x13f)]);ytPlayer=new YT[(_0x3cea7e(0x2dd))]('youtube-player-container',_0x1b8226);try{window[_0x3cea7e(0x18d)]&&window[_0x3cea7e(0x18d)][_0x3cea7e(0x302)]();const _0x5140af=document[_0x3cea7e(0x1d7)](_0x3cea7e(0x22c));_0x5140af&&(_0x5140af[_0x3cea7e(0x181)]='');}catch(_0xd8fa4c){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x287dc7(0x1e8)]('sound_unlocked')==='1';}catch(_0x2481a8){}function showSoundPermission(){const _0x8fd1c=_0x287dc7,_0x1019d7=document[_0x8fd1c(0x1d7)]('soundPermissionBar');if(!_0x1019d7)return;if(_ytUnlocked){_0x1019d7[_0x8fd1c(0x1de)][_0x8fd1c(0x178)](_0x8fd1c(0x384));return;}_0x1019d7[_0x8fd1c(0x1de)][_0x8fd1c(0x347)](_0x8fd1c(0x384));}function hideSoundPermission(){const _0x49044d=_0x287dc7,_0x3d7c71=document[_0x49044d(0x1d7)](_0x49044d(0x295));if(!_0x3d7c71)return;_0x3d7c71['classList'][_0x49044d(0x178)]('show');}function unlockAudioChain(){const _0x37cc44=_0x287dc7;try{if(AUDIO_CTX&&typeof AUDIO_CTX[_0x37cc44(0x1af)]===_0x37cc44(0x425))AUDIO_CTX[_0x37cc44(0x1af)]();}catch(_0x12d414){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer['unMute']&&(ytPlayer['unMute'](),ytPlayer['playVideo']());}catch(_0xd8053b){}_ytUnlocked=!![];try{localStorage[_0x37cc44(0x2e0)](_0x37cc44(0x202),'1');}catch(_0x4fd332){}hideSoundPermission(),toast(_0x37cc44(0x31b));}function onPlayerReady(_0x5e80e9){const _0x4dba39=_0x287dc7;try{const _0x152f70=ytPlayer&&ytPlayer[_0x4dba39(0x140)]?ytPlayer[_0x4dba39(0x140)]():null;_0x152f70&&_0x152f70[_0x4dba39(0x286)](_0x4dba39(0x2d9),'autoplay;\x20encrypted-media;\x20picture-in-picture');}catch(_0x3edf1b){}try{if(ytPlayer&&ytPlayer['setVolume'])ytPlayer[_0x4dba39(0x422)](data&&data[_0x4dba39(0x3e8)]&&data['settings'][_0x4dba39(0x37d)]||0x50);}catch(_0x35b895){}try{const _0x5b8ce5=getActiveVideoId&&getActiveVideoId();if(_0x5b8ce5&&ytPlayer&&ytPlayer[_0x4dba39(0x24a)]&&ytPlayer[_0x4dba39(0x43e)]){ytPlayer[_0x4dba39(0x24a)](),ytPlayer[_0x4dba39(0x43e)](),_ytPrimed=!![];const _0x18a97b=()=>{const _0x3912e6=_0x4dba39;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x3e906b){}window[_0x3912e6(0x14b)](_0x3912e6(0x3a7),_0x18a97b,!![]),window['removeEventListener'](_0x3912e6(0x1cc),_0x18a97b,!![]);};window[_0x4dba39(0x399)](_0x4dba39(0x3a7),_0x18a97b,!![]),window['addEventListener'](_0x4dba39(0x1cc),_0x18a97b,!![]),showSoundPermission();}}catch(_0x3fa420){}updateYouTubePlayer();}function onPlayerStateChange(_0x5d7a1a){const _0x50d675=_0x287dc7,_0x5cdc57=$(_0x50d675(0x15e));_0x5d7a1a[_0x50d675(0x308)]==YT[_0x50d675(0x20f)][_0x50d675(0x43a)]?(_0x5cdc57['textContent']='⏸️',hideSoundPermission()):_0x5cdc57[_0x50d675(0x181)]='▶️';if(_0x5d7a1a[_0x50d675(0x308)]===YT['PlayerState'][_0x50d675(0x450)]){if(!ytUserPaused)ytPlayer[_0x50d675(0x43e)]();}}async function ytFadeTo(_0xed3bef,_0x430570=0xfa){const _0x4b92b9=_0x287dc7;try{if(!ytPlayer||!ytPlayer[_0x4b92b9(0x2de)]||!ytPlayer[_0x4b92b9(0x422)])return;ytPlayer[_0x4b92b9(0x18b)]();const _0x3af017=ytPlayer['getVolume'](),_0x4b45b7=_0xed3bef-_0x3af017;if(Math[_0x4b92b9(0x176)](_0x4b45b7)<0x1||_0x430570<=0x0){ytPlayer['setVolume'](_0xed3bef);return;}const _0x22f553=performance[_0x4b92b9(0x447)]();await new Promise(_0x4f3374=>{const _0x25ea8a=_0x284762=>{const _0xe3c495=_0xbc78,_0x4bb91d=Math[_0xe3c495(0x445)](0x1,(_0x284762-_0x22f553)/_0x430570),_0x525b42=Math[_0xe3c495(0x16d)](_0x3af017+_0x4b45b7*_0x4bb91d);ytPlayer[_0xe3c495(0x422)](_0x525b42);if(_0x4bb91d<0x1)requestAnimationFrame(_0x25ea8a);else _0x4f3374();};requestAnimationFrame(_0x25ea8a);});}catch(_0xb486a5){}}async function ytFadeInPlay(_0x2b41b8=0xdc){const _0x3b89ae=_0x287dc7;try{const _0xdd7486=Math['max'](0x0,Math[_0x3b89ae(0x445)](0x64,data&&data[_0x3b89ae(0x3e8)]&&data['settings'][_0x3b89ae(0x37d)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer['unMute'](),ytPlayer[_0x3b89ae(0x43e)]();try{ytPlayer[_0x3b89ae(0x422)](0x0);}catch(_0x32be95){}await ytFadeTo(_0xdd7486,_0x2b41b8);}else{const _0x37b84b=getActiveVideoId();_0x37b84b&&fallbackLoadVideo(_0x37b84b,{'autoplay':0x1,'mute':0x0});}}catch(_0x495a06){}}async function ytFadeOutPause(_0xc27b56=0xb4){const _0x178c75=_0x287dc7;try{const _0x36ce09=Math['max'](0x0,Math[_0x178c75(0x445)](0x64,data&&data[_0x178c75(0x3e8)]&&data['settings'][_0x178c75(0x37d)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0xc27b56);try{ytPlayer[_0x178c75(0x1a8)](),ytPlayer['setVolume'](_0x36ce09);}catch(_0xa87572){}}else try{fallbackPause();}catch(_0x148579){}}catch(_0x3881da){}}async function updateYouTubePlayer(){const _0x505698=_0x287dc7,_0xc3e2c=getActiveVideoId();if(data['settings']['useYtThumbnailAsBg']&&_0xc3e2c){const _0x4b22dd=_0x505698(0x2ed)+_0xc3e2c+_0x505698(0x32d),_0x1aaebe=new Image();_0x1aaebe[_0x505698(0x329)]=async()=>{const _0x35fd93=_0x505698;data['settings'][_0x35fd93(0x3b2)]=_0x4b22dd,await saveData(),applyCustomBg();},_0x1aaebe[_0x505698(0x1a9)]=async()=>{const _0x26af30=_0x505698,_0x3ee88d=_0x26af30(0x2ed)+_0xc3e2c+_0x26af30(0x182);data[_0x26af30(0x3e8)][_0x26af30(0x3b2)]=_0x3ee88d,await saveData(),applyCustomBg();},_0x1aaebe[_0x505698(0x28c)]=_0x4b22dd;}else!_0xc3e2c&&(data[_0x505698(0x3e8)][_0x505698(0x3b2)]='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0xc3e2c){fallbackStop(),hideSoundPermission();return;}const _0x1dadba=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0xc3e2c,{'autoplay':0x1,'mute':_0x1dadba});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer[_0x505698(0x2ee)]){try{ensureYouTubeAPI();}catch(_0x4babb8){}return;}if(!_0xc3e2c){if(ytPlayer[_0x505698(0x139)])ytPlayer[_0x505698(0x139)]();hideSoundPermission();return;}ytPlayer[_0x505698(0x2ee)](_0xc3e2c),ytPlayer[_0x505698(0x422)](data['settings'][_0x505698(0x37d)]);}function toggleYtSound(){const _0x1af38e=_0x287dc7;if(!_ytUnlocked){try{ensureAudio();}catch(_0x1f5ad9){}try{unlockAudioChain();}catch(_0x161119){}return;}if(IS_FILE_PROTOCOL){const _0x5cdabf=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame[_0x1af38e(0x1ab)]){if(!_0x5cdabf){toast('Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.');return;}fallbackLoadVideo(_0x5cdabf,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x3ab48d=document[_0x1af38e(0x1d7)]('btnToggleYtSound');if(_0x3ab48d)_0x3ab48d[_0x1af38e(0x181)]='⏸️';}catch(_0xb5b3f3){}toast(_0x1af38e(0x17a));return;}if(ytFallbackIsPlaying)fallbackPostMessage(_0x1af38e(0x1a8)),ytFallbackIsPlaying=![],toast(_0x1af38e(0x25e));else{if(!_0x5cdabf){toast(_0x1af38e(0x1bb));return;}fallbackPostMessage(_0x1af38e(0x43e)),ytFallbackIsPlaying=!![],toast(_0x1af38e(0x17a));}try{const _0x31d4b7=document[_0x1af38e(0x1d7)](_0x1af38e(0x2f9));if(_0x31d4b7)_0x31d4b7[_0x1af38e(0x181)]=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x2c6cee){}return;}if(!ytPlayer||typeof ytPlayer['getPlayerState']!==_0x1af38e(0x425)){try{ensureYouTubeAPI();}catch(_0x2af87f){}return;}const _0xdd4019=ytPlayer[_0x1af38e(0x1f4)]();_0xdd4019===YT[_0x1af38e(0x20f)][_0x1af38e(0x43a)]||_0xdd4019===YT[_0x1af38e(0x20f)][_0x1af38e(0x44f)]?(ytFadeOutPause(),ytUserPaused=!![],toast(_0x1af38e(0x25e))):(ytFadeInPlay(),ytUserPaused=![],toast('Đang\x20phát\x20nhạc\x20nền...'));}function bindEvents(){const _0x522de3=_0x287dc7;try{const _0x87d14f=document[_0x522de3(0x253)](_0x522de3(0x271));_0x87d14f&&(_0x87d14f[_0x522de3(0x382)]='Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.');}catch(_0x1bf222){}on($(_0x522de3(0x16c)),'click',toggleBackgroundView),on($(_0x522de3(0x36f)),'click',()=>{const _0x41e228=_0x522de3;$('#modalMilestone')[_0x41e228(0x1de)]['remove'](_0x41e228(0x384));try{releaseFocus();}catch(_0x3902a9){}}),on($('#btnAddTopic'),'click',()=>showInputModal(_0x522de3(0x40c),async _0x473afb=>{const _0x35d0de=_0x522de3;if(!_0x473afb)return;data[_0x35d0de(0x309)][_0x35d0de(0x207)]({'id':uid('t'),'name':_0x473afb,'subtopics':[]}),await saveData(),renderTopics();})),on($('#btnExport'),_0x522de3(0x443),()=>storageManager['exportData'](data)),on($(_0x522de3(0x43f)),_0x522de3(0x304),_0x230980=>{const _0x8b44bf=_0x522de3,_0x3a1c6c=_0x230980[_0x8b44bf(0x402)][_0x8b44bf(0x241)][0x0];if(!_0x3a1c6c)return;storageManager[_0x8b44bf(0x3ac)](_0x3a1c6c)[_0x8b44bf(0x32e)](async _0x1e5dd0=>{const _0x168826=_0x8b44bf;data=_0x1e5dd0,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast(_0x168826(0x3c7)),renderAll();})['catch'](_0x2aa78d=>toast(_0x8b44bf(0x2f6)+_0x2aa78d['message'])),_0x230980[_0x8b44bf(0x402)][_0x8b44bf(0x1ae)]=null;}),on($('#btnRestoreBackup'),_0x522de3(0x443),()=>{const _0x42b5a0=_0x522de3,_0xa6e387=$(_0x42b5a0(0x328)),_0x5045dd=_0xa6e387?_0xa6e387[_0x42b5a0(0x1ae)]:'';if(!_0x5045dd){toast(_0x42b5a0(0x29e));return;}showConfirmModal(_0x42b5a0(0x244),_0x42b5a0(0x26d)+new Date(_0x5045dd)[_0x42b5a0(0x39d)]()+_0x42b5a0(0x1ff),_0x530fa3=>{const _0xb8ebf=_0x42b5a0;_0x530fa3&&storageManager[_0xb8ebf(0x349)](_0x5045dd)[_0xb8ebf(0x32e)](_0x155aa5=>{const _0x15b8f9=_0xb8ebf;data=_0x155aa5,toast(_0x15b8f9(0x243)),setTimeout(()=>window[_0x15b8f9(0x28d)][_0x15b8f9(0x201)](),0x5dc);})[_0xb8ebf(0x2db)](_0x323fba=>{const _0x419c7d=_0xb8ebf;toast(_0x419c7d(0x2b4)+_0x323fba[_0x419c7d(0x2fc)]);});});}),on($(_0x522de3(0x314)),_0x522de3(0x214),_0x36a4c0=>{const _0x984a33=_0x522de3,_0x37e0f9=_0x36a4c0[_0x984a33(0x402)][_0x984a33(0x1ae)];applyTheme(_0x37e0f9);if(_0x37e0f9===_0x984a33(0x356)||_0x37e0f9===_0x984a33(0x1f5)){const _0x35d37a=$(_0x984a33(0x278));_0x35d37a&&(_0x35d37a[_0x984a33(0x269)]=![],toast('Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.',0x7d0));try{document[_0x984a33(0x192)]['style'][_0x984a33(0x13d)](_0x984a33(0x149),_0x984a33(0x1cf));}catch(_0x2dc57f){}}else{const _0xe707f2=$(_0x984a33(0x278));_0xe707f2&&(_0xe707f2[_0x984a33(0x269)]=!![]);try{updateYouTubePlayer();}catch(_0x2dd123){}}}),on($(_0x522de3(0x3a8)),_0x522de3(0x443),openSettings),on($(_0x522de3(0x42b)),_0x522de3(0x443),()=>{const _0x2c9477=_0x522de3;switchView('topics'),$(_0x2c9477(0x3b8))['click']();}),on($('#btnDashboard'),_0x522de3(0x443),()=>{const _0x279a43=_0x522de3;renderDashboard(),$(_0x279a43(0x2a8))[_0x279a43(0x1de)][_0x279a43(0x347)](_0x279a43(0x384));}),on($('#btnCloseDashboard'),_0x522de3(0x443),()=>{const _0x56ab9b=_0x522de3;$(_0x56ab9b(0x2a8))[_0x56ab9b(0x1de)][_0x56ab9b(0x178)]('show');}),on($(_0x522de3(0x1a4)),_0x522de3(0x443),closeSettings),on($(_0x522de3(0x3dc)),'click',saveSettings),on($(_0x522de3(0x2f8)),_0x522de3(0x443),setDefaults),on($(_0x522de3(0x1ea)),_0x522de3(0x443),()=>{ensureAudio(),playSound('work_end');}),on($(_0x522de3(0x143)),_0x522de3(0x443),_0x5d8690=>{const _0x194d61=_0x522de3;_0x5d8690['preventDefault']();const _0x437c80=$(_0x194d61(0x19c));if(_0x437c80)_0x437c80[_0x194d61(0x1de)][_0x194d61(0x331)]('hidden');}),on($('#btnSaveNote'),_0x522de3(0x443),async()=>{const _0x1b7c22=_0x522de3,_0x922e39=getCurrentSubtopic();if(!_0x922e39)return;const _0x279def=pendingNoteSessionId,_0x7615a7=_0x922e39[_0x1b7c22(0x423)][_0x1b7c22(0x137)](_0xaeff5a=>_0xaeff5a['id']===_0x279def);_0x7615a7&&(_0x7615a7['note']=$('#noteText')[_0x1b7c22(0x1ae)][_0x1b7c22(0x13e)](),await saveData(),renderStatsHistory(),toast(_0x1b7c22(0x333))),closeNoteModal();}),on($(_0x522de3(0x3d2)),_0x522de3(0x443),()=>closeNoteModal()),on($(_0x522de3(0x3bc)),_0x522de3(0x443),addGeneralNote),on($(_0x522de3(0x21c)),_0x522de3(0x443),handleSummarizeNote),on($(_0x522de3(0x37c)),_0x522de3(0x443),handleSendMessage),on($(_0x522de3(0x387)),_0x522de3(0x1cc),_0x46291c=>{const _0xe6ab35=_0x522de3;if(_0x46291c[_0xe6ab35(0x3f1)]==='Enter')handleSendMessage();}),$$(_0x522de3(0x25a))[_0x522de3(0x1a1)](_0x2022a5=>{on(_0x2022a5,'click',()=>{const _0x221478=_0xbc78,_0x4e58aa=_0x2022a5[_0x221478(0x44e)][_0x221478(0x281)];$(_0x221478(0x387))[_0x221478(0x1ae)]=_0x4e58aa,$(_0x221478(0x387))[_0x221478(0x171)]();});}),on($(_0x522de3(0x1fa)),'click',clearChat),on($(_0x522de3(0x426)),_0x522de3(0x443),addSubtopicTask),on($(_0x522de3(0x162)),_0x522de3(0x1cc),_0x814e8a=>{const _0x26de77=_0x522de3;if(_0x814e8a[_0x26de77(0x3f1)]===_0x26de77(0x289))addSubtopicTask();}),on($(_0x522de3(0x15e)),_0x522de3(0x443),toggleYtSound),on($('#btnEnableSound'),_0x522de3(0x443),()=>{ensureAudio(),unlockAudioChain();}),on($(_0x522de3(0x3ef)),_0x522de3(0x214),_0x5b7021=>{const _0x29db74=_0x522de3,_0x586aeb=parseInt(_0x5b7021[_0x29db74(0x402)][_0x29db74(0x1ae)],0xa);ytPlayer&&ytPlayer[_0x29db74(0x422)]&&ytPlayer[_0x29db74(0x422)](_0x586aeb);}),on($(_0x522de3(0x3d4)),_0x522de3(0x214),handleYoutubeUrlInput),$$(_0x522de3(0x31a))[_0x522de3(0x1a1)](_0x202a07=>{const _0x2b63b0=_0x522de3;_0x202a07['addEventListener'](_0x2b63b0(0x443),()=>{const _0x289211=_0x2b63b0,_0x91bc06=_0x202a07['dataset'][_0x289211(0x30d)],_0x45a284=data?.[_0x289211(0x3e8)]?.['currentView']||'timer';if(_0x45a284===_0x91bc06&&_0x91bc06!==_0x289211(0x3cd))switchView(_0x289211(0x3cd));else switchView(_0x91bc06);});}),$$('.tab-btn')[_0x522de3(0x1a1)](_0x6d9417=>{const _0x52171a=_0x522de3;_0x6d9417[_0x52171a(0x399)]('click',()=>{const _0x24a615=_0x52171a,_0x554670=_0x6d9417[_0x24a615(0x44e)][_0x24a615(0x1eb)],_0x13c951=_0x6d9417[_0x24a615(0x366)](_0x24a615(0x439));if(!_0x13c951)return;_0x13c951[_0x24a615(0x145)](_0x24a615(0x2a4))[_0x24a615(0x1a1)](_0x450dbd=>_0x450dbd[_0x24a615(0x1de)]['remove'](_0x24a615(0x371))),_0x6d9417[_0x24a615(0x1de)][_0x24a615(0x347)](_0x24a615(0x371)),_0x13c951[_0x24a615(0x145)]('.tab-content')['forEach'](_0x255691=>{const _0x47123e=_0x24a615;_0x255691[_0x47123e(0x1de)][_0x47123e(0x178)]('active'),_0x255691['style'][_0x47123e(0x2a9)]='none';});const _0x40ff2d=_0x13c951[_0x24a615(0x253)]('#'+_0x554670);_0x40ff2d&&(_0x40ff2d['classList'][_0x24a615(0x347)](_0x24a615(0x371)),_0x40ff2d['style']['display']='block',_0x13c951[_0x24a615(0x366)]('#modalSettings')&&(_0x40ff2d[_0x24a615(0x44b)][_0x24a615(0x2a9)]='flex'));});});const _0x4448cd=$(_0x522de3(0x363));function _0x5080f0(_0x92e6ef,_0x3e8c14=null){const _0x12f907=_0x522de3;try{document[_0x12f907(0x208)](_0x12f907(0x317),![],!![]);}catch(_0xa52f38){}try{document['execCommand'](_0x92e6ef,![],_0x3e8c14);}catch(_0x82b263){}if(_0x4448cd)_0x4448cd[_0x12f907(0x171)]();}on($(_0x522de3(0x2b1)),_0x522de3(0x443),()=>_0x5080f0('bold')),on($(_0x522de3(0x134)),_0x522de3(0x443),()=>_0x5080f0(_0x522de3(0x251))),on($(_0x522de3(0x393)),_0x522de3(0x443),()=>_0x5080f0(_0x522de3(0x17d),_0x522de3(0x135))),on($(_0x522de3(0x170)),_0x522de3(0x443),()=>_0x5080f0('insertOrderedList')),on($(_0x522de3(0x362)),_0x522de3(0x443),()=>_0x5080f0(_0x522de3(0x40d)));const _0x4d2b1f=$('.color-picker-wrapper'),_0x431d2f=$('.color-palette');on($('#toolColor'),'click',_0x200ae9=>{const _0x14212d=_0x522de3;if(!_0x431d2f)return;_0x200ae9[_0x14212d(0x220)](),_0x431d2f[_0x14212d(0x1de)][_0x14212d(0x331)](_0x14212d(0x280));}),$$('.color-swatch')[_0x522de3(0x1a1)](_0x509ad1=>{on(_0x509ad1,'click',_0x3d5023=>{const _0x1c8b3d=_0xbc78;_0x3d5023[_0x1c8b3d(0x23a)]();const _0x10825f=_0x509ad1[_0x1c8b3d(0x44e)][_0x1c8b3d(0x3aa)]||'';let _0xdf3ee2=_0x10825f;try{const _0x93a819=_0x10825f['match'](/--[a-zA-Z0-9_-]+/);if(_0x93a819)_0xdf3ee2=getComputedStyle(document[_0x1c8b3d(0x192)])[_0x1c8b3d(0x1e3)](_0x93a819[0x0])[_0x1c8b3d(0x13e)]();}catch(_0x28cb1d){}_0x5080f0('foreColor',_0xdf3ee2);if(_0x431d2f)_0x431d2f[_0x1c8b3d(0x1de)][_0x1c8b3d(0x347)](_0x1c8b3d(0x280));});}),on(document,_0x522de3(0x443),_0x54e657=>{const _0x468206=_0x522de3;if(!_0x4d2b1f||!_0x431d2f)return;!_0x4d2b1f[_0x468206(0x14d)](_0x54e657[_0x468206(0x402)])&&!_0x431d2f[_0x468206(0x1de)][_0x468206(0x14d)](_0x468206(0x280))&&_0x431d2f[_0x468206(0x1de)]['add'](_0x468206(0x280));});function _0x336267(_0x1d3a26){const _0x5aa348=_0x522de3,_0x546d56=getCurrentSubtopic();if(!_0x546d56){toast(_0x5aa348(0x226));return;}_0x546d56[_0x5aa348(0x34c)]=Array[_0x5aa348(0x164)](_0x546d56[_0x5aa348(0x34c)])?_0x546d56['methods']:[];const _0x7152dd=_0x546d56[_0x5aa348(0x34c)],_0x5ef438=_0x1d3a26?_0x7152dd[_0x5aa348(0x137)](_0x451e37=>_0x451e37['id']===_0x1d3a26):null;$('#methodEditorId')[_0x5aa348(0x1ae)]=_0x5ef438&&_0x5ef438['id']||'',$(_0x5aa348(0x14a))[_0x5aa348(0x181)]=_0x5ef438?_0x5aa348(0x16a):_0x5aa348(0x2d3),$(_0x5aa348(0x1d6))[_0x5aa348(0x1ae)]=_0x5ef438&&_0x5ef438[_0x5aa348(0x44a)]||'';const _0x1e2549=$(_0x5aa348(0x363));if(_0x1e2549)_0x1e2549['innerHTML']=_0x5ef438&&_0x5ef438[_0x5aa348(0x1e9)]||'';$(_0x5aa348(0x25f))[_0x5aa348(0x1de)][_0x5aa348(0x347)](_0x5aa348(0x384));try{trapFocus($(_0x5aa348(0x25f)));}catch(_0x1b72a9){}try{const _0x194259=$(_0x5aa348(0x3dd));if(_0x194259){const _0x23c532=!!(data?.[_0x5aa348(0x3e8)]?.[_0x5aa348(0x41b)]&&data[_0x5aa348(0x3e8)][_0x5aa348(0x41b)][_0x5aa348(0x13e)]());_0x194259[_0x5aa348(0x146)]=!_0x23c532,_0x194259[_0x5aa348(0x44a)]=_0x23c532?_0x5aa348(0x2ec):_0x5aa348(0x2eb);}}catch(_0x17ccc6){}}on($('#btnCancelMethodEditor'),'click',()=>{const _0x348d94=_0x522de3;$(_0x348d94(0x25f))[_0x348d94(0x1de)][_0x348d94(0x178)](_0x348d94(0x384));try{releaseFocus();}catch(_0xabb1c9){}}),on($(_0x522de3(0x33b)),_0x522de3(0x443),async()=>{const _0x3915d9=_0x522de3,_0xbba64b=getCurrentSubtopic();if(!_0xbba64b){toast(_0x3915d9(0x226));return;}_0xbba64b['methods']=Array[_0x3915d9(0x164)](_0xbba64b[_0x3915d9(0x34c)])?_0xbba64b[_0x3915d9(0x34c)]:[];const _0x33ef4e=$('#methodEditorId')[_0x3915d9(0x1ae)]||uid('m'),_0x287029=($(_0x3915d9(0x1d6))[_0x3915d9(0x1ae)]||'')[_0x3915d9(0x13e)](),_0x3c42fa=$(_0x3915d9(0x363)),_0x4e0932=_0x3c42fa?_0x3c42fa[_0x3915d9(0x382)]||'':'',_0x4cf6ff=_0xbba64b[_0x3915d9(0x34c)]['findIndex'](_0x36e06e=>_0x36e06e['id']===_0x33ef4e),_0xa2bd5={'id':_0x33ef4e,'title':_0x287029,'content':_0x4e0932};if(_0x4cf6ff>=0x0)_0xbba64b[_0x3915d9(0x34c)][_0x4cf6ff]=_0xa2bd5;else _0xbba64b[_0x3915d9(0x34c)]['unshift'](_0xa2bd5);await storageManager[_0x3915d9(0x38c)](_0x3915d9(0x1cd),_0xbba64b),renderMethods(),$(_0x3915d9(0x25f))[_0x3915d9(0x1de)][_0x3915d9(0x178)](_0x3915d9(0x384));try{releaseFocus();}catch(_0x1866ab){}}),on($(_0x522de3(0x3dd)),'click',async()=>{const _0x2a50db=_0x522de3,_0x40b40c=$(_0x2a50db(0x363));if(!_0x40b40c)return;const _0x55c4b0=(_0x40b40c[_0x2a50db(0x181)]||'')['trim']();if(!_0x55c4b0||_0x55c4b0[_0x2a50db(0x2ae)]<0x14){toast(_0x2a50db(0x279));return;}const _0xa42d94=$(_0x2a50db(0x3dd));_0xa42d94&&(_0xa42d94[_0x2a50db(0x146)]=!![],_0xa42d94[_0x2a50db(0x382)]=_0x2a50db(0x231));const _0x5c8ebb='Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22'+_0x55c4b0+'\x22',_0x3a2371=await callGeminiAPI(_0x5c8ebb);_0x3a2371?(_0x40b40c[_0x2a50db(0x382)]=_0x3a2371,toast('AI\x20đã\x20định\x20dạng\x20xong!')):toast('AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.'),_0xa42d94&&(_0xa42d94[_0x2a50db(0x146)]=![],_0xa42d94[_0x2a50db(0x382)]='✨\x20Tự\x20động\x20định\x20dạng');}),on($(_0x522de3(0x367)),_0x522de3(0x443),()=>{const _0x50bb78=_0x522de3;if(!getCurrentSubtopic()){toast(_0x50bb78(0x226));return;}_0x336267();});const _0x2a64b1=document['querySelector'](_0x522de3(0x3d1));_0x2a64b1&&_0x2a64b1['addEventListener'](_0x522de3(0x443),_0x21968b=>{const _0x4f5f15=_0x522de3,_0x2982d1=_0x21968b['target'][_0x4f5f15(0x366)]&&_0x21968b[_0x4f5f15(0x402)][_0x4f5f15(0x366)]('.method-edit'),_0x5c604c=!_0x2982d1&&_0x21968b[_0x4f5f15(0x402)][_0x4f5f15(0x366)]&&_0x21968b[_0x4f5f15(0x402)][_0x4f5f15(0x366)](_0x4f5f15(0x2f2));if(_0x2982d1){_0x21968b['preventDefault'](),_0x21968b[_0x4f5f15(0x220)]();const _0x2db907=_0x2982d1[_0x4f5f15(0x44e)]['id'];if(_0x2db907)_0x336267(_0x2db907);return;}if(_0x5c604c){_0x21968b[_0x4f5f15(0x23a)](),_0x21968b['stopPropagation']();const _0x49feff=_0x5c604c['dataset']['id'];if(!_0x49feff)return;const _0x1c53bf=getCurrentSubtopic();if(!_0x1c53bf)return;_0x1c53bf[_0x4f5f15(0x34c)]=Array[_0x4f5f15(0x164)](_0x1c53bf[_0x4f5f15(0x34c)])?_0x1c53bf[_0x4f5f15(0x34c)]:[];const _0x1738ec=_0x1c53bf[_0x4f5f15(0x34c)]['find'](_0x5df6a4=>_0x5df6a4['id']===_0x49feff);if(!_0x1738ec)return;showConfirmModal(_0x4f5f15(0x1d8),_0x4f5f15(0x3d0)+(_0x1738ec['title']||'')+'\x22?',async _0x2917a8=>{const _0x733e30=_0x4f5f15;if(!_0x2917a8)return;_0x1c53bf[_0x733e30(0x34c)]=_0x1c53bf[_0x733e30(0x34c)][_0x733e30(0x273)](_0xe1ee2d=>_0xe1ee2d['id']!==_0x49feff),await storageManager['update'](_0x733e30(0x1cd),_0x1c53bf),renderMethods();});}});$$(_0x522de3(0x1cb))['forEach'](_0x17080b=>{const _0x239af9=_0x522de3;_0x17080b[_0x239af9(0x399)](_0x239af9(0x443),()=>{const _0x22ee52=_0x239af9;editingPreset=_0x17080b[_0x22ee52(0x44e)][_0x22ee52(0x133)],highlightPresetSelector(),loadEditingPresetFields();});}),$$(_0x522de3(0x41d))[_0x522de3(0x1a1)](_0x50dbd3=>{const _0x2871c2=_0x522de3;_0x50dbd3[_0x2871c2(0x399)](_0x2871c2(0x443),_0x8c660=>{const _0x165de5=_0x2871c2,_0x2fbd02=_0x8c660[_0x165de5(0x402)][_0x165de5(0x44e)][_0x165de5(0x3db)],_0x3b72be=data['settings']['preset'];if(_0x2fbd02===_0x3b72be)return;timer[_0x165de5(0x184)]!==_0x165de5(0x1d5)?showConfirmModal(_0x165de5(0x1c5),_0x165de5(0x418)+_0x2fbd02+_0x165de5(0x20e),_0x4e9032=>{const _0x17ec70=_0x165de5;_0x4e9032&&(timer['reset'](),timer['setPreset'](_0x2fbd02),renderAll(),toast(_0x17ec70(0x2cb)+_0x2fbd02+'.'));}):(timer[_0x165de5(0x198)](_0x2fbd02),renderAll(),toast(_0x165de5(0x2cb)+_0x2fbd02+'.'));});}),on($('#btnStart'),_0x522de3(0x443),()=>timer[_0x522de3(0x315)]()),on($('#btnFinishFlow'),_0x522de3(0x443),()=>timer[_0x522de3(0x168)]()),on($('#btnPause'),_0x522de3(0x443),()=>timer[_0x522de3(0x27f)]()),on($(_0x522de3(0x13b)),_0x522de3(0x443),()=>timer[_0x522de3(0x1af)]()),on($(_0x522de3(0x283)),_0x522de3(0x443),()=>timer['skip']()),on($(_0x522de3(0x2e2)),'click',()=>timer['reset']()),on($('#btnBreakEarly'),_0x522de3(0x443),()=>timer['beginBreak']()),on($('#uploadBg'),_0x522de3(0x304),_0x204a7c=>{const _0x18421b=_0x522de3;handleFileUpload(_0x204a7c[_0x18421b(0x402)][_0x18421b(0x241)][0x0],async _0xa829a6=>{const _0x360358=_0x18421b;data['settings']['customBg']=_0xa829a6,await saveData(),applyCustomBg(),toast(_0x360358(0x2ba));}),_0x204a7c[_0x18421b(0x402)][_0x18421b(0x1ae)]=null;}),on($(_0x522de3(0x173)),_0x522de3(0x443),async()=>{const _0x459045=_0x522de3;data[_0x459045(0x3e8)][_0x459045(0x3b2)]='',data[_0x459045(0x3e8)][_0x459045(0x448)]=![],await saveData(),applyCustomBg(),toast(_0x459045(0x33a)),$(_0x459045(0x36a))[_0x459045(0x1de)][_0x459045(0x14d)]('show')&&openSettings();}),on($(_0x522de3(0x357)),'change',_0x2545fe=>{const _0x54c294=_0x522de3;handleFileUpload(_0x2545fe[_0x54c294(0x402)]['files'][0x0],async _0x5a6ebc=>{const _0x56f02e=_0x54c294;data['settings']['customSounds']['work_end']=_0x5a6ebc,await saveData(),toast(_0x56f02e(0x428));}),_0x2545fe[_0x54c294(0x402)]['value']=null;}),on($('#uploadSoundBreak'),_0x522de3(0x304),_0x187145=>{const _0x4126da=_0x522de3;handleFileUpload(_0x187145[_0x4126da(0x402)][_0x4126da(0x241)][0x0],async _0x5ae4bc=>{const _0x3c043a=_0x4126da;data['settings']['customSounds'][_0x3c043a(0x392)]=_0x5ae4bc,await saveData(),toast('Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.');}),_0x187145[_0x4126da(0x402)][_0x4126da(0x1ae)]=null;}),on($(_0x522de3(0x22e)),'change',_0x349a65=>{const _0x758728=_0x522de3;handleFileUpload(_0x349a65[_0x758728(0x402)][_0x758728(0x241)][0x0],async _0x3fe9c7=>{const _0x5f1b2b=_0x758728;data[_0x5f1b2b(0x3e8)][_0x5f1b2b(0x2f1)][_0x5f1b2b(0x1bd)]=_0x3fe9c7,await saveData(),toast(_0x5f1b2b(0x3e7));}),_0x349a65[_0x758728(0x402)][_0x758728(0x1ae)]=null;}),on($('#btnFullscreen'),_0x522de3(0x443),toggleFullScreen),document[_0x522de3(0x399)]('fullscreenchange',updateFullscreenButton),window['addEventListener'](_0x522de3(0x1cc),_0x42d25e=>{const _0xee19b2=_0x522de3,_0x489fa8=_0x42d25e['target'],_0x3d1d30=(_0x489fa8[_0xee19b2(0x15b)]||'')[_0xee19b2(0x3ee)](),_0x5986b0=[_0xee19b2(0x214),'textarea','select']['includes'](_0x3d1d30)||_0x489fa8[_0xee19b2(0x3d8)];if(_0x42d25e[_0xee19b2(0x30e)]==='Space'&&!_0x5986b0){_0x42d25e[_0xee19b2(0x23a)]();if(timer[_0xee19b2(0x184)]===_0xee19b2(0x1d5)||timer[_0xee19b2(0x184)]===_0xee19b2(0x35b))timer[_0xee19b2(0x315)]();else timer[_0xee19b2(0x27f)]();}(_0x42d25e[_0xee19b2(0x3f1)]==='n'||_0x42d25e[_0xee19b2(0x3f1)]==='N')&&(!_0x5986b0&&(_0x42d25e[_0xee19b2(0x23a)](),timer['skip']()));if(_0x42d25e[_0xee19b2(0x3f1)]===_0xee19b2(0x43c)){$$(_0xee19b2(0x2c6))[_0xee19b2(0x1a1)](_0x4680ae=>_0x4680ae[_0xee19b2(0x1de)][_0xee19b2(0x178)](_0xee19b2(0x384)));try{releaseFocus();}catch(_0x3161be){}}if(_0x42d25e[_0xee19b2(0x1c9)]&&!_0x5986b0){if(_0x42d25e[_0xee19b2(0x3f1)]===_0xee19b2(0x3cc))_0x42d25e[_0xee19b2(0x23a)](),_0x5c3fc4(0x0,-0xa);else{if(_0x42d25e[_0xee19b2(0x3f1)]===_0xee19b2(0x42d))_0x42d25e[_0xee19b2(0x23a)](),_0x5c3fc4(0x0,0xa);else{if(_0x42d25e[_0xee19b2(0x3f1)]==='ArrowLeft')_0x42d25e['preventDefault'](),_0x5c3fc4(-0xa,0x0);else _0x42d25e[_0xee19b2(0x3f1)]==='ArrowRight'&&(_0x42d25e[_0xee19b2(0x23a)](),_0x5c3fc4(0xa,0x0));}}}}),$$(_0x522de3(0x2c6))[_0x522de3(0x1a1)](_0x15b504=>_0x15b504[_0x522de3(0x399)](_0x522de3(0x443),_0x1ab58f=>{const _0x1d12da=_0x522de3;if(_0x1ab58f&&_0x1ab58f[_0x1d12da(0x402)]&&_0x1ab58f[_0x1d12da(0x402)]['id']===_0x1d12da(0x30f))return;if(_0x1ab58f['target']===_0x15b504){_0x15b504[_0x1d12da(0x1de)]['remove']('show');try{releaseFocus();}catch(_0x30344a){}}})),window[_0x522de3(0x399)](_0x522de3(0x443),_0x3e50e4=>{const _0x56a691=_0x522de3;!_0x3e50e4[_0x56a691(0x402)][_0x56a691(0x366)](_0x56a691(0x34d))&&!_0x3e50e4[_0x56a691(0x402)]['closest'](_0x56a691(0x263))&&closeAllMenus();});try{const _0xccdc24=document[_0x522de3(0x253)]('.app-content');if(_0xccdc24)_0xccdc24[_0x522de3(0x399)](_0x522de3(0x2ad),closeAllMenus);}catch(_0x1c90e7){}try{window['addEventListener'](_0x522de3(0x2ad),closeAllMenus,!![]);}catch(_0xc0e5e2){}window['addEventListener'](_0x522de3(0x391),()=>timer[_0x522de3(0x42f)](!![]));try{const _0x48c413=Array[_0x522de3(0x17f)](document[_0x522de3(0x145)](_0x522de3(0x141)));_0x48c413[_0x522de3(0x2ae)]&&_0x48c413[_0x522de3(0x1a1)](_0x32792b=>{const _0x557209=_0x522de3;_0x32792b[_0x557209(0x399)](_0x557209(0x331),()=>{const _0xb2b2be=_0x557209;_0x32792b['open']&&_0x48c413[_0xb2b2be(0x1a1)](_0x52c622=>{const _0x48bc4e=_0xb2b2be;if(_0x52c622!==_0x32792b)_0x52c622[_0x48bc4e(0x18e)]=![];});});});}catch(_0x29db90){}const _0x4cefb6=$(_0x522de3(0x403));let _0x349405=![],_0x328fa6,_0x3e04bd;_0x4cefb6&&(_0x4cefb6[_0x522de3(0x399)](_0x522de3(0x324),_0x58dbcb=>{const _0x2af41b=_0x522de3;_0x349405=!![];const _0x59cc45=_0x4cefb6['getBoundingClientRect']();_0x328fa6=_0x58dbcb[_0x2af41b(0x213)]-_0x59cc45['left'],_0x3e04bd=_0x58dbcb['clientY']-_0x59cc45[_0x2af41b(0x20b)],_0x4cefb6['style'][_0x2af41b(0x42c)]=_0x2af41b(0x1cf);}),document[_0x522de3(0x399)](_0x522de3(0x293),_0x19d7f2=>{const _0x3e8925=_0x522de3;if(!_0x349405)return;let _0x5e176b=_0x19d7f2['clientX']-_0x328fa6,_0x514a81=_0x19d7f2[_0x3e8925(0x36d)]-_0x3e04bd;const _0x409539=window[_0x3e8925(0x3bb)]-_0x4cefb6[_0x3e8925(0x37a)],_0x182628=window[_0x3e8925(0x375)]-_0x4cefb6[_0x3e8925(0x233)];_0x5e176b=Math[_0x3e8925(0x344)](0x0,Math[_0x3e8925(0x445)](_0x5e176b,_0x409539)),_0x514a81=Math['max'](0x0,Math[_0x3e8925(0x445)](_0x514a81,_0x182628)),_0x4cefb6[_0x3e8925(0x44b)][_0x3e8925(0x29a)]=_0x5e176b+'px',_0x4cefb6['style']['top']=_0x514a81+'px',_0x4cefb6[_0x3e8925(0x44b)][_0x3e8925(0x211)]=_0x3e8925(0x341),_0x4cefb6[_0x3e8925(0x44b)][_0x3e8925(0x390)]=_0x3e8925(0x341);}),document[_0x522de3(0x399)]('mouseup',()=>{const _0x51d5b5=_0x522de3;if(!_0x349405)return;_0x349405=![],_0x4cefb6[_0x51d5b5(0x44b)][_0x51d5b5(0x42c)]='';}));function _0xf8f4c(_0x1f09ad){const _0x57e6a9=_0x522de3,_0x2b06ef=$('#draggableTimer');if(!_0x2b06ef)return;_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x306)]=_0x57e6a9(0x406),_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x42c)]='',_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x29a)]='auto',_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x20b)]=_0x57e6a9(0x341),_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x390)]=_0x57e6a9(0x341),_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x211)]=_0x57e6a9(0x341);const _0x2d0a8a=0x10;_0x1f09ad==='tl'&&(_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x29a)]=_0x2d0a8a+'px',_0x2b06ef[_0x57e6a9(0x44b)]['top']=_0x2d0a8a+'px'),_0x1f09ad==='tr'&&(_0x2b06ef[_0x57e6a9(0x44b)]['right']=_0x2d0a8a+'px',_0x2b06ef['style']['top']=_0x2d0a8a+'px'),_0x1f09ad==='bl'&&(_0x2b06ef[_0x57e6a9(0x44b)]['left']=_0x2d0a8a+'px',_0x2b06ef['style']['bottom']=_0x2d0a8a+'px'),_0x1f09ad==='br'&&(_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x390)]=_0x2d0a8a+'px',_0x2b06ef[_0x57e6a9(0x44b)][_0x57e6a9(0x211)]=_0x2d0a8a+'px');}function _0x5c3fc4(_0x5940ac,_0x5ea718){const _0x476906=_0x522de3,_0x2c44c3=$(_0x476906(0x403));if(!_0x2c44c3)return;const _0x4aa283=_0x2c44c3[_0x476906(0x2be)](),_0x101f0a=Math[_0x476906(0x344)](0x0,Math[_0x476906(0x445)](_0x4aa283[_0x476906(0x29a)]+_0x5940ac,window[_0x476906(0x3bb)]-_0x2c44c3[_0x476906(0x37a)])),_0x49c58b=Math[_0x476906(0x344)](0x0,Math[_0x476906(0x445)](_0x4aa283[_0x476906(0x20b)]+_0x5ea718,window['innerHeight']-_0x2c44c3['offsetHeight']));_0x2c44c3[_0x476906(0x44b)][_0x476906(0x29a)]=_0x101f0a+'px',_0x2c44c3[_0x476906(0x44b)][_0x476906(0x20b)]=_0x49c58b+'px',_0x2c44c3[_0x476906(0x44b)][_0x476906(0x390)]=_0x476906(0x341),_0x2c44c3[_0x476906(0x44b)][_0x476906(0x211)]=_0x476906(0x341);}}function toggleBackgroundView(){const _0x3561e0=_0x287dc7,_0x15a9f0=document['body'];_0x15a9f0[_0x3561e0(0x1de)][_0x3561e0(0x331)](_0x3561e0(0x3e2));const _0x451e25=_0x15a9f0['classList']['contains'](_0x3561e0(0x3e2)),_0x41d65c=$(_0x3561e0(0x16c));if(!_0x41d65c)return;_0x451e25?(_0x41d65c['title']=_0x3561e0(0x427),_0x41d65c['innerHTML']=_0x3561e0(0x401)):(_0x41d65c[_0x3561e0(0x44a)]=_0x3561e0(0x369),_0x41d65c[_0x3561e0(0x382)]=_0x3561e0(0x2d7));}function updateMainViewVisibility(){const _0x4867cf=_0x287dc7,_0x4c5f4c=!!getCurrentSubtopic(),_0x325fe5=$(_0x4867cf(0x41a)),_0x3226d5=$(_0x4867cf(0x2e4));_0x3226d5&&_0x3226d5['classList']['toggle']('hidden',_0x4c5f4c),_0x325fe5&&(_0x4c5f4c?_0x325fe5[_0x4867cf(0x1de)][_0x4867cf(0x178)]('no-subtopic-selected'):_0x325fe5[_0x4867cf(0x1de)][_0x4867cf(0x347)](_0x4867cf(0x359)));}function updatePresetButtonsText(){const _0x488e89=_0x287dc7,_0x51361b=data[_0x488e89(0x3e8)],_0x59070b=_0x51361b[_0x488e89(0x1a7)],_0x103b43=_0x51361b[_0x488e89(0x2a0)],_0x109735=_0x51361b[_0x488e89(0x22a)]['A_work'],_0x4b8a7e=_0x51361b['durations'][_0x488e89(0x22d)],_0x174fef=$('#btnPresetA'),_0x5f47dd=$(_0x488e89(0x34f)),_0x1f8d59=$(_0x488e89(0x2a1));_0x174fef&&(_0x174fef[_0x488e89(0x181)]=_0x59070b+'×'+_0x109735+_0x488e89(0x15c)),_0x5f47dd&&(_0x5f47dd[_0x488e89(0x181)]=_0x103b43+'×'+_0x4b8a7e+'\x20(B)'),_0x1f8d59&&(_0x1f8d59[_0x488e89(0x181)]=_0x488e89(0x17b));}function renderAll(){const _0x3f23e4=_0x287dc7;updatePresetButtonsText();const _0x38d06e=data['settings'][_0x3f23e4(0x3db)];$$(_0x3f23e4(0x41d))[_0x3f23e4(0x1a1)](_0x5d7ffc=>{const _0x48bb9c=_0x3f23e4,_0x543b5a=_0x5d7ffc[_0x48bb9c(0x44e)]['preset']===_0x38d06e;_0x5d7ffc[_0x48bb9c(0x1de)][_0x48bb9c(0x331)](_0x48bb9c(0x31f),_0x543b5a),_0x5d7ffc[_0x48bb9c(0x1de)][_0x48bb9c(0x331)](_0x48bb9c(0x18c),!_0x543b5a),_0x5d7ffc[_0x48bb9c(0x286)]('aria-pressed',_0x543b5a);}),updateMainViewVisibility(),timer[_0x3f23e4(0x198)](data[_0x3f23e4(0x3e8)][_0x3f23e4(0x3db)],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data[_0x3f23e4(0x3e8)]['currentView']);}function toggleFullScreen(){const _0x33817a=_0x287dc7;!document[_0x33817a(0x350)]?document['documentElement']['requestFullscreen']()[_0x33817a(0x2db)](_0xaac5b=>{const _0x5dc985=_0x33817a;toast(_0x5dc985(0x229)+_0xaac5b[_0x5dc985(0x2fc)]);}):document[_0x33817a(0x22b)]&&document[_0x33817a(0x22b)]();}function updateFullscreenButton(){const _0x336b25=_0x287dc7,_0x5009d2=$(_0x336b25(0x3eb));document['fullscreenElement']?(_0x5009d2[_0x336b25(0x382)]='↙️',_0x5009d2[_0x336b25(0x44a)]=_0x336b25(0x26b)):(_0x5009d2[_0x336b25(0x382)]='↗️',_0x5009d2[_0x336b25(0x44a)]=_0x336b25(0x444));}async function initializeApp(){const _0x599e75=_0x287dc7;try{await storageManager[_0x599e75(0x160)]();const [_0x330a3e,_0x10a729,_0x4bc5a0]=await Promise['all']([storageManager[_0x599e75(0x1ed)](),storageManager[_0x599e75(0x398)]('topics'),storageManager[_0x599e75(0x398)]('subtopics')]);let _0x2d2921;if(!_0x330a3e){const _0x140404=JSON[_0x599e75(0x23b)](JSON[_0x599e75(0x194)](defaults));await storageManager[_0x599e75(0x12d)](_0x140404[_0x599e75(0x3e8)]);for(const _0x407645 of _0x140404[_0x599e75(0x309)]){const {subtopics:_0x5d24fe,..._0x14fb23}=_0x407645;await storageManager['add']('topics',_0x14fb23);for(const _0x4a05a5 of _0x5d24fe){await storageManager[_0x599e75(0x347)]('subtopics',{..._0x4a05a5,'topicId':_0x407645['id']});}}_0x2d2921=_0x140404;}else{const _0x336958={};for(const _0x1d319a of _0x10a729)_0x336958[_0x1d319a['id']]={..._0x1d319a,'subtopics':[]};for(const _0x2ab6f2 of _0x4bc5a0)_0x336958[_0x2ab6f2[_0x599e75(0x2a5)]]?.[_0x599e75(0x1cd)]['push'](_0x2ab6f2);_0x2d2921={'version':defaults[_0x599e75(0x227)],'settings':_0x330a3e,'topics':Object['values'](_0x336958)};}data=window[_0x599e75(0x308)]=_0x2d2921,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0x599e75(0x21e)](data);}catch(_0x233094){console['warn'](_0x599e75(0x2f7),_0x233094);}bindEvents(),applyTheme();}catch(_0x3acbe6){console[_0x599e75(0x206)](_0x599e75(0x3ce),_0x3acbe6),toast('Lỗi\x20khởi\x20tạo:\x20'+_0x3acbe6['message']);}}callGeminiAPI=async function(_0x488d58,_0x417496=0x3,_0x3afc87=0x3e8){const _0x27a112=_0x287dc7,_0x482403=data?.[_0x27a112(0x3e8)]?.['apiKey']||'';if(!_0x482403)return toast(_0x27a112(0x305)),null;const _0x5a3d8b=_0x27a112(0x25d)+_0x482403,_0x38873d={'contents':[{'role':_0x27a112(0x1c0),'parts':[{'text':_0x488d58}]}]};try{const _0x1dd535=await fetch(_0x5a3d8b,{'method':_0x27a112(0x3e3),'headers':{'Content-Type':_0x27a112(0x166)},'body':JSON[_0x27a112(0x194)](_0x38873d)});if(!_0x1dd535['ok']){if(_0x1dd535[_0x27a112(0x25c)]===0x1ad&&_0x417496>0x0)return await new Promise(_0x367c15=>setTimeout(_0x367c15,_0x3afc87)),callGeminiAPI(_0x488d58,_0x417496-0x1,_0x3afc87*0x2);let _0x379ad9=null;try{_0x379ad9=await _0x1dd535[_0x27a112(0x15d)]();}catch(_0x514d29){}let _0xb0caf6=_0x27a112(0x1c3)+_0x1dd535[_0x27a112(0x25c)];if(_0x1dd535[_0x27a112(0x25c)]===0x190)_0xb0caf6=_0x27a112(0x138);else{if(_0x1dd535['status']===0x1ad)_0xb0caf6=_0x27a112(0x2b7);else _0x379ad9?.['error']?.[_0x27a112(0x2fc)]&&(_0xb0caf6=_0x27a112(0x1b9)+_0x379ad9['error']['message']);}return toast(_0xb0caf6,0xfa0),console[_0x27a112(0x206)]('Gemini\x20API\x20Error:',_0x379ad9||_0x1dd535[_0x27a112(0x2c3)]),null;}const _0x38859c=await _0x1dd535[_0x27a112(0x15d)]();if(_0x38859c[_0x27a112(0x34e)]&&_0x38859c[_0x27a112(0x34e)][0x0]?.[_0x27a112(0x1e9)]?.[_0x27a112(0x3a2)]?.[0x0]?.[_0x27a112(0x13a)])return formatGeminiResponse(_0x38859c[_0x27a112(0x34e)][0x0][_0x27a112(0x1e9)][_0x27a112(0x3a2)][0x0][_0x27a112(0x13a)]);else{console['error'](_0x27a112(0x3ca),_0x38859c);if(_0x38859c['promptFeedback']?.[_0x27a112(0x2b2)])return _0x27a112(0x1a3)+_0x38859c[_0x27a112(0x239)][_0x27a112(0x2b2)]+_0x27a112(0x39a);return'Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.';}}catch(_0x2d33bd){return console['error'](_0x27a112(0x174),_0x2d33bd),toast(_0x27a112(0x1b5),0xfa0),null;}},loadLanguage(localStorage['getItem'](_0x287dc7(0x242))||'vi')['then'](initializeApp);
    </script>
</body>
</html>

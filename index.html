<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Ứng dụng Pomodoro hỗ trợ học tập với tích hợp Gemini AI và giao diện hiện đại." />
    <title>Pomodoro Study App — Tích hợp Gemini AI (Giao diện mới)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — PHIÊN BẢN GIAO DIỆN TẬP TRUNG (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Mặc định) - Cập nhật từ file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Thêm biến RGB cho panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: THÊM CÁC THEME MỚI === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: THÊM CÁC THEME MỚI === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Thêm các quy tắc border cho theme light/pastel */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Sửa đổi: bỏ border mặc định */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Sửa đổi */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    /* Nâng khối đang mở menu lên trên các khối khác */
    .topic-item.menu-active { position: relative; z-index: 20; }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Sửa đổi */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Giữ nền trong suốt khi di chuột qua */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Sửa đổi màu */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Sửa đổi màu */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */
    #view-timer .panel-bg hr {
        border: none; /* Bỏ đường viền mặc định */
        height: 1px;  /* Đặt chiều cao cho đường kẻ */
        background-color: var(--muted); /* Sử dụng màu phụ của theme */
        opacity: 0.3; /* Làm cho nó mờ đi, hòa vào nền */
        margin-top: 0; /* Điều chỉnh lại khoảng cách */
    }
    /* === END: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Sửa đổi */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Sửa đổi */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Sửa đổi */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Nâng z-index để nằm trên header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Sửa đổi */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Sửa đổi */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Sửa đổi */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Sửa đổi */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Sửa đổi */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Sửa đổi: chuyển sang nền trắng trong suốt */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Viền trắng mờ */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Tinh chỉnh: sát mẫu hơn */
        border-color: var(--acc);
    }
    /* === START: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Dùng nền đen mờ thay vì trắng mờ */
        border-color: rgba(0, 0, 0, 0.1); /* Viền đen mờ trên theme sáng */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Tăng độ đậm khi focus */
    }
    /* === END: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */

    /* Cải thiện nền và màu chữ cho option trong select theo theme hiện tại */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Sửa đổi */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Giảm/loại bỏ bóng chữ cho theme sáng để tránh nhòe/lóa */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
.method-item[open] summary {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
    [data-theme='light'] .method-item[open] summary,
    [data-theme='pastel'] .method-item[open] summary {
        border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* Method actions inline with summary and show on hover */
    .method-item summary { display: flex; align-items: center; justify-content: space-between; }
    .method-item summary > span { flex: 1; }
    .method-item summary .topic-actions { margin-left: 8px; }
    .method-title { cursor: pointer; }
    .method-item:hover .topic-actions, .method-item:focus-within .topic-actions { opacity: 1; visibility: visible; }

    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Đồng hồ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Đồng hồ</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Chủ đề">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Chủ đề</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Thống kê">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Thống kê</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Kho Tri Thức">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Kho Tri Thức</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Cài đặt">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Cài đặt</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Hướng dẫn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Hướng dẫn</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">Chưa chọn Chủ đề con</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard Tổng quan">📊 Tổng Quan </button>
          <a href="https://forms.gle/EfFqBJFTbFtDo5H4A" target="_blank" rel="noopener noreferrer" class="btn ghost small" title="Gửi phản hồi của bạn">💬 Phản Hồi</a>
          <button class="btn ghost small" id="btnExport" title="Xuất JSON">⬇️ Xuất File</button>
          <label class="btn ghost small" for="importFile" title="Nhập JSON">⬆️ Nhập File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Ẩn/Hiện giao diện">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Toàn màn hình">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Chào mừng đến với Pomodoro Study App!</h3>
                <p>Hãy bắt đầu bằng cách chọn một <strong>Chủ đề con</strong> hoặc tạo Chủ đề/Chủ đề con mới.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Tạo Chủ đề Mới</button>
            </div>
            <div class="presets" role="group" aria-label="Chọn chế độ preset">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">TRẠNG THÁI</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Checklist Hạ nhiệt</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Lưu công việc đang làm (Save/Commit).</li>
                <li>Ghi chú nhanh "Next step".</li>
                <li>Dọn dẹp không gian làm việc.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Bắt đầu (Space)">▶️ Bắt đầu</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="Kết thúc phiên làm việc">🧘 Bắt đầu nghỉ</button>
              <button class="btn" id="btnPause" aria-label="Tạm dừng (Space)">⏸️ Tạm dừng</button>
              <button class="btn" id="btnResume" aria-label="Tiếp tục (Space)">⏵ Tiếp tục</button>
              <button class="btn warn" id="btnSkip" aria-label="Bỏ qua (N)">⏭️ Bỏ qua</button>
              <button class="btn danger" id="btnReset">↺ Đặt lại</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Nghỉ sớm</button>
            </div>
            <div class="tiny">Phím tắt: <strong>Space</strong> = Bắt đầu/Tạm dừng/Tiếp tục, <strong>N</strong> = Tiếp theo/Bỏ qua</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Nhiệm vụ</button>
                <button class="tab-btn" data-tab="notes">Ghi chú</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-do cho chủ đề con này:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Thêm một task mới..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Thêm</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Thêm ghi chú mới..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Thêm ghi chú</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini cho: <span id="currentSubtopicNameChat">(chưa chọn)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Xóa lịch sử">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Giải thích khái niệm chính của chủ đề này">Giải thích khái niệm</button>
                  <button class="btn small ghost" data-prompt="Tạo một dàn ý chi tiết cho chủ đề này">Tạo dàn ý</button>
                  <button class="btn small ghost" data-prompt="Liệt kê 5 câu hỏi ôn tập quan trọng về chủ đề này">Tạo câu hỏi ôn tập</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Hỏi Gemini điều gì đó..." />
                  <button id="btnSendMessage" class="btn acc">Gửi</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Quản lý Chủ đề</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Thêm Chủ đề</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Nhấp mũi tên để mở/đóng danh sách chủ đề con.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
      <script>
        window.addEventListener('DOMContentLoaded', () => {
          try {
            const topicsView = document.querySelector('#view-topics');
            if (!topicsView) return;
            const header = topicsView.querySelector('.row h3');
            if (header) header.textContent = 'Quản lý Chủ đề';
            const addBtn = topicsView.querySelector('#btnAddTopic');
            if (addBtn) addBtn.textContent = '+ Thêm Chủ đề';
            const note = topicsView.querySelector('.footer-note');
            if (note) note.textContent = 'Nhấp mũi tên để mở/đóng danh sách chủ đề con.';
          } catch (e) {}
        });
      </script>
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Thống kê & Lịch sử — <span id="currentSubtopicName">(chưa chọn)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Tổng thời gian</h4><div class="stat-value" id="statTotal">0 phút</div></div>
              <div class="stat-card"><h4>Phiên</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Nhiệm vụ Hoàn thành</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">Lịch sử (LÀM VIỆC)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Kho Tri Thức Cá Nhân Hóa</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Thêm tri thức</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Nhấp vào từng mục để xem chi tiết.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Khám Phá Pomodoro Study App</h3>
              <p>
                  Chào mừng bạn đến với không gian học tập được thiết kế dành riêng cho sự tập trung và hiệu quả. Hãy cùng khám phá những tính năng sẽ đồng hành cùng bạn trên hành trình chinh phục tri thức.
              </p>

              <h4>🚀 Khởi Đầu Nhanh Chỉ Trong 4 Bước</h4>
              <p>Để hành trình của bạn luôn mạch lạc, mọi thứ trong ứng dụng được sắp xếp theo cấu trúc <strong>Chủ đề Lớn → Chủ đề con</strong>.</p>
              <ol>
                  <li>Mở mục <strong>📚 Chủ đề</strong> từ thanh điều hướng bên cạnh.</li>
                  <li>Nhấn <strong>＋ Thêm Chủ đề</strong> để tạo một lĩnh vực lớn (ví dụ: "Tiếng Anh Giao Tiếp").</li>
                  <li>Bên cạnh chủ đề vừa tạo, nhấn <strong>＋ Thêm</strong> để tạo một chủ đề con, chi tiết hơn (ví dụ: "Bài 1: Luyện phát âm IPA").</li>
                  <li>Chọn chủ đề con đó. Giờ đây, bạn đã sẵn sàng để bắt đầu phiên học đầu tiên của mình!</li>
              </ol>

              <hr />
              <h4>✨ Những Tính Năng Đáng Chú Ý</h4>

              <h4>Các Chế Độ Đồng Hồ Linh Hoạt ⏱️</h4>
              <p>Ứng dụng không chỉ có Pomodoro. Hãy chọn phương pháp phù hợp với công việc của bạn:</p>
              <ul>
                  <li><strong>Pomodoro Cổ Điển (Kiểu A/B):</strong> Làm việc tập trung trong các phiên định sẵn (ví dụ: 25 phút làm, 5 phút nghỉ) để xây dựng kỷ luật và nhịp độ.</li>
                  <li><strong>Chế độ Flowtime (Kiểu 🌊 Flow):</strong> Dành cho công việc cần dòng chảy sâu. Đồng hồ sẽ đếm lên, cho phép bạn làm việc đến khi tự cảm thấy cần nghỉ. Thời gian nghỉ sẽ được đề xuất dựa trên thời gian bạn đã làm việc.</li>
                  <li><strong>Đệm "Hạ nhiệt" (Wind-down):</strong> Một khoảng đệm tùy chỉnh giữa lúc làm và lúc nghỉ, giúp bạn kết thúc công việc đang dở, ghi chú lại "bước tiếp theo" và chuyển trạng thái một cách mượt mà, không bị cắt ngang đột ngột.</li>
              </ul> 
              <h4>Kho Tri Thức Theo Từng Chủ Đề Con 💡</h4>
<p>
    Mỗi một <strong>Chủ đề con</strong> giờ đây sẽ có một "Kho Tri Thức" hoàn toàn riêng biệt. Tính năng này cho phép bạn xây dựng một thư viện kiến thức chuyên sâu, chỉ liên quan đến lĩnh vực bạn đang học.
</p>
<p>
    Ví dụ, các ghi chú và phương pháp học "Tiếng Anh Giao Tiếp" sẽ chỉ xuất hiện khi bạn chọn chủ đề con đó, và sẽ không bị lẫn với các công thức trong chủ đề con "Giải tích Toán học".
</p>
<p>
    Với trình soạn thảo mạnh mẽ, bạn vẫn có thể dễ dàng định dạng tiêu đề, in đậm, tạo danh sách và làm nổi bật những thông tin quan trọng nhất cho từng môn học của mình.
</p>

              <h4>Quản Lý Chủ Đề Trực Quan</h4>
              <p>Dễ dàng sắp xếp các mục tiêu học tập của bạn. Sử dụng thao tác <strong>kéo và thả</strong> để sắp xếp lại thứ tự các Chủ đề hoặc di chuyển một Chủ đề con sang một lĩnh vực khác một cách trực quan.</p>

              <h4>Nhiệm Vụ & Ghi Chú Tích Hợp 📝</h4>
              <p>Ngay trong màn hình đồng hồ, bạn có thể tạo danh sách việc cần làm (to-do) cho từng chủ đề con hoặc ghi lại những ý tưởng chợt nảy ra mà không làm gián đoạn dòng chảy công việc.</p>

              <h4>Chế Độ Zen 🧘</h4>
              <p>Khi cần tập trung tuyệt đối, hãy nhấn vào biểu tượng con mắt (👁️). Giao diện sẽ ẩn đi, chỉ để lại hình nền và chiếc đồng hồ. Trong chế độ này, bạn có thể <strong>kéo thả đồng hồ</strong> đến bất kỳ vị trí nào trên màn hình để có một không gian làm việc gọn gàng nhất.</p>

              <h4>Thống Kê & Cột Mốc 🏆</h4>
              <p>Theo dõi hành trình của bạn qua những con số biết nói. Ứng dụng sẽ tự động ghi nhận và chúc mừng khi bạn đạt được những cột mốc quan trọng về thời gian tập trung, biến mỗi nỗ lực thành một thành tựu đáng tự hào.</p>

              <hr />
              <h4>⌨️ Phím Tắt Thông Minh</h4>
              <ul>
                  <li><kbd>Space</kbd>: Bắt đầu / Tạm dừng / Tiếp tục phiên học.</li>
                  <li><kbd>N</kbd>: Bỏ qua phiên làm việc hoặc nghỉ hiện tại.</li>
                  <li><kbd>Esc</kbd>: Đóng các cửa sổ đang mở (như Cài đặt).</li>
              </ul>

              <hr />
              <h4>🛠️ Cài Đặt Nâng Cao & Tích Hợp</h4>

              <h4>Trợ Lý Gemini AI 🧠</h4>
              <p>Biến ứng dụng thành một người bạn đồng hành thông minh. Ngoài việc hỏi đáp, bạn còn có thể:</p>
              <ul>
                  <li><strong>Tự động Định dạng Thông minh:</strong> Khi soạn thảo trong mục "Phương pháp", hãy để AI tự động phân tích và định dạng văn bản thô của bạn—tự nhận diện tiêu đề, các ý chính cần in đậm và danh sách.</li>
                  <li><strong>Thiết lập:</strong> Truy cập Google AI Studio để tạo API Key miễn phí và dán vào ô "Gemini API Key" trong Cài đặt của ứng dụng.</li>
              </ul>

              <h4>Tùy Biến Giao Diện & Âm Thanh 🎨</h4>
              <p>Biến không gian học tập thành của riêng bạn:</p>
              <ul>
                  <li><strong>Nhiều Theme & Hình nền:</strong> Lựa chọn giữa các theme có sẵn (Sáng, Tối, Pastel...) hoặc <strong>tải lên hình nền của riêng bạn</strong> để tạo cảm hứng.</li>
                  <li><strong>Âm báo Tùy chỉnh:</strong> Bạn có thể <strong>tải lên các file âm thanh (.mp3, .wav...) của riêng mình</strong> để sử dụng làm chuông báo cho các phiên làm việc và nghỉ ngơi.</li>
              </ul>

              <h4>Nhạc Nền YouTube 🎶</h4>
              <p>Tạo không gian học tập hoàn hảo bằng cách phát một video hoặc danh sách phát YouTube làm nhạc nền. Dán đường dẫn (URL) vào ô "Nhạc nền YouTube" trong Cài đặt.</p>

              <h4>An Toàn Dữ Liệu: Sao Lưu & Phục Hồi 🛡️</h4>
              <p>Ứng dụng tự động sao lưu tiến trình của bạn mỗi ngày. Bạn có thể tùy chỉnh số ngày lưu giữ bản sao lưu và phục hồi dữ liệu từ một ngày trong quá khứ nếu cần. ⚠️ <strong>Cảnh báo:</strong> Phục hồi sẽ ghi đè toàn bộ dữ liệu hiện tại.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Chúc mừng Bạn!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Tiếp tục hành trình!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Cài đặt</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Đồng hồ</button>
              <button class="tab-btn" data-tab="settings-ui">Giao diện & Âm thanh</button>
              <button class="tab-btn" data-tab="settings-integrations">Tích hợp</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Kiểu A </button>
                      <button class="btn ghost" data-preset-target="B"> Kiểu B </button>
                      <button class="btn ghost" data-preset-target="C"> Kiểu C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Thời lượng Pomodoro</h4>
                      <div class="row">
                          <label>LÀM VIỆC (phút)<input type="number" id="set_work" min="1" /></label>
                          <label>HẠ NHIỆT (phút)<input type="number" id="set_winddown" min="0" /></label>
                          <label>NGHỈ NGẮN (phút)<input type="number" id="set_short" min="1" /></label>
                          <label>NGHỈ DÀI (phút)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Chu kỳ Pomodoro<input type="number" id="set_cycles" min="1" /></label>
                          <label>Chu kỳ nghỉ dài<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Tỷ lệ nghỉ (Làm việc / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Gợi ý: Thời gian nghỉ = tổng thời gian làm việc / X. Mặc định là 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Tự động bắt đầu phiên tiếp theo</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Bật Hạ nhiệt sau phiên làm</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableSessionNotes">Nhắc ghi chú sau mỗi phiên</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableSessionNotes">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Giao diện</h4>
                      <div class="row">
                          <label>Theme Giao Diện
                                <select id="set_theme_color">
                                    <option value="default">Mặc định (Dark Blue)</option>
                                    <option value="light">Light - Trà Sữa</option>
                                    <option value="pastel">Pastel - Dễ thương</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Chế độ hiển thị nền
                              <select id="set_backgroundMode">
                                  <option value="cover">Lấp đầy (Mặc định)</option>
                                  <option value="contain">Vừa vặn (Sắc nét)</option>
                                  <option value="auto">Kích thước gốc (Lặp lại)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Hình nền
                              <label class="btn small ghost" for="uploadBg">Tải ảnh mới</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Xóa nền</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Độ trong suốt của nền</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Âm thanh</h4>
                      <div class="row">
                          <label>Âm lượng (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Kiểu âm báo
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Tùy chỉnh âm báo</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Âm báo hết LÀM VIỆC</small>
                              <label title="Âm báo hết LÀM VIỆC" class="btn small ghost" for="uploadSoundWork">LÀM VIỆC</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ NGẮN</small>
                              <label title="Âm báo hết NGHỈ NGẮN" class="btn small ghost" for="uploadSoundBreak">NGHỈ NGẮN</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ DÀI</small>
                              <label title="Âm báo hết NGHỈ DÀI" class="btn small ghost" for="uploadSoundLong">NGHỈ DÀI</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Tích hợp AI</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Dán API Key của bạn vào đây..." />
                      </label>
                      <div class="tiny">Cần có để sử dụng các tính năng AI. Lấy key miễn phí tại <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 Nhạc nền YouTube</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Dán link YouTube vào đây..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Dùng ảnh bìa video làm nền</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Dừng sẽ không tự phát lại cho đến khi bạn bấm ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Âm lượng</div>
                  </div>
                  <div>
                      <h4>🛡️ Cài đặt sao lưu</h4>
                      <div class="row">
                          <label>Số ngày sao lưu cần giữ lại
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Phục hồi dữ liệu</h4>
                      <p class="tiny">Phục hồi dữ liệu từ một bản sao lưu tự động hàng ngày. Hành động này sẽ ghi đè lên dữ liệu hiện tại của bạn.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Phục hồi</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Mặc định</button>
              <button class="btn acc" id="btnSaveSettings">Lưu</button>
              <button class="btn" id="btnCloseSettings">Đóng</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Ghi chú cho phiên vừa hoàn thành</h3>
      <div class="row"><textarea id="noteText" placeholder="Bạn học được gì? Khó khăn? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Tóm tắt & Gợi ý</button>
        <button class="btn" id="btnSkipNote">Bỏ qua</button>
        <button class="btn acc" id="btnSaveNote">Lưu ghi chú</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Tiêu đề</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Hủy</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Tổng quan</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Đóng</button>
        </div>
        <p class="tiny">Tổng hợp thời gian và số phiên đã hoàn thành trên tất cả các chủ đề.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Chỉnh-sửa Phương-pháp</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Tiêu-đề<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Nội-dung</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Tiêu-đề nhỏ">H</button>
          <button id="toolBold" class="btn small ghost" title="In đậm">B</button>
          <button id="toolItalic" class="btn small ghost" title="In nghiêng">I</button>
          <button id="toolList" class="btn small ghost" title="Danh-sách">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Danh sách chấm tròn">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Màu chữ">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Màu chữ mặc định"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Màu nhấn mạnh"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Màu tích cực"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Màu cảnh báo"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Màu nguy hiểm"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Màu tím"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="Tính năng này yêu cầu Gemini API Key">✨ Tự động định dạng</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Hủy</button>
          <button class="btn acc" id="btnSaveMethod">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Nhấn "Bật âm thanh" để cho phép phát nhạc nền.</span>
    <button id="btnEnableSound" class="btn small acc">Bật âm thanh</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
    const _0x17450c=_0x2dbf;(function(_0x43a0f9,_0x534db4){const _0x89931f=_0x2dbf,_0x386275=_0x43a0f9();while(!![]){try{const _0x4c32f7=-parseInt(_0x89931f(0x4be))/0x1*(parseInt(_0x89931f(0x33c))/0x2)+parseInt(_0x89931f(0x418))/0x3+parseInt(_0x89931f(0x3af))/0x4+parseInt(_0x89931f(0x407))/0x5*(parseInt(_0x89931f(0x202))/0x6)+parseInt(_0x89931f(0x444))/0x7+parseInt(_0x89931f(0x4b9))/0x8*(-parseInt(_0x89931f(0x3b0))/0x9)+-parseInt(_0x89931f(0x3c7))/0xa;if(_0x4c32f7===_0x534db4)break;else _0x386275['push'](_0x386275['shift']());}catch(_0xb0656c){_0x386275['push'](_0x386275['shift']());}}}(_0x526e,0x4a886),window[_0x17450c(0x45b)](_0x17450c(0x49e),()=>{try{updateFullscreenButton();}catch(_0x1c16d8){}}));const IS_FILE_PROTOCOL=window[_0x17450c(0x308)][_0x17450c(0x297)]===_0x17450c(0x4ff);function startYtApiWatchdog(){const _0x44d407=_0x17450c,_0x549e53=document[_0x44d407(0x1f8)](_0x44d407(0x395));if(!_0x549e53)return;const _0x4d5c0f=setTimeout(()=>{const _0x7ba1f0=_0x44d407;try{(!window['YT']||!window['YT'][_0x7ba1f0(0x43f)])&&(_0x549e53['textContent']=_0x7ba1f0(0x2a6),_0x549e53[_0x7ba1f0(0x3a2)]['color']='var(--sub)');}catch(_0x2ccf23){}},0x5dc),_0x15aa29=setTimeout(()=>{const _0x95c8f2=_0x44d407;try{(!window['YT']||!window['YT'][_0x95c8f2(0x43f)])&&(_0x549e53[_0x95c8f2(0x48c)]=_0x95c8f2(0x452),_0x549e53[_0x95c8f2(0x3a2)][_0x95c8f2(0x2d1)]=_0x95c8f2(0x41f));}catch(_0x28f542){}},0x1b58);window['__ytApiWatchdog']={'cancel'(){clearTimeout(_0x4d5c0f),clearTimeout(_0x15aa29);}};}(function(){const _0x47a1cf=_0x17450c,_0x169f33={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>'Chu\x20kỳ\x20'+current+'/'+target,'timer.selectSubtopicPrompt':_0x47a1cf(0x211)};window['t']=function _0x26c8d9(_0x2db35a,_0x36e78a){try{const _0x2d1d4c=_0x169f33[_0x2db35a];if(typeof _0x2d1d4c==='function')return _0x2d1d4c(_0x36e78a||{});if(typeof _0x2d1d4c==='string')return _0x2d1d4c;}catch(_0x409c35){}return _0x2db35a;},window[_0x47a1cf(0x3c6)]=function _0x5a081b(_0x1f1d8f){const _0x131706=_0x47a1cf;try{localStorage['setItem'](_0x131706(0x305),_0x1f1d8f||'vi');}catch(_0x473185){}return Promise[_0x131706(0x32f)]();};}());function ensureYouTubeAPI(){const _0x18acbd=_0x17450c;if(IS_FILE_PROTOCOL)return Promise['resolve'](![]);try{if(window['YT']&&window['YT'][_0x18acbd(0x43f)])return Promise[_0x18acbd(0x32f)](!![]);}catch(_0x3cbf38){}if(window['__ytApiPromise'])return window[_0x18acbd(0x44f)];return startYtApiWatchdog(),window[_0x18acbd(0x44f)]=new Promise((_0x5d7f96,_0x2180e9)=>{const _0x43035b=_0x18acbd;try{const _0x522a6f=document['createElement']('script');_0x522a6f[_0x43035b(0x35b)]=_0x43035b(0x1ff),_0x522a6f[_0x43035b(0x301)]=!![],_0x522a6f['defer']=!![],_0x522a6f[_0x43035b(0x4b8)]=()=>_0x5d7f96(!![]),_0x522a6f[_0x43035b(0x233)]=()=>_0x2180e9(new Error(_0x43035b(0x248))),document[_0x43035b(0x317)][_0x43035b(0x2e8)](_0x522a6f);}catch(_0x4a4136){_0x2180e9(_0x4a4136);}}),window[_0x18acbd(0x44f)];}const storageManager={'DB_NAME':_0x17450c(0x340),'DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x1ea557,_0x540ffc)=>{const _0xba1bb7=_0x2dbf;if(this['db'])return _0x1ea557(this['db']);const _0x4bb79b=indexedDB[_0xba1bb7(0x326)](this['DB_NAME'],this[_0xba1bb7(0x287)]);_0x4bb79b[_0xba1bb7(0x335)]=_0x16de2e=>{const _0x54fb50=_0xba1bb7,_0x4af789=_0x16de2e[_0x54fb50(0x4a2)]['result'];!_0x4af789[_0x54fb50(0x415)][_0x54fb50(0x4ea)](_0x54fb50(0x4a9))&&_0x4af789[_0x54fb50(0x394)]('settings');!_0x4af789[_0x54fb50(0x415)]['contains'](_0x54fb50(0x3b3))&&_0x4af789[_0x54fb50(0x394)](_0x54fb50(0x3b3),{'keyPath':'id'});if(!_0x4af789[_0x54fb50(0x415)][_0x54fb50(0x4ea)](_0x54fb50(0x206))){const _0xc42ac6=_0x4af789['createObjectStore']('subtopics',{'keyPath':'id'});_0xc42ac6[_0x54fb50(0x49b)](_0x54fb50(0x445),_0x54fb50(0x281));}!_0x4af789[_0x54fb50(0x415)][_0x54fb50(0x4ea)](_0x54fb50(0x3f7))&&_0x4af789[_0x54fb50(0x394)]('backups',{'keyPath':_0x54fb50(0x4f4)});},_0x4bb79b[_0xba1bb7(0x2b2)]=_0x528da0=>{const _0x2d9ef0=_0xba1bb7;this['db']=_0x528da0[_0x2d9ef0(0x4a2)]['result'],console['log'](_0x2d9ef0(0x27c)),_0x1ea557(this['db']);},_0x4bb79b[_0xba1bb7(0x233)]=_0x267d43=>{const _0x59da17=_0xba1bb7;console[_0x59da17(0x30e)](_0x59da17(0x4a1),_0x267d43['target'][_0x59da17(0x263)]),_0x540ffc(_0x267d43[_0x59da17(0x4a2)]['error']);};});},async '_getStore'(_0x321890,_0x4eafaa=_0x17450c(0x26d)){const _0x3e8a9c=_0x17450c;await this[_0x3e8a9c(0x4c7)]();const _0x2b0780=this['db'][_0x3e8a9c(0x327)]([_0x321890],_0x4eafaa);return _0x2b0780[_0x3e8a9c(0x366)](_0x321890);},async 'getSettings'(){const _0x16bddd=_0x17450c,_0x188ce5=await this[_0x16bddd(0x460)](_0x16bddd(0x4a9));return new Promise((_0x30cc91,_0x2c0676)=>{const _0xe42ba9=_0x16bddd,_0x3758bb=_0x188ce5[_0xe42ba9(0x4cf)](_0xe42ba9(0x457));_0x3758bb[_0xe42ba9(0x2b2)]=()=>_0x30cc91(_0x3758bb[_0xe42ba9(0x271)]),_0x3758bb[_0xe42ba9(0x233)]=()=>_0x2c0676(_0x3758bb['error']);});},async 'updateSettings'(_0x5b88eb){const _0xf21b29=_0x17450c,_0x1ba984=await this[_0xf21b29(0x460)]('settings',_0xf21b29(0x30c));return new Promise((_0x5c4751,_0x53dd74)=>{const _0x29dd58=_0xf21b29,_0x486720=_0x1ba984[_0x29dd58(0x275)](_0x5b88eb,_0x29dd58(0x457));_0x486720[_0x29dd58(0x2b2)]=()=>_0x5c4751(_0x486720[_0x29dd58(0x271)]),_0x486720['onerror']=()=>_0x53dd74(_0x486720[_0x29dd58(0x30e)]);});},async 'getAll'(_0x360788){const _0x5177a5=_0x17450c,_0x23f2a3=await this[_0x5177a5(0x460)](_0x360788);return new Promise((_0x328062,_0x20059a)=>{const _0x148d27=_0x5177a5,_0xcbbe5d=_0x23f2a3[_0x148d27(0x27d)]();_0xcbbe5d[_0x148d27(0x2b2)]=()=>_0x328062(_0xcbbe5d['result']),_0xcbbe5d[_0x148d27(0x233)]=()=>_0x20059a(_0xcbbe5d[_0x148d27(0x30e)]);});},async 'update'(_0x1ffeb0,_0x1698b){const _0x657ce8=_0x17450c,_0x1c11de=await this[_0x657ce8(0x460)](_0x1ffeb0,_0x657ce8(0x30c));return new Promise((_0x4759cd,_0x55addb)=>{const _0x2211ae=_0x657ce8,_0x11f808=_0x1c11de[_0x2211ae(0x275)](_0x1698b);_0x11f808[_0x2211ae(0x2b2)]=()=>_0x4759cd(_0x11f808[_0x2211ae(0x271)]),_0x11f808['onerror']=()=>_0x55addb(_0x11f808[_0x2211ae(0x30e)]);});},async 'add'(_0x3d479c,_0x4c1931){const _0x38f2b9=_0x17450c,_0x469a87=await this[_0x38f2b9(0x460)](_0x3d479c,_0x38f2b9(0x30c));return new Promise((_0x13aa1c,_0x9d34d0)=>{const _0x2e133f=_0x38f2b9,_0x231f7f=_0x469a87[_0x2e133f(0x30f)](_0x4c1931);_0x231f7f['onsuccess']=()=>_0x13aa1c(_0x231f7f[_0x2e133f(0x271)]),_0x231f7f[_0x2e133f(0x233)]=()=>_0x9d34d0(_0x231f7f[_0x2e133f(0x30e)]);});},async 'delete'(_0x1798c0,_0x14491c){const _0x3fb048=_0x17450c,_0x3b0e03=await this[_0x3fb048(0x460)](_0x1798c0,_0x3fb048(0x30c));return new Promise((_0x40c132,_0x33ec28)=>{const _0x1d3d1b=_0x3fb048,_0x582d2e=_0x3b0e03['delete'](_0x14491c);_0x582d2e[_0x1d3d1b(0x2b2)]=()=>_0x40c132(_0x582d2e[_0x1d3d1b(0x271)]),_0x582d2e[_0x1d3d1b(0x233)]=()=>_0x33ec28(_0x582d2e[_0x1d3d1b(0x30e)]);});},async 'save'(_0x417342){const _0x21374d=_0x17450c;return await this[_0x21374d(0x4c7)](),new Promise((_0x6e9ff6,_0x28a482)=>{const _0x254d0d=_0x21374d,_0x6382ed=this['db']['transaction'](['settings','topics','subtopics'],'readwrite'),_0x286546=_0x6382ed[_0x254d0d(0x366)](_0x254d0d(0x4a9)),_0x354deb=_0x6382ed['objectStore'](_0x254d0d(0x3b3)),_0x419e50=_0x6382ed[_0x254d0d(0x366)](_0x254d0d(0x206));_0x286546[_0x254d0d(0x275)](_0x417342[_0x254d0d(0x4a9)],_0x254d0d(0x457)),_0x354deb[_0x254d0d(0x325)](),_0x419e50[_0x254d0d(0x325)](),_0x417342[_0x254d0d(0x3b3)][_0x254d0d(0x4a0)](_0x5c4e8d=>{const _0x106b7f=_0x254d0d,{subtopics:_0x129a2c,..._0x533acb}=_0x5c4e8d;_0x354deb['put'](_0x533acb),(_0x129a2c||[])[_0x106b7f(0x4a0)](_0x5bfe24=>_0x419e50[_0x106b7f(0x275)](_0x5bfe24));}),_0x6382ed[_0x254d0d(0x40c)]=()=>_0x6e9ff6(),_0x6382ed['onerror']=_0x26c1bd=>_0x28a482(_0x26c1bd['target'][_0x254d0d(0x30e)]);});},async 'autoBackup'(_0x2ba8f9){const _0xbb6754=_0x17450c;await this[_0xbb6754(0x4c7)]();const _0x24f249=new Date()[_0xbb6754(0x370)]()[_0xbb6754(0x2ba)](0x0,0xa),_0x266cbb=localStorage[_0xbb6754(0x286)](_0xbb6754(0x43a));if(_0x24f249!==_0x266cbb){console['log'](_0xbb6754(0x22e)+_0x24f249+_0xbb6754(0x4dd));const _0x34db03={'date':_0x24f249,'data':JSON[_0xbb6754(0x31b)](JSON[_0xbb6754(0x239)](_0x2ba8f9))},_0x2f1b39=this['db'][_0xbb6754(0x327)](['backups'],'readwrite'),_0x2dde64=_0x2f1b39['objectStore'](_0xbb6754(0x3f7)),_0x33d190=_0x2dde64[_0xbb6754(0x275)](_0x34db03);_0x33d190[_0xbb6754(0x2b2)]=()=>{const _0x432691=_0xbb6754;localStorage[_0x432691(0x25d)](_0x432691(0x43a),_0x24f249),console['log']('Daily\x20backup\x20successful.'),this[_0x432691(0x22d)](_0x2ba8f9?.['settings']?.[_0x432691(0x332)]||0x7);},_0x33d190['onerror']=_0x441fe2=>{const _0x4add0b=_0xbb6754;console[_0x4add0b(0x30e)](_0x4add0b(0x46a),_0x441fe2[_0x4add0b(0x4a2)][_0x4add0b(0x30e)]);};}},async 'cleanupOldBackups'(_0x1032d8){const _0x141b69=_0x17450c;await this[_0x141b69(0x4c7)]();const _0x4d30a0=this['db'][_0x141b69(0x327)](['backups'],'readwrite'),_0x40fbb8=_0x4d30a0[_0x141b69(0x366)](_0x141b69(0x3f7)),_0x1763b1=_0x40fbb8[_0x141b69(0x3b1)]();_0x1763b1[_0x141b69(0x2b2)]=()=>{const _0x43c14b=_0x141b69,_0x991389=_0x1763b1['result'][_0x43c14b(0x236)]()['reverse']();if(_0x991389[_0x43c14b(0x223)]>_0x1032d8){const _0x524bd5=_0x991389[_0x43c14b(0x2ba)](_0x1032d8);_0x524bd5[_0x43c14b(0x4a0)](_0x51b293=>{const _0x5e4f06=_0x43c14b;_0x40fbb8[_0x5e4f06(0x3e3)](_0x51b293),console[_0x5e4f06(0x4b4)](_0x5e4f06(0x462)+_0x51b293);});}};},async 'getBackupList'(){const _0x4dff07=_0x17450c;return await this[_0x4dff07(0x4c7)](),new Promise((_0x1cf143,_0x4605b1)=>{const _0xcbcda7=_0x4dff07,_0x19162f=this['db'][_0xcbcda7(0x327)]([_0xcbcda7(0x3f7)],_0xcbcda7(0x26d)),_0x1a2c96=_0x19162f[_0xcbcda7(0x366)](_0xcbcda7(0x3f7)),_0x5f44fb=_0x1a2c96[_0xcbcda7(0x27d)]();_0x5f44fb[_0xcbcda7(0x2b2)]=()=>_0x1cf143(_0x5f44fb[_0xcbcda7(0x271)]['sort']((_0x2a69f0,_0x253b8a)=>_0x253b8a[_0xcbcda7(0x4f4)][_0xcbcda7(0x46c)](_0x2a69f0[_0xcbcda7(0x4f4)]))),_0x5f44fb[_0xcbcda7(0x233)]=_0x2ce04b=>_0x4605b1(_0x2ce04b['target'][_0xcbcda7(0x30e)]);});},async 'restoreBackup'(_0x3e6abe){const _0x476d53=_0x17450c;return await this[_0x476d53(0x4c7)](),new Promise((_0x41f732,_0x55f4b8)=>{const _0x5d232e=_0x476d53,_0x1199f6=this['db'][_0x5d232e(0x327)](['backups'],_0x5d232e(0x26d)),_0x2c3473=_0x1199f6['objectStore'](_0x5d232e(0x3f7)),_0x367192=_0x2c3473[_0x5d232e(0x4cf)](_0x3e6abe);_0x367192['onsuccess']=()=>{const _0x1c9b27=_0x5d232e;_0x367192[_0x1c9b27(0x271)]&&_0x367192[_0x1c9b27(0x271)][_0x1c9b27(0x249)]?(localStorage[_0x1c9b27(0x25d)](_0x1c9b27(0x228),JSON[_0x1c9b27(0x239)](_0x367192[_0x1c9b27(0x271)][_0x1c9b27(0x249)])),_0x41f732(_0x367192['result'][_0x1c9b27(0x249)])):_0x55f4b8(new Error(_0x1c9b27(0x4bc)));},_0x367192[_0x5d232e(0x233)]=_0x5e2c75=>_0x55f4b8(_0x5e2c75['target'][_0x5d232e(0x30e)]);});},'exportData'(_0x2cfa0f){const _0x3f111b=_0x17450c;let _0x21b156={};try{_0x21b156=JSON[_0x3f111b(0x31b)](JSON[_0x3f111b(0x239)](_0x2cfa0f||{}));}catch(_0x141e18){_0x21b156=_0x2cfa0f;}try{if(_0x21b156&&_0x21b156['settings'])_0x21b156[_0x3f111b(0x4a9)][_0x3f111b(0x27a)]='';}catch(_0x43af92){}const _0x27ddd2=new Blob([JSON[_0x3f111b(0x239)](_0x21b156,null,0x2)],{'type':_0x3f111b(0x2e5)}),_0x3b8138=document[_0x3f111b(0x251)]('a'),_0x2bf07d=new Date(),_0x3f23bd=_0x1517a7=>(''+_0x1517a7)[_0x3f111b(0x397)](0x2,'0');_0x3b8138['href']=URL[_0x3f111b(0x362)](_0x27ddd2),_0x3b8138[_0x3f111b(0x31a)]='pomodoro_backup_'+_0x2bf07d[_0x3f111b(0x38d)]()+_0x3f23bd(_0x2bf07d['getMonth']()+0x1)+_0x3f23bd(_0x2bf07d[_0x3f111b(0x3fa)]())+_0x3f111b(0x2dd),_0x3b8138['click'](),URL[_0x3f111b(0x459)](_0x3b8138[_0x3f111b(0x364)]);},async 'importData'(_0xadf059){const _0x364377=_0x17450c,_0x150511=await _0xadf059[_0x364377(0x2ee)](),_0x17b468=JSON[_0x364377(0x31b)](_0x150511);if(!_0x17b468[_0x364377(0x44e)]||!_0x17b468[_0x364377(0x4a9)]||!Array['isArray'](_0x17b468[_0x364377(0x3b3)]))throw new Error(_0x364377(0x39d));try{const _0x1c157f=window[_0x364377(0x249)]&&window[_0x364377(0x249)][_0x364377(0x4a9)]&&window[_0x364377(0x249)][_0x364377(0x4a9)][_0x364377(0x27a)]||'';(!(_0x364377(0x27a)in _0x17b468[_0x364377(0x4a9)])||_0x17b468[_0x364377(0x4a9)][_0x364377(0x27a)]==='')&&(_0x17b468[_0x364377(0x4a9)]['apiKey']=_0x1c157f);}catch(_0x70d9ea){}return localStorage['setItem'](_0x364377(0x228),JSON['stringify'](_0x17b468)),_0x17b468;}},$=(_0x376a40,_0x353b63=document)=>_0x353b63['querySelector'](_0x376a40),breakSuggestions=['Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.',_0x17450c(0x363),_0x17450c(0x4d8),_0x17450c(0x215),_0x17450c(0x371),_0x17450c(0x399),_0x17450c(0x247),_0x17450c(0x330),_0x17450c(0x342),_0x17450c(0x4a3),_0x17450c(0x207),_0x17450c(0x3bd),'Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.',_0x17450c(0x346),_0x17450c(0x2a7),_0x17450c(0x3fc),_0x17450c(0x41b),_0x17450c(0x319),'Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.',_0x17450c(0x36d),_0x17450c(0x348),_0x17450c(0x447),_0x17450c(0x3d8),_0x17450c(0x296),_0x17450c(0x3a3),_0x17450c(0x4e6),_0x17450c(0x2b1),_0x17450c(0x428),_0x17450c(0x246),'Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.','Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!'],$$=(_0x2a01cf,_0x296670=document)=>Array[_0x17450c(0x2c2)](_0x296670[_0x17450c(0x283)](_0x2a01cf));function on(_0x4cd024,_0x5af5d8,_0x159053){const _0x540e27=_0x17450c;if(!_0x4cd024){console[_0x540e27(0x1e9)](_0x540e27(0x24e),_0x5af5d8);return;}_0x4cd024[_0x540e27(0x45b)](_0x5af5d8,_0x159053);}const formatMMSS=_0x5c08e1=>{const _0x4fc0a2=_0x17450c,_0x2bd3ac=Math[_0x4fc0a2(0x294)](_0x5c08e1/0x3c)[_0x4fc0a2(0x314)]()[_0x4fc0a2(0x397)](0x2,'0'),_0x232fd5=Math[_0x4fc0a2(0x294)](_0x5c08e1%0x3c)[_0x4fc0a2(0x314)]()[_0x4fc0a2(0x397)](0x2,'0');return _0x2bd3ac+':'+_0x232fd5;},uid=(_0x29b0cd='id')=>_0x29b0cd+'_'+Date[_0x17450c(0x20e)]()+'_'+Math[_0x17450c(0x2f5)]()[_0x17450c(0x314)](0x24)[_0x17450c(0x2ba)](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0x206a56){const _0x4ebaa9=_0x17450c;try{const _0x135173=_0x206a56[_0x4ebaa9(0x283)](_0x4ebaa9(0x4f1));if(!_0x135173[_0x4ebaa9(0x223)])return;const _0x4dd0c8=_0x135173[0x0],_0x3e48a9=_0x135173[_0x135173[_0x4ebaa9(0x223)]-0x1],_0x34b856=_0x46d3e5=>{const _0x2e2155=_0x4ebaa9;if(_0x46d3e5[_0x2e2155(0x2f4)]===_0x2e2155(0x33f)){if(_0x46d3e5['shiftKey']&&document[_0x2e2155(0x254)]===_0x4dd0c8)_0x46d3e5[_0x2e2155(0x441)](),_0x3e48a9['focus']();else!_0x46d3e5[_0x2e2155(0x1e8)]&&document['activeElement']===_0x3e48a9&&(_0x46d3e5[_0x2e2155(0x441)](),_0x4dd0c8[_0x2e2155(0x310)]());}};_0x206a56[_0x4ebaa9(0x45b)](_0x4ebaa9(0x4b2),_0x34b856),_0x4dd0c8['focus'](),__releaseFocusTrap=()=>{const _0x40c2fc=_0x4ebaa9;try{_0x206a56[_0x40c2fc(0x411)](_0x40c2fc(0x4b2),_0x34b856);}catch(_0x290050){}};}catch(_0x48a808){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x25fba0){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()[_0x17450c(0x370)]();function toast(_0x4f7681,_0x474ea9=0xa28){const _0x187969=_0x17450c,_0x46613b=$(_0x187969(0x2b4)),_0x1bcf7d=document[_0x187969(0x251)](_0x187969(0x2d4));_0x1bcf7d[_0x187969(0x2a9)]='toast',_0x1bcf7d[_0x187969(0x48c)]=_0x4f7681,_0x46613b[_0x187969(0x2e8)](_0x1bcf7d),setTimeout(()=>{const _0x5519d7=_0x187969;_0x1bcf7d[_0x5519d7(0x3a2)][_0x5519d7(0x1ed)]='0';},_0x474ea9-0x12c),setTimeout(()=>_0x46613b[_0x187969(0x242)](_0x1bcf7d),_0x474ea9);}function escapeHTML(_0x270720){const _0x3e10ca=_0x17450c;return _0x270720[_0x3e10ca(0x466)](/[&<>"']/g,_0x26177b=>({'&':'&amp;','<':_0x3e10ca(0x24b),'>':_0x3e10ca(0x35c),'\x22':'&quot;','\x27':_0x3e10ca(0x1e6)}[_0x26177b]));}function formatDaysHoursMinutes(_0x55221e){const _0xc62730=_0x17450c;if(!_0x55221e||_0x55221e<0x1)return _0xc62730(0x28a);const _0x20e2e7=Math[_0xc62730(0x294)](_0x55221e/0x3c),_0x5d75ec=_0x55221e%0x3c,_0x28f61b=_0x5d75ec[_0xc62730(0x314)]()['padStart'](0x2,'0');return _0x20e2e7+'\x20tiếng\x20'+_0x28f61b+_0xc62730(0x27e);}function formatGeminiResponse(_0x2df871){const _0x5e5d68=_0x17450c;return _0x2df871[_0x5e5d68(0x466)](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0x1e3d92){const _0x18a9d8=_0x17450c,_0x262c59=(_0x1e3d92||'')[_0x18a9d8(0x33e)]('\x0a');let _0x5f497a='',_0x923cb1=null;const _0x2bc48f=()=>{const _0x1670bc=_0x18a9d8;_0x923cb1&&(_0x5f497a+=_0x923cb1==='ol'?_0x1670bc(0x3e6):_0x1670bc(0x4b0),_0x923cb1=null);};for(let _0x4bb7cb of _0x262c59){let _0x3ea51e=(_0x4bb7cb||'')[_0x18a9d8(0x404)]();if(!_0x3ea51e){_0x2bc48f();continue;}if(_0x3ea51e[_0x18a9d8(0x29a)]('####\x20'))_0x2bc48f(),_0x5f497a+=_0x18a9d8(0x299)+escapeHTML(_0x3ea51e['substring'](0x5))+_0x18a9d8(0x4d5);else{if(/^\d+\.\s/['test'](_0x3ea51e)){_0x923cb1!=='ol'&&(_0x2bc48f(),_0x5f497a+='<ol>',_0x923cb1='ol');const _0x1b269f=_0x3ea51e['substring'](_0x3ea51e[_0x18a9d8(0x379)]('\x20')+0x1);_0x5f497a+='<li>'+escapeHTML(_0x1b269f)+'</li>';}else _0x3ea51e[_0x18a9d8(0x29a)]('-\x20')?(_0x923cb1!=='ul'&&(_0x2bc48f(),_0x5f497a+=_0x18a9d8(0x4e5),_0x923cb1='ul'),_0x5f497a+='<li>'+escapeHTML(_0x3ea51e['substring'](0x2))+'</li>'):(_0x2bc48f(),_0x3ea51e=escapeHTML(_0x3ea51e)[_0x18a9d8(0x466)](/\*\*(.*?)\*\*/g,'<strong>$1</strong>')[_0x18a9d8(0x466)](/_(.*?)_/g,_0x18a9d8(0x425)),_0x5f497a+='<p>'+_0x3ea51e+_0x18a9d8(0x311));}}return _0x2bc48f(),_0x5f497a;}function wrapTextInMarkdown(_0x2d110a,_0x3b405a,_0x2fbc6c=''){const _0x2f58da=_0x17450c;if(!_0x2d110a)return;const _0x31f255=_0x2d110a['selectionStart']||0x0,_0x329b17=_0x2d110a[_0x2f58da(0x3c3)]||0x0,_0x4d2903=_0x2d110a['value']['substring'](_0x31f255,_0x329b17),_0x2c78eb=_0x3b405a+_0x4d2903+(_0x2fbc6c||_0x3b405a);_0x2d110a[_0x2f58da(0x2fe)](_0x2c78eb,_0x31f255,_0x329b17,_0x2f58da(0x42e)),_0x2d110a[_0x2f58da(0x310)]();}function updateEditorPreview(){const _0x2a6e44=_0x17450c,_0x2aaff3=$('#methodEditorContentInput'),_0x1aa117=$('#editorPreview');if(!_0x2aaff3||!_0x1aa117)return;const _0x17debe=_0x2aaff3[_0x2a6e44(0x406)]||'';_0x1aa117['innerHTML']=parseSimpleMarkdown(_0x17debe);}function _0x526e(){const _0xbbfd95=['Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.','\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','prompt','acc','currentConfig','interval','end','A_winddown','statusText','Đã\x20xóa\x20tóm\x20tắt.','#set_cycles','#modalNote','\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22','_onFinishSegment','B_work','data:','<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>','PLAYING','lastBackupDate','Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.','--bg-image','winddown','https://www.youtube.com','Player','prevState','preventDefault','play','getIframe','1232329FsNlyE','by_topic','#generalNotesList','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.','destination','#noteText','backgroundImage','exitFullscreen','toggle','join','version','__ytApiPromise','task','Thêm\x20tùy\x20chọn','Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.','splice','hidden','#btnAddSubtopicTask','Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.','main_settings','block','revokeObjectURL','<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>','addEventListener','#chatInput','#btnSummarizeNote','note-meta','btn\x20small','_getStore','Thoát\x20toàn\x20màn\x20hình','Deleted\x20old\x20backup:\x20','#btnToggleBg','#btnFinishFlow','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','replace','badge','Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.','#btnSkip','Backup\x20failed:','#set_winddown','localeCompare','timerState_','<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>','#stateBadge','badge\x20state\x20work','Chỉnh-sửa\x20Tri\x20thức','right','<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>','longBreakIntervalB','method-content','update','expanded','\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]','cancel','.nav-btn','Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','B_short','#uploadSoundBreak','isArray','BUFFERING','Xóa','note','transition','#btnEnableSound','?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.','autoStartNext','isConnected','#windDownChecklist','stats','break','json','hours','textContent','querySelector','Tên\x20Chủ\x20đề\x20mới?','#toolBullet','#currentSubtopicName','#set_enableSessionNotes','pointerdown','candidates','A_short','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','aria-expanded','flowtimeBreakRatio','#dashboardContent','#toolItalic','#btnSkipNote','createIndex','AI\x20đã\x20định\x20dạng\x20xong!','#set_theme','load','includes','forEach','IndexedDB\x20error:','target','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','click','B_winddown','requestFullscreen','beginWork','<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>','settings','long_end','#btnClearBg','skip','setPreset','save','#btnSummarize','</ul>','fullscreenElement','keydown','reduce','log','#view-methods','idle','autoplay;\x20encrypted-media;\x20picture-in-picture','onload','137632RqYfnv','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?','stroke','Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.','Đã\x20xóa\x20lịch\x20sử\x20chat.','2ZaxoCZ','topic','#set_panelOpacity','methods','timerState','Failed\x20to\x20delete\x20summary:','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20để\x20xem\x20Kho\x20Tri\x20Thức.</p>','.timer-circle-progress','initDB','Đã\x20dừng\x20nhạc\x20nền.','soundPermissionBar','theme','Lỗi\x20HTTP:\x20','#btnAddTopic','blob:','Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.','get','<div\x20class=\x22spinner\x22></div>','#btnDashboard','Enter','getBackupList','#set_work','</h4>','Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.','breathing','Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.','isNaN','Xuất','.actions-menu.show','Đang\x20phát\x20nhạc\x20nền...','...','.subtopic-btn','<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>','postMessage','pauseVideo','Đã\x20lưu\x20ghi\x20chú','#btnSendMessage','#btnSaveMethod','<ul>','Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.','workMinutes','Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...','timer.selectSubtopicPrompt','contains','#chatMessages','findIndex','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','#modalDashboard','#importFile','durationMinutes','button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])','map','removing','date','#btnCloseSettings','Đã\x20chuyển\x20sang\x20Kiểu\x20','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=','ArrowLeft','_sortable','Xác\x20nhận\x20phục\x20hồi','absolute','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22','triangle','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>','file:','Xác\x20nhận\x20xóa','&#39;','updateSettings','shiftKey','warn','</label>','#set_backgroundMode','Đã\x20lưu\x20cài\x20đặt','opacity','currentTime','innerHTML','#set_interval','formatBlock','TẠM\x20DỪNG','Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20','panelOpacity','#set_theme_color','Sửa','methodId','getElementById','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước.','Chọn\x20chủ\x20đề\x20con\x20trước.','subtopic','checked','Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.','status','https://www.youtube.com/iframe_api','#set_flowRatio','currentDurations','27618QaGleV','＋\x20Thêm','menu-item\x20danger','.presets\x20button','subtopics','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','Tên\x20Chủ\x20đề\x20con\x20mới?','#ytUrlFeedback','var(--acc-2)','bold','.app-content','sessions','now','❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.','#settings-flowtime','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.','sess','no-repeat','default','Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.','soundOn','#btnCloseDashboard','#newSubtopicTaskInput','body','\x0a-\x20','.method-delete','#backupList','offsetHeight','left','beep','execCommand','</div>','AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.','length','segmentTotal','setVolume','getPropertyValue','Thêm\x20Chủ\x20đề\x20con','pomodoroData_v11','tasks','.topic-item.menu-active','tagName','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>','cleanupOldBackups','Creating\x20backup\x20for\x20','beforeunload','.subtopics','B_long','LÀM\x20VIỆC','onerror','Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','.color-swatch','sort','textarea','HẠ\x20NHIỆT','stringify','/hqdefault.jpg','#btnPresetA','actions-menu','newIndex','start','Đã\x20khôi\x20phục\x20mặc\x20định','long','title','removeChild','styleWithCSS','light','#btnBreakEarly','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','Failed\x20to\x20load\x20YouTube\x20API','data','reset','&lt;','closest','state','Missing\x20element','ArrowRight','toLowerCase','createElement','Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.','unshift','activeElement','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?','round','Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.','AutoBackup\x20error:','lastPersist','youtube-player-container','#set_long','#btnPresetB','setItem','Ẩn\x20giao\x20diện','Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.','string','Thêm\x20Tri\x20thức\x20mới','note-item','errorCode','finishFlowSession','Escape','#btnExport','innerWidth','reload','vi-VN','btnToggleYtSound','#uploadSoundWork','exportData','readonly','#statTotal','Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20','iframe','result','.nav-btn[data-view=\x22','longBreakIntervalA','Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22','put','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','Âm\x20thanh\x20đã\x20được\x20bật!','<div>','classList','apiKey','Lỗi\x20khởi\x20tạo:\x20','IndexedDB\x20initialized\x20successfully.','getAll','\x20phút','#breakSuggestionDisplay','Sortable','topicId','getVolume','querySelectorAll','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','btn\x20subtopic-btn','getItem','DB_VERSION','abs','Đã\x20cập\x20nhật\x20hình\x20nền.','0\x20phút','remaining','find','#set_ytThumbAsBg','space','width','altKey','Xác\x20nhận\x20chuyển\x20đổi','menu-active','Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a','floor','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.','protocol','btn\x20small\x20ghost\x20actions-menu-btn','<h4>','startsWith','allow','topic-title','chat-msg\x20','scrollTop','#btnFullscreen','stopPropagation','Lỗi\x20lưu\x20dữ\x20liệu:\x20','#audioLongEnd','100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.','</td><td>','#welcomePanel\x20p','Đang\x20tải\x20API\x20YouTube...','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','#modalMethodEditor','className','.color-picker-wrapper','enableSessionNotes','youtubeVolume','#btnReset','match','#btnToggleYtSound','gain','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','onsuccess','tid','#toasts','undefined','#set_volume','#btnStart','Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.','topic-header','slice','#milestoneMessage','#btnRestoreBackup','#ytSoundVolume','#btnAddGeneralNote','Đổi\x20tên\x20Chủ\x20đề\x20con','selectedSubtopicId','display','from','onclick','.topic-item','.tab-btn','enableWinddown','#toolList','btn\x20small\x20danger','toLocaleString','Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','img.youtube.com/vi/','không\x20rõ','Đang\x20phát','getMonth','POST','#genericInput','color','LÀM\x20VIỆC\x20(FLOW)','https://www.youtube.com/embed/','div','lofi','#uploadBg','Hiện\x20giao\x20diện','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>','#btnSaveSettings','connect','Xóa\x20tri\x20thức\x20\x22','-9999px','.json','.modal','bg-view-mode','content','exponentialRampToValueAtTime','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','http','.view','application/json','#aiPromptSuggestions\x20button','#toolH4','appendChild','disabled','\x20·\x20','button','customBg','input','text','#set_backupDays','#btnGenericOk','code','playVideo','#timeDisplay','key','random','</tbody></table>','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>','pomodoro_files','#btnGenericCancel','#btnCancelMethodEditor','sid','work_end','#uploadSoundLong','setRangeText','cyclesB','isCompleted','async','long_break','innerHeight','menu-item','lang','blockReason','Sửa\x20tên\x20Chủ\x20đề','location','height','finished','flex','readwrite','onkeydown','error','add','focus','</p>','.tab-content','stop','toString','change','PlayerState','head','<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>','Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.','download','parse','#set_apiKey','input,select,textarea','badge\x20state\x20break','✨\x20Tự\x20động\x20định\x20dạng','note-content-wrapper','/maxresdefault.jpg','backgroundRepeat','preset','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','clear','open','transaction','relative','onYouTubeIframeAPIReady','topic-item','Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.','Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.','dataset','(Không\x20tạo\x20được\x20tóm\x20tắt)','resolve','Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','chatHistory','backupDaysToKeep','wind_down','unMute','onupgradeneeded','chev\x20btn\x20small\x20ghost','<div\x20class=\x22hist-meta\x22>','parts','#btnResume','backgroundSize','scroll','527278CTXBgS','removeProperty','split','Tab','PomodoroAppDB','#view-timer','Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.','Chưa\x20chọn\x20Chủ\x20đề\x20con','presetTarget','updateUI','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>','Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.','restoreBackup','#toolBold','toLocaleDateString','cyclesA','achievedMilestones','Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','Failed\x20to\x20save\x20data:','setAttribute','#methodEditorTitleInput','oldIndex','<span\x20class=\x22ico\x22>▾</span>','chime','#btnPause','sine','active','cycleIndex','contentWindow','position','src','&gt;','https://img.youtube.com/vi/','pause','.sub-row','user','function','createObjectURL','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','href','Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22','objectStore','push','_startTick','totalMinutes','sessionsCompleted','.actions-menu','object','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','collapsedTopics','Nội\x20dung\x20bị\x20chặn\x20vì:\x20','toISOString','Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.','files','ArrowDown','mouseup','pastel','Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.','indexOf','.txt','?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.','persistTimerState','bottom','strokeDasharray','customSounds','work','Lỗi\x20phát\x20âm\x20thanh:','Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','tickHandle','beginBreak','cover','fixed','#set_youtubeUrl','#set_autoStartNext','💡\x20Gợi\x20ý:\x20','\x20hidden','#modalGeneric','no-subtopic-selected','getFullYear','.color-palette','stopVideo','.method-item\x20.method-content','message','Đổi\x20tên\x20Chủ\x20đề','remove','createObjectStore','ytUrlFeedback','generalNotes','padStart','__ytApiWatchdog','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.','none','#cycleInfo','.nav-btn[data-view]','Tệp\x20không\x20đúng\x20định\x20dạng','setProperty','\x20|\x20<strong>Tổng\x20phiên:</strong>\x20','filter','Lỗi:\x20','style','Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.','summaries','append','repeat','scrollHeight','sound_unlocked','webkitAudioContext','btn\x20small\x20danger\x20method-delete','.actions-menu-btn','backgroundMode','Không\x20thể\x20lưu\x20thay\x20đổi.','show','586892lVDRjp','9ZjAwWX','getAllKeys','Sửa\x20tên\x20Chủ\x20đề\x20con','topics','Gemini\x20API\x20Error:','item','note-content','ghost','#btnClearChat','ArrowUp','paused','getPlayerState','#welcomePanel','Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.','option','Tóm\x20tắt','topicsList','#toolColor','mode','selectionEnd','top','#genericMessage','loadLanguage','880740fMCnQX','promptFeedback','Thêm\x20ghi\x20chú','#modalSettings','#btnAutoFormat','values','currentView','Tóm\x20tắt\x20thất\x20bại.','Toàn\x20màn\x20hình','beginWindDown','ENDED','select','http:','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','resume','summary_','#topicsList','Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!','durations','auto','.method-item','#modalMilestone','createdAt','origin','insertUnorderedList','url(','#view-','<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>','delete','hist-item','offsetWidth','</ol>','selectedTopicId','max','<tr><td>','documentElement','strokeDashoffset','file','Chủ\x20đề\x20con:\x20','🌊\x20Flow','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','topic-actions','#statTasks','getBoundingClientRect','timer','var(--warn)','#historyList','autoBackup','backups','clientY','flatMap','getDate','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','volume','#audioWorkEnd','then','useYtThumbnailAsBg','#draggableTimer','Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.','.method-edit','trim','<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20','value','165JupErg','modalMethodEditor','#summariesList','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','short','oncomplete','soundTheme','method-title','A_long','#timerPresetSelector\x20button','removeEventListener','A_work','break_end','#methodEditorContentInput','objectStoreNames','#set_enableWinddown','reloading','1389519ymBGMD','cueVideoById','.method-content','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.','setValueAtTime','cyclesTarget','#selectedContext','var(--danger)','min','<input\x20type=\x22checkbox\x22\x20id=\x22','name','catch','cycles','<i>$1</i>','mute','Xóa\x20Chủ\x20đề\x20con'];_0x526e=function(){return _0xbbfd95;};return _0x526e();}function normalizeDataStructure(_0x58902c){const _0x16ac3c=_0x17450c;if(!_0x58902c||typeof _0x58902c!==_0x16ac3c(0x36c))return;const _0x4a3e93=_0x58902c[_0x16ac3c(0x4a9)]||{},_0x1484b6={...defaults[_0x16ac3c(0x4a9)],..._0x4a3e93,'durations':{...defaults[_0x16ac3c(0x4a9)][_0x16ac3c(0x3d9)],..._0x4a3e93['durations']||{}}};if(!Array[_0x16ac3c(0x47e)](_0x1484b6[_0x16ac3c(0x34d)]))_0x1484b6[_0x16ac3c(0x34d)]=[];_0x58902c[_0x16ac3c(0x4a9)]=_0x1484b6,_0x58902c[_0x16ac3c(0x3b3)]=Array[_0x16ac3c(0x47e)](_0x58902c[_0x16ac3c(0x3b3)])?_0x58902c[_0x16ac3c(0x3b3)]:[],_0x58902c[_0x16ac3c(0x3b3)][_0x16ac3c(0x4a0)](_0x1930d0=>{const _0x43a4b8=_0x16ac3c;_0x1930d0['subtopics']=Array['isArray'](_0x1930d0[_0x43a4b8(0x206)])?_0x1930d0[_0x43a4b8(0x206)]:[],_0x1930d0[_0x43a4b8(0x206)][_0x43a4b8(0x4a0)](_0x4b057e=>{const _0x246f79=_0x43a4b8;_0x4b057e['tasks']=_0x4b057e[_0x246f79(0x229)]||[],_0x4b057e[_0x246f79(0x396)]=_0x4b057e[_0x246f79(0x396)]||[],_0x4b057e[_0x246f79(0x3a4)]=_0x4b057e[_0x246f79(0x3a4)]||[],_0x4b057e[_0x246f79(0x331)]=_0x4b057e['chatHistory']||[],_0x4b057e[_0x246f79(0x4c1)]=Array[_0x246f79(0x47e)](_0x4b057e[_0x246f79(0x4c1)])?_0x4b057e[_0x246f79(0x4c1)]:[],_0x4b057e['stats']=_0x4b057e[_0x246f79(0x488)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x4b057e[_0x246f79(0x20d)]=_0x4b057e[_0x246f79(0x20d)]||[],_0x4b057e['timerState']=_0x4b057e[_0x246f79(0x4c2)]||{'state':'idle','prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x48e07a){const _0x77de75=_0x17450c;if(!_0x48e07a)return null;const _0x499863=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0xcdf8ba=_0x48e07a[_0x77de75(0x2ae)](_0x499863);return _0xcdf8ba?_0xcdf8ba[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x192374=_0x17450c;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x1452da=document[_0x192374(0x1f8)]('set_youtubeUrl'),_0x1187af=(_0x1452da&&_0x1452da['value']?_0x1452da[_0x192374(0x406)]:'')[_0x192374(0x404)]();return _0x1187af;}catch(_0x2cfb3d){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function handleYoutubeUrlInput(){const _0x45f116=_0x17450c,_0x249b82=$(_0x45f116(0x387)),_0xf126df=$(_0x45f116(0x209)),_0x3d77d2=$('#btnToggleYtSound'),_0x18de21=_0x249b82['value']['trim'](),_0x5126ab=extractYouTubeID(_0x18de21);if(_0x5126ab){_0xf126df[_0x45f116(0x48c)]=_0x45f116(0x284),_0xf126df[_0x45f116(0x3a2)]['color']=_0x45f116(0x20a),_0x3d77d2[_0x45f116(0x2e9)]=![],sessionYoutubeUrl=_0x18de21;try{ytUserPaused=![];}catch(_0x362ba1){}try{const _0x55665c=_0x45f116(0x35d)+_0x5126ab+_0x45f116(0x321),_0x1351a0=new Image();_0x1351a0[_0x45f116(0x4b8)]=async()=>{const _0x22ad85=_0x45f116;data[_0x22ad85(0x4a9)][_0x22ad85(0x2ec)]=_0x55665c;try{await saveData();}catch(_0x1b2bb8){}applyCustomBg();},_0x1351a0['onerror']=async()=>{const _0x494fb8=_0x45f116,_0x1751b5=_0x494fb8(0x35d)+_0x5126ab+_0x494fb8(0x23a);data[_0x494fb8(0x4a9)][_0x494fb8(0x2ec)]=_0x1751b5;try{await saveData();}catch(_0x340e40){}applyCustomBg();},_0x1351a0[_0x45f116(0x35b)]=_0x55665c;}catch(_0x145334){}try{if(IS_FILE_PROTOCOL){const _0x540ba9=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x5126ab,{'autoplay':0x1,'mute':_0x540ba9});try{setTimeout(()=>{const _0x3180da=_0x45f116;try{fallbackPostMessage(_0x3180da(0x2f2));}catch(_0x19b3f2){}},0xfa);}catch(_0x207300){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0x18b69e=_0x45f116,_0x2670bc=document[_0x18b69e(0x1f8)]('ytUrlFeedback');if(_0x2670bc)_0x2670bc[_0x18b69e(0x48c)]=_0x18b69e(0x2cd);},0x1f4);}catch(_0x56d8bd){}}else ensureYouTubeAPI()[_0x45f116(0x3ff)](()=>{const _0x3eb768=_0x45f116;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer[_0x3eb768(0x426)]&&ytPlayer[_0x3eb768(0x2f2)]&&(ytPlayer['mute'](),ytPlayer[_0x3eb768(0x2f2)](),_ytPrimed=!![],showSoundPermission());}catch(_0x35728f){}})[_0x45f116(0x423)](()=>{});}catch(_0x29405e){}}else{if(_0x18de21===''){_0xf126df['textContent']='',_0x3d77d2['disabled']=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x2fbe9e){}else ytPlayer&&ytPlayer['stopVideo']&&ytPlayer[_0x45f116(0x38f)]();}else _0xf126df[_0x45f116(0x48c)]=_0x45f116(0x20f),_0xf126df[_0x45f116(0x3a2)]['color']=_0x45f116(0x41f),_0x3d77d2['disabled']=!![];}}function applyTheme(_0x3657cc){const _0x178c8b=_0x17450c,_0x42caef=_0x3657cc||data[_0x178c8b(0x4a9)][_0x178c8b(0x4ca)]||_0x178c8b(0x214);document[_0x178c8b(0x219)][_0x178c8b(0x32d)]['theme']=_0x42caef;const _0x52295b=[_0x178c8b(0x2d5),_0x178c8b(0x28e)][_0x178c8b(0x49f)](_0x42caef),_0xbbd79c=_0x42caef===_0x178c8b(0x244)||_0x42caef==='pastel',_0x2785a2=data[_0x178c8b(0x4a9)][_0x178c8b(0x2ec)],_0x37d70a=()=>{const _0x2f7cc1=_0x178c8b;try{document[_0x2f7cc1(0x219)][_0x2f7cc1(0x3a2)][_0x2f7cc1(0x44a)]='';}catch(_0x7596a4){}};if(_0x2785a2&&!data[_0x178c8b(0x4a9)][_0x178c8b(0x400)])document[_0x178c8b(0x219)][_0x178c8b(0x3a2)][_0x178c8b(0x39e)]('--bg-image',_0x178c8b(0x3e0)+_0x2785a2+')'),_0x37d70a();else{if(_0x2785a2&&data['settings'][_0x178c8b(0x400)])document['body'][_0x178c8b(0x3a2)][_0x178c8b(0x39e)]('--bg-image',_0x178c8b(0x3e0)+_0x2785a2+')'),_0x37d70a();else{if(_0x52295b)document[_0x178c8b(0x219)][_0x178c8b(0x3a2)][_0x178c8b(0x33d)]('--bg-image'),_0x37d70a();else _0xbbd79c?(document[_0x178c8b(0x219)]['style'][_0x178c8b(0x39e)]('--bg-image',_0x178c8b(0x39a)),_0x37d70a()):(document[_0x178c8b(0x219)][_0x178c8b(0x3a2)][_0x178c8b(0x39e)](_0x178c8b(0x43c),''),document[_0x178c8b(0x219)][_0x178c8b(0x3a2)][_0x178c8b(0x44a)]=_0x178c8b(0x377));}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':_0x17450c(0x3f3),'preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x17450c(0x21f),'theme':_0x17450c(0x214),'cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'enableSessionNotes':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x17450c(0x385),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':_0x17450c(0x47b),'content':_0x17450c(0x4ed)},{'id':uid('m'),'title':'Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','content':_0x17450c(0x438)},{'id':uid('m'),'title':_0x17450c(0x276),'content':_0x17450c(0x45a)},{'id':uid('m'),'title':_0x17450c(0x495),'content':_0x17450c(0x3e2)},{'id':uid('m'),'title':'Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','content':_0x17450c(0x46e)}]},'topics':[]};let data,editingPreset='A',AUDIO_CTX=null;function ensureAudio(){const _0x455430=_0x17450c;if(!AUDIO_CTX)AUDIO_CTX=new(window['AudioContext']||window[(_0x455430(0x3a9))])();}function _0x2dbf(_0x4327d7,_0x3bbdda){const _0x526e37=_0x526e();return _0x2dbf=function(_0x2dbfe2,_0x3dc5cc){_0x2dbfe2=_0x2dbfe2-0x1e6;let _0x3d2037=_0x526e37[_0x2dbfe2];return _0x3d2037;},_0x2dbf(_0x4327d7,_0x3bbdda);}function tone(_0x65836d=0x370,_0x1cdbfb=0xc8,_0x64b776=0.2,_0x2d4894='sine',_0x1a8f9f=0x0){const _0x10f55b=_0x17450c;ensureAudio();const _0x2622a1=AUDIO_CTX,_0x39647d=_0x2622a1['createOscillator'](),_0x439169=_0x2622a1['createGain']();_0x39647d['type']=_0x2d4894,_0x39647d['frequency'][_0x10f55b(0x406)]=_0x65836d,_0x39647d[_0x10f55b(0x2da)](_0x439169),_0x439169[_0x10f55b(0x2da)](_0x2622a1[_0x10f55b(0x448)]);const _0xeb421f=_0x2622a1[_0x10f55b(0x1ee)]+_0x1a8f9f;_0x439169[_0x10f55b(0x2b0)][_0x10f55b(0x41c)](0x0,_0xeb421f),_0x439169['gain']['linearRampToValueAtTime'](_0x64b776,_0xeb421f+0.01),_0x439169[_0x10f55b(0x2b0)][_0x10f55b(0x2e1)](0.0001,_0xeb421f+_0x1cdbfb/0x3e8),_0x39647d[_0x10f55b(0x23e)](_0xeb421f),_0x39647d[_0x10f55b(0x313)](_0xeb421f+_0x1cdbfb/0x3e8+0.05);}function playSound(_0x7be38d){const _0x15eb29=_0x17450c;if(!data[_0x15eb29(0x4a9)][_0x15eb29(0x216)])return;const _0xd12d64=Math[_0x15eb29(0x3e8)](0x0,Math[_0x15eb29(0x420)](0x1,data[_0x15eb29(0x4a9)][_0x15eb29(0x3fd)]??0.8)),_0x5a1b95=data[_0x15eb29(0x4a9)]['customSounds']?.[_0x7be38d];let _0x226369;if(_0x7be38d===_0x15eb29(0x2fc))_0x226369=$(_0x15eb29(0x3fe));else{if(_0x7be38d==='break_end')_0x226369=$('#audioBreakEnd');else{if(_0x7be38d===_0x15eb29(0x4aa))_0x226369=$(_0x15eb29(0x2a2));}}if(_0x5a1b95&&_0x226369){_0x5a1b95[_0x15eb29(0x29a)](_0x15eb29(0x437))||_0x5a1b95['startsWith'](_0x15eb29(0x2e3))||_0x5a1b95['startsWith'](_0x15eb29(0x4cd))?(_0x226369[_0x15eb29(0x35b)]=_0x5a1b95,_0x226369['volume']=_0xd12d64,_0x226369['play']()[_0x15eb29(0x423)](_0x5caabf=>console[_0x15eb29(0x30e)](_0x15eb29(0x381),_0x5caabf))):getStoredFileUrl(_0x5a1b95)['then'](_0x37f15a=>{const _0x5088ac=_0x15eb29;_0x37f15a&&(_0x226369[_0x5088ac(0x35b)]=_0x37f15a,_0x226369[_0x5088ac(0x3fd)]=_0xd12d64,_0x226369[_0x5088ac(0x442)]()[_0x5088ac(0x423)](_0x4736a2=>console[_0x5088ac(0x30e)](_0x5088ac(0x381),_0x4736a2)));});return;}const _0x1cd089=data['settings']['soundTheme']||_0x15eb29(0x21f);if(_0x1cd089===_0x15eb29(0x21f)){if(_0x7be38d==='work_end')tone(0x370,0xfa,_0xd12d64),tone(0x294,0xb4,_0xd12d64*0.8,_0x15eb29(0x356),0.22);else{if(_0x7be38d===_0x15eb29(0x413))tone(0x294,0xdc,_0xd12d64*0.9);else _0x7be38d==='long_end'&&(tone(0x208,0xc8,_0xd12d64),tone(0x30c,0xc8,_0xd12d64,_0x15eb29(0x356),0.22),tone(0x410,0xdc,_0xd12d64,_0x15eb29(0x356),0.44));}}else{if(_0x7be38d==='work_end')tone(0x4b0,0xa0,_0xd12d64*0.9,_0x15eb29(0x4fd)),tone(0x384,0xdc,_0xd12d64*0.8,_0x15eb29(0x4fd),0.18);else{if(_0x7be38d===_0x15eb29(0x413))tone(0x370,0xf0,_0xd12d64*0.8,_0x15eb29(0x4fd));else _0x7be38d==='long_end'&&(tone(0x258,0xdc,_0xd12d64*0.9,_0x15eb29(0x4fd)),tone(0x3b6,0xf0,_0xd12d64*0.9,_0x15eb29(0x4fd),0.22),tone(0x4b0,0xf0,_0xd12d64,_0x15eb29(0x4fd),0.44));}}}async function saveData(){const _0x81ea68=_0x17450c;try{await storageManager[_0x81ea68(0x4ae)](data);}catch(_0x34cf07){console[_0x81ea68(0x30e)](_0x81ea68(0x34f),_0x34cf07),toast(_0x81ea68(0x2a1)+_0x34cf07[_0x81ea68(0x391)]);}}async function ensureValidSelection(){const _0x2b687c=_0x17450c,_0x4faf53=data[_0x2b687c(0x4a9)];if(!data[_0x2b687c(0x3b3)]||data['topics'][_0x2b687c(0x223)]===0x0){_0x4faf53[_0x2b687c(0x3e7)]='',_0x4faf53['selectedSubtopicId']='',await saveData();return;}const _0x34bfb7=data[_0x2b687c(0x3b3)][_0x2b687c(0x28c)](_0x388da0=>_0x388da0['id']===_0x4faf53['selectedTopicId']),_0x10fdee=_0x34bfb7?.[_0x2b687c(0x206)][_0x2b687c(0x28c)](_0x2e3ca0=>_0x2e3ca0['id']===_0x4faf53[_0x2b687c(0x2c0)]);if(!_0x34bfb7||!_0x10fdee){const _0x147878=data[_0x2b687c(0x3b3)][0x0],_0x2c01c9=_0x147878?.[_0x2b687c(0x206)]?.[0x0];_0x4faf53['selectedTopicId']=_0x147878?.['id']||'',_0x4faf53[_0x2b687c(0x2c0)]=_0x2c01c9?.['id']||'',await saveData();}}function showInputModal(_0x564dc0,_0x1ae063,_0x107ec1=''){const _0x576825=_0x17450c;$('#genericTitle')[_0x576825(0x48c)]=_0x564dc0,$(_0x576825(0x3c5))[_0x576825(0x279)][_0x576825(0x30f)](_0x576825(0x454));const _0x2dbbf4=$(_0x576825(0x2d0));_0x2dbbf4['value']=_0x107ec1,_0x2dbbf4['classList'][_0x576825(0x393)](_0x576825(0x454)),$(_0x576825(0x38b))['classList'][_0x576825(0x30f)](_0x576825(0x3ae));try{trapFocus($(_0x576825(0x38b)));}catch(_0x5c9072){}_0x2dbbf4[_0x576825(0x310)](),_0x2dbbf4[_0x576825(0x3d2)]();const _0x4ff153=()=>{const _0x52a6aa=_0x576825;_0x1ae063(_0x2dbbf4[_0x52a6aa(0x406)]),_0x9fd129();},_0x1f8353=()=>_0x9fd129(),_0x329927=_0x38bcbe=>{const _0x4c6c50=_0x576825;if(_0x38bcbe[_0x4c6c50(0x2f4)]===_0x4c6c50(0x4d2))_0x4ff153();if(_0x38bcbe[_0x4c6c50(0x2f4)]==='Escape')_0x1f8353();};$(_0x576825(0x2f0))[_0x576825(0x2c3)]=_0x4ff153,$(_0x576825(0x2f9))['onclick']=_0x1f8353,_0x2dbbf4[_0x576825(0x30d)]=_0x329927;function _0x9fd129(){const _0x5e46f5=_0x576825;$(_0x5e46f5(0x38b))[_0x5e46f5(0x279)]['remove'](_0x5e46f5(0x3ae)),$('#btnGenericOk')[_0x5e46f5(0x2c3)]=null,$(_0x5e46f5(0x2f9))[_0x5e46f5(0x2c3)]=null,_0x2dbbf4[_0x5e46f5(0x30d)]=null;try{releaseFocus();}catch(_0x5d0cc9){}}}function showConfirmModal(_0x5f1e68,_0x3ab93a,_0xffc642){const _0x421a5f=_0x17450c;$('#genericTitle')[_0x421a5f(0x48c)]=_0x5f1e68;const _0x4df276=$(_0x421a5f(0x3c5));_0x4df276['textContent']=_0x3ab93a,_0x4df276[_0x421a5f(0x279)]['remove']('hidden'),$('#genericInput')[_0x421a5f(0x279)]['add'](_0x421a5f(0x454)),$(_0x421a5f(0x38b))['classList'][_0x421a5f(0x30f)](_0x421a5f(0x3ae));try{trapFocus($(_0x421a5f(0x38b)));}catch(_0xf68159){}const _0x9cb050=()=>{_0xffc642(!![]),_0x3dafb1();},_0x3eb3e4=()=>{_0xffc642(![]),_0x3dafb1();};$(_0x421a5f(0x2f0))[_0x421a5f(0x2c3)]=_0x9cb050,$('#btnGenericCancel')['onclick']=_0x3eb3e4;function _0x3dafb1(){const _0x326bdc=_0x421a5f;$(_0x326bdc(0x38b))['classList']['remove']('show'),$(_0x326bdc(0x2f0))[_0x326bdc(0x2c3)]=null,$(_0x326bdc(0x2f9))[_0x326bdc(0x2c3)]=null;try{releaseFocus();}catch(_0x3a5000){}}}let pendingNoteSessionId=null;function openNoteModal(_0x54dcda){const _0x15f5fc=_0x17450c;pendingNoteSessionId=_0x54dcda||null;const _0x4db81=$(_0x15f5fc(0x433));if(!_0x4db81)return;const _0xe63b71=$(_0x15f5fc(0x449));if(_0xe63b71)try{_0xe63b71[_0x15f5fc(0x406)]='';}catch(_0x3de0c8){}_0x4db81[_0x15f5fc(0x279)][_0x15f5fc(0x30f)]('show');try{trapFocus(_0x4db81);}catch(_0x4e6ba5){}}function closeNoteModal(){const _0x2cade8=_0x17450c,_0x4ea61d=$(_0x2cade8(0x433));if(!_0x4ea61d)return;_0x4ea61d['classList']['remove'](_0x2cade8(0x3ae)),pendingNoteSessionId=null;try{releaseFocus();}catch(_0x3fdb17){}}async function switchView(_0x1ad564){const _0x495cb0=_0x17450c;$$(_0x495cb0(0x2e4))[_0x495cb0(0x4a0)](_0x246d3d=>_0x246d3d[_0x495cb0(0x279)]['remove'](_0x495cb0(0x357))),$(_0x495cb0(0x3e1)+_0x1ad564)[_0x495cb0(0x279)][_0x495cb0(0x30f)](_0x495cb0(0x357)),$$(_0x495cb0(0x47a))[_0x495cb0(0x4a0)](_0x59e415=>_0x59e415['classList'][_0x495cb0(0x393)](_0x495cb0(0x357)));const _0x3755cc=$(_0x495cb0(0x272)+_0x1ad564+'\x22]');if(_0x3755cc)_0x3755cc[_0x495cb0(0x279)][_0x495cb0(0x30f)](_0x495cb0(0x357));data['settings'][_0x495cb0(0x3cd)]=_0x1ad564,await saveData(),_0x1ad564===_0x495cb0(0x488)&&renderDashboard();}function closeAllMenus(){const _0xb0d39f=_0x17450c;$$(_0xb0d39f(0x4db))['forEach'](_0x572020=>_0x572020[_0xb0d39f(0x279)]['remove'](_0xb0d39f(0x3ae))),$$(_0xb0d39f(0x22a))[_0xb0d39f(0x4a0)](_0x40fe1e=>_0x40fe1e[_0xb0d39f(0x279)][_0xb0d39f(0x393)](_0xb0d39f(0x292)));}function renderTopics(){const _0x593f67=_0x17450c,_0x1f31a4=$(_0x593f67(0x3d7));if(!_0x1f31a4)return;_0x1f31a4[_0x593f67(0x1ef)]='';const _0x3aa5f5=data[_0x593f67(0x4a9)][_0x593f67(0x36e)]||{};data['topics'][_0x593f67(0x4a0)](_0x7f0620=>{const _0x1d786b=_0x593f67,_0xb37438=document[_0x1d786b(0x251)](_0x1d786b(0x2d4));_0xb37438[_0x1d786b(0x2a9)]=_0x1d786b(0x32a),_0xb37438[_0x1d786b(0x32d)][_0x1d786b(0x2b3)]=_0x7f0620['id'];const _0x141573=document[_0x1d786b(0x251)](_0x1d786b(0x2d4));_0x141573[_0x1d786b(0x2a9)]=_0x1d786b(0x2b9);const _0xbebd68=!!_0x3aa5f5[_0x7f0620['id']],_0x159437=document[_0x1d786b(0x251)]('button');_0x159437[_0x1d786b(0x2a9)]=_0x1d786b(0x336),_0x159437['setAttribute'](_0x1d786b(0x496),String(!_0xbebd68)),_0x159437['innerHTML']=_0x1d786b(0x353);const _0x489fb0=document[_0x1d786b(0x251)](_0x1d786b(0x2d4));_0x489fb0[_0x1d786b(0x2a9)]=_0x1d786b(0x29c),_0x489fb0[_0x1d786b(0x48c)]=_0x7f0620['name'];const _0x1db5b4=document['createElement'](_0x1d786b(0x2d4));_0x1db5b4[_0x1d786b(0x2a9)]=_0x1d786b(0x3f0);const _0x776eb3=document['createElement'](_0x1d786b(0x2eb));_0x776eb3['className']=_0x1d786b(0x45f),_0x776eb3[_0x1d786b(0x1ef)]=_0x1d786b(0x203),_0x776eb3[_0x1d786b(0x241)]=_0x1d786b(0x227);const _0x105d2b=document[_0x1d786b(0x251)](_0x1d786b(0x2d4));_0x105d2b[_0x1d786b(0x3a2)][_0x1d786b(0x35a)]=_0x1d786b(0x328);const _0x2b7b0c=document[_0x1d786b(0x251)]('button');_0x2b7b0c[_0x1d786b(0x2a9)]='btn\x20small\x20ghost\x20actions-menu-btn',_0x2b7b0c[_0x1d786b(0x1ef)]=_0x1d786b(0x4dd),_0x2b7b0c[_0x1d786b(0x241)]='Thêm\x20tùy\x20chọn';const _0x3a6db8=document[_0x1d786b(0x251)]('div');_0x3a6db8[_0x1d786b(0x2a9)]=_0x1d786b(0x23c);const _0xe962cb=document[_0x1d786b(0x251)](_0x1d786b(0x2eb));_0xe962cb[_0x1d786b(0x2a9)]=_0x1d786b(0x304),_0xe962cb[_0x1d786b(0x1ef)]=_0x1d786b(0x307);const _0x5064c1=document[_0x1d786b(0x251)]('button');_0x5064c1[_0x1d786b(0x2a9)]='menu-item\x20danger',_0x5064c1[_0x1d786b(0x1ef)]='Xóa\x20Chủ\x20đề',_0x3a6db8[_0x1d786b(0x3a5)](_0xe962cb,_0x5064c1),_0x105d2b[_0x1d786b(0x3a5)](_0x2b7b0c,_0x3a6db8),_0x1db5b4[_0x1d786b(0x3a5)](_0x776eb3,_0x105d2b),_0x141573['append'](_0x159437,_0x489fb0,_0x1db5b4),_0x159437[_0x1d786b(0x45b)](_0x1d786b(0x4a4),async _0x2ef26f=>{const _0x11902a=_0x1d786b;_0x2ef26f[_0x11902a(0x2a0)]();const _0x4608fc=!!_0x3aa5f5[_0x7f0620['id']];_0x4608fc?delete _0x3aa5f5[_0x7f0620['id']]:_0x3aa5f5[_0x7f0620['id']]=!![],data[_0x11902a(0x4a9)][_0x11902a(0x36e)]=_0x3aa5f5,await storageManager[_0x11902a(0x1e7)](data['settings']),renderTopics();});const _0x279bd1=async()=>{const _0x295387=_0x1d786b,_0x20a35b=!!_0x3aa5f5[_0x7f0620['id']];_0x20a35b?delete _0x3aa5f5[_0x7f0620['id']]:_0x3aa5f5[_0x7f0620['id']]=!![],data[_0x295387(0x4a9)][_0x295387(0x36e)]=_0x3aa5f5,await storageManager[_0x295387(0x1e7)](data[_0x295387(0x4a9)]),renderTopics();};_0x141573[_0x1d786b(0x45b)](_0x1d786b(0x4a4),async _0x203e3a=>{const _0x532cd1=_0x1d786b,_0x2ffa7d=_0x203e3a[_0x532cd1(0x4a2)];if(_0x2ffa7d&&_0x2ffa7d[_0x532cd1(0x24c)]){if(_0x2ffa7d['closest'](_0x532cd1(0x36b))||_0x2ffa7d['closest'](_0x532cd1(0x3ab))||_0x2ffa7d['closest']('button')||_0x2ffa7d[_0x532cd1(0x24c)](_0x532cd1(0x31d)))return;}_0x203e3a[_0x532cd1(0x2a0)](),await _0x279bd1();}),_0x489fb0[_0x1d786b(0x45b)](_0x1d786b(0x4a4),async _0x2215fd=>{_0x2215fd['stopPropagation'](),await _0x279bd1();}),_0xb37438[_0x1d786b(0x45b)]('click',async _0x423080=>{const _0x1a63e7=_0x1d786b,_0x5843e6=_0x423080[_0x1a63e7(0x4a2)];if(_0x5843e6&&_0x5843e6['closest']){if(_0x5843e6['closest'](_0x1a63e7(0x230)))return;if(_0x5843e6[_0x1a63e7(0x24c)](_0x1a63e7(0x36b))||_0x5843e6[_0x1a63e7(0x24c)](_0x1a63e7(0x3ab))||_0x5843e6[_0x1a63e7(0x24c)](_0x1a63e7(0x2eb))||_0x5843e6[_0x1a63e7(0x24c)](_0x1a63e7(0x31d)))return;}await _0x279bd1();});const _0x3e8c23=document[_0x1d786b(0x251)](_0x1d786b(0x2d4));_0x3e8c23[_0x1d786b(0x2a9)]='subtopics'+(_0xbebd68?_0x1d786b(0x38a):''),_0x3e8c23[_0x1d786b(0x32d)]['tid']=_0x7f0620['id'],_0x7f0620[_0x1d786b(0x206)][_0x1d786b(0x4a0)](_0x3b1097=>{const _0x501b01=_0x1d786b,_0x5ee8f5=document[_0x501b01(0x251)](_0x501b01(0x2d4));_0x5ee8f5[_0x501b01(0x2a9)]='sub-row',_0x5ee8f5[_0x501b01(0x32d)]['sid']=_0x3b1097['id'];const _0x41eac3=document[_0x501b01(0x251)](_0x501b01(0x2eb));_0x41eac3[_0x501b01(0x2a9)]=_0x501b01(0x285),_0x41eac3['textContent']='•\x20'+_0x3b1097[_0x501b01(0x422)],_0x41eac3['dataset'][_0x501b01(0x2fb)]=_0x3b1097['id'],_0x41eac3[_0x501b01(0x32d)][_0x501b01(0x2b3)]=_0x7f0620['id'];if(data[_0x501b01(0x4a9)][_0x501b01(0x2c0)]===_0x3b1097['id'])_0x41eac3['classList'][_0x501b01(0x30f)](_0x501b01(0x357));const _0x3bfb17=document[_0x501b01(0x251)]('div');_0x3bfb17['className']='actions';const _0x21ff6c=document[_0x501b01(0x251)](_0x501b01(0x2d4));_0x21ff6c['style']['position']=_0x501b01(0x328);const _0x1e2982=document[_0x501b01(0x251)](_0x501b01(0x2eb));_0x1e2982[_0x501b01(0x2a9)]=_0x501b01(0x298),_0x1e2982['innerHTML']=_0x501b01(0x4dd),_0x1e2982[_0x501b01(0x241)]=_0x501b01(0x451);const _0x4c07e7=document[_0x501b01(0x251)]('div');_0x4c07e7['className']='actions-menu';const _0x5becd3=document[_0x501b01(0x251)]('button');_0x5becd3[_0x501b01(0x2a9)]=_0x501b01(0x304),_0x5becd3[_0x501b01(0x1ef)]=_0x501b01(0x3b2);const _0x23c978=document['createElement']('button');_0x23c978[_0x501b01(0x2a9)]=_0x501b01(0x204),_0x23c978[_0x501b01(0x1ef)]=_0x501b01(0x427),_0x4c07e7[_0x501b01(0x3a5)](_0x5becd3,_0x23c978),_0x21ff6c[_0x501b01(0x3a5)](_0x1e2982,_0x4c07e7),_0x3bfb17['append'](_0x21ff6c),_0x5ee8f5[_0x501b01(0x3a5)](_0x41eac3,_0x3bfb17),_0x3e8c23['appendChild'](_0x5ee8f5),_0x41eac3[_0x501b01(0x45b)]('click',()=>selectSubtopic(_0x7f0620['id'],_0x3b1097['id'])),_0x1e2982['addEventListener']('click',_0x4b5052=>{const _0x3f5814=_0x501b01;_0x4b5052[_0x3f5814(0x2a0)]();const _0x8bece7=_0x4c07e7[_0x3f5814(0x279)][_0x3f5814(0x4ea)](_0x3f5814(0x3ae));closeAllMenus(),_0x8bece7?_0xb37438['classList'][_0x3f5814(0x393)](_0x3f5814(0x292)):(_0x4c07e7[_0x3f5814(0x279)][_0x3f5814(0x30f)](_0x3f5814(0x3ae)),_0xb37438[_0x3f5814(0x279)][_0x3f5814(0x30f)](_0x3f5814(0x292)));}),_0x5becd3[_0x501b01(0x45b)](_0x501b01(0x4a4),()=>showInputModal(_0x501b01(0x2bf),async _0x5f571c=>{const _0x3807a2=_0x501b01;if(!_0x5f571c)return;_0x3b1097['name']=_0x5f571c,await storageManager[_0x3807a2(0x476)](_0x3807a2(0x206),_0x3b1097),renderAll();},_0x3b1097['name'])),_0x23c978['addEventListener']('click',()=>showConfirmModal(_0x501b01(0x500),_0x501b01(0x4fc)+_0x3b1097[_0x501b01(0x422)]+_0x501b01(0x3ef),async _0x14738a=>{const _0x4efd94=_0x501b01;if(!_0x14738a)return;_0x7f0620['subtopics']=_0x7f0620[_0x4efd94(0x206)][_0x4efd94(0x3a0)](_0x931765=>_0x931765['id']!==_0x3b1097['id']);const _0x30b94b=data[_0x4efd94(0x4a9)];_0x30b94b[_0x4efd94(0x2c0)]===_0x3b1097['id']&&(_0x30b94b[_0x4efd94(0x2c0)]='',_0x30b94b[_0x4efd94(0x3e7)]='',ensureValidSelection()),await storageManager[_0x4efd94(0x3e3)](_0x4efd94(0x206),_0x3b1097['id']),renderAll();}));}),_0x2b7b0c[_0x1d786b(0x45b)](_0x1d786b(0x4a4),_0x27e861=>{const _0x27d87f=_0x1d786b;_0x27e861[_0x27d87f(0x2a0)]();const _0x376c45=_0x3a6db8[_0x27d87f(0x279)][_0x27d87f(0x4ea)](_0x27d87f(0x3ae));closeAllMenus(),_0x376c45?_0xb37438[_0x27d87f(0x279)][_0x27d87f(0x393)](_0x27d87f(0x292)):(_0x3a6db8[_0x27d87f(0x279)][_0x27d87f(0x30f)](_0x27d87f(0x3ae)),_0xb37438[_0x27d87f(0x279)][_0x27d87f(0x30f)](_0x27d87f(0x292)));}),_0x776eb3['addEventListener'](_0x1d786b(0x4a4),()=>showInputModal(_0x1d786b(0x208),async _0x5e35c0=>{const _0x1a42ee=_0x1d786b;if(!_0x5e35c0)return;const _0x49980d={'id':uid('s'),'topicId':_0x7f0620['id'],'name':_0x5e35c0,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'methods':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':_0x1a42ee(0x4b6),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x7f0620[_0x1a42ee(0x206)][_0x1a42ee(0x367)](_0x49980d),await storageManager['add'](_0x1a42ee(0x206),_0x49980d),renderTopics();})),_0xe962cb['addEventListener'](_0x1d786b(0x4a4),()=>showInputModal(_0x1d786b(0x392),async _0x11b9c3=>{const _0x2aa342=_0x1d786b;if(!_0x11b9c3)return;_0x7f0620[_0x2aa342(0x422)]=_0x11b9c3,await storageManager[_0x2aa342(0x476)](_0x2aa342(0x3b3),_0x7f0620),renderTopics();},_0x7f0620[_0x1d786b(0x422)])),_0x5064c1['addEventListener'](_0x1d786b(0x4a4),()=>showConfirmModal(_0x1d786b(0x500),'Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22'+_0x7f0620[_0x1d786b(0x422)]+_0x1d786b(0x429),async _0x307691=>{const _0x3af855=_0x1d786b;if(!_0x307691)return;data['topics']=data[_0x3af855(0x3b3)]['filter'](_0x23c001=>_0x23c001['id']!==_0x7f0620['id']),delete _0x3aa5f5[_0x7f0620['id']];data[_0x3af855(0x4a9)][_0x3af855(0x3e7)]===_0x7f0620['id']&&(data[_0x3af855(0x4a9)]['selectedTopicId']='',data[_0x3af855(0x4a9)][_0x3af855(0x2c0)]='',ensureValidSelection());await storageManager[_0x3af855(0x3e3)]('topics',_0x7f0620['id']);for(const _0x42917c of _0x7f0620[_0x3af855(0x206)]){await storageManager[_0x3af855(0x3e3)](_0x3af855(0x206),_0x42917c['id']);}renderAll();})),_0x776eb3[_0x1d786b(0x45b)](_0x1d786b(0x4a4),_0x3339bf=>_0x3339bf[_0x1d786b(0x2a0)]()),_0xe962cb[_0x1d786b(0x45b)]('click',_0x1dd8f4=>_0x1dd8f4[_0x1d786b(0x2a0)]()),_0x5064c1['addEventListener'](_0x1d786b(0x4a4),_0x158991=>_0x158991[_0x1d786b(0x2a0)]()),_0xb37438[_0x1d786b(0x3a5)](_0x141573,_0x3e8c23),_0x1f31a4[_0x1d786b(0x2e8)](_0xb37438);});if(window['Sortable']){const _0xb0ee19=document[_0x593f67(0x1f8)](_0x593f67(0x3c0));if(_0xb0ee19){if(_0xb0ee19[_0x593f67(0x4f9)])try{_0xb0ee19[_0x593f67(0x4f9)]['destroy']();}catch(_0x94700b){}_0xb0ee19['_sortable']=new Sortable(_0xb0ee19,{'animation':0x96,'draggable':'.topic-item','onEnd':async function(_0x357e46){const _0x360645=_0x593f67;if(_0x357e46[_0x360645(0x352)]===_0x357e46[_0x360645(0x23d)])return;const _0x20d52e=data[_0x360645(0x3b3)][_0x360645(0x453)](_0x357e46['oldIndex'],0x1)[0x0];data['topics']['splice'](_0x357e46[_0x360645(0x23d)],0x0,_0x20d52e),await saveData(),renderTopics();}}),_0xb0ee19[_0x593f67(0x283)](_0x593f67(0x230))['forEach'](_0x1e52d7=>{const _0x43fde7=_0x593f67;new Sortable(_0x1e52d7,{'group':'subtopics-group','animation':0x96,'draggable':_0x43fde7(0x35f),'onEnd':async function(_0x15c241){const _0x3a704c=_0x43fde7,_0x315330=_0x15c241[_0x3a704c(0x2c2)]?.[_0x3a704c(0x32d)]?.[_0x3a704c(0x2b3)]||_0x15c241[_0x3a704c(0x2c2)]?.[_0x3a704c(0x24c)](_0x3a704c(0x2c4))?.[_0x3a704c(0x32d)]?.[_0x3a704c(0x2b3)],_0x399309=_0x15c241['to']?.[_0x3a704c(0x32d)]?.[_0x3a704c(0x2b3)]||_0x15c241['to']?.[_0x3a704c(0x24c)](_0x3a704c(0x2c4))?.[_0x3a704c(0x32d)]?.[_0x3a704c(0x2b3)],_0x1631cb=data[_0x3a704c(0x3b3)][_0x3a704c(0x28c)](_0x56b9f2=>_0x56b9f2['id']===_0x315330),_0x234783=data[_0x3a704c(0x3b3)][_0x3a704c(0x28c)](_0x14ef09=>_0x14ef09['id']===_0x399309);if(!_0x1631cb||!_0x234783)return;let _0x4bd817=null;const _0x7e5b1a=_0x15c241['item']?.[_0x3a704c(0x32d)]?.[_0x3a704c(0x2fb)]||_0x15c241[_0x3a704c(0x3b5)]?.[_0x3a704c(0x48d)](_0x3a704c(0x4de))?.[_0x3a704c(0x32d)]?.['sid'];if(_0x7e5b1a){const _0x2fb67d=_0x1631cb[_0x3a704c(0x206)][_0x3a704c(0x4ec)](_0x49332e=>_0x49332e['id']===_0x7e5b1a);if(_0x2fb67d>=0x0)_0x4bd817=_0x1631cb[_0x3a704c(0x206)][_0x3a704c(0x453)](_0x2fb67d,0x1)[0x0];}!_0x4bd817&&(_0x4bd817=_0x1631cb[_0x3a704c(0x206)][_0x3a704c(0x453)](_0x15c241['oldIndex'],0x1)[0x0]);if(!_0x4bd817)return;_0x4bd817[_0x3a704c(0x281)]=_0x234783['id'],_0x234783['subtopics'][_0x3a704c(0x453)](_0x15c241['newIndex'],0x0,_0x4bd817),data['settings']['selectedSubtopicId']===_0x4bd817['id']&&(data['settings'][_0x3a704c(0x3e7)]=_0x234783['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x1a2515,_0xb060fa){const _0x83069b=_0x17450c,_0x5d587f=$('.app-content'),_0x1543af=getCurrentSubtopic();_0x1543af&&timer['state']!=='idle'&&(_0x1543af[_0x83069b(0x4c2)]={'state':timer['state'],'prevState':timer[_0x83069b(0x440)],'remaining':timer[_0x83069b(0x28b)],'segmentTotal':timer[_0x83069b(0x224)],'cycleIndex':timer[_0x83069b(0x358)]}),_0x5d587f[_0x83069b(0x279)]['add'](_0x83069b(0x417)),setTimeout(async()=>{const _0x597a8c=_0x83069b;data[_0x597a8c(0x4a9)][_0x597a8c(0x3e7)]=_0x1a2515,data['settings'][_0x597a8c(0x2c0)]=_0xb060fa;const _0x22c448=getCurrentSubtopic();_0x22c448[_0x597a8c(0x4c2)]?(timer[_0x597a8c(0x24d)]=_0x22c448['timerState'][_0x597a8c(0x24d)],timer[_0x597a8c(0x440)]=_0x22c448[_0x597a8c(0x4c2)][_0x597a8c(0x440)]||null,timer['remaining']=_0x22c448[_0x597a8c(0x4c2)][_0x597a8c(0x28b)],timer[_0x597a8c(0x224)]=_0x22c448['timerState'][_0x597a8c(0x224)],timer['cycleIndex']=_0x22c448['timerState'][_0x597a8c(0x358)]):timer[_0x597a8c(0x24a)](),await saveData(),timer[_0x597a8c(0x345)](),renderAll(),switchView('timer'),_0x5d587f[_0x597a8c(0x279)][_0x597a8c(0x393)]('reloading');},0xc8);}function getCurrentSubtopic(){const _0x5a5418=_0x17450c,_0x2ce57c=data['settings']['selectedTopicId'],_0x8e6253=data[_0x5a5418(0x4a9)][_0x5a5418(0x2c0)];if(!_0x2ce57c||!_0x8e6253)return null;const _0x49c58f=data[_0x5a5418(0x3b3)]['find'](_0x3cf30d=>_0x3cf30d['id']===_0x2ce57c);if(!_0x49c58f)return null;return _0x49c58f[_0x5a5418(0x206)][_0x5a5418(0x28c)](_0x3d1e70=>_0x3d1e70['id']===_0x8e6253)||null;}function renderContextBadge(){const _0x489863=_0x17450c,_0x32a229=getCurrentSubtopic(),_0x3ce682=_0x32a229?_0x32a229[_0x489863(0x422)]:'(chưa\x20chọn)',_0x3ff6fd=$(_0x489863(0x41e)),_0x31ba90=$(_0x489863(0x490)),_0x4d4a0e=$('#currentSubtopicNameChat');if(_0x3ff6fd)_0x3ff6fd[_0x489863(0x48c)]=_0x32a229?_0x489863(0x3ed)+_0x32a229[_0x489863(0x422)]:_0x489863(0x343);if(_0x31ba90)_0x31ba90[_0x489863(0x48c)]=_0x3ce682;if(_0x4d4a0e)_0x4d4a0e[_0x489863(0x48c)]=_0x3ce682;}function renderSubtopicTasks(){const _0x17f236=_0x17450c,_0xa2c893=getCurrentSubtopic(),_0x47f9d4=$('#subtopicTasksList'),_0x3cfef5=$('#newSubtopicTaskInput');if(!_0x47f9d4||!_0x3cfef5)return;const _0x25a798=_0x3cfef5['parentElement'];if(!_0xa2c893){_0x47f9d4['innerHTML']=_0x17f236(0x4c4),_0x25a798[_0x17f236(0x279)][_0x17f236(0x30f)]('hidden');return;}_0x25a798['classList'][_0x17f236(0x393)](_0x17f236(0x454)),_0x47f9d4[_0x17f236(0x1ef)]='';const _0x559678=_0xa2c893[_0x17f236(0x229)]?_0xa2c893[_0x17f236(0x229)][_0x17f236(0x3a0)](_0x2b6a10=>!_0x2b6a10[_0x17f236(0x300)]):[];_0x559678[_0x17f236(0x223)]===0x0&&(_0x47f9d4[_0x17f236(0x1ef)]='<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>'),_0x559678[_0x17f236(0x4a0)](_0x5046cd=>{const _0x574f26=_0x17f236,_0x23a120=document[_0x574f26(0x251)]('li');_0x23a120[_0x574f26(0x1ef)]=_0x574f26(0x421)+_0x5046cd['id']+_0x574f26(0x434)+_0x5046cd['id']+'\x22>'+escapeHTML(_0x5046cd[_0x574f26(0x2ee)])+_0x574f26(0x1ea),_0x23a120[_0x574f26(0x48d)]('input')['addEventListener'](_0x574f26(0x315),_0x1728a9=>toggleSubtopicTask(_0x1728a9[_0x574f26(0x4a2)]['id'],_0x23a120)),_0x47f9d4[_0x574f26(0x2e8)](_0x23a120);});}async function addSubtopicTask(){const _0x15e797=_0x17450c,_0x4dc836=getCurrentSubtopic();if(!_0x4dc836){toast(t(_0x15e797(0x4e9)));return;}const _0x3290a5=$(_0x15e797(0x218)),_0x300769=_0x3290a5['value'][_0x15e797(0x404)]();if(_0x300769){if(!_0x4dc836[_0x15e797(0x229)])_0x4dc836[_0x15e797(0x229)]=[];_0x4dc836[_0x15e797(0x229)]['push']({'id':uid(_0x15e797(0x450)),'text':_0x300769,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x3290a5[_0x15e797(0x406)]='';}_0x3290a5[_0x15e797(0x310)]();}async function toggleSubtopicTask(_0x51000a,_0x534220){const _0x273f05=_0x17450c,_0x24ca07=getCurrentSubtopic();if(!_0x24ca07||!_0x24ca07[_0x273f05(0x229)])return;const _0x2d11f5=_0x24ca07[_0x273f05(0x229)]['find'](_0x14c2fa=>_0x14c2fa['id']===_0x51000a);_0x2d11f5&&(_0x2d11f5[_0x273f05(0x300)]=!![],_0x24ca07[_0x273f05(0x488)]['tasksCompleted']=(_0x24ca07[_0x273f05(0x488)]['tasksCompleted']||0x0)+0x1,await saveData(),_0x534220[_0x273f05(0x279)][_0x273f05(0x30f)](_0x273f05(0x4f3)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':_0x17450c(0x4b6),'prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0x344dfc,{silent:silent=![]}={}){const _0x3abee3=_0x17450c,_0x4fbf9a=data[_0x3abee3(0x4a9)];this['mode']=_0x344dfc,this[_0x3abee3(0x41d)]=_0x344dfc==='A'?_0x4fbf9a[_0x3abee3(0x34c)]:_0x344dfc==='B'?_0x4fbf9a['cyclesB']:0x0,_0x4fbf9a[_0x3abee3(0x323)]=_0x344dfc,await saveData(),this[_0x3abee3(0x24d)]===_0x3abee3(0x4b6)&&this[_0x3abee3(0x24a)]();},'currentDurations'(){const _0x12e39a=_0x17450c,_0x4c3c67=data[_0x12e39a(0x4a9)][_0x12e39a(0x3d9)];if(this[_0x12e39a(0x3c2)]==='A')return{'work':_0x4c3c67[_0x12e39a(0x412)],'short':_0x4c3c67[_0x12e39a(0x494)],'long':_0x4c3c67[_0x12e39a(0x40f)],'winddown':_0x4c3c67[_0x12e39a(0x42f)]??0x0};if(this[_0x12e39a(0x3c2)]==='B')return{'work':_0x4c3c67[_0x12e39a(0x436)],'short':_0x4c3c67[_0x12e39a(0x47c)],'long':_0x4c3c67[_0x12e39a(0x231)],'winddown':_0x4c3c67[_0x12e39a(0x4a5)]??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x481240=_0x17450c,_0x420315=data[_0x481240(0x4a9)];if(this['mode']==='A')return{'cycles':_0x420315[_0x481240(0x34c)],'interval':_0x420315['longBreakIntervalA']};if(this[_0x481240(0x3c2)]==='B')return{'cycles':_0x420315[_0x481240(0x2ff)],'interval':_0x420315[_0x481240(0x474)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x2a1146=_0x17450c,_0x59c190=$(_0x2a1146(0x46f)),_0x280c0a=$(_0x2a1146(0x4c6)),_0x2122e9=$('.timer-circle-container');if(!_0x59c190||!_0x280c0a||!_0x2122e9)return;const _0x22bf6f=this[_0x2a1146(0x3c2)]==='C';$(_0x2a1146(0x2b7))[_0x2a1146(0x279)]['toggle'](_0x2a1146(0x454),this[_0x2a1146(0x24d)]!==_0x2a1146(0x4b6)||_0x22bf6f&&this[_0x2a1146(0x24d)]===_0x2a1146(0x380)),$(_0x2a1146(0x464))[_0x2a1146(0x279)][_0x2a1146(0x44c)]('hidden',!(_0x22bf6f&&this['state']===_0x2a1146(0x380))),$(_0x2a1146(0x355))[_0x2a1146(0x279)][_0x2a1146(0x44c)](_0x2a1146(0x454),![_0x2a1146(0x380),'break',_0x2a1146(0x302)][_0x2a1146(0x49f)](this[_0x2a1146(0x24d)])),$(_0x2a1146(0x339))[_0x2a1146(0x279)][_0x2a1146(0x44c)](_0x2a1146(0x454),this['state']!==_0x2a1146(0x3ba));let _0xc605af='var(--muted)';if(this[_0x2a1146(0x24d)]===_0x2a1146(0x380))_0x59c190[_0x2a1146(0x48c)]=_0x22bf6f?_0x2a1146(0x2d2):_0x2a1146(0x232),_0x59c190['className']=_0x2a1146(0x470),_0xc605af='var(--acc)';else{if(this['state']==='break')_0x59c190['textContent']='NGHỈ\x20NGẮN',_0x59c190[_0x2a1146(0x2a9)]=_0x2a1146(0x31e),_0xc605af=_0x2a1146(0x3f4);else{if(this[_0x2a1146(0x24d)]==='long_break')_0x59c190[_0x2a1146(0x48c)]='NGHỈ\x20DÀI',_0x59c190['className']='badge\x20state\x20long',_0xc605af='var(--danger)';else{if(this['state']===_0x2a1146(0x333)){_0x59c190['textContent']=_0x2a1146(0x238),_0x59c190[_0x2a1146(0x2a9)]=_0x2a1146(0x470),_0xc605af=_0x2a1146(0x20a);try{$(_0x2a1146(0x487))[_0x2a1146(0x279)][_0x2a1146(0x393)](_0x2a1146(0x454)),$('#btnBreakEarly')[_0x2a1146(0x279)][_0x2a1146(0x393)](_0x2a1146(0x454));}catch(_0x48b914){}}else this['state']===_0x2a1146(0x3ba)?(_0x59c190[_0x2a1146(0x48c)]=_0x2a1146(0x1f2),_0x59c190['className']='badge'):(_0x59c190[_0x2a1146(0x48c)]='SẴN\x20SÀNG',_0x59c190[_0x2a1146(0x2a9)]=_0x2a1146(0x467));}}}[_0x2a1146(0x380),_0x2a1146(0x489),_0x2a1146(0x302),'wind_down'][_0x2a1146(0x49f)](this[_0x2a1146(0x24d)])?_0x2122e9[_0x2a1146(0x279)]['add'](_0x2a1146(0x4d7)):_0x2122e9[_0x2a1146(0x279)][_0x2a1146(0x393)]('breathing');_0x280c0a[_0x2a1146(0x3a2)][_0x2a1146(0x4bb)]=_0xc605af,_0x2122e9[_0x2a1146(0x279)][_0x2a1146(0x393)](_0x2a1146(0x30a));const _0x3c6dd3=$(_0x2a1146(0x2f3));if(_0x3c6dd3)_0x3c6dd3[_0x2a1146(0x48c)]=formatMMSS(this['remaining']);const _0x2a6a80=_0x280c0a['r']['baseVal'][_0x2a1146(0x406)],_0xb10bf9=0x2*Math['PI']*_0x2a6a80,_0x5e394a=this['segmentTotal']>0x0?_0xb10bf9-this[_0x2a1146(0x28b)]/this[_0x2a1146(0x224)]*_0xb10bf9:_0xb10bf9;_0x280c0a[_0x2a1146(0x3a2)][_0x2a1146(0x37e)]=_0xb10bf9,_0x280c0a[_0x2a1146(0x3a2)][_0x2a1146(0x3eb)]=isNaN(_0x5e394a)?_0xb10bf9:_0x5e394a;const _0x1b819b=$(_0x2a1146(0x39b));if(_0x1b819b){const _0xf5949d=this[_0x2a1146(0x42c)]();_0x1b819b[_0x2a1146(0x48c)]=t('timer.cycleInfo',{'current':this[_0x2a1146(0x358)],'target':_0xf5949d[_0x2a1146(0x424)]}),_0x1b819b['classList'][_0x2a1146(0x44c)](_0x2a1146(0x454),_0x22bf6f);}const _0x5511c3=$('#breakSuggestionDisplay');_0x5511c3&&_0x5511c3[_0x2a1146(0x279)]['toggle'](_0x2a1146(0x454),_0x22bf6f&&this[_0x2a1146(0x24d)]===_0x2a1146(0x380));const _0x148a7a=$(_0x2a1146(0x401));if(_0x148a7a)_0x148a7a[_0x2a1146(0x48c)]=formatMMSS(this[_0x2a1146(0x28b)]);if(this['state']!=='wind_down')try{$(_0x2a1146(0x487))[_0x2a1146(0x279)][_0x2a1146(0x30f)]('hidden'),$(_0x2a1146(0x245))[_0x2a1146(0x279)][_0x2a1146(0x30f)](_0x2a1146(0x454));}catch(_0x4282f9){}},'persistTimerState'(_0x5387ee=![]){const _0x57a24c=_0x17450c;try{const _0x4cff45=getCurrentSubtopic();if(!_0x4cff45)return;const _0x2460be={'state':this[_0x57a24c(0x24d)],'prevState':this[_0x57a24c(0x440)],'remaining':this[_0x57a24c(0x28b)],'segmentTotal':this['segmentTotal'],'cycleIndex':this[_0x57a24c(0x358)]};_0x4cff45['timerState']=_0x2460be;try{localStorage[_0x57a24c(0x25d)](_0x57a24c(0x46d)+_0x4cff45['id'],JSON['stringify'](_0x2460be));}catch(_0xde2e67){}this[_0x57a24c(0x259)]=Date[_0x57a24c(0x20e)]();}catch(_0x91f17b){}},'_startTick'(){const _0x54140b=_0x17450c;if(this[_0x54140b(0x383)])clearInterval(this[_0x54140b(0x383)]);if(this[_0x54140b(0x3c2)]==='C'&&this[_0x54140b(0x24d)]===_0x54140b(0x380)){this['tickHandle']=setInterval(()=>{const _0x501c58=_0x54140b;this[_0x501c58(0x28b)]+=0x1,this['updateUI'](),this[_0x501c58(0x37c)]();},0x3e8);return;}this[_0x54140b(0x383)]=setInterval(()=>{const _0x3418ef=_0x54140b;this['remaining']>0x0&&(this[_0x3418ef(0x28b)]-=0x1,this[_0x3418ef(0x345)](),this[_0x3418ef(0x37c)]()),this[_0x3418ef(0x28b)]<=0x0&&(clearInterval(this[_0x3418ef(0x383)]),this[_0x3418ef(0x383)]=null,this[_0x3418ef(0x435)]());},0x3e8);},'_onFinishSegment'(){const _0x106802=_0x17450c;if(this[_0x106802(0x24d)]===_0x106802(0x380)){const _0x16383f=getCurrentSubtopic();if(_0x16383f){const _0x194695=this['currentDurations']()[_0x106802(0x380)];_0x16383f[_0x106802(0x488)]['totalMinutes']=(_0x16383f[_0x106802(0x488)]['totalMinutes']||0x0)+_0x194695,_0x16383f[_0x106802(0x488)][_0x106802(0x36a)]=(_0x16383f['stats'][_0x106802(0x36a)]||0x0)+0x1;const _0x38cd9a={'id':uid(_0x106802(0x212)),'dateISO':todayISO(),'durationMinutes':_0x194695,'mode':this[_0x106802(0x3c2)],'note':''};if(!_0x16383f[_0x106802(0x20d)])_0x16383f[_0x106802(0x20d)]=[];_0x16383f[_0x106802(0x20d)][_0x106802(0x253)](_0x38cd9a);if(data?.[_0x106802(0x4a9)]?.[_0x106802(0x2ab)]!==![])try{openNoteModal(_0x38cd9a['id']);}catch(_0x6ef302){}saveData(),renderStatsHistory(),checkAndShowMilestones();}this['cycleIndex']++;}if(typeof data!==_0x106802(0x2b5)&&data&&data[_0x106802(0x4a9)]&&data[_0x106802(0x4a9)][_0x106802(0x2c6)]===![]&&this[_0x106802(0x24d)]===_0x106802(0x380))playSound(_0x106802(0x2fc));else(this[_0x106802(0x24d)]===_0x106802(0x333)||this['state']===_0x106802(0x489)||this[_0x106802(0x24d)]===_0x106802(0x302))&&playSound('break_end');const _0x1b1440=$('.timer-circle-container');if(_0x1b1440)_0x1b1440['classList'][_0x106802(0x30f)]('finished');if(data[_0x106802(0x4a9)][_0x106802(0x485)]){if(this[_0x106802(0x24d)]===_0x106802(0x380))data[_0x106802(0x4a9)][_0x106802(0x2c6)]===![]?this['beginBreak']():this[_0x106802(0x3d0)]();else this[_0x106802(0x24d)]==='wind_down'?this['beginBreak']():this[_0x106802(0x4a7)]();}else this[_0x106802(0x383)]&&(clearInterval(this['tickHandle']),this['tickHandle']=null),this[_0x106802(0x24d)]=_0x106802(0x4b6),this[_0x106802(0x440)]=null,this[_0x106802(0x345)](),toast(_0x106802(0x252));},'beginWindDown'(){const _0x259b89=_0x17450c;if(data?.[_0x259b89(0x4a9)]?.[_0x259b89(0x2c6)]===![]){this[_0x259b89(0x384)]();return;}this[_0x259b89(0x440)]=this[_0x259b89(0x24d)],this[_0x259b89(0x24d)]=_0x259b89(0x333);const _0x5151a4=(this[_0x259b89(0x201)]()[_0x259b89(0x43d)]||0x0)*0x3c;if(_0x5151a4<=0x0){this[_0x259b89(0x384)]();return;}this[_0x259b89(0x224)]=_0x5151a4,this['remaining']=_0x5151a4;try{playSound(_0x259b89(0x413));}catch(_0x2f9fcc){}try{toast('Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.');}catch(_0x41b48d){}this['_startTick'](),this[_0x259b89(0x345)]();},'beginWork'(){const _0x188c1f=_0x17450c;this['prevState']=this[_0x188c1f(0x24d)],this[_0x188c1f(0x24d)]='work';if(this[_0x188c1f(0x3c2)]==='C'){this['segmentTotal']=0x0;if(this[_0x188c1f(0x440)]!==_0x188c1f(0x3ba))this[_0x188c1f(0x28b)]=0x0;}else{const _0x2c0de7=this[_0x188c1f(0x201)]()[_0x188c1f(0x380)]*0x3c;this[_0x188c1f(0x224)]=_0x2c0de7;if(this['prevState']!=='paused')this['remaining']=_0x2c0de7;}const _0x5eea21=$(_0x188c1f(0x27f));_0x5eea21&&(_0x5eea21[_0x188c1f(0x48c)]=''),this[_0x188c1f(0x368)](),this['updateUI']();},'finishFlowSession'(){const _0x54dc93=_0x17450c;if(this[_0x54dc93(0x3c2)]!=='C'||this['state']!=='work')return;this[_0x54dc93(0x383)]&&(clearInterval(this['tickHandle']),this[_0x54dc93(0x383)]=null);const _0x13c8d3=Math[_0x54dc93(0x3e8)](0x1,parseInt(data[_0x54dc93(0x4a9)]['flowtimeBreakRatio']??0x5,0xa)),_0x228640=Math[_0x54dc93(0x3e8)](0x0,this[_0x54dc93(0x28b)]|0x0),_0x2a30c0=Math[_0x54dc93(0x3e8)](0x3c,Math[_0x54dc93(0x294)](_0x228640/_0x13c8d3));try{const _0x151424=getCurrentSubtopic();if(_0x151424){const _0x23a1d7=Math[_0x54dc93(0x3e8)](0x1,Math[_0x54dc93(0x256)](_0x228640/0x3c));_0x151424['stats'][_0x54dc93(0x369)]=(_0x151424[_0x54dc93(0x488)][_0x54dc93(0x369)]||0x0)+_0x23a1d7,_0x151424[_0x54dc93(0x488)][_0x54dc93(0x36a)]=(_0x151424[_0x54dc93(0x488)][_0x54dc93(0x36a)]||0x0)+0x1;const _0x4e18ec={'id':uid('sess'),'dateISO':todayISO(),'durationMinutes':_0x23a1d7,'mode':this[_0x54dc93(0x3c2)],'note':''};if(!_0x151424[_0x54dc93(0x20d)])_0x151424[_0x54dc93(0x20d)]=[];_0x151424[_0x54dc93(0x20d)][_0x54dc93(0x253)](_0x4e18ec),saveData(),renderStatsHistory(),data?.[_0x54dc93(0x4a9)]?.[_0x54dc93(0x2ab)]!==![]&&openNoteModal(_0x4e18ec['id']);}}catch(_0x29ba57){}this[_0x54dc93(0x24d)]='break',this['segmentTotal']=_0x2a30c0,this[_0x54dc93(0x28b)]=_0x2a30c0,this[_0x54dc93(0x368)](),this['updateUI'](),this[_0x54dc93(0x37c)](!![]);try{toast('Nghỉ\x20'+Math['round'](_0x2a30c0/0x3c)+'\x20phút\x20theo\x20Flowtime\x20('+_0x13c8d3+').');}catch(_0x41fa84){}},'beginBreak'(){const _0x40e307=_0x17450c;this['prevState']=this[_0x40e307(0x24d)];const _0x4721dc=this[_0x40e307(0x42c)](),_0xaadf37=this[_0x40e307(0x201)]();if(this[_0x40e307(0x358)]>0x0&&this[_0x40e307(0x358)]%_0x4721dc[_0x40e307(0x42d)]===0x0){this[_0x40e307(0x24d)]=_0x40e307(0x302);const _0x29baf9=_0xaadf37[_0x40e307(0x240)]*0x3c;this[_0x40e307(0x224)]=_0x29baf9;if(this['prevState']!==_0x40e307(0x3ba))this[_0x40e307(0x28b)]=_0x29baf9;toast('Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.');}else{this[_0x40e307(0x24d)]='break';const _0x470252=_0xaadf37[_0x40e307(0x40b)]*0x3c;this[_0x40e307(0x224)]=_0x470252;if(this['prevState']!=='paused')this[_0x40e307(0x28b)]=_0x470252;}const _0x2e8dc6=$(_0x40e307(0x27f));if(_0x2e8dc6){const _0x312f05=Math[_0x40e307(0x294)](Math[_0x40e307(0x2f5)]()*breakSuggestions[_0x40e307(0x223)]);_0x2e8dc6[_0x40e307(0x48c)]=_0x40e307(0x389)+breakSuggestions[_0x312f05];}this['_startTick'](),this[_0x40e307(0x345)]();},async 'start'(){const _0x5e09f0=_0x17450c;if(!getCurrentSubtopic()){toast('Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu');return;}ensureAudio();if(this[_0x5e09f0(0x3c2)]==='C'&&this[_0x5e09f0(0x24d)]===_0x5e09f0(0x4b6))this[_0x5e09f0(0x24d)]=_0x5e09f0(0x380),this['remaining']=0x0,this[_0x5e09f0(0x224)]=0x0,this[_0x5e09f0(0x358)]=0x0,this[_0x5e09f0(0x368)](),this['updateUI']();else{if(this[_0x5e09f0(0x24d)]===_0x5e09f0(0x4b6))this[_0x5e09f0(0x358)]=this[_0x5e09f0(0x358)]||0x0,this[_0x5e09f0(0x4a7)]();else this[_0x5e09f0(0x24d)]===_0x5e09f0(0x3ba)&&this[_0x5e09f0(0x3d5)]();}await this[_0x5e09f0(0x37c)](!![]);},async 'pause'(){const _0x3bf782=_0x17450c;this[_0x3bf782(0x383)]&&(clearInterval(this[_0x3bf782(0x383)]),this[_0x3bf782(0x383)]=null),this['prevState']=this[_0x3bf782(0x24d)],this['state']=_0x3bf782(0x3ba),this[_0x3bf782(0x345)](),await this['persistTimerState'](!![]);},async 'resume'(){const _0x550586=_0x17450c;if(this['state']!=='paused')return;this[_0x550586(0x24d)]=this['prevState']||'work',this['_startTick'](),this[_0x550586(0x345)](),await this['persistTimerState'](!![]);},async 'skip'(){const _0x3bebcf=_0x17450c;if(this[_0x3bebcf(0x3c2)]==='C'&&this[_0x3bebcf(0x24d)]===_0x3bebcf(0x380)){this[_0x3bebcf(0x264)](),await this['persistTimerState'](!![]);return;}this[_0x3bebcf(0x24d)]===_0x3bebcf(0x380)?(this[_0x3bebcf(0x383)]&&(clearInterval(this[_0x3bebcf(0x383)]),this['tickHandle']=null),this[_0x3bebcf(0x28b)]=0x0,this[_0x3bebcf(0x435)]()):(this[_0x3bebcf(0x28b)]=0x0,this[_0x3bebcf(0x383)]&&(clearInterval(this[_0x3bebcf(0x383)]),this[_0x3bebcf(0x383)]=null),this['_onFinishSegment']()),await this[_0x3bebcf(0x37c)](!![]);},async 'reset'(){const _0x532d2b=_0x17450c;this[_0x532d2b(0x383)]&&(clearInterval(this['tickHandle']),this['tickHandle']=null);this[_0x532d2b(0x24d)]=_0x532d2b(0x4b6),this[_0x532d2b(0x440)]=null,this[_0x532d2b(0x28b)]=0x0,this[_0x532d2b(0x224)]=0x0,this[_0x532d2b(0x358)]=0x0;const _0x53c1ae=$(_0x532d2b(0x27f));_0x53c1ae&&(_0x53c1ae['textContent']=''),this['updateUI'](),await this[_0x532d2b(0x37c)](!![]);}};async function deleteSummary(_0x2b5512){const _0x48d134=_0x17450c;showConfirmModal('Xác\x20nhận\x20xóa',_0x48d134(0x255),async _0x5b28cd=>{const _0x1009c6=_0x48d134;if(!_0x5b28cd)return;const _0x4dbd59=getCurrentSubtopic();if(!_0x4dbd59||!_0x4dbd59[_0x1009c6(0x3a4)])return;const _0x5c1b12=[..._0x4dbd59[_0x1009c6(0x3a4)]];_0x4dbd59[_0x1009c6(0x3a4)]=_0x4dbd59[_0x1009c6(0x3a4)][_0x1009c6(0x3a0)](_0x1f1ad4=>_0x1f1ad4['id']!==_0x2b5512);try{await storageManager[_0x1009c6(0x476)]('subtopics',_0x4dbd59),renderSummaries(),toast(_0x1009c6(0x431));}catch(_0x5db714){console['error'](_0x1009c6(0x4c3),_0x5db714),_0x4dbd59['summaries']=_0x5c1b12,toast(_0x1009c6(0x3ad));}});}function exportSummary(_0x20222a){const _0x1d3d0f=_0x17450c,_0x1678d1=new Blob([_0x20222a[_0x1d3d0f(0x2e0)]],{'type':'text/plain'}),_0x168dee=document[_0x1d3d0f(0x251)]('a'),_0x30f1c6=new Date(_0x20222a[_0x1d3d0f(0x3dd)]),_0x29f246=_0x1937e1=>(''+_0x1937e1)[_0x1d3d0f(0x397)](0x2,'0');_0x168dee['href']=URL[_0x1d3d0f(0x362)](_0x1678d1),_0x168dee[_0x1d3d0f(0x31a)]=_0x1d3d0f(0x3d6)+_0x30f1c6[_0x1d3d0f(0x38d)]()+_0x29f246(_0x30f1c6[_0x1d3d0f(0x2ce)]()+0x1)+_0x29f246(_0x30f1c6[_0x1d3d0f(0x3fa)]())+_0x1d3d0f(0x37a),_0x168dee[_0x1d3d0f(0x4a4)](),URL[_0x1d3d0f(0x459)](_0x168dee[_0x1d3d0f(0x364)]);}function renderStatsHistory(){const _0x418a96=_0x17450c,_0x181177=getCurrentSubtopic(),_0x4dac63=$(_0x418a96(0x26e)),_0x63657e=$('#statSessions'),_0x46a61e=$(_0x418a96(0x3f1)),_0x5ec40e=$(_0x418a96(0x3f5));if(!_0x4dac63||!_0x63657e||!_0x46a61e||!_0x5ec40e)return;if(!_0x181177){_0x4dac63['textContent']=_0x418a96(0x28a),_0x63657e[_0x418a96(0x48c)]='0',_0x46a61e['textContent']='0',_0x5ec40e[_0x418a96(0x1ef)]=_0x418a96(0x473);return;}const _0x5df635=_0x181177[_0x418a96(0x488)]&&_0x181177['stats'][_0x418a96(0x369)]?_0x181177[_0x418a96(0x488)][_0x418a96(0x369)]:0x0,_0x4e3691=_0x181177['stats']&&_0x181177[_0x418a96(0x488)][_0x418a96(0x36a)]?_0x181177['stats']['sessionsCompleted']:0x0,_0x5235a2=_0x181177[_0x418a96(0x229)]?_0x181177[_0x418a96(0x229)][_0x418a96(0x3a0)](_0xbf4b57=>_0xbf4b57[_0x418a96(0x300)])['length']:0x0;_0x4dac63[_0x418a96(0x48c)]=formatDaysHoursMinutes(_0x5df635),_0x63657e['textContent']=String(_0x4e3691),_0x46a61e['textContent']=String(_0x5235a2),_0x5ec40e[_0x418a96(0x1ef)]='';const _0x26b14e=Array[_0x418a96(0x47e)](_0x181177[_0x418a96(0x20d)])?_0x181177[_0x418a96(0x20d)]:[];if(_0x26b14e[_0x418a96(0x223)]===0x0){_0x5ec40e[_0x418a96(0x1ef)]=_0x418a96(0x318);return;}_0x26b14e['forEach'](_0x3378e9=>{const _0x5d97af=_0x418a96,_0xa9d24d=document[_0x5d97af(0x251)](_0x5d97af(0x2d4));_0xa9d24d['className']=_0x5d97af(0x3e4);const _0x1cc0b7=document[_0x5d97af(0x251)](_0x5d97af(0x2d4)),_0x312cac=_0x3378e9['dateISO']?new Date(_0x3378e9['dateISO']):new Date(),_0x2a4c87=_0x3378e9[_0x5d97af(0x4f0)]!=null?_0x3378e9[_0x5d97af(0x4f0)]:_0x3378e9[_0x5d97af(0x4e7)]||0x0,_0x2cb9ac=_0x5d97af(0x337)+_0x312cac[_0x5d97af(0x2c9)]()+_0x5d97af(0x2ea)+_0x2a4c87+'\x27\x20·\x20Mode\x20'+(_0x3378e9['mode']||'')+_0x5d97af(0x221);let _0x418113='';if(_0x3378e9[_0x5d97af(0x481)])_0x418113=_0x5d97af(0x278)+escapeHTML(_0x3378e9['note'])+_0x5d97af(0x221);else data?.['settings']?.[_0x5d97af(0x2ab)]!==![]&&(_0x418113='<div><span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span></div>');_0x1cc0b7[_0x5d97af(0x1ef)]=_0x2cb9ac+_0x418113,_0xa9d24d[_0x5d97af(0x2e8)](_0x1cc0b7),_0x5ec40e[_0x5d97af(0x2e8)](_0xa9d24d);});}function renderGeneralNotes(){const _0x6289a7=_0x17450c,_0x32c90b=$(_0x6289a7(0x446));if(!_0x32c90b)return;const _0x315531=getCurrentSubtopic();if(!_0x315531){_0x32c90b[_0x6289a7(0x1ef)]=_0x6289a7(0x2f7);return;}_0x315531['generalNotes']=_0x315531[_0x6289a7(0x396)]||[];if(_0x315531[_0x6289a7(0x396)][_0x6289a7(0x223)]===0x0){_0x32c90b[_0x6289a7(0x1ef)]='<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>';return;}_0x32c90b[_0x6289a7(0x1ef)]='',_0x315531[_0x6289a7(0x396)][_0x6289a7(0x4a0)](_0x331993=>{const _0x2440da=_0x6289a7,_0x4acd16=document['createElement']('div');_0x4acd16['className']=_0x2440da(0x262);const _0x4d39d3=document['createElement'](_0x2440da(0x2d4));_0x4d39d3[_0x2440da(0x2a9)]=_0x2440da(0x3b6),_0x4d39d3['textContent']=typeof _0x331993==='string'?_0x331993:_0x331993[_0x2440da(0x2ee)]||'';const _0x292266=document[_0x2440da(0x251)]('div');_0x292266['className']=_0x2440da(0x45e),_0x292266[_0x2440da(0x48c)]=_0x331993[_0x2440da(0x3dd)]?new Date(_0x331993[_0x2440da(0x3dd)])[_0x2440da(0x2c9)]():'';const _0x1d4d7b=document[_0x2440da(0x251)](_0x2440da(0x2d4)),_0x5ce4ae=document[_0x2440da(0x251)]('button');_0x5ce4ae[_0x2440da(0x2a9)]=_0x2440da(0x2c8),_0x5ce4ae[_0x2440da(0x48c)]='Xóa',_0x5ce4ae[_0x2440da(0x2c3)]=async _0x4b4e25=>{const _0x246ed2=_0x2440da;_0x4b4e25[_0x246ed2(0x2a0)]();const _0x5aa1b8=getCurrentSubtopic();if(!_0x5aa1b8)return;_0x5aa1b8[_0x246ed2(0x396)]=(_0x5aa1b8['generalNotes']||[])[_0x246ed2(0x3a0)](_0x1ee2b7=>(_0x1ee2b7['id']||_0x1ee2b7)!==(_0x331993['id']||_0x331993)),await saveData(),renderGeneralNotes();},_0x1d4d7b[_0x2440da(0x2e8)](_0x5ce4ae);const _0x28f6b2=document[_0x2440da(0x251)]('div');_0x28f6b2['className']=_0x2440da(0x320),_0x28f6b2[_0x2440da(0x3a5)](_0x4d39d3,_0x292266),_0x4acd16[_0x2440da(0x3a5)](_0x28f6b2,_0x1d4d7b),_0x32c90b[_0x2440da(0x2e8)](_0x4acd16);});}function renderMethods(){const _0x512ea3=_0x17450c,_0x40796c=document[_0x512ea3(0x48d)]('#view-methods\x20.methods-container');if(!_0x40796c)return;_0x40796c[_0x512ea3(0x1ef)]='';const _0xc9b664=getCurrentSubtopic();if(!_0xc9b664){_0x40796c[_0x512ea3(0x1ef)]=_0x512ea3(0x4c5);return;}const _0x29db03=Array[_0x512ea3(0x47e)](_0xc9b664[_0x512ea3(0x4c1)])?_0xc9b664[_0x512ea3(0x4c1)]:[];if(_0x29db03[_0x512ea3(0x223)]===0x0){_0x40796c[_0x512ea3(0x1ef)]='<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20trong\x20Chủ\x20đề\x20con\x20này.</p>';return;}_0x29db03[_0x512ea3(0x4a0)](_0x2dbc08=>{const _0x1f2974=_0x512ea3,_0x482f6a=document['createElement'](_0x1f2974(0x2d4));_0x482f6a['className']='method-item',_0x482f6a[_0x1f2974(0x32d)][_0x1f2974(0x1f7)]=_0x2dbc08['id'];const _0x5ea727=document[_0x1f2974(0x251)](_0x1f2974(0x2d4)),_0x378301=document[_0x1f2974(0x251)]('span');_0x378301[_0x1f2974(0x2a9)]=_0x1f2974(0x40e),_0x378301[_0x1f2974(0x48c)]=_0x2dbc08[_0x1f2974(0x241)]||'Chưa\x20có\x20tiêu\x20đề',_0x378301['addEventListener'](_0x1f2974(0x4a4),_0x1e34c9=>{const _0x3cbb64=_0x1f2974;_0x1e34c9['preventDefault'](),_0x1e34c9[_0x3cbb64(0x2a0)]();const _0x51c607=_0x482f6a[_0x3cbb64(0x48d)](_0x3cbb64(0x41a));if(!_0x51c607)return;const _0x24e74d=_0x51c607[_0x3cbb64(0x454)];_0x40796c[_0x3cbb64(0x283)](_0x3cbb64(0x390))['forEach'](_0x2a6342=>{const _0x131fdb=_0x3cbb64;_0x2a6342[_0x131fdb(0x454)]=!![];}),_0x51c607[_0x3cbb64(0x454)]=!_0x24e74d;});const _0x23cde4=document[_0x1f2974(0x251)]('div');_0x23cde4[_0x1f2974(0x2a9)]='topic-actions';const _0x293860=document[_0x1f2974(0x251)](_0x1f2974(0x2eb));_0x293860['className']='btn\x20small\x20ghost\x20method-edit',_0x293860[_0x1f2974(0x48c)]=_0x1f2974(0x1f6),_0x293860['dataset']['id']=_0x2dbc08['id'];const _0x3aa24d=document[_0x1f2974(0x251)](_0x1f2974(0x2eb));_0x3aa24d['className']=_0x1f2974(0x3aa),_0x3aa24d[_0x1f2974(0x48c)]=_0x1f2974(0x480),_0x3aa24d['dataset']['id']=_0x2dbc08['id'],_0x23cde4[_0x1f2974(0x3a5)](_0x293860,_0x3aa24d),_0x5ea727['append'](_0x378301,_0x23cde4);const _0x31d0be=document[_0x1f2974(0x251)](_0x1f2974(0x2d4));_0x31d0be[_0x1f2974(0x2a9)]=_0x1f2974(0x475),_0x31d0be[_0x1f2974(0x1ef)]=_0x2dbc08[_0x1f2974(0x2e0)]||'',_0x31d0be[_0x1f2974(0x454)]=!![],_0x482f6a[_0x1f2974(0x3a5)](_0x5ea727,_0x31d0be),_0x40796c[_0x1f2974(0x2e8)](_0x482f6a),_0x482f6a[_0x1f2974(0x45b)](_0x1f2974(0x4a4),_0x5666f2=>{const _0x524800=_0x1f2974,_0x80b5a9=_0x5666f2[_0x524800(0x4a2)];if(!_0x80b5a9)return;if(_0x80b5a9[_0x524800(0x24c)](_0x524800(0x2eb))||_0x80b5a9[_0x524800(0x24c)]('a')||_0x80b5a9[_0x524800(0x24c)](_0x524800(0x2aa))||_0x80b5a9[_0x524800(0x24c)](_0x524800(0x38e)))return;const _0x2daa99=_0x31d0be[_0x524800(0x454)];_0x40796c[_0x524800(0x283)]('.method-item\x20.method-content')[_0x524800(0x4a0)](_0x15e159=>{const _0x5dec86=_0x524800;_0x15e159[_0x5dec86(0x454)]=!![];}),_0x31d0be[_0x524800(0x454)]=!_0x2daa99;});});const _0x1ce94c=_0x40796c['querySelectorAll'](_0x512ea3(0x3db));_0x1ce94c[_0x512ea3(0x4a0)](_0x226a4e=>{const _0x52fb4c=_0x512ea3;_0x226a4e['addEventListener'](_0x52fb4c(0x44c),()=>{const _0x245ec4=_0x52fb4c;_0x226a4e['open']&&_0x1ce94c[_0x245ec4(0x4a0)](_0x5a50e4=>{const _0x2b9cb8=_0x245ec4;if(_0x5a50e4!==_0x226a4e)_0x5a50e4[_0x2b9cb8(0x326)]=![];});});}),window[_0x512ea3(0x280)]&&new Sortable(_0x40796c,{'animation':0x96,'draggable':'.method-item','onEnd':async function(_0x1f585c){const _0x2e5d95=_0x512ea3;if(_0x1f585c['oldIndex']===_0x1f585c[_0x2e5d95(0x23d)])return;const _0x2a84e0=getCurrentSubtopic();if(!_0x2a84e0||!Array[_0x2e5d95(0x47e)](_0x2a84e0[_0x2e5d95(0x4c1)]))return;const _0x44a382=_0x2a84e0[_0x2e5d95(0x4c1)]['splice'](_0x1f585c[_0x2e5d95(0x352)],0x1)[0x0];_0x2a84e0[_0x2e5d95(0x4c1)][_0x2e5d95(0x453)](_0x1f585c[_0x2e5d95(0x23d)],0x0,_0x44a382),await saveData();}});}function addGeneralNote(){const _0x339f7c=_0x17450c;showInputModal(_0x339f7c(0x3c9),async _0x5c104c=>{const _0x3df269=_0x339f7c;if(!_0x5c104c)return;const _0xe3077b=getCurrentSubtopic();if(!_0xe3077b){toast('Chọn\x20một\x20chủ\x20đề\x20con\x20trước.');return;}_0xe3077b[_0x3df269(0x396)]=_0xe3077b[_0x3df269(0x396)]||[],_0xe3077b[_0x3df269(0x396)][_0x3df269(0x253)]({'id':uid('gn'),'text':_0x5c104c,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0x240cde=_0x17450c,_0x3c35eb=getCurrentSubtopic();if(!_0x3c35eb){toast(_0x240cde(0x1fa));return;}const _0x5a87cf=(_0x3c35eb[_0x240cde(0x396)]||[])[_0x240cde(0x4f2)](_0x493e17=>typeof _0x493e17===_0x240cde(0x260)?_0x493e17:_0x493e17[_0x240cde(0x2ee)]||'')[_0x240cde(0x3a0)](Boolean);if(_0x5a87cf[_0x240cde(0x223)]===0x0){toast(_0x240cde(0x32b));return;}const _0x40dffb=$(_0x240cde(0x4af));_0x40dffb&&(_0x40dffb[_0x240cde(0x2e9)]=!![],_0x40dffb[_0x240cde(0x1ef)]=_0x240cde(0x4d0));try{const _0x31bae9=_0x240cde(0x293)+_0x5a87cf[_0x240cde(0x44d)](_0x240cde(0x21a)),_0x103882=await callGeminiAPI(_0x31bae9);if(!_0x3c35eb['summaries'])_0x3c35eb[_0x240cde(0x3a4)]=[];_0x3c35eb['summaries'][_0x240cde(0x253)]({'id':uid('sum'),'content':_0x103882||_0x240cde(0x32e),'createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x52405e){console[_0x240cde(0x30e)](_0x52405e),toast(_0x240cde(0x3ce));}finally{_0x40dffb&&(_0x40dffb[_0x240cde(0x2e9)]=![],_0x40dffb[_0x240cde(0x48c)]=_0x240cde(0x3bf));}}function renderSummaries(){const _0x579274=_0x17450c,_0xaa662f=$(_0x579274(0x409));if(!_0xaa662f)return;const _0x4cf256=getCurrentSubtopic();if(!_0x4cf256){_0xaa662f[_0x579274(0x1ef)]=_0x579274(0x347);return;}_0xaa662f['innerHTML']='';if(!_0x4cf256[_0x579274(0x3a4)]||_0x4cf256[_0x579274(0x3a4)][_0x579274(0x223)]===0x0){_0xaa662f[_0x579274(0x1ef)]=_0x579274(0x2e2);return;}_0x4cf256[_0x579274(0x3a4)][_0x579274(0x4a0)](_0x2dd52e=>{const _0x2d1c2f=_0x579274,_0x7fc4bb=document[_0x2d1c2f(0x251)](_0x2d1c2f(0x2d4));_0x7fc4bb[_0x2d1c2f(0x2a9)]=_0x2d1c2f(0x262);const _0x15960c=document[_0x2d1c2f(0x251)](_0x2d1c2f(0x2d4));_0x15960c[_0x2d1c2f(0x2a9)]=_0x2d1c2f(0x320);const _0x34d133=document[_0x2d1c2f(0x251)](_0x2d1c2f(0x2d4));_0x34d133[_0x2d1c2f(0x2a9)]='note-content',_0x34d133[_0x2d1c2f(0x48c)]=_0x2dd52e[_0x2d1c2f(0x2e0)];const _0x54973a=document['createElement'](_0x2d1c2f(0x2d4));_0x54973a[_0x2d1c2f(0x2a9)]=_0x2d1c2f(0x45e),_0x54973a['textContent']=new Date(_0x2dd52e['createdAt'])[_0x2d1c2f(0x2c9)](),_0x15960c[_0x2d1c2f(0x3a5)](_0x34d133,_0x54973a);const _0x4a16a1=document[_0x2d1c2f(0x251)](_0x2d1c2f(0x2d4)),_0x3b0a9b=document[_0x2d1c2f(0x251)](_0x2d1c2f(0x2eb));_0x3b0a9b[_0x2d1c2f(0x2a9)]='btn\x20small',_0x3b0a9b['textContent']=_0x2d1c2f(0x4da),_0x3b0a9b['onclick']=_0x3ddb19=>{_0x3ddb19['stopPropagation'](),exportSummary(_0x2dd52e);};const _0x1b6ae6=document[_0x2d1c2f(0x251)]('button');_0x1b6ae6[_0x2d1c2f(0x2a9)]='btn\x20small\x20danger',_0x1b6ae6['textContent']=_0x2d1c2f(0x480),_0x1b6ae6[_0x2d1c2f(0x2c3)]=_0x32968c=>{const _0x1d3d97=_0x2d1c2f;_0x32968c[_0x1d3d97(0x2a0)](),deleteSummary(_0x2dd52e['id']);},_0x4a16a1[_0x2d1c2f(0x3a5)](_0x3b0a9b,_0x1b6ae6),_0x7fc4bb['append'](_0x15960c,_0x4a16a1),_0x7fc4bb[_0x2d1c2f(0x45b)](_0x2d1c2f(0x4a4),()=>_0x34d133[_0x2d1c2f(0x279)][_0x2d1c2f(0x44c)](_0x2d1c2f(0x477))),_0xaa662f['appendChild'](_0x7fc4bb);});}function loadEditingPresetFields(){const _0x239cba=_0x17450c,_0x1f4237=data[_0x239cba(0x4a9)],_0x37c52a=_0x1f4237[_0x239cba(0x3d9)],_0x21cb88=$('#settings-pomodoro'),_0x582414=$(_0x239cba(0x210));if(_0x21cb88&&_0x582414){const _0x3d3c92=editingPreset==='C';_0x21cb88[_0x239cba(0x279)][_0x239cba(0x44c)](_0x239cba(0x454),_0x3d3c92),_0x582414[_0x239cba(0x279)][_0x239cba(0x44c)](_0x239cba(0x454),!_0x3d3c92);}if(editingPreset==='A'){$(_0x239cba(0x4d4))[_0x239cba(0x406)]=_0x37c52a[_0x239cba(0x412)];if($(_0x239cba(0x46b)))$(_0x239cba(0x46b))[_0x239cba(0x406)]=_0x37c52a[_0x239cba(0x42f)]??0x0;$('#set_short')[_0x239cba(0x406)]=_0x37c52a['A_short'],$(_0x239cba(0x25b))[_0x239cba(0x406)]=_0x37c52a[_0x239cba(0x40f)],$('#set_cycles')[_0x239cba(0x406)]=_0x1f4237['cyclesA'],$(_0x239cba(0x1f0))[_0x239cba(0x406)]=_0x1f4237[_0x239cba(0x273)];}else{if(editingPreset==='B'){$(_0x239cba(0x4d4))['value']=_0x37c52a[_0x239cba(0x436)];if($(_0x239cba(0x46b)))$(_0x239cba(0x46b))['value']=_0x37c52a['B_winddown']??0x0;$('#set_short')['value']=_0x37c52a[_0x239cba(0x47c)],$('#set_long')['value']=_0x37c52a[_0x239cba(0x231)],$(_0x239cba(0x432))[_0x239cba(0x406)]=_0x1f4237[_0x239cba(0x2ff)],$(_0x239cba(0x1f0))[_0x239cba(0x406)]=_0x1f4237[_0x239cba(0x474)];}else{if(editingPreset==='C'){const _0x5748e8=$(_0x239cba(0x200));if(_0x5748e8)_0x5748e8[_0x239cba(0x406)]=_0x1f4237[_0x239cba(0x497)]??0x5;}}}}function highlightPresetSelector(){const _0x13fd1b=_0x17450c;$$(_0x13fd1b(0x410))[_0x13fd1b(0x4a0)](_0x54e876=>{const _0x1c82be=_0x13fd1b,_0x3a22b2=_0x54e876[_0x1c82be(0x32d)][_0x1c82be(0x344)]===editingPreset;_0x54e876[_0x1c82be(0x279)]['toggle'](_0x1c82be(0x42b),_0x3a22b2),_0x54e876[_0x1c82be(0x279)][_0x1c82be(0x44c)]('ghost',!_0x3a22b2);});}function openSettings(){const _0x1f0b5c=_0x17450c,_0x27ef91=data[_0x1f0b5c(0x4a9)];editingPreset=_0x27ef91[_0x1f0b5c(0x323)],$(_0x1f0b5c(0x31c))['value']=_0x27ef91[_0x1f0b5c(0x27a)]||'',loadEditingPresetFields(),highlightPresetSelector(),$(_0x1f0b5c(0x2b6))[_0x1f0b5c(0x406)]=_0x27ef91[_0x1f0b5c(0x3fd)]??0.8,$(_0x1f0b5c(0x49d))[_0x1f0b5c(0x406)]=_0x27ef91['soundTheme']||_0x1f0b5c(0x21f),$('#set_theme_color')[_0x1f0b5c(0x406)]=_0x27ef91[_0x1f0b5c(0x4ca)]||'default';const _0x25c52a=getActiveYoutubeUrl();$(_0x1f0b5c(0x387))[_0x1f0b5c(0x406)]=_0x25c52a||'';const _0x4e7c68=extractYouTubeID(_0x25c52a);$(_0x1f0b5c(0x2af))[_0x1f0b5c(0x2e9)]=!_0x4e7c68;$(_0x1f0b5c(0x209))&&($(_0x1f0b5c(0x209))[_0x1f0b5c(0x48c)]='');$('#ytSoundVolume')[_0x1f0b5c(0x406)]=_0x27ef91['youtubeVolume']||0x50,$(_0x1f0b5c(0x28d))[_0x1f0b5c(0x1fc)]=!!_0x27ef91['useYtThumbnailAsBg'],$(_0x1f0b5c(0x4c0))[_0x1f0b5c(0x406)]=_0x27ef91[_0x1f0b5c(0x1f4)]||0.85;$(_0x1f0b5c(0x1eb))&&($(_0x1f0b5c(0x1eb))['value']=_0x27ef91[_0x1f0b5c(0x3ac)]||_0x1f0b5c(0x385));$(_0x1f0b5c(0x388))&&($('#set_autoStartNext')[_0x1f0b5c(0x1fc)]=!!_0x27ef91[_0x1f0b5c(0x485)]);$(_0x1f0b5c(0x416))&&($(_0x1f0b5c(0x416))[_0x1f0b5c(0x1fc)]=_0x27ef91[_0x1f0b5c(0x2c6)]!==![]);$(_0x1f0b5c(0x491))&&($(_0x1f0b5c(0x491))[_0x1f0b5c(0x1fc)]=_0x27ef91[_0x1f0b5c(0x2ab)]!==![]);$(_0x1f0b5c(0x2ef))&&($('#set_backupDays')[_0x1f0b5c(0x406)]=_0x27ef91[_0x1f0b5c(0x332)]||0x7);const _0x49595f=$(_0x1f0b5c(0x21c));_0x49595f&&storageManager[_0x1f0b5c(0x4d3)]()[_0x1f0b5c(0x3ff)](_0x334fec=>{const _0x5115a6=_0x1f0b5c;_0x49595f[_0x5115a6(0x1ef)]=_0x5115a6(0x4df),_0x334fec&&_0x334fec['length']>0x0?_0x334fec['forEach'](_0x2b8e0a=>{const _0x1d9377=_0x5115a6,_0x424c80=document['createElement'](_0x1d9377(0x3be));_0x424c80[_0x1d9377(0x406)]=_0x2b8e0a[_0x1d9377(0x4f4)],_0x424c80[_0x1d9377(0x48c)]='Bản\x20sao\x20lưu\x20ngày:\x20'+new Date(_0x2b8e0a[_0x1d9377(0x4f4)])[_0x1d9377(0x34b)](_0x1d9377(0x269)),_0x49595f['appendChild'](_0x424c80);}):_0x49595f['innerHTML']='<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>';});$(_0x1f0b5c(0x3ca))[_0x1f0b5c(0x279)][_0x1f0b5c(0x30f)](_0x1f0b5c(0x3ae));try{trapFocus($(_0x1f0b5c(0x3ca)));}catch(_0x3bb34f){}}function closeSettings(){const _0x5eabb4=_0x17450c;$('#modalSettings')[_0x5eabb4(0x279)][_0x5eabb4(0x393)]('show');try{releaseFocus();}catch(_0x2f1e16){}}async function setDefaults(){const _0x285894=_0x17450c;data[_0x285894(0x4a9)][_0x285894(0x3d9)]={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data['settings'][_0x285894(0x34c)]=0x4,data[_0x285894(0x4a9)]['longBreakIntervalA']=0x4,data[_0x285894(0x4a9)]['cyclesB']=0x4,data[_0x285894(0x4a9)][_0x285894(0x474)]=0x4,data[_0x285894(0x4a9)][_0x285894(0x497)]=0x5,data['settings'][_0x285894(0x323)]='A',data[_0x285894(0x4a9)][_0x285894(0x3fd)]=0.8,data['settings']['soundTheme']=_0x285894(0x21f),await saveData(),openSettings(),toast(_0x285894(0x23f));}async function saveSettings(){const _0x4e5cb1=_0x17450c,_0x4e053d=data[_0x4e5cb1(0x4a9)];_0x4e053d['apiKey']=$('#set_apiKey')[_0x4e5cb1(0x406)][_0x4e5cb1(0x404)]();const _0xf172e7=_0x4e053d['durations'];if(editingPreset==='A')_0xf172e7[_0x4e5cb1(0x412)]=clampInt($(_0x4e5cb1(0x4d4))['value'],0x1,0x3e7),_0xf172e7[_0x4e5cb1(0x42f)]=clampInt($(_0x4e5cb1(0x46b))[_0x4e5cb1(0x406)],0x0,0x3e7),_0xf172e7[_0x4e5cb1(0x494)]=clampInt($('#set_short')[_0x4e5cb1(0x406)],0x1,0x3e7),_0xf172e7[_0x4e5cb1(0x40f)]=clampInt($(_0x4e5cb1(0x25b))[_0x4e5cb1(0x406)],0x1,0x3e7),_0x4e053d['cyclesA']=clampInt($('#set_cycles')['value'],0x1,0xc),_0x4e053d[_0x4e5cb1(0x273)]=clampInt($(_0x4e5cb1(0x1f0))[_0x4e5cb1(0x406)],0x2,0xc);else{if(editingPreset==='B')_0xf172e7[_0x4e5cb1(0x436)]=clampInt($('#set_work')['value'],0x1,0x3e7),_0xf172e7[_0x4e5cb1(0x4a5)]=clampInt($(_0x4e5cb1(0x46b))[_0x4e5cb1(0x406)],0x0,0x3e7),_0xf172e7['B_short']=clampInt($('#set_short')[_0x4e5cb1(0x406)],0x1,0x3e7),_0xf172e7[_0x4e5cb1(0x231)]=clampInt($(_0x4e5cb1(0x25b))['value'],0x1,0x3e7),_0x4e053d['cyclesB']=clampInt($(_0x4e5cb1(0x432))['value'],0x1,0xc),_0x4e053d[_0x4e5cb1(0x474)]=clampInt($(_0x4e5cb1(0x1f0))['value'],0x2,0xc);else{if(editingPreset==='C'){const _0x495511=$(_0x4e5cb1(0x200));if(_0x495511)_0x4e053d[_0x4e5cb1(0x497)]=clampInt(_0x495511[_0x4e5cb1(0x406)],0x1,0x14);}}}_0x4e053d[_0x4e5cb1(0x3fd)]=clampFloat($(_0x4e5cb1(0x2b6))[_0x4e5cb1(0x406)],0x0,0x1,0.8),_0x4e053d[_0x4e5cb1(0x40d)]=$(_0x4e5cb1(0x49d))[_0x4e5cb1(0x406)]===_0x4e5cb1(0x354)?_0x4e5cb1(0x354):'beep',_0x4e053d[_0x4e5cb1(0x4ca)]=$('#set_theme_color')['value'],_0x4e053d[_0x4e5cb1(0x1f4)]=parseFloat($(_0x4e5cb1(0x4c0))[_0x4e5cb1(0x406)])||0.85;$(_0x4e5cb1(0x1eb))&&(_0x4e053d['backgroundMode']=$(_0x4e5cb1(0x1eb))[_0x4e5cb1(0x406)]);_0x4e053d[_0x4e5cb1(0x485)]=!!($(_0x4e5cb1(0x388))&&$('#set_autoStartNext')[_0x4e5cb1(0x1fc)]),_0x4e053d[_0x4e5cb1(0x2c6)]=!!($('#set_enableWinddown')&&$('#set_enableWinddown')[_0x4e5cb1(0x1fc)]),_0x4e053d[_0x4e5cb1(0x2ab)]=!!($(_0x4e5cb1(0x491))&&$(_0x4e5cb1(0x491))[_0x4e5cb1(0x1fc)]);$(_0x4e5cb1(0x2ef))&&(_0x4e053d['backupDaysToKeep']=clampInt($(_0x4e5cb1(0x2ef))[_0x4e5cb1(0x406)],0x1,0x1e));_0x4e053d[_0x4e5cb1(0x4ca)]===_0x4e5cb1(0x244)||_0x4e053d[_0x4e5cb1(0x4ca)]===_0x4e5cb1(0x375)?(_0x4e053d['useYtThumbnailAsBg']=![],typeof _0x4e053d[_0x4e5cb1(0x2ec)]===_0x4e5cb1(0x260)&&_0x4e053d[_0x4e5cb1(0x2ec)][_0x4e5cb1(0x49f)](_0x4e5cb1(0x2cb))&&(_0x4e053d[_0x4e5cb1(0x2ec)]='')):_0x4e053d[_0x4e5cb1(0x400)]=!![];const _0x41e82c=$(_0x4e5cb1(0x387))[_0x4e5cb1(0x406)][_0x4e5cb1(0x404)]();_0x4e053d[_0x4e5cb1(0x400)]=$(_0x4e5cb1(0x28d))[_0x4e5cb1(0x1fc)],_0x4e053d['youtubeVolume']=parseInt($(_0x4e5cb1(0x2bd))[_0x4e5cb1(0x406)],0xa),sessionYoutubeUrl=_0x41e82c;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer[_0x4e5cb1(0x225)])ytPlayer[_0x4e5cb1(0x225)](_0x4e053d[_0x4e5cb1(0x2ac)]);}else try{fallbackPostMessage('setVolume',[_0x4e053d[_0x4e5cb1(0x2ac)]]);}catch(_0x3f19ae){}}catch(_0x227762){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x4e5cb1(0x4ad)](_0x4e053d[_0x4e5cb1(0x323)],{'silent':!![]}),closeSettings(),toast(_0x4e5cb1(0x1ec));}function clampInt(_0x4c8d95,_0x2c5bcb,_0x5c5ef3){_0x4c8d95=parseInt(_0x4c8d95||0x0,0xa);if(isNaN(_0x4c8d95))_0x4c8d95=_0x2c5bcb;return Math['max'](_0x2c5bcb,Math['min'](_0x5c5ef3,_0x4c8d95));}function clampFloat(_0x44116d,_0x4d3aac,_0x20f05d,_0x1e36a9){const _0x157ef0=_0x17450c;_0x44116d=parseFloat(_0x44116d);if(Number[_0x157ef0(0x4d9)](_0x44116d))_0x44116d=_0x1e36a9;return Math[_0x157ef0(0x3e8)](_0x4d3aac,Math[_0x157ef0(0x420)](_0x20f05d,_0x44116d));}const dbPromise=new Promise((_0x300016,_0x4ab0c5)=>{const _0x46e283=_0x17450c,_0x337b5e=indexedDB[_0x46e283(0x326)](_0x46e283(0x2f8),0x1);_0x337b5e['onupgradeneeded']=_0x2aa971=>_0x2aa971['target'][_0x46e283(0x271)][_0x46e283(0x394)](_0x46e283(0x372)),_0x337b5e[_0x46e283(0x2b2)]=_0x533d49=>_0x300016(_0x533d49[_0x46e283(0x4a2)]['result']),_0x337b5e[_0x46e283(0x233)]=_0x9ce0c5=>_0x4ab0c5(_0x9ce0c5);}),fileCache={};function handleFileUpload(_0x18aeda,_0x42355b){const _0x467165=_0x17450c;if(!_0x18aeda)return;dbPromise[_0x467165(0x3ff)](_0x1c5de4=>{const _0xdf361a=_0x467165,_0x30cab5=uid(_0xdf361a(0x3ec)),_0xe7acd9=_0x1c5de4[_0xdf361a(0x327)](_0xdf361a(0x372),_0xdf361a(0x30c));_0xe7acd9[_0xdf361a(0x366)](_0xdf361a(0x372))[_0xdf361a(0x275)](_0x18aeda,_0x30cab5),_0xe7acd9[_0xdf361a(0x40c)]=()=>_0x42355b(_0x30cab5),_0xe7acd9[_0xdf361a(0x233)]=()=>toast('Lỗi\x20lưu\x20file.');});}function getStoredFileUrl(_0x44c066){const _0x262e32=_0x17450c;if(!_0x44c066)return Promise[_0x262e32(0x32f)]('');if(fileCache[_0x44c066])return Promise[_0x262e32(0x32f)](fileCache[_0x44c066]);return dbPromise[_0x262e32(0x3ff)](_0x41ac58=>new Promise(_0x3b86bc=>{const _0x102eff=_0x262e32,_0x5a5c7d=_0x41ac58[_0x102eff(0x327)](_0x102eff(0x372),_0x102eff(0x26d)),_0x5ba583=_0x5a5c7d[_0x102eff(0x366)](_0x102eff(0x372))[_0x102eff(0x4cf)](_0x44c066);_0x5ba583[_0x102eff(0x2b2)]=_0x5213d7=>{const _0xcb004f=_0x102eff,_0x570134=_0x5213d7['target'][_0xcb004f(0x271)];if(_0x570134){const _0x55b4be=URL[_0xcb004f(0x362)](_0x570134);fileCache[_0x44c066]=_0x55b4be,_0x3b86bc(_0x55b4be);}else _0x3b86bc('');},_0x5ba583[_0x102eff(0x233)]=()=>_0x3b86bc('');}));}function applyCustomBg(){const _0x1b5273=_0x17450c,_0x2a5245=data[_0x1b5273(0x4a9)],_0x2dcb26=_0x2a5245[_0x1b5273(0x2ec)],_0x449436=_0x2a5245[_0x1b5273(0x4ca)],_0x260d4b=[_0x1b5273(0x2d5),'space']['includes'](_0x449436),_0x18e9c9=_0x449436===_0x1b5273(0x244)||_0x449436===_0x1b5273(0x375),_0x52137e=_0x2a5245[_0x1b5273(0x3ac)]||_0x1b5273(0x385);document['body']['style'][_0x1b5273(0x33a)]=_0x52137e,document[_0x1b5273(0x219)]['style'][_0x1b5273(0x322)]=_0x52137e===_0x1b5273(0x3da)?_0x1b5273(0x3a6):_0x1b5273(0x213);const _0x315e40=()=>{const _0x34a560=_0x1b5273;try{document[_0x34a560(0x219)][_0x34a560(0x3a2)][_0x34a560(0x44a)]='';}catch(_0x1ea838){}};if(_0x2dcb26){const _0x2dc702=_0x2dcb26['startsWith'](_0x1b5273(0x437))||_0x2dcb26[_0x1b5273(0x29a)]('http')||_0x2dcb26['startsWith'](_0x1b5273(0x4cd))?Promise[_0x1b5273(0x32f)](_0x2dcb26):getStoredFileUrl(_0x2dcb26);_0x2dc702[_0x1b5273(0x3ff)](_0x45992f=>{const _0x23d75a=_0x1b5273;_0x45992f?document[_0x23d75a(0x219)][_0x23d75a(0x3a2)][_0x23d75a(0x39e)](_0x23d75a(0x43c),_0x23d75a(0x3e0)+_0x45992f+')'):document[_0x23d75a(0x219)][_0x23d75a(0x3a2)][_0x23d75a(0x39e)](_0x23d75a(0x43c),_0x18e9c9?_0x23d75a(0x39a):''),_0x315e40();});}else!_0x260d4b?_0x18e9c9?(document[_0x1b5273(0x219)]['style']['setProperty'](_0x1b5273(0x43c),_0x1b5273(0x39a)),_0x315e40()):document['body'][_0x1b5273(0x3a2)][_0x1b5273(0x39e)]('--bg-image','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)'):(document['body'][_0x1b5273(0x3a2)][_0x1b5273(0x33d)](_0x1b5273(0x43c)),_0x315e40());}function applyPanelOpacity(){const _0x55812a=_0x17450c;document[_0x55812a(0x3ea)][_0x55812a(0x3a2)]['setProperty']('--panel-opacity',data[_0x55812a(0x4a9)][_0x55812a(0x1f4)]);}function renderDashboard(){const _0x326dd5=_0x17450c,_0x29116b=data[_0x326dd5(0x3b3)][_0x326dd5(0x3f9)](_0x19a510=>_0x19a510['subtopics'][_0x326dd5(0x4f2)](_0x36b2c2=>({'topic':_0x19a510['name'],'subtopic':_0x36b2c2[_0x326dd5(0x422)],'m':_0x36b2c2[_0x326dd5(0x488)][_0x326dd5(0x369)]||0x0,'c':_0x36b2c2['stats'][_0x326dd5(0x36a)]||0x0,'t':_0x36b2c2[_0x326dd5(0x488)]['tasksCompleted']||0x0}))),_0x344535=_0x29116b['reduce']((_0x3fc946,_0x4fccc5)=>_0x3fc946+_0x4fccc5['m'],0x0),_0x519693=_0x29116b[_0x326dd5(0x4b3)]((_0x48a80c,_0x302169)=>_0x48a80c+_0x302169['c'],0x0),_0x21b681=_0x29116b[_0x326dd5(0x4b3)]((_0x2e6616,_0x499c72)=>_0x2e6616+_0x499c72['t'],0x0);let _0xa6bdda=_0x326dd5(0x405)+formatDaysHoursMinutes(_0x344535)+_0x326dd5(0x39f)+_0x519693+_0x326dd5(0x295)+_0x21b681+_0x326dd5(0x22c);_0x29116b[_0x326dd5(0x4a0)](_0x30d350=>{const _0xb7c8e2=_0x326dd5;_0xa6bdda+=_0xb7c8e2(0x3e9)+escapeHTML(_0x30d350[_0xb7c8e2(0x4bf)])+_0xb7c8e2(0x2a4)+escapeHTML(_0x30d350[_0xb7c8e2(0x1fb)])+_0xb7c8e2(0x2a4)+formatDaysHoursMinutes(_0x30d350['m'])+_0xb7c8e2(0x2a4)+_0x30d350['c']+_0xb7c8e2(0x2a4)+_0x30d350['t']+'</td></tr>';}),_0xa6bdda+=_0x326dd5(0x2f6);const _0x2ebe76=$(_0x326dd5(0x498));if(_0x2ebe76)_0x2ebe76[_0x326dd5(0x1ef)]=_0xa6bdda;}function getMilestones(){const _0x101639=_0x17450c;return[{'hours':0x5,'title':_0x101639(0x234),'message':_0x101639(0x376)},{'hours':0x14,'title':_0x101639(0x465),'message':_0x101639(0x32c)},{'hours':0x32,'title':'Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','message':'50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.'},{'hours':0x64,'title':_0x101639(0x2ca),'message':_0x101639(0x2a3)},{'hours':0xfa,'title':'Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','message':_0x101639(0x3fb)},{'hours':0x1f4,'title':_0x101639(0x382),'message':_0x101639(0x402)},{'hours':0x3e8,'title':_0x101639(0x34e),'message':_0x101639(0x257)},{'hours':0x1388,'title':'Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','message':'5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.'}]['sort']((_0x1d1e21,_0x12258e)=>_0x12258e['hours']-_0x1d1e21[_0x101639(0x48b)]);}async function checkAndShowMilestones(){const _0x1779c0=_0x17450c;if(!data||!data['settings'])return;if(!Array[_0x1779c0(0x47e)](data[_0x1779c0(0x4a9)][_0x1779c0(0x34d)]))data[_0x1779c0(0x4a9)][_0x1779c0(0x34d)]=[];const _0x9b5471=data[_0x1779c0(0x3b3)]['reduce']((_0x29d4fe,_0x1df672)=>{const _0x25d74c=_0x1779c0;return _0x29d4fe+_0x1df672[_0x25d74c(0x206)]['reduce']((_0x167d86,_0x279717)=>{const _0x57b7b0=_0x25d74c;return _0x167d86+(_0x279717['stats'][_0x57b7b0(0x369)]||0x0);},0x0);},0x0),_0xba37a9=_0x9b5471/0x3c,_0x3bb28b=getMilestones(),_0x46934b=Array[_0x1779c0(0x47e)](data['settings'][_0x1779c0(0x34d)])?data['settings']['achievedMilestones']:[],_0x72ad37=_0x3bb28b[_0x1779c0(0x3a0)](_0x4db42a=>_0xba37a9>=_0x4db42a['hours']&&!_0x46934b[_0x1779c0(0x49f)](_0x4db42a[_0x1779c0(0x48b)]));if(_0x72ad37[_0x1779c0(0x223)]===0x0)return![];const _0x4a821d=_0x72ad37[_0x1779c0(0x4b3)]((_0x55e0ae,_0x58db18)=>_0x55e0ae&&_0x55e0ae[_0x1779c0(0x48b)]>_0x58db18[_0x1779c0(0x48b)]?_0x55e0ae:_0x58db18,null);if(!_0x4a821d)return![];$('#milestoneTitle')[_0x1779c0(0x48c)]=_0x4a821d['title'],$(_0x1779c0(0x2bb))[_0x1779c0(0x48c)]=_0x4a821d['message'],$(_0x1779c0(0x3dc))[_0x1779c0(0x279)][_0x1779c0(0x30f)](_0x1779c0(0x3ae));try{trapFocus($(_0x1779c0(0x3dc)));}catch(_0x348fc1){}return data[_0x1779c0(0x4a9)][_0x1779c0(0x34d)][_0x1779c0(0x367)](_0x4a821d[_0x1779c0(0x48b)]),await saveData(),!![];}async function seedAchievedMilestones(){const _0x4364f7=_0x17450c;if(!data||!data['settings'])return;!Array[_0x4364f7(0x47e)](data['settings'][_0x4364f7(0x34d)])&&(data[_0x4364f7(0x4a9)][_0x4364f7(0x34d)]=[],await saveData());}async function handleSendMessage(){const _0x1d847f=_0x17450c,_0xbeebf7=$(_0x1d847f(0x4e3)),_0x6aa341=$(_0x1d847f(0x45c)),_0x37153e=_0x6aa341[_0x1d847f(0x406)][_0x1d847f(0x404)](),_0x102479=getCurrentSubtopic();if(!_0x37153e)return;if(!_0x102479){toast(t('timer.selectSubtopicPrompt'));return;}_0x6aa341[_0x1d847f(0x406)]='',_0xbeebf7['disabled']=!![],_0xbeebf7[_0x1d847f(0x1ef)]=_0x1d847f(0x4d0),_0x102479[_0x1d847f(0x331)][_0x1d847f(0x367)]({'role':_0x1d847f(0x360),'text':_0x37153e}),renderChat();const _0x31db39=await callGeminiAPI(_0x37153e);_0x31db39&&(_0x102479[_0x1d847f(0x331)][_0x1d847f(0x367)]({'role':'model','text':_0x31db39}),await saveData(),renderChat()),_0xbeebf7[_0x1d847f(0x2e9)]=![],_0xbeebf7[_0x1d847f(0x1ef)]='Gửi';}function renderChat(){const _0x18c2e8=_0x17450c,_0x26ea8b=getCurrentSubtopic(),_0x464f0e=$(_0x18c2e8(0x4eb)),_0x1fc8e8=$('#chatInput'),_0x4d7520=$(_0x18c2e8(0x4e3));if(!_0x464f0e||!_0x1fc8e8||!_0x4d7520)return;if(!_0x26ea8b){_0x464f0e['innerHTML']=_0x18c2e8(0x4a8),_0x1fc8e8[_0x18c2e8(0x2e9)]=!![],_0x4d7520[_0x18c2e8(0x2e9)]=!![];return;}_0x1fc8e8[_0x18c2e8(0x2e9)]=![],_0x4d7520[_0x18c2e8(0x2e9)]=![],_0x464f0e['innerHTML']='';if(!_0x26ea8b['chatHistory']||_0x26ea8b[_0x18c2e8(0x331)][_0x18c2e8(0x223)]===0x0){_0x464f0e[_0x18c2e8(0x1ef)]=_0x18c2e8(0x40a);return;}_0x26ea8b[_0x18c2e8(0x331)][_0x18c2e8(0x4a0)](_0x1c6dec=>{const _0x23bf1f=_0x18c2e8,_0x2e8057=document[_0x23bf1f(0x251)](_0x23bf1f(0x2d4));_0x2e8057['className']=_0x23bf1f(0x29d)+_0x1c6dec['role'],_0x2e8057[_0x23bf1f(0x48c)]=_0x1c6dec[_0x23bf1f(0x2ee)],_0x464f0e[_0x23bf1f(0x2e8)](_0x2e8057);}),_0x464f0e[_0x18c2e8(0x29e)]=_0x464f0e[_0x18c2e8(0x3a7)];}async function handleSummarizeNote(){const _0x213594=_0x17450c,_0x11d3a6=$(_0x213594(0x45d)),_0x4250fb=$(_0x213594(0x449)),_0xc8ac1f=_0x4250fb[_0x213594(0x406)][_0x213594(0x404)](),_0x562c51=getCurrentSubtopic();if(!_0xc8ac1f){toast(_0x213594(0x43b));return;}const _0x5564bc=_0x11d3a6[_0x213594(0x1ef)];_0x11d3a6['innerHTML']=_0x213594(0x4d0),_0x11d3a6[_0x213594(0x2e9)]=!![];const _0x473d5a=_0x213594(0x365)+(_0x562c51?.['name']||_0x213594(0x2cc))+'\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22'+_0xc8ac1f+_0x213594(0x478),_0x420472=await callGeminiAPI(_0x473d5a);_0x420472&&(_0x4250fb[_0x213594(0x406)]+='\x0a\x0a'+_0x420472),_0x11d3a6[_0x213594(0x1ef)]=_0x5564bc,_0x11d3a6[_0x213594(0x2e9)]=![];}function clearChat(){const _0x405351=_0x17450c,_0x2a195c=getCurrentSubtopic();if(!_0x2a195c){toast(t(_0x405351(0x4e9)));return;}showConfirmModal(_0x405351(0x500),_0x405351(0x4ba),async _0xaa2cf3=>{const _0x58f563=_0x405351;_0xaa2cf3&&(_0x2a195c['chatHistory']=[],await saveData(),renderChat(),toast(_0x58f563(0x4bd)));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0xb60eb4,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0xe65534=_0x17450c,_0x4ee6fe=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0xb60eb4,'enablejsapi':'1','origin':'https://www.youtube.com'})[_0xe65534(0x314)]();return _0xe65534(0x2d3)+_0xb60eb4+'?'+_0x4ee6fe;}function ensureFallbackFrame(){const _0x104401=_0x17450c,_0x52a596=document[_0x104401(0x1f8)](_0x104401(0x25a));if(!_0x52a596)return null;if(ytFallbackFrame&&ytFallbackFrame[_0x104401(0x486)])return ytFallbackFrame;const _0x4820fe=document[_0x104401(0x251)]('iframe');return _0x4820fe['id']='yt-fallback',_0x4820fe[_0x104401(0x28f)]='1',_0x4820fe[_0x104401(0x309)]='1',_0x4820fe[_0x104401(0x3a2)][_0x104401(0x35a)]='absolute',_0x4820fe['style'][_0x104401(0x3c4)]='-9999px',_0x4820fe[_0x104401(0x3a2)][_0x104401(0x21e)]=_0x104401(0x2dc),_0x4820fe[_0x104401(0x29b)]='autoplay;\x20encrypted-media;\x20picture-in-picture',_0x52a596['innerHTML']='',_0x52a596[_0x104401(0x2e8)](_0x4820fe),ytFallbackFrame=_0x4820fe,_0x4820fe;}function fallbackLoadVideo(_0x41b59e,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x5833d4=_0x17450c,_0x3660c9=document['getElementById'](_0x5833d4(0x25a));if(!_0x3660c9)return;_0x3660c9[_0x5833d4(0x1ef)]='';const _0x56e88b=document[_0x5833d4(0x251)](_0x5833d4(0x270));_0x56e88b['id']='yt-fallback',_0x56e88b[_0x5833d4(0x28f)]='1',_0x56e88b[_0x5833d4(0x309)]='1',_0x56e88b['style'][_0x5833d4(0x35a)]=_0x5833d4(0x4fb),_0x56e88b[_0x5833d4(0x3a2)][_0x5833d4(0x3c4)]='-9999px',_0x56e88b[_0x5833d4(0x3a2)][_0x5833d4(0x21e)]=_0x5833d4(0x2dc),_0x56e88b[_0x5833d4(0x29b)]=_0x5833d4(0x4b7),_0x56e88b[_0x5833d4(0x35b)]=buildFallbackSrc(_0x41b59e,{'autoplay':autoplay,'mute':mute}),_0x3660c9['appendChild'](_0x56e88b),ytFallbackFrame=_0x56e88b,ytFallbackIsPlaying=!!autoplay;try{const _0x1992ae=document['getElementById'](_0x5833d4(0x26a));if(_0x1992ae)_0x1992ae['textContent']=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x462e70){}}function fallbackPostMessage(_0x1620fe,_0x1ad5b6=[]){const _0x45b18c=_0x17450c;try{if(!ytFallbackFrame||!ytFallbackFrame[_0x45b18c(0x359)])return;ytFallbackFrame[_0x45b18c(0x359)][_0x45b18c(0x4e0)](JSON['stringify']({'event':'command','func':_0x1620fe,'args':_0x1ad5b6}),_0x45b18c(0x43e));}catch(_0x2dfca6){}}function fallbackPlay(){const _0x31610b=_0x17450c;fallbackPostMessage(_0x31610b(0x2f2));}function fallbackStop(){const _0x6d2fd0=_0x17450c;try{ytFallbackFrame&&(ytFallbackFrame[_0x6d2fd0(0x35b)]='about:blank',ytFallbackIsPlaying=![]);}catch(_0x5430c6){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){const _0x5b951c=_0x17450c;fallbackPostMessage(_0x5b951c(0x334));}function fallbackMute(){fallbackPostMessage('mute');}window[_0x17450c(0x329)]=function(){const _0xecfc14=_0x17450c;if(IS_FILE_PROTOCOL){try{window[_0xecfc14(0x398)]&&window['__ytApiWatchdog']['cancel']();}catch(_0x4402ac){}return;}const _0x2d6cf8={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0xecfc14(0x43e)};(window[_0xecfc14(0x308)][_0xecfc14(0x297)]===_0xecfc14(0x3d3)||window['location'][_0xecfc14(0x297)]==='https:')&&(_0x2d6cf8[_0xecfc14(0x3de)]=window[_0xecfc14(0x308)]['origin']);ytPlayer=new YT[(_0xecfc14(0x43f))](_0xecfc14(0x25a),_0x2d6cf8);try{window[_0xecfc14(0x398)]&&window[_0xecfc14(0x398)][_0xecfc14(0x479)]();const _0x4bda5a=document['getElementById'](_0xecfc14(0x395));_0x4bda5a&&(_0x4bda5a[_0xecfc14(0x48c)]='');}catch(_0x1dd433){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x17450c(0x286)]('sound_unlocked')==='1';}catch(_0x25e7a4){}function showSoundPermission(){const _0x27b72c=_0x17450c,_0x18ce4d=document[_0x27b72c(0x1f8)](_0x27b72c(0x4c9));if(!_0x18ce4d)return;if(_ytUnlocked){_0x18ce4d[_0x27b72c(0x279)][_0x27b72c(0x393)](_0x27b72c(0x3ae));return;}_0x18ce4d[_0x27b72c(0x279)][_0x27b72c(0x30f)](_0x27b72c(0x3ae));}function hideSoundPermission(){const _0x427ea1=_0x17450c,_0x466681=document[_0x427ea1(0x1f8)]('soundPermissionBar');if(!_0x466681)return;_0x466681['classList'][_0x427ea1(0x393)](_0x427ea1(0x3ae));}function unlockAudioChain(){const _0x385c67=_0x17450c;try{if(AUDIO_CTX&&typeof AUDIO_CTX['resume']===_0x385c67(0x361))AUDIO_CTX[_0x385c67(0x3d5)]();}catch(_0x3d0434){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer[_0x385c67(0x334)]&&(ytPlayer['unMute'](),ytPlayer[_0x385c67(0x2f2)]());}catch(_0x201f24){}_ytUnlocked=!![];try{localStorage[_0x385c67(0x25d)](_0x385c67(0x3a8),'1');}catch(_0x54b8c7){}hideSoundPermission(),toast(_0x385c67(0x277));}function onPlayerReady(_0x55f61d){const _0x2a45db=_0x17450c;try{const _0x1bac6=ytPlayer&&ytPlayer[_0x2a45db(0x443)]?ytPlayer['getIframe']():null;_0x1bac6&&_0x1bac6[_0x2a45db(0x350)](_0x2a45db(0x29b),_0x2a45db(0x4b7));}catch(_0xa03c51){}try{if(ytPlayer&&ytPlayer[_0x2a45db(0x225)])ytPlayer[_0x2a45db(0x225)](data&&data[_0x2a45db(0x4a9)]&&data['settings'][_0x2a45db(0x2ac)]||0x50);}catch(_0x40ded7){}try{const _0x8899ed=getActiveVideoId&&getActiveVideoId();if(_0x8899ed&&ytPlayer&&ytPlayer['mute']&&ytPlayer[_0x2a45db(0x2f2)]){ytPlayer[_0x2a45db(0x426)](),ytPlayer[_0x2a45db(0x2f2)](),_ytPrimed=!![];const _0x217e3d=()=>{const _0x279a93=_0x2a45db;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x2e05fd){}window[_0x279a93(0x411)](_0x279a93(0x492),_0x217e3d,!![]),window[_0x279a93(0x411)](_0x279a93(0x4b2),_0x217e3d,!![]);};window['addEventListener']('pointerdown',_0x217e3d,!![]),window['addEventListener'](_0x2a45db(0x4b2),_0x217e3d,!![]),showSoundPermission();}}catch(_0x4ee9c4){}updateYouTubePlayer();}function onPlayerStateChange(_0x5055a1){const _0x251897=_0x17450c,_0x1a9197=$(_0x251897(0x2af));_0x5055a1[_0x251897(0x249)]==YT[_0x251897(0x316)][_0x251897(0x439)]?(_0x1a9197[_0x251897(0x48c)]='⏸️',hideSoundPermission()):_0x1a9197[_0x251897(0x48c)]='▶️';if(_0x5055a1[_0x251897(0x249)]===YT[_0x251897(0x316)][_0x251897(0x3d1)]){if(!ytUserPaused)ytPlayer[_0x251897(0x2f2)]();}}async function ytFadeTo(_0x3c5031,_0x3b447c=0xfa){const _0x1a8c9d=_0x17450c;try{if(!ytPlayer||!ytPlayer[_0x1a8c9d(0x282)]||!ytPlayer[_0x1a8c9d(0x225)])return;ytPlayer[_0x1a8c9d(0x334)]();const _0x19b099=ytPlayer[_0x1a8c9d(0x282)](),_0x68c023=_0x3c5031-_0x19b099;if(Math[_0x1a8c9d(0x288)](_0x68c023)<0x1||_0x3b447c<=0x0){ytPlayer['setVolume'](_0x3c5031);return;}const _0x93197c=performance['now']();await new Promise(_0x5eb69f=>{const _0x18ae8b=_0x4189ec=>{const _0x8fb53b=_0x2dbf,_0x1ed2b6=Math[_0x8fb53b(0x420)](0x1,(_0x4189ec-_0x93197c)/_0x3b447c),_0x4434a6=Math[_0x8fb53b(0x256)](_0x19b099+_0x68c023*_0x1ed2b6);ytPlayer[_0x8fb53b(0x225)](_0x4434a6);if(_0x1ed2b6<0x1)requestAnimationFrame(_0x18ae8b);else _0x5eb69f();};requestAnimationFrame(_0x18ae8b);});}catch(_0x3648f7){}}async function ytFadeInPlay(_0x5384e1=0xdc){const _0x2c2672=_0x17450c;try{const _0x485663=Math[_0x2c2672(0x3e8)](0x0,Math[_0x2c2672(0x420)](0x64,data&&data[_0x2c2672(0x4a9)]&&data['settings'][_0x2c2672(0x2ac)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer[_0x2c2672(0x334)](),ytPlayer[_0x2c2672(0x2f2)]();try{ytPlayer[_0x2c2672(0x225)](0x0);}catch(_0x350380){}await ytFadeTo(_0x485663,_0x5384e1);}else{const _0x55e2c8=getActiveVideoId();_0x55e2c8&&fallbackLoadVideo(_0x55e2c8,{'autoplay':0x1,'mute':0x0});}}catch(_0x27a13e){}}async function ytFadeOutPause(_0x598fda=0xb4){const _0x56e07e=_0x17450c;try{const _0x554dc0=Math[_0x56e07e(0x3e8)](0x0,Math[_0x56e07e(0x420)](0x64,data&&data[_0x56e07e(0x4a9)]&&data[_0x56e07e(0x4a9)][_0x56e07e(0x2ac)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0x598fda);try{ytPlayer[_0x56e07e(0x4e1)](),ytPlayer[_0x56e07e(0x225)](_0x554dc0);}catch(_0x34ca81){}}else try{fallbackPause();}catch(_0x61c07c){}}catch(_0xadb723){}}async function updateYouTubePlayer(){const _0x4fe2d9=_0x17450c,_0x549c46=getActiveVideoId();if(data['settings'][_0x4fe2d9(0x400)]&&_0x549c46){const _0x477628='https://img.youtube.com/vi/'+_0x549c46+_0x4fe2d9(0x321),_0x21604e=new Image();_0x21604e[_0x4fe2d9(0x4b8)]=async()=>{const _0x2d9e63=_0x4fe2d9;data[_0x2d9e63(0x4a9)][_0x2d9e63(0x2ec)]=_0x477628,await saveData(),applyCustomBg();},_0x21604e['onerror']=async()=>{const _0x281115=_0x4fe2d9,_0x285733='https://img.youtube.com/vi/'+_0x549c46+_0x281115(0x23a);data[_0x281115(0x4a9)][_0x281115(0x2ec)]=_0x285733,await saveData(),applyCustomBg();},_0x21604e[_0x4fe2d9(0x35b)]=_0x477628;}else!_0x549c46&&(data[_0x4fe2d9(0x4a9)]['customBg']='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0x549c46){fallbackStop(),hideSoundPermission();return;}const _0x330bc6=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x549c46,{'autoplay':0x1,'mute':_0x330bc6});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer[_0x4fe2d9(0x419)]){try{ensureYouTubeAPI();}catch(_0x58dd54){}return;}if(!_0x549c46){if(ytPlayer['stopVideo'])ytPlayer[_0x4fe2d9(0x38f)]();hideSoundPermission();return;}ytPlayer[_0x4fe2d9(0x419)](_0x549c46),ytPlayer[_0x4fe2d9(0x225)](data['settings'][_0x4fe2d9(0x2ac)]);}function toggleYtSound(){const _0x32cc65=_0x17450c;if(!_ytUnlocked){try{ensureAudio();}catch(_0x12f37c){}try{unlockAudioChain();}catch(_0x51be23){}return;}if(IS_FILE_PROTOCOL){const _0x46d196=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame[_0x32cc65(0x486)]){if(!_0x46d196){toast('Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.');return;}fallbackLoadVideo(_0x46d196,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x31608a=document[_0x32cc65(0x1f8)]('btnToggleYtSound');if(_0x31608a)_0x31608a['textContent']='⏸️';}catch(_0x5a8bdc){}toast('Đang\x20phát\x20nhạc\x20nền...');return;}if(ytFallbackIsPlaying)fallbackPostMessage('pauseVideo'),ytFallbackIsPlaying=![],toast(_0x32cc65(0x4c8));else{if(!_0x46d196){toast(_0x32cc65(0x4d6));return;}fallbackPostMessage(_0x32cc65(0x2f2)),ytFallbackIsPlaying=!![],toast('Đang\x20phát\x20nhạc\x20nền...');}try{const _0x397ffb=document[_0x32cc65(0x1f8)]('btnToggleYtSound');if(_0x397ffb)_0x397ffb['textContent']=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0xb1dfe){}return;}if(!ytPlayer||typeof ytPlayer[_0x32cc65(0x3bb)]!=='function'){try{ensureYouTubeAPI();}catch(_0x1e3ede){}return;}const _0x4a2457=ytPlayer['getPlayerState']();_0x4a2457===YT[_0x32cc65(0x316)][_0x32cc65(0x439)]||_0x4a2457===YT[_0x32cc65(0x316)][_0x32cc65(0x47f)]?(ytFadeOutPause(),ytUserPaused=!![],toast(_0x32cc65(0x4c8))):(ytFadeInPlay(),ytUserPaused=![],toast(_0x32cc65(0x4dc)));}function bindEvents(){const _0x43fbe2=_0x17450c;try{const _0x4ade5b=document[_0x43fbe2(0x48d)](_0x43fbe2(0x2a5));_0x4ade5b&&(_0x4ade5b[_0x43fbe2(0x1ef)]='Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.');}catch(_0x47c02e){}on($(_0x43fbe2(0x463)),_0x43fbe2(0x4a4),toggleBackgroundView),on($('#btnMilestoneClose'),'click',()=>{const _0x36acb3=_0x43fbe2;$('#modalMilestone')['classList'][_0x36acb3(0x393)](_0x36acb3(0x3ae));try{releaseFocus();}catch(_0x1f1789){}}),on($(_0x43fbe2(0x4cc)),_0x43fbe2(0x4a4),()=>showInputModal(_0x43fbe2(0x48e),async _0x2ff877=>{if(!_0x2ff877)return;data['topics']['push']({'id':uid('t'),'name':_0x2ff877,'subtopics':[]}),await saveData(),renderTopics();})),on($(_0x43fbe2(0x266)),_0x43fbe2(0x4a4),()=>storageManager[_0x43fbe2(0x26c)](data)),on($(_0x43fbe2(0x4ef)),_0x43fbe2(0x315),_0x55a0c9=>{const _0x53f1aa=_0x43fbe2,_0x521f71=_0x55a0c9['target'][_0x53f1aa(0x372)][0x0];if(!_0x521f71)return;storageManager['importData'](_0x521f71)[_0x53f1aa(0x3ff)](async _0x2bfa9c=>{data=_0x2bfa9c,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast('Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!'),renderAll();})[_0x53f1aa(0x423)](_0x356183=>toast('Nhập\x20thất\x20bại:\x20'+_0x356183['message'])),_0x55a0c9[_0x53f1aa(0x4a2)][_0x53f1aa(0x406)]=null;}),on($(_0x43fbe2(0x2bc)),'click',()=>{const _0xe19d7f=_0x43fbe2,_0x2a549a=$(_0xe19d7f(0x21c)),_0x3615d4=_0x2a549a?_0x2a549a['value']:'';if(!_0x3615d4){toast('Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.');return;}showConfirmModal(_0xe19d7f(0x4fa),_0xe19d7f(0x26f)+new Date(_0x3615d4)[_0xe19d7f(0x34b)]()+_0xe19d7f(0x484),_0x2dabbe=>{const _0x74b667=_0xe19d7f;_0x2dabbe&&storageManager[_0x74b667(0x349)](_0x3615d4)[_0x74b667(0x3ff)](_0x7ea104=>{const _0x4c6281=_0x74b667;data=_0x7ea104,toast(_0x4c6281(0x4e8)),setTimeout(()=>window['location'][_0x4c6281(0x268)](),0x5dc);})[_0x74b667(0x423)](_0x3c80a2=>{const _0x3edd0f=_0x74b667;toast(_0x3edd0f(0x3a1)+_0x3c80a2['message']);});});}),on($(_0x43fbe2(0x1f5)),_0x43fbe2(0x2ed),_0x48862f=>{const _0x5644f5=_0x43fbe2,_0x4f9d5e=_0x48862f[_0x5644f5(0x4a2)][_0x5644f5(0x406)];applyTheme(_0x4f9d5e);if(_0x4f9d5e===_0x5644f5(0x244)||_0x4f9d5e==='pastel'){const _0x45c9ed=$(_0x5644f5(0x28d));_0x45c9ed&&(_0x45c9ed[_0x5644f5(0x1fc)]=![],toast(_0x5644f5(0x1fd),0x7d0));try{document[_0x5644f5(0x219)][_0x5644f5(0x3a2)]['setProperty']('--bg-image',_0x5644f5(0x39a));}catch(_0x1c6451){}}else{const _0x1a9a3b=$(_0x5644f5(0x28d));_0x1a9a3b&&(_0x1a9a3b[_0x5644f5(0x1fc)]=!![]);try{updateYouTubePlayer();}catch(_0x47bf97){}}}),on($('#btnSettings'),'click',openSettings),on($('#btnHelpCreateTopic'),_0x43fbe2(0x4a4),()=>{const _0x203188=_0x43fbe2;switchView(_0x203188(0x3b3)),$('#btnAddTopic')[_0x203188(0x4a4)]();}),on($(_0x43fbe2(0x4d1)),_0x43fbe2(0x4a4),()=>{const _0x450fa7=_0x43fbe2;renderDashboard(),$('#modalDashboard')['classList'][_0x450fa7(0x30f)](_0x450fa7(0x3ae));}),on($(_0x43fbe2(0x217)),_0x43fbe2(0x4a4),()=>{const _0x3b35f7=_0x43fbe2;$(_0x3b35f7(0x4ee))[_0x3b35f7(0x279)][_0x3b35f7(0x393)](_0x3b35f7(0x3ae));}),on($(_0x43fbe2(0x4f5)),_0x43fbe2(0x4a4),closeSettings),on($(_0x43fbe2(0x2d9)),_0x43fbe2(0x4a4),saveSettings),on($('#btnDefaults'),_0x43fbe2(0x4a4),setDefaults),on($('#btnTestSound'),_0x43fbe2(0x4a4),()=>{const _0x2dfc7b=_0x43fbe2;ensureAudio(),playSound(_0x2dfc7b(0x2fc));}),on($('#btnToggleCustomSounds'),_0x43fbe2(0x4a4),_0x398bad=>{const _0x455d5c=_0x43fbe2;_0x398bad['preventDefault']();const _0x19e1b8=$('#customSoundsContainer');if(_0x19e1b8)_0x19e1b8[_0x455d5c(0x279)][_0x455d5c(0x44c)]('hidden');}),on($('#btnSaveNote'),_0x43fbe2(0x4a4),async()=>{const _0x2c4604=_0x43fbe2,_0x57cf52=getCurrentSubtopic();if(!_0x57cf52)return;const _0x1bd7f8=pendingNoteSessionId,_0x3dbb9d=_0x57cf52[_0x2c4604(0x20d)]['find'](_0x265aee=>_0x265aee['id']===_0x1bd7f8);_0x3dbb9d&&(_0x3dbb9d['note']=$(_0x2c4604(0x449))[_0x2c4604(0x406)][_0x2c4604(0x404)](),await saveData(),renderStatsHistory(),toast(_0x2c4604(0x4e2))),closeNoteModal();}),on($(_0x43fbe2(0x49a)),_0x43fbe2(0x4a4),()=>closeNoteModal()),on($(_0x43fbe2(0x2be)),_0x43fbe2(0x4a4),addGeneralNote),on($(_0x43fbe2(0x45d)),_0x43fbe2(0x4a4),handleSummarizeNote),on($(_0x43fbe2(0x4e3)),_0x43fbe2(0x4a4),handleSendMessage),on($('#chatInput'),_0x43fbe2(0x4b2),_0x723daf=>{const _0x30e70f=_0x43fbe2;if(_0x723daf[_0x30e70f(0x2f4)]===_0x30e70f(0x4d2))handleSendMessage();}),$$(_0x43fbe2(0x2e6))[_0x43fbe2(0x4a0)](_0x58320b=>{const _0x48415c=_0x43fbe2;on(_0x58320b,_0x48415c(0x4a4),()=>{const _0x26b7aa=_0x48415c,_0x5de6b4=_0x58320b['dataset'][_0x26b7aa(0x42a)];$(_0x26b7aa(0x45c))[_0x26b7aa(0x406)]=_0x5de6b4,$(_0x26b7aa(0x45c))[_0x26b7aa(0x310)]();});}),on($(_0x43fbe2(0x3b8)),_0x43fbe2(0x4a4),clearChat),on($(_0x43fbe2(0x455)),_0x43fbe2(0x4a4),addSubtopicTask),on($(_0x43fbe2(0x218)),_0x43fbe2(0x4b2),_0x328bb1=>{const _0x31b2c8=_0x43fbe2;if(_0x328bb1[_0x31b2c8(0x2f4)]==='Enter')addSubtopicTask();}),on($(_0x43fbe2(0x2af)),'click',toggleYtSound),on($(_0x43fbe2(0x483)),_0x43fbe2(0x4a4),()=>{ensureAudio(),unlockAudioChain();}),on($(_0x43fbe2(0x2bd)),_0x43fbe2(0x2ed),_0x27df64=>{const _0xbe43d3=_0x43fbe2,_0x4a894f=parseInt(_0x27df64[_0xbe43d3(0x4a2)][_0xbe43d3(0x406)],0xa);ytPlayer&&ytPlayer[_0xbe43d3(0x225)]&&ytPlayer['setVolume'](_0x4a894f);}),on($(_0x43fbe2(0x387)),'input',handleYoutubeUrlInput),$$(_0x43fbe2(0x39c))[_0x43fbe2(0x4a0)](_0x2fa746=>{const _0x5e45a3=_0x43fbe2;_0x2fa746[_0x5e45a3(0x45b)](_0x5e45a3(0x4a4),()=>{const _0x4ee73f=_0x5e45a3,_0x307160=_0x2fa746[_0x4ee73f(0x32d)]['view'],_0x577460=data?.[_0x4ee73f(0x4a9)]?.['currentView']||_0x4ee73f(0x3f3);if(_0x577460===_0x307160&&_0x307160!==_0x4ee73f(0x3f3))switchView(_0x4ee73f(0x3f3));else switchView(_0x307160);});}),$$(_0x43fbe2(0x2c5))[_0x43fbe2(0x4a0)](_0x686c5f=>{const _0x4ba361=_0x43fbe2;_0x686c5f[_0x4ba361(0x45b)](_0x4ba361(0x4a4),()=>{const _0x5e3e45=_0x4ba361,_0x15edae=_0x686c5f[_0x5e3e45(0x32d)]['tab'],_0x50f548=_0x686c5f[_0x5e3e45(0x24c)]('.aux-panel,\x20.modal-card');if(!_0x50f548)return;_0x50f548[_0x5e3e45(0x283)]('.tab-btn')['forEach'](_0x9f8daf=>_0x9f8daf[_0x5e3e45(0x279)]['remove']('active')),_0x686c5f[_0x5e3e45(0x279)][_0x5e3e45(0x30f)](_0x5e3e45(0x357)),_0x50f548[_0x5e3e45(0x283)](_0x5e3e45(0x312))[_0x5e3e45(0x4a0)](_0x2a55b4=>{const _0x26313b=_0x5e3e45;_0x2a55b4[_0x26313b(0x279)][_0x26313b(0x393)](_0x26313b(0x357)),_0x2a55b4['style'][_0x26313b(0x2c1)]=_0x26313b(0x39a);});const _0x17eedf=_0x50f548['querySelector']('#'+_0x15edae);_0x17eedf&&(_0x17eedf['classList'][_0x5e3e45(0x30f)](_0x5e3e45(0x357)),_0x17eedf[_0x5e3e45(0x3a2)][_0x5e3e45(0x2c1)]=_0x5e3e45(0x458),_0x50f548['closest'](_0x5e3e45(0x3ca))&&(_0x17eedf[_0x5e3e45(0x3a2)]['display']=_0x5e3e45(0x30b)));});});const _0x5904b1=$(_0x43fbe2(0x414));function _0xd3232b(_0x28385b,_0x1051d5=null){const _0x28361a=_0x43fbe2;try{document[_0x28361a(0x220)](_0x28361a(0x243),![],!![]);}catch(_0x5ce704){}try{document[_0x28361a(0x220)](_0x28385b,![],_0x1051d5);}catch(_0x1211c2){}if(_0x5904b1)_0x5904b1[_0x28361a(0x310)]();}on($(_0x43fbe2(0x34a)),_0x43fbe2(0x4a4),()=>_0xd3232b(_0x43fbe2(0x20b))),on($(_0x43fbe2(0x499)),_0x43fbe2(0x4a4),()=>_0xd3232b('italic')),on($(_0x43fbe2(0x2e7)),_0x43fbe2(0x4a4),()=>_0xd3232b(_0x43fbe2(0x1f1),_0x43fbe2(0x299))),on($(_0x43fbe2(0x2c7)),_0x43fbe2(0x4a4),()=>_0xd3232b('insertOrderedList')),on($(_0x43fbe2(0x48f)),_0x43fbe2(0x4a4),()=>_0xd3232b(_0x43fbe2(0x3df)));const _0x3fb250=$(_0x43fbe2(0x2aa)),_0x38e161=$(_0x43fbe2(0x38e));on($(_0x43fbe2(0x3c1)),_0x43fbe2(0x4a4),_0x3888ec=>{const _0x4e4d2f=_0x43fbe2;if(!_0x38e161)return;_0x3888ec[_0x4e4d2f(0x2a0)](),_0x38e161[_0x4e4d2f(0x279)][_0x4e4d2f(0x44c)]('hidden');}),$$(_0x43fbe2(0x235))[_0x43fbe2(0x4a0)](_0x22d9ba=>{const _0x277c79=_0x43fbe2;on(_0x22d9ba,_0x277c79(0x4a4),_0x56215b=>{const _0x1568ab=_0x277c79;_0x56215b[_0x1568ab(0x441)]();const _0x9bc823=_0x22d9ba['dataset'][_0x1568ab(0x2d1)]||'';let _0x383599=_0x9bc823;try{const _0x4311a3=_0x9bc823[_0x1568ab(0x2ae)](/--[a-zA-Z0-9_-]+/);if(_0x4311a3)_0x383599=getComputedStyle(document[_0x1568ab(0x219)])[_0x1568ab(0x226)](_0x4311a3[0x0])[_0x1568ab(0x404)]();}catch(_0x1af3dc){}_0xd3232b('foreColor',_0x383599);if(_0x38e161)_0x38e161[_0x1568ab(0x279)][_0x1568ab(0x30f)](_0x1568ab(0x454));});}),on(document,_0x43fbe2(0x4a4),_0x372059=>{const _0x466b3d=_0x43fbe2;if(!_0x3fb250||!_0x38e161)return;!_0x3fb250[_0x466b3d(0x4ea)](_0x372059['target'])&&!_0x38e161[_0x466b3d(0x279)]['contains'](_0x466b3d(0x454))&&_0x38e161[_0x466b3d(0x279)][_0x466b3d(0x30f)](_0x466b3d(0x454));});function _0x593c5f(_0x1ed54b){const _0x55473e=_0x43fbe2,_0x166b09=getCurrentSubtopic();if(!_0x166b09){toast('Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước.');return;}_0x166b09[_0x55473e(0x4c1)]=Array[_0x55473e(0x47e)](_0x166b09[_0x55473e(0x4c1)])?_0x166b09[_0x55473e(0x4c1)]:[];const _0x387427=_0x166b09['methods'],_0x45ad04=_0x1ed54b?_0x387427[_0x55473e(0x28c)](_0x98347a=>_0x98347a['id']===_0x1ed54b):null;$('#methodEditorId')[_0x55473e(0x406)]=_0x45ad04&&_0x45ad04['id']||'',$('#methodEditorTitle')[_0x55473e(0x48c)]=_0x45ad04?_0x55473e(0x471):_0x55473e(0x261),$(_0x55473e(0x351))['value']=_0x45ad04&&_0x45ad04[_0x55473e(0x241)]||'';const _0x5c1b84=$(_0x55473e(0x414));if(_0x5c1b84)_0x5c1b84[_0x55473e(0x1ef)]=_0x45ad04&&_0x45ad04[_0x55473e(0x2e0)]||'';$(_0x55473e(0x2a8))[_0x55473e(0x279)][_0x55473e(0x30f)](_0x55473e(0x3ae));try{trapFocus($(_0x55473e(0x2a8)));}catch(_0x23acf5){}try{const _0x37ee7e=$(_0x55473e(0x3cb));if(_0x37ee7e){const _0x1de0d5=!!(data?.[_0x55473e(0x4a9)]?.['apiKey']&&data[_0x55473e(0x4a9)][_0x55473e(0x27a)]['trim']());_0x37ee7e[_0x55473e(0x2e9)]=!_0x1de0d5,_0x37ee7e[_0x55473e(0x241)]=_0x1de0d5?_0x55473e(0x3d4):'Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.';}}catch(_0x2e184e){}}on($(_0x43fbe2(0x2fa)),'click',()=>{const _0x5085e6=_0x43fbe2;$(_0x5085e6(0x2a8))[_0x5085e6(0x279)][_0x5085e6(0x393)](_0x5085e6(0x3ae));try{releaseFocus();}catch(_0x37ddd0){}}),on($(_0x43fbe2(0x4e4)),_0x43fbe2(0x4a4),async()=>{const _0x57bb00=_0x43fbe2,_0x786784=getCurrentSubtopic();if(!_0x786784){toast(_0x57bb00(0x1f9));return;}_0x786784['methods']=Array[_0x57bb00(0x47e)](_0x786784[_0x57bb00(0x4c1)])?_0x786784[_0x57bb00(0x4c1)]:[];const _0x48bc02=$('#methodEditorId')[_0x57bb00(0x406)]||uid('m'),_0x27c9b3=($(_0x57bb00(0x351))[_0x57bb00(0x406)]||'')[_0x57bb00(0x404)](),_0x4b85ba=$('#methodEditorContentInput'),_0x3b5d59=_0x4b85ba?_0x4b85ba[_0x57bb00(0x1ef)]||'':'',_0x1298bc=_0x786784[_0x57bb00(0x4c1)][_0x57bb00(0x4ec)](_0x4a1299=>_0x4a1299['id']===_0x48bc02),_0xbb3905={'id':_0x48bc02,'title':_0x27c9b3,'content':_0x3b5d59};if(_0x1298bc>=0x0)_0x786784['methods'][_0x1298bc]=_0xbb3905;else _0x786784[_0x57bb00(0x4c1)][_0x57bb00(0x253)](_0xbb3905);await storageManager[_0x57bb00(0x476)]('subtopics',_0x786784),renderMethods(),$(_0x57bb00(0x2a8))[_0x57bb00(0x279)]['remove']('show');try{releaseFocus();}catch(_0x51bd47){}}),on($(_0x43fbe2(0x3cb)),_0x43fbe2(0x4a4),async()=>{const _0x1402ba=_0x43fbe2,_0x521137=$(_0x1402ba(0x414));if(!_0x521137)return;const _0xc5752e=(_0x521137[_0x1402ba(0x48c)]||'')[_0x1402ba(0x404)]();if(!_0xc5752e||_0xc5752e['length']<0x14){toast(_0x1402ba(0x468));return;}const _0x4356ee=$('#btnAutoFormat');_0x4356ee&&(_0x4356ee[_0x1402ba(0x2e9)]=!![],_0x4356ee['innerHTML']='<div\x20class=\x22spinner\x22></div>');const _0x48a3ac=_0x1402ba(0x274)+_0xc5752e+'\x22',_0x559f11=await callGeminiAPI(_0x48a3ac);_0x559f11?(_0x521137[_0x1402ba(0x1ef)]=_0x559f11,toast(_0x1402ba(0x49c))):toast(_0x1402ba(0x222)),_0x4356ee&&(_0x4356ee[_0x1402ba(0x2e9)]=![],_0x4356ee[_0x1402ba(0x1ef)]=_0x1402ba(0x31f));}),on($('#btnAddMethod'),_0x43fbe2(0x4a4),()=>{const _0x11e78c=_0x43fbe2;if(!getCurrentSubtopic()){toast(_0x11e78c(0x1f9));return;}_0x593c5f();});const _0x5e8642=document[_0x43fbe2(0x48d)](_0x43fbe2(0x4b5));_0x5e8642&&_0x5e8642[_0x43fbe2(0x45b)](_0x43fbe2(0x4a4),_0x2ae459=>{const _0x1f9d85=_0x43fbe2,_0x221e80=_0x2ae459[_0x1f9d85(0x4a2)][_0x1f9d85(0x24c)]&&_0x2ae459[_0x1f9d85(0x4a2)][_0x1f9d85(0x24c)](_0x1f9d85(0x403)),_0x18aad9=!_0x221e80&&_0x2ae459[_0x1f9d85(0x4a2)][_0x1f9d85(0x24c)]&&_0x2ae459[_0x1f9d85(0x4a2)][_0x1f9d85(0x24c)](_0x1f9d85(0x21b));if(_0x221e80){_0x2ae459[_0x1f9d85(0x441)](),_0x2ae459['stopPropagation']();const _0x3cb247=_0x221e80[_0x1f9d85(0x32d)]['id'];if(_0x3cb247)_0x593c5f(_0x3cb247);return;}if(_0x18aad9){_0x2ae459['preventDefault'](),_0x2ae459[_0x1f9d85(0x2a0)]();const _0x31d1cf=_0x18aad9[_0x1f9d85(0x32d)]['id'];if(!_0x31d1cf)return;const _0x677048=getCurrentSubtopic();if(!_0x677048)return;_0x677048[_0x1f9d85(0x4c1)]=Array[_0x1f9d85(0x47e)](_0x677048[_0x1f9d85(0x4c1)])?_0x677048[_0x1f9d85(0x4c1)]:[];const _0x476d2c=_0x677048[_0x1f9d85(0x4c1)][_0x1f9d85(0x28c)](_0x55b9d2=>_0x55b9d2['id']===_0x31d1cf);if(!_0x476d2c)return;showConfirmModal('Xác\x20nhận\x20xóa',_0x1f9d85(0x2db)+(_0x476d2c[_0x1f9d85(0x241)]||'')+'\x22?',async _0x25d31f=>{const _0x5ffe1b=_0x1f9d85;if(!_0x25d31f)return;_0x677048['methods']=_0x677048[_0x5ffe1b(0x4c1)][_0x5ffe1b(0x3a0)](_0x483d60=>_0x483d60['id']!==_0x31d1cf),await storageManager[_0x5ffe1b(0x476)]('subtopics',_0x677048),renderMethods();});}});$$(_0x43fbe2(0x410))['forEach'](_0x43211f=>{const _0x3ef43a=_0x43fbe2;_0x43211f[_0x3ef43a(0x45b)](_0x3ef43a(0x4a4),()=>{const _0x19a587=_0x3ef43a;editingPreset=_0x43211f[_0x19a587(0x32d)]['presetTarget'],highlightPresetSelector(),loadEditingPresetFields();});}),$$(_0x43fbe2(0x205))[_0x43fbe2(0x4a0)](_0x3b9d73=>{const _0x451953=_0x43fbe2;_0x3b9d73[_0x451953(0x45b)](_0x451953(0x4a4),_0xf761f5=>{const _0x1514ed=_0x451953,_0x384249=_0xf761f5[_0x1514ed(0x4a2)][_0x1514ed(0x32d)][_0x1514ed(0x323)],_0x5ccfd8=data[_0x1514ed(0x4a9)][_0x1514ed(0x323)];if(_0x384249===_0x5ccfd8)return;timer[_0x1514ed(0x24d)]!==_0x1514ed(0x4b6)?showConfirmModal(_0x1514ed(0x291),_0x1514ed(0x1f3)+_0x384249+_0x1514ed(0x37b),_0x1e5e8e=>{const _0x3f5f7a=_0x1514ed;_0x1e5e8e&&(timer['reset'](),timer[_0x3f5f7a(0x4ad)](_0x384249),renderAll(),toast(_0x3f5f7a(0x4f6)+_0x384249+'.'));}):(timer[_0x1514ed(0x4ad)](_0x384249),renderAll(),toast(_0x1514ed(0x4f6)+_0x384249+'.'));});}),on($(_0x43fbe2(0x2b7)),_0x43fbe2(0x4a4),()=>timer[_0x43fbe2(0x23e)]()),on($(_0x43fbe2(0x464)),'click',()=>timer['finishFlowSession']()),on($(_0x43fbe2(0x355)),'click',()=>timer[_0x43fbe2(0x35e)]()),on($('#btnResume'),_0x43fbe2(0x4a4),()=>timer[_0x43fbe2(0x3d5)]()),on($(_0x43fbe2(0x469)),_0x43fbe2(0x4a4),()=>timer[_0x43fbe2(0x4ac)]()),on($(_0x43fbe2(0x2ad)),_0x43fbe2(0x4a4),()=>timer[_0x43fbe2(0x24a)]()),on($(_0x43fbe2(0x245)),'click',()=>timer[_0x43fbe2(0x384)]()),on($(_0x43fbe2(0x2d6)),_0x43fbe2(0x315),_0xb72d9c=>{const _0x425a0c=_0x43fbe2;handleFileUpload(_0xb72d9c[_0x425a0c(0x4a2)][_0x425a0c(0x372)][0x0],async _0x184ac0=>{const _0x35ca94=_0x425a0c;data[_0x35ca94(0x4a9)]['customBg']=_0x184ac0,await saveData(),applyCustomBg(),toast(_0x35ca94(0x289));}),_0xb72d9c[_0x425a0c(0x4a2)]['value']=null;}),on($(_0x43fbe2(0x4ab)),_0x43fbe2(0x4a4),async()=>{const _0xc33a6b=_0x43fbe2;data[_0xc33a6b(0x4a9)][_0xc33a6b(0x2ec)]='',data['settings']['useYtThumbnailAsBg']=![],await saveData(),applyCustomBg(),toast('Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.'),$(_0xc33a6b(0x3ca))[_0xc33a6b(0x279)][_0xc33a6b(0x4ea)](_0xc33a6b(0x3ae))&&openSettings();}),on($(_0x43fbe2(0x26b)),_0x43fbe2(0x315),_0x354862=>{const _0x3cb895=_0x43fbe2;handleFileUpload(_0x354862[_0x3cb895(0x4a2)][_0x3cb895(0x372)][0x0],async _0x599e10=>{const _0x371678=_0x3cb895;data[_0x371678(0x4a9)]['customSounds']['work_end']=_0x599e10,await saveData(),toast(_0x371678(0x25f));}),_0x354862[_0x3cb895(0x4a2)][_0x3cb895(0x406)]=null;}),on($(_0x43fbe2(0x47d)),'change',_0x1215f6=>{const _0x3bcf79=_0x43fbe2;handleFileUpload(_0x1215f6[_0x3bcf79(0x4a2)][_0x3bcf79(0x372)][0x0],async _0x1e80c8=>{const _0x1423bc=_0x3bcf79;data[_0x1423bc(0x4a9)][_0x1423bc(0x37f)][_0x1423bc(0x413)]=_0x1e80c8,await saveData(),toast('Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.');}),_0x1215f6[_0x3bcf79(0x4a2)][_0x3bcf79(0x406)]=null;}),on($(_0x43fbe2(0x2fd)),'change',_0x349975=>{const _0x40f3cb=_0x43fbe2;handleFileUpload(_0x349975[_0x40f3cb(0x4a2)][_0x40f3cb(0x372)][0x0],async _0x297957=>{const _0x1ff5cf=_0x40f3cb;data['settings'][_0x1ff5cf(0x37f)][_0x1ff5cf(0x4aa)]=_0x297957,await saveData(),toast(_0x1ff5cf(0x378));}),_0x349975[_0x40f3cb(0x4a2)][_0x40f3cb(0x406)]=null;}),on($('#btnFullscreen'),'click',toggleFullScreen),document[_0x43fbe2(0x45b)]('fullscreenchange',updateFullscreenButton),window['addEventListener'](_0x43fbe2(0x4b2),_0x52c112=>{const _0x560528=_0x43fbe2,_0x1f85ba=_0x52c112[_0x560528(0x4a2)],_0x2b22f5=(_0x1f85ba[_0x560528(0x22b)]||'')[_0x560528(0x250)](),_0x369202=['input',_0x560528(0x237),_0x560528(0x3d2)][_0x560528(0x49f)](_0x2b22f5)||_0x1f85ba['isContentEditable'];if(_0x52c112[_0x560528(0x2f1)]==='Space'&&!_0x369202){_0x52c112[_0x560528(0x441)]();if(timer[_0x560528(0x24d)]==='idle'||timer[_0x560528(0x24d)]===_0x560528(0x3ba))timer[_0x560528(0x23e)]();else timer['pause']();}(_0x52c112[_0x560528(0x2f4)]==='n'||_0x52c112[_0x560528(0x2f4)]==='N')&&(!_0x369202&&(_0x52c112[_0x560528(0x441)](),timer[_0x560528(0x4ac)]()));if(_0x52c112['key']===_0x560528(0x265)){$$(_0x560528(0x2de))[_0x560528(0x4a0)](_0x109d46=>_0x109d46['classList']['remove'](_0x560528(0x3ae)));try{releaseFocus();}catch(_0x320270){}}if(_0x52c112[_0x560528(0x290)]&&!_0x369202){if(_0x52c112[_0x560528(0x2f4)]===_0x560528(0x3b9))_0x52c112[_0x560528(0x441)](),_0x5158cb(0x0,-0xa);else{if(_0x52c112['key']===_0x560528(0x373))_0x52c112[_0x560528(0x441)](),_0x5158cb(0x0,0xa);else{if(_0x52c112[_0x560528(0x2f4)]===_0x560528(0x4f8))_0x52c112[_0x560528(0x441)](),_0x5158cb(-0xa,0x0);else _0x52c112['key']===_0x560528(0x24f)&&(_0x52c112[_0x560528(0x441)](),_0x5158cb(0xa,0x0));}}}}),$$('.modal')[_0x43fbe2(0x4a0)](_0x48336c=>_0x48336c['addEventListener'](_0x43fbe2(0x4a4),_0x468bbb=>{const _0x565b20=_0x43fbe2;if(_0x468bbb&&_0x468bbb[_0x565b20(0x4a2)]&&_0x468bbb[_0x565b20(0x4a2)]['id']===_0x565b20(0x408))return;if(_0x468bbb[_0x565b20(0x4a2)]===_0x48336c){_0x48336c[_0x565b20(0x279)][_0x565b20(0x393)]('show');try{releaseFocus();}catch(_0x17746c){}}})),window[_0x43fbe2(0x45b)](_0x43fbe2(0x4a4),_0x5a4805=>{const _0x184488=_0x43fbe2;!_0x5a4805[_0x184488(0x4a2)]['closest'](_0x184488(0x3ab))&&!_0x5a4805[_0x184488(0x4a2)][_0x184488(0x24c)]('.actions-menu')&&closeAllMenus();});try{const _0x3cb562=document[_0x43fbe2(0x48d)](_0x43fbe2(0x20c));if(_0x3cb562)_0x3cb562[_0x43fbe2(0x45b)](_0x43fbe2(0x33b),closeAllMenus);}catch(_0x5ef93b){}try{window[_0x43fbe2(0x45b)](_0x43fbe2(0x33b),closeAllMenus,!![]);}catch(_0x336cfd){}window[_0x43fbe2(0x45b)](_0x43fbe2(0x22f),()=>timer[_0x43fbe2(0x37c)](!![]));try{const _0x1ea98a=Array['from'](document[_0x43fbe2(0x283)]('#view-methods\x20.method-item'));_0x1ea98a['length']&&_0x1ea98a[_0x43fbe2(0x4a0)](_0x14b73d=>{const _0xcc28cc=_0x43fbe2;_0x14b73d['addEventListener'](_0xcc28cc(0x44c),()=>{const _0x111677=_0xcc28cc;_0x14b73d['open']&&_0x1ea98a[_0x111677(0x4a0)](_0x5f508a=>{if(_0x5f508a!==_0x14b73d)_0x5f508a['open']=![];});});});}catch(_0x3d1dc5){}const _0x6384e7=$('#draggableTimer');let _0x3e986c=![],_0x4d7b4c,_0xe605d1;_0x6384e7&&(_0x6384e7[_0x43fbe2(0x45b)]('mousedown',_0x1269c1=>{const _0x352110=_0x43fbe2;_0x3e986c=!![];const _0x54cef5=_0x6384e7[_0x352110(0x3f2)]();_0x4d7b4c=_0x1269c1['clientX']-_0x54cef5[_0x352110(0x21e)],_0xe605d1=_0x1269c1[_0x352110(0x3f8)]-_0x54cef5[_0x352110(0x3c4)],_0x6384e7[_0x352110(0x3a2)]['transition']=_0x352110(0x39a);}),document['addEventListener']('mousemove',_0x25425a=>{const _0x186c41=_0x43fbe2;if(!_0x3e986c)return;let _0x3d601b=_0x25425a['clientX']-_0x4d7b4c,_0x2e1c67=_0x25425a['clientY']-_0xe605d1;const _0x33e014=window[_0x186c41(0x267)]-_0x6384e7['offsetWidth'],_0x48e1c5=window['innerHeight']-_0x6384e7[_0x186c41(0x21d)];_0x3d601b=Math[_0x186c41(0x3e8)](0x0,Math[_0x186c41(0x420)](_0x3d601b,_0x33e014)),_0x2e1c67=Math[_0x186c41(0x3e8)](0x0,Math[_0x186c41(0x420)](_0x2e1c67,_0x48e1c5)),_0x6384e7['style'][_0x186c41(0x21e)]=_0x3d601b+'px',_0x6384e7[_0x186c41(0x3a2)]['top']=_0x2e1c67+'px',_0x6384e7[_0x186c41(0x3a2)]['bottom']='auto',_0x6384e7['style']['right']='auto';}),document[_0x43fbe2(0x45b)](_0x43fbe2(0x374),()=>{const _0x1286b7=_0x43fbe2;if(!_0x3e986c)return;_0x3e986c=![],_0x6384e7[_0x1286b7(0x3a2)]['transition']='';}));function _0x29a776(_0x2b77bd){const _0x22af5b=_0x43fbe2,_0x23efc9=$(_0x22af5b(0x401));if(!_0x23efc9)return;_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x35a)]=_0x22af5b(0x386),_0x23efc9['style'][_0x22af5b(0x482)]='',_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x21e)]=_0x22af5b(0x3da),_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x3c4)]='auto',_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x472)]='auto',_0x23efc9['style'][_0x22af5b(0x37d)]=_0x22af5b(0x3da);const _0x21bbba=0x10;_0x2b77bd==='tl'&&(_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x21e)]=_0x21bbba+'px',_0x23efc9['style']['top']=_0x21bbba+'px'),_0x2b77bd==='tr'&&(_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x472)]=_0x21bbba+'px',_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x3c4)]=_0x21bbba+'px'),_0x2b77bd==='bl'&&(_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x21e)]=_0x21bbba+'px',_0x23efc9[_0x22af5b(0x3a2)]['bottom']=_0x21bbba+'px'),_0x2b77bd==='br'&&(_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x472)]=_0x21bbba+'px',_0x23efc9[_0x22af5b(0x3a2)][_0x22af5b(0x37d)]=_0x21bbba+'px');}function _0x5158cb(_0x547b78,_0xa9465){const _0xc5ba8a=_0x43fbe2,_0x55b478=$(_0xc5ba8a(0x401));if(!_0x55b478)return;const _0x2e883f=_0x55b478['getBoundingClientRect'](),_0x39b03e=Math[_0xc5ba8a(0x3e8)](0x0,Math[_0xc5ba8a(0x420)](_0x2e883f[_0xc5ba8a(0x21e)]+_0x547b78,window[_0xc5ba8a(0x267)]-_0x55b478[_0xc5ba8a(0x3e5)])),_0x54d1fb=Math[_0xc5ba8a(0x3e8)](0x0,Math[_0xc5ba8a(0x420)](_0x2e883f['top']+_0xa9465,window[_0xc5ba8a(0x303)]-_0x55b478[_0xc5ba8a(0x21d)]));_0x55b478[_0xc5ba8a(0x3a2)][_0xc5ba8a(0x21e)]=_0x39b03e+'px',_0x55b478[_0xc5ba8a(0x3a2)][_0xc5ba8a(0x3c4)]=_0x54d1fb+'px',_0x55b478['style']['right']=_0xc5ba8a(0x3da),_0x55b478[_0xc5ba8a(0x3a2)][_0xc5ba8a(0x37d)]='auto';}}function toggleBackgroundView(){const _0x56f830=_0x17450c,_0x144fdc=document[_0x56f830(0x219)];_0x144fdc['classList'][_0x56f830(0x44c)](_0x56f830(0x2df));const _0x67d76a=_0x144fdc[_0x56f830(0x279)][_0x56f830(0x4ea)](_0x56f830(0x2df)),_0x4f794b=$(_0x56f830(0x463));if(!_0x4f794b)return;_0x67d76a?(_0x4f794b[_0x56f830(0x241)]=_0x56f830(0x2d7),_0x4f794b['innerHTML']=_0x56f830(0x4fe)):(_0x4f794b[_0x56f830(0x241)]=_0x56f830(0x25e),_0x4f794b[_0x56f830(0x1ef)]=_0x56f830(0x2d8));}function updateMainViewVisibility(){const _0x17f608=_0x17450c,_0x370082=!!getCurrentSubtopic(),_0x4bc846=$(_0x17f608(0x341)),_0x417d15=$(_0x17f608(0x3bc));_0x417d15&&_0x417d15['classList'][_0x17f608(0x44c)](_0x17f608(0x454),_0x370082),_0x4bc846&&(_0x370082?_0x4bc846[_0x17f608(0x279)]['remove'](_0x17f608(0x38c)):_0x4bc846['classList'][_0x17f608(0x30f)](_0x17f608(0x38c)));}function updatePresetButtonsText(){const _0x5489b6=_0x17450c,_0x3abb8b=data[_0x5489b6(0x4a9)],_0x2bd73c=_0x3abb8b[_0x5489b6(0x34c)],_0x7dcf2e=_0x3abb8b[_0x5489b6(0x2ff)],_0x57e006=_0x3abb8b[_0x5489b6(0x3d9)][_0x5489b6(0x412)],_0x4b264c=_0x3abb8b[_0x5489b6(0x3d9)][_0x5489b6(0x436)],_0x1a7c61=$(_0x5489b6(0x23b)),_0x529eea=$(_0x5489b6(0x25c)),_0x4a1a30=$('#btnPresetC');_0x1a7c61&&(_0x1a7c61[_0x5489b6(0x48c)]=_0x2bd73c+'×'+_0x57e006+'\x20(A)'),_0x529eea&&(_0x529eea[_0x5489b6(0x48c)]=_0x7dcf2e+'×'+_0x4b264c+'\x20(B)'),_0x4a1a30&&(_0x4a1a30[_0x5489b6(0x48c)]=_0x5489b6(0x3ee));}function renderAll(){const _0xc576dd=_0x17450c;updatePresetButtonsText();const _0x395ae6=data['settings'][_0xc576dd(0x323)];$$(_0xc576dd(0x205))[_0xc576dd(0x4a0)](_0x5ae5ac=>{const _0x4d8d93=_0xc576dd,_0x313883=_0x5ae5ac['dataset'][_0x4d8d93(0x323)]===_0x395ae6;_0x5ae5ac[_0x4d8d93(0x279)][_0x4d8d93(0x44c)]('acc',_0x313883),_0x5ae5ac[_0x4d8d93(0x279)][_0x4d8d93(0x44c)](_0x4d8d93(0x3b7),!_0x313883),_0x5ae5ac['setAttribute']('aria-pressed',_0x313883);}),updateMainViewVisibility(),timer[_0xc576dd(0x4ad)](data[_0xc576dd(0x4a9)][_0xc576dd(0x323)],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data[_0xc576dd(0x4a9)][_0xc576dd(0x3cd)]);}function toggleFullScreen(){const _0x488a4c=_0x17450c;!document[_0x488a4c(0x4b1)]?document[_0x488a4c(0x3ea)][_0x488a4c(0x4a6)]()[_0x488a4c(0x423)](_0x4e32f2=>{const _0x2b745d=_0x488a4c;toast('Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20'+_0x4e32f2[_0x2b745d(0x391)]);}):document['exitFullscreen']&&document[_0x488a4c(0x44b)]();}function updateFullscreenButton(){const _0x36f106=_0x17450c,_0x4822ed=$(_0x36f106(0x29f));document[_0x36f106(0x4b1)]?(_0x4822ed[_0x36f106(0x1ef)]='↙️',_0x4822ed[_0x36f106(0x241)]=_0x36f106(0x461)):(_0x4822ed[_0x36f106(0x1ef)]='↗️',_0x4822ed[_0x36f106(0x241)]=_0x36f106(0x3cf));}async function initializeApp(){const _0x47c3e3=_0x17450c;try{await storageManager[_0x47c3e3(0x4c7)]();const [_0x4fb96b,_0x3aa562,_0x259291]=await Promise['all']([storageManager['getSettings'](),storageManager['getAll'](_0x47c3e3(0x3b3)),storageManager[_0x47c3e3(0x27d)](_0x47c3e3(0x206))]);let _0x761088;if(!_0x4fb96b){const _0x519cd2=JSON[_0x47c3e3(0x31b)](JSON['stringify'](defaults));await storageManager[_0x47c3e3(0x1e7)](_0x519cd2[_0x47c3e3(0x4a9)]);for(const _0x1b9ede of _0x519cd2[_0x47c3e3(0x3b3)]){const {subtopics:_0x3d68f9,..._0x1f9d7f}=_0x1b9ede;await storageManager[_0x47c3e3(0x30f)](_0x47c3e3(0x3b3),_0x1f9d7f);for(const _0x110c46 of _0x3d68f9){await storageManager[_0x47c3e3(0x30f)](_0x47c3e3(0x206),{..._0x110c46,'topicId':_0x1b9ede['id']});}}_0x761088=_0x519cd2;}else{const _0x3d5202={};for(const _0x16a286 of _0x3aa562)_0x3d5202[_0x16a286['id']]={..._0x16a286,'subtopics':[]};for(const _0x1cb2e8 of _0x259291)_0x3d5202[_0x1cb2e8['topicId']]?.[_0x47c3e3(0x206)][_0x47c3e3(0x367)](_0x1cb2e8);_0x761088={'version':defaults[_0x47c3e3(0x44e)],'settings':_0x4fb96b,'topics':Object[_0x47c3e3(0x3cc)](_0x3d5202)};}data=window['data']=_0x761088,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0x47c3e3(0x3f6)](data);}catch(_0x1332e9){console[_0x47c3e3(0x1e9)](_0x47c3e3(0x258),_0x1332e9);}bindEvents(),applyTheme();}catch(_0x3092a6){console[_0x47c3e3(0x30e)]('Initialization\x20error:',_0x3092a6),toast(_0x47c3e3(0x27b)+_0x3092a6[_0x47c3e3(0x391)]);}}callGeminiAPI=async function(_0x12f66a,_0x2e1f8c=0x3,_0x9cc966=0x3e8){const _0x32ce5b=_0x17450c,_0x5083c9=data?.[_0x32ce5b(0x4a9)]?.['apiKey']||'';if(!_0x5083c9)return toast('Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.'),null;const _0x15fb5c=_0x32ce5b(0x4f7)+_0x5083c9,_0x3885e5={'contents':[{'role':_0x32ce5b(0x360),'parts':[{'text':_0x12f66a}]}]};try{const _0x4e0ba7=await fetch(_0x15fb5c,{'method':_0x32ce5b(0x2cf),'headers':{'Content-Type':_0x32ce5b(0x2e5)},'body':JSON[_0x32ce5b(0x239)](_0x3885e5)});if(!_0x4e0ba7['ok']){if(_0x4e0ba7[_0x32ce5b(0x1fe)]===0x1ad&&_0x2e1f8c>0x0)return await new Promise(_0x2e99f2=>setTimeout(_0x2e99f2,_0x9cc966)),callGeminiAPI(_0x12f66a,_0x2e1f8c-0x1,_0x9cc966*0x2);let _0x4fae13=null;try{_0x4fae13=await _0x4e0ba7[_0x32ce5b(0x48a)]();}catch(_0x547fb8){}let _0xa3e186=_0x32ce5b(0x4cb)+_0x4e0ba7[_0x32ce5b(0x1fe)];if(_0x4e0ba7[_0x32ce5b(0x1fe)]===0x190)_0xa3e186=_0x32ce5b(0x2b8);else{if(_0x4e0ba7[_0x32ce5b(0x1fe)]===0x1ad)_0xa3e186='Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.';else _0x4fae13?.[_0x32ce5b(0x30e)]?.[_0x32ce5b(0x391)]&&(_0xa3e186='Lỗi\x20từ\x20Gemini:\x20'+_0x4fae13[_0x32ce5b(0x30e)][_0x32ce5b(0x391)]);}return toast(_0xa3e186,0xfa0),console[_0x32ce5b(0x30e)](_0x32ce5b(0x3b4),_0x4fae13||_0x4e0ba7[_0x32ce5b(0x430)]),null;}const _0x429547=await _0x4e0ba7['json']();if(_0x429547[_0x32ce5b(0x493)]&&_0x429547[_0x32ce5b(0x493)][0x0]?.[_0x32ce5b(0x2e0)]?.[_0x32ce5b(0x338)]?.[0x0]?.['text'])return formatGeminiResponse(_0x429547[_0x32ce5b(0x493)][0x0]['content'][_0x32ce5b(0x338)][0x0][_0x32ce5b(0x2ee)]);else{console['error']('API\x20response\x20structure\x20is\x20unexpected:',_0x429547);if(_0x429547['promptFeedback']?.[_0x32ce5b(0x306)])return _0x32ce5b(0x36f)+_0x429547[_0x32ce5b(0x3c8)][_0x32ce5b(0x306)]+_0x32ce5b(0x324);return _0x32ce5b(0x4ce);}}catch(_0x23875f){return console[_0x32ce5b(0x30e)]('Lỗi\x20khi\x20gọi\x20Gemini\x20API:',_0x23875f),toast(_0x32ce5b(0x456),0xfa0),null;}},loadLanguage(localStorage['getItem'](_0x17450c(0x305))||'vi')[_0x17450c(0x3ff)](initializeApp);
    </script>
</body>
</html>

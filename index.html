<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Ứng dụng Pomodoro hỗ trợ học tập với tích hợp Gemini AI và giao diện hiện đại." />
    <title>Pomodoro Study App — Tích hợp Gemini AI (Giao diện mới)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — PHIÊN BẢN GIAO DIỆN TẬP TRUNG (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Mặc định) - Cập nhật từ file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Thêm biến RGB cho panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: THÊM CÁC THEME MỚI === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Ngăn nền tối mặc định khi không có ảnh */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: THÊM CÁC THEME MỚI === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Thêm các quy tắc border cho theme light/pastel */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Sửa đổi: bỏ border mặc định */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Sửa đổi */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    /* Nâng khối đang mở menu lên trên các khối khác */
    .topic-item.menu-active { position: relative; z-index: 20; }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: CẬP NHẬT GIAO DIỆN QUẢN LÝ CHỦ ĐỀ === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Sửa đổi */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Giữ nền trong suốt khi di chuột qua */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Sửa đổi màu */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Sửa đổi màu */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */
    #view-timer .panel-bg hr {
        border: none; /* Bỏ đường viền mặc định */
        height: 1px;  /* Đặt chiều cao cho đường kẻ */
        background-color: var(--muted); /* Sử dụng màu phụ của theme */
        opacity: 0.3; /* Làm cho nó mờ đi, hòa vào nền */
        margin-top: 0; /* Điều chỉnh lại khoảng cách */
    }
    /* === END: TÙY CHỈNH DẢI PHÂN CÁCH MỀM MẠI HƠN === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Sửa đổi */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Sửa đổi */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Sửa đổi */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Nâng z-index để nằm trên header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Sửa đổi */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Sửa đổi */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Sửa đổi */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Sửa đổi */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Sửa đổi */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Sửa đổi: chuyển sang nền trắng trong suốt */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Viền trắng mờ */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Tinh chỉnh: sát mẫu hơn */
        border-color: var(--acc);
    }
    /* === START: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Dùng nền đen mờ thay vì trắng mờ */
        border-color: rgba(0, 0, 0, 0.1); /* Viền đen mờ trên theme sáng */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Tăng độ đậm khi focus */
    }
    /* === END: SỬA LỖI NỀN INPUT/SELECT TRÊN THEME SÁNG === */

    /* Cải thiện nền và màu chữ cho option trong select theo theme hiện tại */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Sửa đổi */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Giảm/loại bỏ bóng chữ cho theme sáng để tránh nhòe/lóa */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
.method-item[open] summary {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
    [data-theme='light'] .method-item[open] summary,
    [data-theme='pastel'] .method-item[open] summary {
        border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* Method actions inline with summary and show on hover */
    .method-item summary { display: flex; align-items: center; justify-content: space-between; }
    .method-item summary > span { flex: 1; }
    .method-item summary .topic-actions { margin-left: 8px; }
    .method-title { cursor: pointer; }
    .method-item:hover .topic-actions, .method-item:focus-within .topic-actions { opacity: 1; visibility: visible; }

    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Đồng hồ">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Đồng hồ</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Chủ đề">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Chủ đề</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Thống kê">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Thống kê</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Kho Tri Thức">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Kho Tri Thức</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Cài đặt">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Cài đặt</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Hướng dẫn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Hướng dẫn</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">Chưa chọn Chủ đề con</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard Tổng quan">📊 Tổng Quan </button>
          <a href="https://forms.gle/EfFqBJFTbFtDo5H4A" target="_blank" rel="noopener noreferrer" class="btn ghost small" title="Gửi phản hồi của bạn">💬 Phản Hồi</a>
          <button class="btn ghost small" id="btnExport" title="Xuất JSON">⬇️ Xuất File</button>
          <label class="btn ghost small" for="importFile" title="Nhập JSON">⬆️ Nhập File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Ẩn/Hiện giao diện">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Toàn màn hình">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Chào mừng đến với Pomodoro Study App!</h3>
                <p>Hãy bắt đầu bằng cách chọn một <strong>Chủ đề con</strong> hoặc tạo Chủ đề/Chủ đề con mới.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Tạo Chủ đề Mới</button>
            </div>
            <div class="presets" role="group" aria-label="Chọn chế độ preset">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">TRẠNG THÁI</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Checklist Hạ nhiệt</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Lưu công việc đang làm (Save/Commit).</li>
                <li>Ghi chú nhanh "Next step".</li>
                <li>Dọn dẹp không gian làm việc.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Bắt đầu (Space)">▶️ Bắt đầu</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="Kết thúc phiên làm việc">🧘 Bắt đầu nghỉ</button>
              <button class="btn" id="btnPause" aria-label="Tạm dừng (Space)">⏸️ Tạm dừng</button>
              <button class="btn" id="btnResume" aria-label="Tiếp tục (Space)">⏵ Tiếp tục</button>
              <button class="btn warn" id="btnSkip" aria-label="Bỏ qua (N)">⏭️ Bỏ qua</button>
              <button class="btn danger" id="btnReset">↺ Đặt lại</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Nghỉ sớm</button>
            </div>
            <div class="tiny">Phím tắt: <strong>Space</strong> = Bắt đầu/Tạm dừng/Tiếp tục, <strong>N</strong> = Tiếp theo/Bỏ qua</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Nhiệm vụ</button>
                <button class="tab-btn" data-tab="notes">Ghi chú</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-do cho chủ đề con này:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Thêm một task mới..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Thêm</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Thêm ghi chú mới..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Thêm ghi chú</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini cho: <span id="currentSubtopicNameChat">(chưa chọn)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Xóa lịch sử">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Giải thích khái niệm chính của chủ đề này">Giải thích khái niệm</button>
                  <button class="btn small ghost" data-prompt="Tạo một dàn ý chi tiết cho chủ đề này">Tạo dàn ý</button>
                  <button class="btn small ghost" data-prompt="Liệt kê 5 câu hỏi ôn tập quan trọng về chủ đề này">Tạo câu hỏi ôn tập</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Hỏi Gemini điều gì đó..." />
                  <button id="btnSendMessage" class="btn acc">Gửi</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Quản lý Chủ đề</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Thêm Chủ đề</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Nhấp mũi tên để mở/đóng danh sách chủ đề con.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Thống kê & Lịch sử — <span id="currentSubtopicName">(chưa chọn)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Tổng thời gian</h4><div class="stat-value" id="statTotal">0 phút</div></div>
              <div class="stat-card"><h4>Phiên</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Nhiệm vụ Hoàn thành</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">Lịch sử (LÀM VIỆC)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Kho Tri Thức Cá Nhân Hóa</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Thêm tri thức</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Nhấp vào từng mục để xem chi tiết.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Khám Phá Pomodoro Study App</h3>
              <p>
                  Chào mừng bạn đến với không gian học tập được thiết kế dành riêng cho sự tập trung và hiệu quả. Hãy cùng khám phá những tính năng sẽ đồng hành cùng bạn trên hành trình chinh phục tri thức.
              </p>

              <h4>🚀 Khởi Đầu Nhanh Chỉ Trong 4 Bước</h4>
              <p>Để hành trình của bạn luôn mạch lạc, mọi thứ trong ứng dụng được sắp xếp theo cấu trúc <strong>Chủ đề Lớn → Chủ đề con</strong>.</p>
              <ol>
                  <li>Mở mục <strong>📚 Chủ đề</strong> từ thanh điều hướng bên cạnh.</li>
                  <li>Nhấn <strong>＋ Thêm Chủ đề</strong> để tạo một lĩnh vực lớn (ví dụ: "Tiếng Anh Giao Tiếp").</li>
                  <li>Bên cạnh chủ đề vừa tạo, nhấn <strong>＋ Thêm</strong> để tạo một chủ đề con, chi tiết hơn (ví dụ: "Bài 1: Luyện phát âm IPA").</li>
                  <li>Chọn chủ đề con đó. Giờ đây, bạn đã sẵn sàng để bắt đầu phiên học đầu tiên của mình!</li>
              </ol>

              <hr />
              <h4>✨ Những Tính Năng Đáng Chú Ý</h4>

              <h4>Các Chế Độ Đồng Hồ Linh Hoạt ⏱️</h4>
              <p>Ứng dụng không chỉ có Pomodoro. Hãy chọn phương pháp phù hợp với công việc của bạn:</p>
              <ul>
                  <li><strong>Pomodoro Cổ Điển (Kiểu A/B):</strong> Làm việc tập trung trong các phiên định sẵn (ví dụ: 25 phút làm, 5 phút nghỉ) để xây dựng kỷ luật và nhịp độ.</li>
                  <li><strong>Chế độ Flowtime (Kiểu 🌊 Flow):</strong> Dành cho công việc cần dòng chảy sâu. Đồng hồ sẽ đếm lên, cho phép bạn làm việc đến khi tự cảm thấy cần nghỉ. Thời gian nghỉ sẽ được đề xuất dựa trên thời gian bạn đã làm việc.</li>
                  <li><strong>Đệm "Hạ nhiệt" (Wind-down):</strong> Một khoảng đệm tùy chỉnh giữa lúc làm và lúc nghỉ, giúp bạn kết thúc công việc đang dở, ghi chú lại "bước tiếp theo" và chuyển trạng thái một cách mượt mà, không bị cắt ngang đột ngột.</li>
              </ul>

              <h4>Kho Tri Thức Cá Nhân Hóa 💡</h4>
              <p>Bạn có thể <strong>Thêm, Sửa, Xóa</strong> các phương pháp và ghi chú quan trọng. Với trình soạn thảo mạnh mẽ, bạn dễ dàng định dạng tiêu đề, in đậm, tạo danh sách và thậm chí chọn màu chữ để làm nổi bật thông tin.</p>

              <h4>Quản Lý Chủ Đề Trực Quan</h4>
              <p>Dễ dàng sắp xếp các mục tiêu học tập của bạn. Sử dụng thao tác <strong>kéo và thả</strong> để sắp xếp lại thứ tự các Chủ đề hoặc di chuyển một Chủ đề con sang một lĩnh vực khác một cách trực quan.</p>

              <h4>Nhiệm Vụ & Ghi Chú Tích Hợp 📝</h4>
              <p>Ngay trong màn hình đồng hồ, bạn có thể tạo danh sách việc cần làm (to-do) cho từng chủ đề con hoặc ghi lại những ý tưởng chợt nảy ra mà không làm gián đoạn dòng chảy công việc.</p>

              <h4>Chế Độ Zen 🧘</h4>
              <p>Khi cần tập trung tuyệt đối, hãy nhấn vào biểu tượng con mắt (👁️). Giao diện sẽ ẩn đi, chỉ để lại hình nền và chiếc đồng hồ. Trong chế độ này, bạn có thể <strong>kéo thả đồng hồ</strong> đến bất kỳ vị trí nào trên màn hình để có một không gian làm việc gọn gàng nhất.</p>

              <h4>Thống Kê & Cột Mốc 🏆</h4>
              <p>Theo dõi hành trình của bạn qua những con số biết nói. Ứng dụng sẽ tự động ghi nhận và chúc mừng khi bạn đạt được những cột mốc quan trọng về thời gian tập trung, biến mỗi nỗ lực thành một thành tựu đáng tự hào.</p>

              <hr />
              <h4>⌨️ Phím Tắt Thông Minh</h4>
              <ul>
                  <li><kbd>Space</kbd>: Bắt đầu / Tạm dừng / Tiếp tục phiên học.</li>
                  <li><kbd>N</kbd>: Bỏ qua phiên làm việc hoặc nghỉ hiện tại.</li>
                  <li><kbd>Esc</kbd>: Đóng các cửa sổ đang mở (như Cài đặt).</li>
              </ul>

              <hr />
              <h4>🛠️ Cài Đặt Nâng Cao & Tích Hợp</h4>

              <h4>Trợ Lý Gemini AI 🧠</h4>
              <p>Biến ứng dụng thành một người bạn đồng hành thông minh. Ngoài việc hỏi đáp, bạn còn có thể:</p>
              <ul>
                  <li><strong>Tự động Định dạng Thông minh:</strong> Khi soạn thảo trong mục "Phương pháp", hãy để AI tự động phân tích và định dạng văn bản thô của bạn—tự nhận diện tiêu đề, các ý chính cần in đậm và danh sách.</li>
                  <li><strong>Thiết lập:</strong> Truy cập Google AI Studio để tạo API Key miễn phí và dán vào ô "Gemini API Key" trong Cài đặt của ứng dụng.</li>
              </ul>

              <h4>Tùy Biến Giao Diện & Âm Thanh 🎨</h4>
              <p>Biến không gian học tập thành của riêng bạn:</p>
              <ul>
                  <li><strong>Nhiều Theme & Hình nền:</strong> Lựa chọn giữa các theme có sẵn (Sáng, Tối, Pastel...) hoặc <strong>tải lên hình nền của riêng bạn</strong> để tạo cảm hứng.</li>
                  <li><strong>Âm báo Tùy chỉnh:</strong> Bạn có thể <strong>tải lên các file âm thanh (.mp3, .wav...) của riêng mình</strong> để sử dụng làm chuông báo cho các phiên làm việc và nghỉ ngơi.</li>
              </ul>

              <h4>Nhạc Nền YouTube 🎶</h4>
              <p>Tạo không gian học tập hoàn hảo bằng cách phát một video hoặc danh sách phát YouTube làm nhạc nền. Dán đường dẫn (URL) vào ô "Nhạc nền YouTube" trong Cài đặt.</p>

              <h4>An Toàn Dữ Liệu: Sao Lưu & Phục Hồi 🛡️</h4>
              <p>Ứng dụng tự động sao lưu tiến trình của bạn mỗi ngày. Bạn có thể tùy chỉnh số ngày lưu giữ bản sao lưu và phục hồi dữ liệu từ một ngày trong quá khứ nếu cần. ⚠️ <strong>Cảnh báo:</strong> Phục hồi sẽ ghi đè toàn bộ dữ liệu hiện tại.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Chúc mừng Bạn!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Tiếp tục hành trình!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Cài đặt</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Đồng hồ</button>
              <button class="tab-btn" data-tab="settings-ui">Giao diện & Âm thanh</button>
              <button class="tab-btn" data-tab="settings-integrations">Tích hợp</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Kiểu A </button>
                      <button class="btn ghost" data-preset-target="B"> Kiểu B </button>
                      <button class="btn ghost" data-preset-target="C"> Kiểu C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Thời lượng Pomodoro</h4>
                      <div class="row">
                          <label>LÀM VIỆC (phút)<input type="number" id="set_work" min="1" /></label>
                          <label>HẠ NHIỆT (phút)<input type="number" id="set_winddown" min="0" /></label>
                          <label>NGHỈ NGẮN (phút)<input type="number" id="set_short" min="1" /></label>
                          <label>NGHỈ DÀI (phút)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Chu kỳ Pomodoro<input type="number" id="set_cycles" min="1" /></label>
                          <label>Chu kỳ nghỉ dài<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Tỷ lệ nghỉ (Làm việc / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Gợi ý: Thời gian nghỉ = tổng thời gian làm việc / X. Mặc định là 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Tự động bắt đầu phiên tiếp theo</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Bật Hạ nhiệt sau phiên làm</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableSessionNotes">Nhắc ghi chú sau mỗi phiên</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableSessionNotes">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Giao diện</h4>
                      <div class="row">
                          <label>Theme Giao Diện
                                <select id="set_theme_color">
                                    <option value="default">Mặc định (Dark Blue)</option>
                                    <option value="light">Light - Trà Sữa</option>
                                    <option value="pastel">Pastel - Dễ thương</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Chế độ hiển thị nền
                              <select id="set_backgroundMode">
                                  <option value="cover">Lấp đầy (Mặc định)</option>
                                  <option value="contain">Vừa vặn (Sắc nét)</option>
                                  <option value="auto">Kích thước gốc (Lặp lại)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Hình nền
                              <label class="btn small ghost" for="uploadBg">Tải ảnh mới</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Xóa nền</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Độ trong suốt của nền</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Âm thanh</h4>
                      <div class="row">
                          <label>Âm lượng (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Kiểu âm báo
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Tùy chỉnh âm báo</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Âm báo hết LÀM VIỆC</small>
                              <label title="Âm báo hết LÀM VIỆC" class="btn small ghost" for="uploadSoundWork">LÀM VIỆC</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ NGẮN</small>
                              <label title="Âm báo hết NGHỈ NGẮN" class="btn small ghost" for="uploadSoundBreak">NGHỈ NGẮN</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Âm báo hết NGHỈ DÀI</small>
                              <label title="Âm báo hết NGHỈ DÀI" class="btn small ghost" for="uploadSoundLong">NGHỈ DÀI</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Tích hợp AI</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Dán API Key của bạn vào đây..." />
                      </label>
                      <div class="tiny">Cần có để sử dụng các tính năng AI. Lấy key miễn phí tại <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 Nhạc nền YouTube</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Dán link YouTube vào đây..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Dùng ảnh bìa video làm nền</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Dừng sẽ không tự phát lại cho đến khi bạn bấm ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Âm lượng</div>
                  </div>
                  <div>
                      <h4>🛡️ Cài đặt sao lưu</h4>
                      <div class="row">
                          <label>Số ngày sao lưu cần giữ lại
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Phục hồi dữ liệu</h4>
                      <p class="tiny">Phục hồi dữ liệu từ một bản sao lưu tự động hàng ngày. Hành động này sẽ ghi đè lên dữ liệu hiện tại của bạn.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Phục hồi</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Mặc định</button>
              <button class="btn acc" id="btnSaveSettings">Lưu</button>
              <button class="btn" id="btnCloseSettings">Đóng</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Ghi chú cho phiên vừa hoàn thành</h3>
      <div class="row"><textarea id="noteText" placeholder="Bạn học được gì? Khó khăn? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Tóm tắt & Gợi ý</button>
        <button class="btn" id="btnSkipNote">Bỏ qua</button>
        <button class="btn acc" id="btnSaveNote">Lưu ghi chú</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Tiêu đề</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Hủy</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Tổng quan</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Đóng</button>
        </div>
        <p class="tiny">Tổng hợp thời gian và số phiên đã hoàn thành trên tất cả các chủ đề.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Chỉnh-sửa Phương-pháp</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Tiêu-đề<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Nội-dung</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Tiêu-đề nhỏ">H</button>
          <button id="toolBold" class="btn small ghost" title="In đậm">B</button>
          <button id="toolItalic" class="btn small ghost" title="In nghiêng">I</button>
          <button id="toolList" class="btn small ghost" title="Danh-sách">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Danh sách chấm tròn">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Màu chữ">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Màu chữ mặc định"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Màu nhấn mạnh"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Màu tích cực"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Màu cảnh báo"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Màu nguy hiểm"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Màu tím"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="Tính năng này yêu cầu Gemini API Key">✨ Tự động định dạng</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Hủy</button>
          <button class="btn acc" id="btnSaveMethod">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Nhấn "Bật âm thanh" để cho phép phát nhạc nền.</span>
    <button id="btnEnableSound" class="btn small acc">Bật âm thanh</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
    const _0x1318bc=_0x2a57;(function(_0x5ca828,_0x37eb00){const _0x46b4f2=_0x2a57,_0x171b07=_0x5ca828();while(!![]){try{const _0x2ed4ba=-parseInt(_0x46b4f2(0x25e))/0x1*(-parseInt(_0x46b4f2(0x1a5))/0x2)+-parseInt(_0x46b4f2(0x433))/0x3+-parseInt(_0x46b4f2(0x31f))/0x4+-parseInt(_0x46b4f2(0x41b))/0x5*(parseInt(_0x46b4f2(0x25c))/0x6)+-parseInt(_0x46b4f2(0x1d5))/0x7*(parseInt(_0x46b4f2(0x255))/0x8)+parseInt(_0x46b4f2(0x1b1))/0x9+parseInt(_0x46b4f2(0x305))/0xa;if(_0x2ed4ba===_0x37eb00)break;else _0x171b07['push'](_0x171b07['shift']());}catch(_0x57ed20){_0x171b07['push'](_0x171b07['shift']());}}}(_0x293e,0x60f2d),window[_0x1318bc(0x2b2)](_0x1318bc(0x499),()=>{try{updateFullscreenButton();}catch(_0x31be40){}}));const IS_FILE_PROTOCOL=window['location'][_0x1318bc(0x28e)]===_0x1318bc(0x3ec);function startYtApiWatchdog(){const _0x5e9c1e=_0x1318bc,_0xa64c52=document['getElementById'](_0x5e9c1e(0x296));if(!_0xa64c52)return;const _0x5f279b=setTimeout(()=>{const _0xfa6e99=_0x5e9c1e;try{(!window['YT']||!window['YT'][_0xfa6e99(0x3a3)])&&(_0xa64c52[_0xfa6e99(0x1ee)]=_0xfa6e99(0x359),_0xa64c52['style'][_0xfa6e99(0x2fe)]='var(--sub)');}catch(_0x4b175c){}},0x5dc),_0x392571=setTimeout(()=>{const _0xfb15c0=_0x5e9c1e;try{(!window['YT']||!window['YT'][_0xfb15c0(0x3a3)])&&(_0xa64c52['textContent']='Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.',_0xa64c52['style']['color']=_0xfb15c0(0x22e));}catch(_0x5a6feb){}},0x1b58);window[_0x5e9c1e(0x21c)]={'cancel'(){clearTimeout(_0x5f279b),clearTimeout(_0x392571);}};}(function(){const _0x1b0519=_0x1318bc,_0x44f67b={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>_0x1b0519(0x30e)+current+'/'+target,'timer.selectSubtopicPrompt':_0x1b0519(0x33d)};window['t']=function _0x231d5d(_0x33ca41,_0x5d2629){const _0xb0352c=_0x1b0519;try{const _0x5c1b78=_0x44f67b[_0x33ca41];if(typeof _0x5c1b78===_0xb0352c(0x3a9))return _0x5c1b78(_0x5d2629||{});if(typeof _0x5c1b78===_0xb0352c(0x31b))return _0x5c1b78;}catch(_0x16803f){}return _0x33ca41;},window[_0x1b0519(0x44d)]=function _0x9361f9(_0x3a306a){const _0x19c446=_0x1b0519;try{localStorage[_0x19c446(0x2be)](_0x19c446(0x2e1),_0x3a306a||'vi');}catch(_0xccab8){}return Promise[_0x19c446(0x40e)]();};}());function ensureYouTubeAPI(){const _0x50c75d=_0x1318bc;if(IS_FILE_PROTOCOL)return Promise[_0x50c75d(0x40e)](![]);try{if(window['YT']&&window['YT'][_0x50c75d(0x3a3)])return Promise[_0x50c75d(0x40e)](!![]);}catch(_0x1d1a3b){}if(window['__ytApiPromise'])return window[_0x50c75d(0x270)];return startYtApiWatchdog(),window[_0x50c75d(0x270)]=new Promise((_0x9dd775,_0x38020c)=>{const _0x365f44=_0x50c75d;try{const _0x111c88=document['createElement'](_0x365f44(0x450));_0x111c88[_0x365f44(0x2d4)]='https://www.youtube.com/iframe_api',_0x111c88[_0x365f44(0x423)]=!![],_0x111c88[_0x365f44(0x431)]=!![],_0x111c88[_0x365f44(0x432)]=()=>_0x9dd775(!![]),_0x111c88[_0x365f44(0x384)]=()=>_0x38020c(new Error(_0x365f44(0x221))),document[_0x365f44(0x1e0)][_0x365f44(0x27e)](_0x111c88);}catch(_0x433c30){_0x38020c(_0x433c30);}}),window[_0x50c75d(0x270)];}const storageManager={'DB_NAME':'PomodoroAppDB','DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x37e0aa,_0x557e36)=>{const _0x30f212=_0x2a57;if(this['db'])return _0x37e0aa(this['db']);const _0x130e84=indexedDB[_0x30f212(0x353)](this[_0x30f212(0x29f)],this['DB_VERSION']);_0x130e84[_0x30f212(0x24a)]=_0x181002=>{const _0x4f82dd=_0x30f212,_0x548f82=_0x181002[_0x4f82dd(0x31c)][_0x4f82dd(0x3d1)];!_0x548f82['objectStoreNames'][_0x4f82dd(0x326)](_0x4f82dd(0x218))&&_0x548f82['createObjectStore']('settings');!_0x548f82[_0x4f82dd(0x389)]['contains'](_0x4f82dd(0x295))&&_0x548f82[_0x4f82dd(0x3ce)](_0x4f82dd(0x295),{'keyPath':'id'});if(!_0x548f82[_0x4f82dd(0x389)][_0x4f82dd(0x326)](_0x4f82dd(0x2ea))){const _0x80f3bb=_0x548f82[_0x4f82dd(0x3ce)](_0x4f82dd(0x2ea),{'keyPath':'id'});_0x80f3bb[_0x4f82dd(0x42b)](_0x4f82dd(0x247),'topicId');}!_0x548f82['objectStoreNames']['contains'](_0x4f82dd(0x39f))&&_0x548f82[_0x4f82dd(0x3ce)]('backups',{'keyPath':_0x4f82dd(0x480)});},_0x130e84['onsuccess']=_0x21f333=>{const _0x23eee1=_0x30f212;this['db']=_0x21f333[_0x23eee1(0x31c)][_0x23eee1(0x3d1)],console[_0x23eee1(0x45c)](_0x23eee1(0x44c)),_0x37e0aa(this['db']);},_0x130e84[_0x30f212(0x384)]=_0x210502=>{const _0x27c2db=_0x30f212;console[_0x27c2db(0x40f)](_0x27c2db(0x413),_0x210502['target'][_0x27c2db(0x1c8)]),_0x557e36(_0x210502[_0x27c2db(0x31c)][_0x27c2db(0x40f)]);};});},async '_getStore'(_0x27a446,_0x3a60e3=_0x1318bc(0x345)){const _0x20b37e=_0x1318bc;await this[_0x20b37e(0x2bb)]();const _0x484cba=this['db']['transaction']([_0x27a446],_0x3a60e3);return _0x484cba[_0x20b37e(0x25b)](_0x27a446);},async 'getSettings'(){const _0x421cd4=_0x1318bc,_0x73ff07=await this[_0x421cd4(0x271)](_0x421cd4(0x218));return new Promise((_0x517cf4,_0x1c06d0)=>{const _0x38e3f2=_0x421cd4,_0x400d99=_0x73ff07['get'](_0x38e3f2(0x3e1));_0x400d99[_0x38e3f2(0x440)]=()=>_0x517cf4(_0x400d99['result']),_0x400d99[_0x38e3f2(0x384)]=()=>_0x1c06d0(_0x400d99[_0x38e3f2(0x40f)]);});},async 'updateSettings'(_0x4dc817){const _0x1c5f7c=_0x1318bc,_0x491c57=await this[_0x1c5f7c(0x271)](_0x1c5f7c(0x218),'readwrite');return new Promise((_0x1b791b,_0x17c4ff)=>{const _0x432b54=_0x1c5f7c,_0x538790=_0x491c57['put'](_0x4dc817,'main_settings');_0x538790['onsuccess']=()=>_0x1b791b(_0x538790['result']),_0x538790[_0x432b54(0x384)]=()=>_0x17c4ff(_0x538790[_0x432b54(0x40f)]);});},async 'getAll'(_0x5a196a){const _0x50e7d3=_0x1318bc,_0x3b24cf=await this[_0x50e7d3(0x271)](_0x5a196a);return new Promise((_0x3c1653,_0x379dcc)=>{const _0x568053=_0x50e7d3,_0x9d425f=_0x3b24cf[_0x568053(0x24f)]();_0x9d425f[_0x568053(0x440)]=()=>_0x3c1653(_0x9d425f[_0x568053(0x3d1)]),_0x9d425f[_0x568053(0x384)]=()=>_0x379dcc(_0x9d425f['error']);});},async 'update'(_0x3432cf,_0x11541b){const _0x169ebc=_0x1318bc,_0x2c6726=await this[_0x169ebc(0x271)](_0x3432cf,_0x169ebc(0x474));return new Promise((_0x1dbc06,_0x389067)=>{const _0x1014cc=_0x169ebc,_0xc8f5df=_0x2c6726[_0x1014cc(0x2a5)](_0x11541b);_0xc8f5df[_0x1014cc(0x440)]=()=>_0x1dbc06(_0xc8f5df[_0x1014cc(0x3d1)]),_0xc8f5df[_0x1014cc(0x384)]=()=>_0x389067(_0xc8f5df[_0x1014cc(0x40f)]);});},async 'add'(_0x16e5fe,_0x5b5a8a){const _0x42046c=_0x1318bc,_0x2c46c9=await this[_0x42046c(0x271)](_0x16e5fe,'readwrite');return new Promise((_0x593d98,_0x1831be)=>{const _0x29d030=_0x42046c,_0x24cd65=_0x2c46c9[_0x29d030(0x28c)](_0x5b5a8a);_0x24cd65[_0x29d030(0x440)]=()=>_0x593d98(_0x24cd65[_0x29d030(0x3d1)]),_0x24cd65[_0x29d030(0x384)]=()=>_0x1831be(_0x24cd65['error']);});},async 'delete'(_0x15595f,_0x1ae560){const _0xe9f4db=_0x1318bc,_0x428bcb=await this[_0xe9f4db(0x271)](_0x15595f,_0xe9f4db(0x474));return new Promise((_0x5bb9ff,_0x348f)=>{const _0x365ce3=_0xe9f4db,_0x2aaea8=_0x428bcb[_0x365ce3(0x25a)](_0x1ae560);_0x2aaea8[_0x365ce3(0x440)]=()=>_0x5bb9ff(_0x2aaea8[_0x365ce3(0x3d1)]),_0x2aaea8[_0x365ce3(0x384)]=()=>_0x348f(_0x2aaea8['error']);});},async 'save'(_0x1b761b){return await this['initDB'](),new Promise((_0x6db48f,_0x156bce)=>{const _0x524e33=_0x2a57,_0x1fdb61=this['db'][_0x524e33(0x22b)]([_0x524e33(0x218),'topics','subtopics'],_0x524e33(0x474)),_0xa83ada=_0x1fdb61[_0x524e33(0x25b)](_0x524e33(0x218)),_0x378441=_0x1fdb61[_0x524e33(0x25b)](_0x524e33(0x295)),_0x3679b=_0x1fdb61[_0x524e33(0x25b)](_0x524e33(0x2ea));_0xa83ada[_0x524e33(0x2a5)](_0x1b761b[_0x524e33(0x218)],_0x524e33(0x3e1)),_0x378441[_0x524e33(0x2b4)](),_0x3679b[_0x524e33(0x2b4)](),_0x1b761b['topics']['forEach'](_0x3eb7bd=>{const _0x447ee6=_0x524e33,{subtopics:_0x2c3b1c,..._0x58b666}=_0x3eb7bd;_0x378441['put'](_0x58b666),(_0x2c3b1c||[])[_0x447ee6(0x395)](_0x298635=>_0x3679b[_0x447ee6(0x2a5)](_0x298635));}),_0x1fdb61[_0x524e33(0x2f5)]=()=>_0x6db48f(),_0x1fdb61['onerror']=_0x4e6aa5=>_0x156bce(_0x4e6aa5[_0x524e33(0x31c)][_0x524e33(0x40f)]);});},async 'autoBackup'(_0x56dbaf){const _0x596356=_0x1318bc;await this[_0x596356(0x2bb)]();const _0x59ee6c=new Date()[_0x596356(0x3e5)]()[_0x596356(0x449)](0x0,0xa),_0x1633fa=localStorage[_0x596356(0x26e)](_0x596356(0x3a0));if(_0x59ee6c!==_0x1633fa){console[_0x596356(0x45c)](_0x596356(0x2d8)+_0x59ee6c+'...');const _0x45a10e={'date':_0x59ee6c,'data':JSON[_0x596356(0x323)](JSON[_0x596356(0x484)](_0x56dbaf))},_0x1b9045=this['db']['transaction']([_0x596356(0x39f)],_0x596356(0x474)),_0x13c633=_0x1b9045['objectStore']('backups'),_0x2817be=_0x13c633[_0x596356(0x2a5)](_0x45a10e);_0x2817be[_0x596356(0x440)]=()=>{const _0x5d9852=_0x596356;localStorage[_0x5d9852(0x2be)](_0x5d9852(0x3a0),_0x59ee6c),console[_0x5d9852(0x45c)]('Daily\x20backup\x20successful.'),this[_0x5d9852(0x397)](_0x56dbaf?.['settings']?.[_0x5d9852(0x329)]||0x7);},_0x2817be['onerror']=_0x2f3868=>{const _0x1c8166=_0x596356;console[_0x1c8166(0x40f)](_0x1c8166(0x2ab),_0x2f3868[_0x1c8166(0x31c)][_0x1c8166(0x40f)]);};}},async 'cleanupOldBackups'(_0x410870){const _0x47d400=_0x1318bc;await this[_0x47d400(0x2bb)]();const _0x56f2e9=this['db'][_0x47d400(0x22b)](['backups'],'readwrite'),_0x58b509=_0x56f2e9[_0x47d400(0x25b)](_0x47d400(0x39f)),_0x34f238=_0x58b509['getAllKeys']();_0x34f238[_0x47d400(0x440)]=()=>{const _0x4b4e32=_0x47d400,_0x5463f5=_0x34f238['result']['sort']()[_0x4b4e32(0x36d)]();if(_0x5463f5[_0x4b4e32(0x469)]>_0x410870){const _0x1aa872=_0x5463f5['slice'](_0x410870);_0x1aa872[_0x4b4e32(0x395)](_0x4d95e1=>{const _0x40db52=_0x4b4e32;_0x58b509[_0x40db52(0x25a)](_0x4d95e1),console['log'](_0x40db52(0x46f)+_0x4d95e1);});}};},async 'getBackupList'(){return await this['initDB'](),new Promise((_0xc20909,_0x349cf0)=>{const _0x239099=_0x2a57,_0x1ad532=this['db'][_0x239099(0x22b)]([_0x239099(0x39f)],'readonly'),_0x18c7f5=_0x1ad532[_0x239099(0x25b)](_0x239099(0x39f)),_0x16839c=_0x18c7f5[_0x239099(0x24f)]();_0x16839c[_0x239099(0x440)]=()=>_0xc20909(_0x16839c[_0x239099(0x3d1)][_0x239099(0x3ba)]((_0x5d4ea7,_0x5a0bad)=>_0x5a0bad['date'][_0x239099(0x453)](_0x5d4ea7[_0x239099(0x480)]))),_0x16839c[_0x239099(0x384)]=_0x2a2994=>_0x349cf0(_0x2a2994[_0x239099(0x31c)][_0x239099(0x40f)]);});},async 'restoreBackup'(_0x4b8836){const _0xf235c=_0x1318bc;return await this[_0xf235c(0x2bb)](),new Promise((_0x510474,_0x366479)=>{const _0x291f5b=_0xf235c,_0x219df2=this['db']['transaction']([_0x291f5b(0x39f)],_0x291f5b(0x345)),_0x30edc1=_0x219df2[_0x291f5b(0x25b)](_0x291f5b(0x39f)),_0x182a12=_0x30edc1['get'](_0x4b8836);_0x182a12[_0x291f5b(0x440)]=()=>{const _0x58bc0c=_0x291f5b;_0x182a12['result']&&_0x182a12[_0x58bc0c(0x3d1)][_0x58bc0c(0x3b1)]?(localStorage[_0x58bc0c(0x2be)](_0x58bc0c(0x1ec),JSON['stringify'](_0x182a12['result'][_0x58bc0c(0x3b1)])),_0x510474(_0x182a12['result'][_0x58bc0c(0x3b1)])):_0x366479(new Error('Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.'));},_0x182a12[_0x291f5b(0x384)]=_0x479f35=>_0x366479(_0x479f35[_0x291f5b(0x31c)][_0x291f5b(0x40f)]);});},'exportData'(_0x37dfec){const _0xf17235=_0x1318bc;let _0x1b86c2={};try{_0x1b86c2=JSON['parse'](JSON[_0xf17235(0x484)](_0x37dfec||{}));}catch(_0x55185a){_0x1b86c2=_0x37dfec;}try{if(_0x1b86c2&&_0x1b86c2['settings'])_0x1b86c2[_0xf17235(0x218)][_0xf17235(0x1ed)]='';}catch(_0xafecfc){}const _0x580d1c=new Blob([JSON[_0xf17235(0x484)](_0x1b86c2,null,0x2)],{'type':_0xf17235(0x287)}),_0xb0340c=document[_0xf17235(0x334)]('a'),_0x43d419=new Date(),_0x56f965=_0x4f5504=>(''+_0x4f5504)['padStart'](0x2,'0');_0xb0340c[_0xf17235(0x1b6)]=URL[_0xf17235(0x445)](_0x580d1c),_0xb0340c[_0xf17235(0x2f7)]=_0xf17235(0x1ff)+_0x43d419[_0xf17235(0x37c)]()+_0x56f965(_0x43d419['getMonth']()+0x1)+_0x56f965(_0x43d419[_0xf17235(0x45a)]())+_0xf17235(0x41d),_0xb0340c[_0xf17235(0x21b)](),URL[_0xf17235(0x291)](_0xb0340c[_0xf17235(0x1b6)]);},async 'importData'(_0x13de45){const _0x53df4c=_0x1318bc,_0x50860f=await _0x13de45[_0x53df4c(0x1bb)](),_0x28a8ff=JSON[_0x53df4c(0x323)](_0x50860f);if(!_0x28a8ff[_0x53df4c(0x274)]||!_0x28a8ff[_0x53df4c(0x218)]||!Array[_0x53df4c(0x366)](_0x28a8ff[_0x53df4c(0x295)]))throw new Error(_0x53df4c(0x217));try{const _0x33b26c=window[_0x53df4c(0x3b1)]&&window[_0x53df4c(0x3b1)]['settings']&&window[_0x53df4c(0x3b1)][_0x53df4c(0x218)][_0x53df4c(0x1ed)]||'';(!('apiKey'in _0x28a8ff[_0x53df4c(0x218)])||_0x28a8ff[_0x53df4c(0x218)][_0x53df4c(0x1ed)]==='')&&(_0x28a8ff[_0x53df4c(0x218)][_0x53df4c(0x1ed)]=_0x33b26c);}catch(_0xc68739){}return localStorage[_0x53df4c(0x2be)]('pomodoroData_v11',JSON[_0x53df4c(0x484)](_0x28a8ff)),_0x28a8ff;}},$=(_0x44524e,_0x3a387c=document)=>_0x3a387c['querySelector'](_0x44524e),breakSuggestions=['Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.',_0x1318bc(0x2de),_0x1318bc(0x350),_0x1318bc(0x292),_0x1318bc(0x383),_0x1318bc(0x277),_0x1318bc(0x285),_0x1318bc(0x1e1),'Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.',_0x1318bc(0x257),_0x1318bc(0x47a),_0x1318bc(0x2f9),_0x1318bc(0x341),_0x1318bc(0x1cc),_0x1318bc(0x328),_0x1318bc(0x3aa),_0x1318bc(0x3d6),_0x1318bc(0x372),_0x1318bc(0x2c9),'Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.',_0x1318bc(0x1d2),'Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!',_0x1318bc(0x1eb),_0x1318bc(0x294),_0x1318bc(0x34b),_0x1318bc(0x26c),'Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.',_0x1318bc(0x2fd),_0x1318bc(0x2c0),'Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!'],$$=(_0x2d8d34,_0x21c81f=document)=>Array[_0x1318bc(0x30f)](_0x21c81f[_0x1318bc(0x32c)](_0x2d8d34));function on(_0x28fd7e,_0x57e184,_0x2331cc){const _0x444366=_0x1318bc;if(!_0x28fd7e){console[_0x444366(0x1ef)](_0x444366(0x49f),_0x57e184);return;}_0x28fd7e[_0x444366(0x2b2)](_0x57e184,_0x2331cc);}const formatMMSS=_0x1bf4ca=>{const _0x18a601=_0x1318bc,_0x54861f=Math[_0x18a601(0x208)](_0x1bf4ca/0x3c)[_0x18a601(0x22a)]()[_0x18a601(0x2b6)](0x2,'0'),_0x301e6c=Math[_0x18a601(0x208)](_0x1bf4ca%0x3c)['toString']()[_0x18a601(0x2b6)](0x2,'0');return _0x54861f+':'+_0x301e6c;},uid=(_0x2f9668='id')=>_0x2f9668+'_'+Date[_0x1318bc(0x429)]()+'_'+Math['random']()[_0x1318bc(0x22a)](0x24)[_0x1318bc(0x449)](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0xa3180d){const _0x5e988a=_0x1318bc;try{const _0x58f386=_0xa3180d[_0x5e988a(0x32c)](_0x5e988a(0x207));if(!_0x58f386['length'])return;const _0x365c78=_0x58f386[0x0],_0x1d2e14=_0x58f386[_0x58f386[_0x5e988a(0x469)]-0x1],_0xa5e983=_0x540064=>{const _0x1c71a8=_0x5e988a;if(_0x540064[_0x1c71a8(0x1c9)]==='Tab'){if(_0x540064[_0x1c71a8(0x2e3)]&&document[_0x1c71a8(0x21d)]===_0x365c78)_0x540064[_0x1c71a8(0x494)](),_0x1d2e14[_0x1c71a8(0x425)]();else!_0x540064[_0x1c71a8(0x2e3)]&&document[_0x1c71a8(0x21d)]===_0x1d2e14&&(_0x540064['preventDefault'](),_0x365c78['focus']());}};_0xa3180d[_0x5e988a(0x2b2)](_0x5e988a(0x3af),_0xa5e983),_0x365c78[_0x5e988a(0x425)](),__releaseFocusTrap=()=>{const _0x5c3cc1=_0x5e988a;try{_0xa3180d[_0x5c3cc1(0x415)]('keydown',_0xa5e983);}catch(_0x22d1c9){}};}catch(_0x1ff0bb){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x3bd4fb){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()[_0x1318bc(0x3e5)]();function toast(_0x5433af,_0x143fe6=0xa28){const _0x59882d=_0x1318bc,_0x25d803=$(_0x59882d(0x1ad)),_0x1bd4e9=document[_0x59882d(0x334)](_0x59882d(0x250));_0x1bd4e9[_0x59882d(0x205)]=_0x59882d(0x293),_0x1bd4e9['textContent']=_0x5433af,_0x25d803[_0x59882d(0x27e)](_0x1bd4e9),setTimeout(()=>{const _0xd8966d=_0x59882d;_0x1bd4e9['style'][_0xd8966d(0x360)]='0';},_0x143fe6-0x12c),setTimeout(()=>_0x25d803[_0x59882d(0x224)](_0x1bd4e9),_0x143fe6);}function escapeHTML(_0x4441bc){const _0x140693=_0x1318bc;return _0x4441bc['replace'](/[&<>"']/g,_0x729a01=>({'&':_0x140693(0x4af),'<':_0x140693(0x35b),'>':_0x140693(0x29c),'\x22':_0x140693(0x30c),'\x27':'&#39;'}[_0x729a01]));}function formatDaysHoursMinutes(_0x4349a0){const _0x4bd622=_0x1318bc;if(!_0x4349a0||_0x4349a0<0x1)return _0x4bd622(0x4a2);const _0x128e17=Math[_0x4bd622(0x208)](_0x4349a0/0x3c),_0x3d6d04=_0x4349a0%0x3c,_0x1d9903=_0x3d6d04['toString']()[_0x4bd622(0x2b6)](0x2,'0');return _0x128e17+_0x4bd622(0x417)+_0x1d9903+_0x4bd622(0x3c2);}function formatGeminiResponse(_0x1c4fa6){return _0x1c4fa6['replace'](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0x4c2a13){const _0x3d91b0=_0x1318bc,_0xa9ce4e=(_0x4c2a13||'')['split']('\x0a');let _0xc094be='',_0x255b27=null;const _0x4c64c8=()=>{const _0x1ce4da=_0x2a57;_0x255b27&&(_0xc094be+=_0x255b27==='ol'?_0x1ce4da(0x347):'</ul>',_0x255b27=null);};for(let _0x5d6085 of _0xa9ce4e){let _0x4611d7=(_0x5d6085||'')[_0x3d91b0(0x3f0)]();if(!_0x4611d7){_0x4c64c8();continue;}if(_0x4611d7[_0x3d91b0(0x1f3)](_0x3d91b0(0x41c)))_0x4c64c8(),_0xc094be+=_0x3d91b0(0x43f)+escapeHTML(_0x4611d7[_0x3d91b0(0x2ca)](0x5))+'</h4>';else{if(/^\d+\.\s/[_0x3d91b0(0x2f2)](_0x4611d7)){_0x255b27!=='ol'&&(_0x4c64c8(),_0xc094be+=_0x3d91b0(0x369),_0x255b27='ol');const _0x20c73e=_0x4611d7[_0x3d91b0(0x2ca)](_0x4611d7[_0x3d91b0(0x1bd)]('\x20')+0x1);_0xc094be+='<li>'+escapeHTML(_0x20c73e)+_0x3d91b0(0x4ab);}else _0x4611d7['startsWith']('-\x20')?(_0x255b27!=='ul'&&(_0x4c64c8(),_0xc094be+=_0x3d91b0(0x3b3),_0x255b27='ul'),_0xc094be+=_0x3d91b0(0x220)+escapeHTML(_0x4611d7[_0x3d91b0(0x2ca)](0x2))+_0x3d91b0(0x4ab)):(_0x4c64c8(),_0x4611d7=escapeHTML(_0x4611d7)[_0x3d91b0(0x4b4)](/\*\*(.*?)\*\*/g,_0x3d91b0(0x31a))[_0x3d91b0(0x4b4)](/_(.*?)_/g,_0x3d91b0(0x34c)),_0xc094be+=_0x3d91b0(0x26a)+_0x4611d7+'</p>');}}return _0x4c64c8(),_0xc094be;}function wrapTextInMarkdown(_0x7bb71c,_0x49a2bf,_0x694f10=''){const _0x1f6b07=_0x1318bc;if(!_0x7bb71c)return;const _0x203d1d=_0x7bb71c['selectionStart']||0x0,_0x354033=_0x7bb71c[_0x1f6b07(0x2fc)]||0x0,_0x35b9b5=_0x7bb71c[_0x1f6b07(0x470)][_0x1f6b07(0x2ca)](_0x203d1d,_0x354033),_0x502b91=_0x49a2bf+_0x35b9b5+(_0x694f10||_0x49a2bf);_0x7bb71c[_0x1f6b07(0x36e)](_0x502b91,_0x203d1d,_0x354033,'end'),_0x7bb71c[_0x1f6b07(0x425)]();}function updateEditorPreview(){const _0x330568=_0x1318bc,_0x5cb3d1=$(_0x330568(0x197)),_0x2e411d=$(_0x330568(0x444));if(!_0x5cb3d1||!_0x2e411d)return;const _0x494040=_0x5cb3d1[_0x330568(0x470)]||'';_0x2e411d['innerHTML']=parseSimpleMarkdown(_0x494040);}function normalizeDataStructure(_0x3860fb){const _0x1e052c=_0x1318bc;if(!_0x3860fb||typeof _0x3860fb!==_0x1e052c(0x2cf))return;const _0x4dc68e=_0x3860fb[_0x1e052c(0x218)]||{},_0xa8701b={...defaults[_0x1e052c(0x218)],..._0x4dc68e,'durations':{...defaults[_0x1e052c(0x218)]['durations'],..._0x4dc68e[_0x1e052c(0x25d)]||{}}};if(!Array[_0x1e052c(0x366)](_0xa8701b[_0x1e052c(0x23f)]))_0xa8701b['achievedMilestones']=[];_0x3860fb[_0x1e052c(0x218)]=_0xa8701b,_0x3860fb[_0x1e052c(0x295)]=Array['isArray'](_0x3860fb['topics'])?_0x3860fb[_0x1e052c(0x295)]:[],_0x3860fb['topics'][_0x1e052c(0x395)](_0x4e3a99=>{const _0x18215c=_0x1e052c;_0x4e3a99[_0x18215c(0x2ea)]=Array['isArray'](_0x4e3a99[_0x18215c(0x2ea)])?_0x4e3a99[_0x18215c(0x2ea)]:[],_0x4e3a99['subtopics'][_0x18215c(0x395)](_0x20ae34=>{const _0x544364=_0x18215c;_0x20ae34[_0x544364(0x1f7)]=_0x20ae34[_0x544364(0x1f7)]||[],_0x20ae34[_0x544364(0x281)]=_0x20ae34[_0x544364(0x281)]||[],_0x20ae34['summaries']=_0x20ae34[_0x544364(0x3f8)]||[],_0x20ae34[_0x544364(0x456)]=_0x20ae34['chatHistory']||[],_0x20ae34[_0x544364(0x49b)]=_0x20ae34[_0x544364(0x49b)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x20ae34[_0x544364(0x23e)]=_0x20ae34['sessions']||[],_0x20ae34['timerState']=_0x20ae34['timerState']||{'state':_0x544364(0x1d7),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x49216a){const _0x2b53aa=_0x1318bc;if(!_0x49216a)return null;const _0x21604a=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0x19afcd=_0x49216a[_0x2b53aa(0x40d)](_0x21604a);return _0x19afcd?_0x19afcd[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x593501=_0x1318bc;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x3a336f=document[_0x593501(0x3e7)](_0x593501(0x47c)),_0x467f65=(_0x3a336f&&_0x3a336f[_0x593501(0x470)]?_0x3a336f[_0x593501(0x470)]:'')[_0x593501(0x3f0)]();return _0x467f65;}catch(_0x213300){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function handleYoutubeUrlInput(){const _0x2e1e96=_0x1318bc,_0x138dc8=$(_0x2e1e96(0x20f)),_0x2e5518=$('#ytUrlFeedback'),_0x4d0c17=$(_0x2e1e96(0x20c)),_0x121f7c=_0x138dc8[_0x2e1e96(0x470)][_0x2e1e96(0x3f0)](),_0x3a414b=extractYouTubeID(_0x121f7c);if(_0x3a414b){_0x2e5518[_0x2e1e96(0x1ee)]=_0x2e1e96(0x400),_0x2e5518[_0x2e1e96(0x2f6)][_0x2e1e96(0x2fe)]=_0x2e1e96(0x375),_0x4d0c17['disabled']=![],sessionYoutubeUrl=_0x121f7c;try{ytUserPaused=![];}catch(_0x4650d9){}try{const _0x2b6b44=_0x2e1e96(0x286)+_0x3a414b+_0x2e1e96(0x486),_0x1919c0=new Image();_0x1919c0[_0x2e1e96(0x432)]=async()=>{const _0x4c65fb=_0x2e1e96;data[_0x4c65fb(0x218)][_0x4c65fb(0x468)]=_0x2b6b44;try{await saveData();}catch(_0x5299c0){}applyCustomBg();},_0x1919c0[_0x2e1e96(0x384)]=async()=>{const _0x56f13f=_0x2e1e96,_0x48aef2=_0x56f13f(0x286)+_0x3a414b+'/hqdefault.jpg';data[_0x56f13f(0x218)][_0x56f13f(0x468)]=_0x48aef2;try{await saveData();}catch(_0x17cafe){}applyCustomBg();},_0x1919c0[_0x2e1e96(0x2d4)]=_0x2b6b44;}catch(_0x5c04c6){}try{if(IS_FILE_PROTOCOL){const _0x289748=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x3a414b,{'autoplay':0x1,'mute':_0x289748});try{setTimeout(()=>{const _0x4fe99b=_0x2e1e96;try{fallbackPostMessage(_0x4fe99b(0x4a3));}catch(_0x5f173a){}},0xfa);}catch(_0x496cd8){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0x394e77=_0x2e1e96,_0x2d0b97=document[_0x394e77(0x3e7)](_0x394e77(0x296));if(_0x2d0b97)_0x2d0b97[_0x394e77(0x1ee)]='Đang\x20phát';},0x1f4);}catch(_0x155bd1){}}else ensureYouTubeAPI()[_0x2e1e96(0x495)](()=>{const _0x58e993=_0x2e1e96;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer[_0x58e993(0x3e9)]&&ytPlayer[_0x58e993(0x4a3)]&&(ytPlayer['mute'](),ytPlayer[_0x58e993(0x4a3)](),_ytPrimed=!![],showSoundPermission());}catch(_0x495eb1){}})['catch'](()=>{});}catch(_0x3a1e73){}}else{if(_0x121f7c===''){_0x2e5518[_0x2e1e96(0x1ee)]='',_0x4d0c17['disabled']=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x401492){}else ytPlayer&&ytPlayer['stopVideo']&&ytPlayer[_0x2e1e96(0x39c)]();}else _0x2e5518[_0x2e1e96(0x1ee)]=_0x2e1e96(0x3eb),_0x2e5518['style'][_0x2e1e96(0x2fe)]=_0x2e1e96(0x22e),_0x4d0c17[_0x2e1e96(0x36f)]=!![];}}function applyTheme(_0x34b311){const _0x2beb3=_0x1318bc,_0x153cf7=_0x34b311||data['settings'][_0x2beb3(0x373)]||_0x2beb3(0x26f);document[_0x2beb3(0x2bf)][_0x2beb3(0x3db)][_0x2beb3(0x373)]=_0x153cf7;const _0xe8ae3c=['lofi',_0x2beb3(0x485)]['includes'](_0x153cf7),_0x47cca8=_0x153cf7===_0x2beb3(0x1c0)||_0x153cf7===_0x2beb3(0x1d4),_0x3925ae=data[_0x2beb3(0x218)][_0x2beb3(0x468)],_0x5310ba=()=>{const _0x54cad0=_0x2beb3;try{document[_0x54cad0(0x2bf)][_0x54cad0(0x2f6)][_0x54cad0(0x238)]='';}catch(_0x3e25f0){}};if(_0x3925ae&&!data[_0x2beb3(0x218)][_0x2beb3(0x33f)])document[_0x2beb3(0x2bf)][_0x2beb3(0x2f6)][_0x2beb3(0x2b7)]('--bg-image',_0x2beb3(0x32d)+_0x3925ae+')'),_0x5310ba();else{if(_0x3925ae&&data[_0x2beb3(0x218)][_0x2beb3(0x33f)])document['body'][_0x2beb3(0x2f6)][_0x2beb3(0x2b7)](_0x2beb3(0x2a1),_0x2beb3(0x32d)+_0x3925ae+')'),_0x5310ba();else{if(_0xe8ae3c)document[_0x2beb3(0x2bf)][_0x2beb3(0x2f6)]['removeProperty'](_0x2beb3(0x2a1)),_0x5310ba();else _0x47cca8?(document[_0x2beb3(0x2bf)][_0x2beb3(0x2f6)][_0x2beb3(0x2b7)]('--bg-image',_0x2beb3(0x24b)),_0x5310ba()):(document['body']['style'][_0x2beb3(0x2b7)](_0x2beb3(0x2a1),''),document['body'][_0x2beb3(0x2f6)][_0x2beb3(0x238)]=_0x2beb3(0x422));}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':_0x1318bc(0x226),'preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x1318bc(0x1ce),'theme':_0x1318bc(0x26f),'cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'enableSessionNotes':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x1318bc(0x3f5),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':_0x1318bc(0x306),'content':_0x1318bc(0x3d9)},{'id':uid('m'),'title':_0x1318bc(0x1b2),'content':_0x1318bc(0x2af)},{'id':uid('m'),'title':_0x1318bc(0x249),'content':_0x1318bc(0x439)},{'id':uid('m'),'title':_0x1318bc(0x41a),'content':_0x1318bc(0x1f6)},{'id':uid('m'),'title':_0x1318bc(0x1d3),'content':'<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>'}]},'topics':[]};let data,editingPreset='A',AUDIO_CTX=null;function _0x2a57(_0x1d89af,_0x441fb9){const _0x293e0f=_0x293e();return _0x2a57=function(_0x2a57c3,_0x1bbec8){_0x2a57c3=_0x2a57c3-0x194;let _0x414fcb=_0x293e0f[_0x2a57c3];return _0x414fcb;},_0x2a57(_0x1d89af,_0x441fb9);}function ensureAudio(){const _0x1323e2=_0x1318bc;if(!AUDIO_CTX)AUDIO_CTX=new(window[(_0x1323e2(0x2b5))]||window[(_0x1323e2(0x3b9))])();}function tone(_0xb99ceb=0x370,_0x5a2c50=0xc8,_0x423173=0.2,_0x5d355a=_0x1318bc(0x3bb),_0x19cdd7=0x0){const _0x111b7f=_0x1318bc;ensureAudio();const _0x59678e=AUDIO_CTX,_0x28197d=_0x59678e[_0x111b7f(0x231)](),_0x43b9e3=_0x59678e[_0x111b7f(0x30b)]();_0x28197d['type']=_0x5d355a,_0x28197d[_0x111b7f(0x399)]['value']=_0xb99ceb,_0x28197d[_0x111b7f(0x1e3)](_0x43b9e3),_0x43b9e3[_0x111b7f(0x1e3)](_0x59678e['destination']);const _0x2a4f8f=_0x59678e['currentTime']+_0x19cdd7;_0x43b9e3[_0x111b7f(0x1cd)][_0x111b7f(0x3b4)](0x0,_0x2a4f8f),_0x43b9e3['gain'][_0x111b7f(0x2ae)](_0x423173,_0x2a4f8f+0.01),_0x43b9e3['gain'][_0x111b7f(0x209)](0.0001,_0x2a4f8f+_0x5a2c50/0x3e8),_0x28197d[_0x111b7f(0x364)](_0x2a4f8f),_0x28197d[_0x111b7f(0x20d)](_0x2a4f8f+_0x5a2c50/0x3e8+0.05);}function playSound(_0x136110){const _0x909b21=_0x1318bc;if(!data['settings']['soundOn'])return;const _0xd1eb73=Math['max'](0x0,Math['min'](0x1,data[_0x909b21(0x218)][_0x909b21(0x3b8)]??0.8)),_0x5df03a=data[_0x909b21(0x218)][_0x909b21(0x340)]?.[_0x136110];let _0x26aa62;if(_0x136110==='work_end')_0x26aa62=$(_0x909b21(0x2a9));else{if(_0x136110===_0x909b21(0x402))_0x26aa62=$(_0x909b21(0x487));else{if(_0x136110===_0x909b21(0x1b8))_0x26aa62=$(_0x909b21(0x47d));}}if(_0x5df03a&&_0x26aa62){_0x5df03a[_0x909b21(0x1f3)](_0x909b21(0x365))||_0x5df03a[_0x909b21(0x1f3)](_0x909b21(0x2a8))||_0x5df03a[_0x909b21(0x1f3)](_0x909b21(0x22d))?(_0x26aa62[_0x909b21(0x2d4)]=_0x5df03a,_0x26aa62[_0x909b21(0x3b8)]=_0xd1eb73,_0x26aa62[_0x909b21(0x33b)]()[_0x909b21(0x3c6)](_0xf2e60e=>console[_0x909b21(0x40f)](_0x909b21(0x2e9),_0xf2e60e))):getStoredFileUrl(_0x5df03a)[_0x909b21(0x495)](_0x596b9c=>{const _0x3a3105=_0x909b21;_0x596b9c&&(_0x26aa62[_0x3a3105(0x2d4)]=_0x596b9c,_0x26aa62[_0x3a3105(0x3b8)]=_0xd1eb73,_0x26aa62[_0x3a3105(0x33b)]()[_0x3a3105(0x3c6)](_0x3710a6=>console[_0x3a3105(0x40f)](_0x3a3105(0x2e9),_0x3710a6)));});return;}const _0x54b6d5=data[_0x909b21(0x218)]['soundTheme']||_0x909b21(0x1ce);if(_0x54b6d5===_0x909b21(0x1ce)){if(_0x136110==='work_end')tone(0x370,0xfa,_0xd1eb73),tone(0x294,0xb4,_0xd1eb73*0.8,'sine',0.22);else{if(_0x136110===_0x909b21(0x402))tone(0x294,0xdc,_0xd1eb73*0.9);else _0x136110==='long_end'&&(tone(0x208,0xc8,_0xd1eb73),tone(0x30c,0xc8,_0xd1eb73,_0x909b21(0x3bb),0.22),tone(0x410,0xdc,_0xd1eb73,'sine',0.44));}}else{if(_0x136110===_0x909b21(0x4a4))tone(0x4b0,0xa0,_0xd1eb73*0.9,_0x909b21(0x48a)),tone(0x384,0xdc,_0xd1eb73*0.8,'triangle',0.18);else{if(_0x136110===_0x909b21(0x402))tone(0x370,0xf0,_0xd1eb73*0.8,_0x909b21(0x48a));else _0x136110===_0x909b21(0x1b8)&&(tone(0x258,0xdc,_0xd1eb73*0.9,_0x909b21(0x48a)),tone(0x3b6,0xf0,_0xd1eb73*0.9,_0x909b21(0x48a),0.22),tone(0x4b0,0xf0,_0xd1eb73,'triangle',0.44));}}}async function saveData(){const _0x1fa1d1=_0x1318bc;try{await storageManager[_0x1fa1d1(0x223)](data);}catch(_0x373daa){console[_0x1fa1d1(0x40f)](_0x1fa1d1(0x34f),_0x373daa),toast(_0x1fa1d1(0x4ac)+_0x373daa[_0x1fa1d1(0x3b0)]);}}async function ensureValidSelection(){const _0x3fcdc4=_0x1318bc,_0x3e7e22=data[_0x3fcdc4(0x218)];if(!data[_0x3fcdc4(0x295)]||data[_0x3fcdc4(0x295)][_0x3fcdc4(0x469)]===0x0){_0x3e7e22['selectedTopicId']='',_0x3e7e22[_0x3fcdc4(0x446)]='',await saveData();return;}const _0x36f852=data[_0x3fcdc4(0x295)][_0x3fcdc4(0x30d)](_0xa2373a=>_0xa2373a['id']===_0x3e7e22[_0x3fcdc4(0x3b2)]),_0x22ae9a=_0x36f852?.[_0x3fcdc4(0x2ea)][_0x3fcdc4(0x30d)](_0x4fa837=>_0x4fa837['id']===_0x3e7e22[_0x3fcdc4(0x446)]);if(!_0x36f852||!_0x22ae9a){const _0x382dbc=data[_0x3fcdc4(0x295)][0x0],_0x743cda=_0x382dbc?.[_0x3fcdc4(0x2ea)]?.[0x0];_0x3e7e22[_0x3fcdc4(0x3b2)]=_0x382dbc?.['id']||'',_0x3e7e22['selectedSubtopicId']=_0x743cda?.['id']||'',await saveData();}}function showInputModal(_0x528958,_0x4459ab,_0x555ef2=''){const _0xceda40=_0x1318bc;$(_0xceda40(0x2a7))[_0xceda40(0x1ee)]=_0x528958,$('#genericMessage')[_0xceda40(0x322)][_0xceda40(0x28c)](_0xceda40(0x2da));const _0x5f3696=$('#genericInput');_0x5f3696[_0xceda40(0x470)]=_0x555ef2,_0x5f3696[_0xceda40(0x322)]['remove'](_0xceda40(0x2da)),$(_0xceda40(0x3cb))[_0xceda40(0x322)]['add'](_0xceda40(0x393));try{trapFocus($(_0xceda40(0x3cb)));}catch(_0x30c76d){}_0x5f3696['focus'](),_0x5f3696[_0xceda40(0x39b)]();const _0x84d59e=()=>{const _0x297a0f=_0xceda40;_0x4459ab(_0x5f3696[_0x297a0f(0x470)]),_0x59f3d1();},_0x35df0c=()=>_0x59f3d1(),_0x828840=_0x373699=>{const _0x3be722=_0xceda40;if(_0x373699[_0x3be722(0x1c9)]===_0x3be722(0x451))_0x84d59e();if(_0x373699['key']==='Escape')_0x35df0c();};$(_0xceda40(0x36a))['onclick']=_0x84d59e,$(_0xceda40(0x1a4))[_0xceda40(0x2dc)]=_0x35df0c,_0x5f3696[_0xceda40(0x1f0)]=_0x828840;function _0x59f3d1(){const _0x2a5af0=_0xceda40;$(_0x2a5af0(0x3cb))[_0x2a5af0(0x322)][_0x2a5af0(0x330)](_0x2a5af0(0x393)),$(_0x2a5af0(0x36a))[_0x2a5af0(0x2dc)]=null,$(_0x2a5af0(0x1a4))[_0x2a5af0(0x2dc)]=null,_0x5f3696['onkeydown']=null;try{releaseFocus();}catch(_0x2758a8){}}}function showConfirmModal(_0x592997,_0x2a3aa1,_0x103e52){const _0x3152d1=_0x1318bc;$(_0x3152d1(0x2a7))[_0x3152d1(0x1ee)]=_0x592997;const _0x3f0623=$('#genericMessage');_0x3f0623['textContent']=_0x2a3aa1,_0x3f0623[_0x3152d1(0x322)]['remove']('hidden'),$(_0x3152d1(0x467))[_0x3152d1(0x322)]['add'](_0x3152d1(0x2da)),$(_0x3152d1(0x3cb))[_0x3152d1(0x322)][_0x3152d1(0x28c)](_0x3152d1(0x393));try{trapFocus($(_0x3152d1(0x3cb)));}catch(_0x188dd5){}const _0x51f06f=()=>{_0x103e52(!![]),_0x57a3db();},_0x34fbe6=()=>{_0x103e52(![]),_0x57a3db();};$(_0x3152d1(0x36a))[_0x3152d1(0x2dc)]=_0x51f06f,$(_0x3152d1(0x1a4))[_0x3152d1(0x2dc)]=_0x34fbe6;function _0x57a3db(){const _0x71ab2f=_0x3152d1;$(_0x71ab2f(0x3cb))[_0x71ab2f(0x322)]['remove']('show'),$(_0x71ab2f(0x36a))[_0x71ab2f(0x2dc)]=null,$(_0x71ab2f(0x1a4))['onclick']=null;try{releaseFocus();}catch(_0x2349a4){}}}let pendingNoteSessionId=null;function openNoteModal(_0x11db1a){const _0x4a1201=_0x1318bc;pendingNoteSessionId=_0x11db1a||null;const _0x5a74cf=$(_0x4a1201(0x248));if(!_0x5a74cf)return;const _0x165c55=$(_0x4a1201(0x336));if(_0x165c55)try{_0x165c55['value']='';}catch(_0x5e6160){}_0x5a74cf[_0x4a1201(0x322)][_0x4a1201(0x28c)](_0x4a1201(0x393));try{trapFocus(_0x5a74cf);}catch(_0x5e8fd7){}}function closeNoteModal(){const _0x271e50=_0x1318bc,_0x159d1d=$('#modalNote');if(!_0x159d1d)return;_0x159d1d['classList'][_0x271e50(0x330)](_0x271e50(0x393)),pendingNoteSessionId=null;try{releaseFocus();}catch(_0x12b5ae){}}async function switchView(_0x23a341){const _0x457ead=_0x1318bc;$$(_0x457ead(0x2df))[_0x457ead(0x395)](_0x5cb9e3=>_0x5cb9e3['classList'][_0x457ead(0x330)](_0x457ead(0x2ef))),$(_0x457ead(0x318)+_0x23a341)[_0x457ead(0x322)][_0x457ead(0x28c)](_0x457ead(0x2ef)),$$('.nav-btn')['forEach'](_0x39d01e=>_0x39d01e[_0x457ead(0x322)][_0x457ead(0x330)](_0x457ead(0x2ef)));const _0x1ca44f=$(_0x457ead(0x236)+_0x23a341+'\x22]');if(_0x1ca44f)_0x1ca44f[_0x457ead(0x322)]['add'](_0x457ead(0x2ef));data[_0x457ead(0x218)][_0x457ead(0x46c)]=_0x23a341,await saveData(),_0x23a341===_0x457ead(0x49b)&&renderDashboard();}function closeAllMenus(){const _0x32ebd4=_0x1318bc;$$(_0x32ebd4(0x3a1))[_0x32ebd4(0x395)](_0x2122ef=>_0x2122ef[_0x32ebd4(0x322)][_0x32ebd4(0x330)](_0x32ebd4(0x393))),$$('.topic-item.menu-active')[_0x32ebd4(0x395)](_0x1dec3f=>_0x1dec3f['classList'][_0x32ebd4(0x330)](_0x32ebd4(0x3dc)));}function renderTopics(){const _0x12f783=_0x1318bc,_0x297b64=$('#topicsList');if(!_0x297b64)return;_0x297b64[_0x12f783(0x2e8)]='';const _0x39def8=data['settings'][_0x12f783(0x234)]||{};data[_0x12f783(0x295)]['forEach'](_0x3417d4=>{const _0x1cf5e8=_0x12f783,_0x28d6e0=document['createElement'](_0x1cf5e8(0x250));_0x28d6e0['className']=_0x1cf5e8(0x47f),_0x28d6e0[_0x1cf5e8(0x3db)]['tid']=_0x3417d4['id'];const _0x1fc48e=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x250));_0x1fc48e[_0x1cf5e8(0x205)]=_0x1cf5e8(0x3c4);const _0x262bc4=!!_0x39def8[_0x3417d4['id']],_0x5cfc4d=document['createElement']('button');_0x5cfc4d[_0x1cf5e8(0x205)]='chev\x20btn\x20small\x20ghost',_0x5cfc4d[_0x1cf5e8(0x35f)](_0x1cf5e8(0x1dc),String(!_0x262bc4)),_0x5cfc4d[_0x1cf5e8(0x2e8)]=_0x1cf5e8(0x1d6);const _0x58c672=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x250));_0x58c672[_0x1cf5e8(0x205)]=_0x1cf5e8(0x31e),_0x58c672[_0x1cf5e8(0x1ee)]=_0x3417d4[_0x1cf5e8(0x40c)];const _0x33ec5a=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x250));_0x33ec5a['className']='topic-actions';const _0x51bbf1=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x32a));_0x51bbf1[_0x1cf5e8(0x205)]='btn\x20small',_0x51bbf1[_0x1cf5e8(0x2e8)]=_0x1cf5e8(0x253),_0x51bbf1[_0x1cf5e8(0x210)]='Thêm\x20Chủ\x20đề\x20con';const _0x4257fc=document[_0x1cf5e8(0x334)]('div');_0x4257fc[_0x1cf5e8(0x2f6)][_0x1cf5e8(0x316)]=_0x1cf5e8(0x258);const _0x5eeb9f=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x32a));_0x5eeb9f[_0x1cf5e8(0x205)]=_0x1cf5e8(0x2a0),_0x5eeb9f[_0x1cf5e8(0x2e8)]=_0x1cf5e8(0x33c),_0x5eeb9f[_0x1cf5e8(0x210)]=_0x1cf5e8(0x1c1);const _0x19db45=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x250));_0x19db45[_0x1cf5e8(0x205)]=_0x1cf5e8(0x3d0);const _0x20210e=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x32a));_0x20210e[_0x1cf5e8(0x205)]='menu-item',_0x20210e[_0x1cf5e8(0x2e8)]=_0x1cf5e8(0x228);const _0x3c219c=document['createElement'](_0x1cf5e8(0x32a));_0x3c219c[_0x1cf5e8(0x205)]='menu-item\x20danger',_0x3c219c[_0x1cf5e8(0x2e8)]=_0x1cf5e8(0x2c8),_0x19db45[_0x1cf5e8(0x2f4)](_0x20210e,_0x3c219c),_0x4257fc[_0x1cf5e8(0x2f4)](_0x5eeb9f,_0x19db45),_0x33ec5a[_0x1cf5e8(0x2f4)](_0x51bbf1,_0x4257fc),_0x1fc48e[_0x1cf5e8(0x2f4)](_0x5cfc4d,_0x58c672,_0x33ec5a),_0x5cfc4d[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),async _0xaeea12=>{const _0x364922=_0x1cf5e8;_0xaeea12['stopPropagation']();const _0x3278f9=!!_0x39def8[_0x3417d4['id']];_0x3278f9?delete _0x39def8[_0x3417d4['id']]:_0x39def8[_0x3417d4['id']]=!![],data[_0x364922(0x218)][_0x364922(0x234)]=_0x39def8,await storageManager[_0x364922(0x201)](data[_0x364922(0x218)]),renderTopics();});const _0x1b5608=async()=>{const _0x5baa56=_0x1cf5e8,_0x93fb2d=!!_0x39def8[_0x3417d4['id']];_0x93fb2d?delete _0x39def8[_0x3417d4['id']]:_0x39def8[_0x3417d4['id']]=!![],data['settings']['collapsedTopics']=_0x39def8,await storageManager[_0x5baa56(0x201)](data['settings']),renderTopics();};_0x1fc48e[_0x1cf5e8(0x2b2)]('click',async _0x7b5e9=>{const _0x188452=_0x1cf5e8,_0x41f114=_0x7b5e9['target'];if(_0x41f114&&_0x41f114[_0x188452(0x1c2)]){if(_0x41f114[_0x188452(0x1c2)](_0x188452(0x303))||_0x41f114['closest']('.actions-menu-btn')||_0x41f114[_0x188452(0x1c2)](_0x188452(0x32a))||_0x41f114[_0x188452(0x1c2)]('input,select,textarea'))return;}_0x7b5e9[_0x188452(0x44a)](),await _0x1b5608();}),_0x58c672[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),async _0x140113=>{const _0x1e40b1=_0x1cf5e8;_0x140113[_0x1e40b1(0x44a)](),await _0x1b5608();}),_0x28d6e0[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),async _0x1fac3c=>{const _0x1cda01=_0x1cf5e8,_0x39ff2d=_0x1fac3c['target'];if(_0x39ff2d&&_0x39ff2d[_0x1cda01(0x1c2)]){if(_0x39ff2d[_0x1cda01(0x1c2)](_0x1cda01(0x196)))return;if(_0x39ff2d[_0x1cda01(0x1c2)](_0x1cda01(0x303))||_0x39ff2d['closest']('.actions-menu-btn')||_0x39ff2d[_0x1cda01(0x1c2)](_0x1cda01(0x32a))||_0x39ff2d[_0x1cda01(0x1c2)](_0x1cda01(0x47b)))return;}await _0x1b5608();});const _0x574732=document[_0x1cf5e8(0x334)](_0x1cf5e8(0x250));_0x574732[_0x1cf5e8(0x205)]=_0x1cf5e8(0x2ea)+(_0x262bc4?_0x1cf5e8(0x459):''),_0x574732[_0x1cf5e8(0x3db)][_0x1cf5e8(0x406)]=_0x3417d4['id'],_0x3417d4['subtopics'][_0x1cf5e8(0x395)](_0x1de31d=>{const _0x2864c4=_0x1cf5e8,_0x1a4372=document[_0x2864c4(0x334)](_0x2864c4(0x250));_0x1a4372['className']=_0x2864c4(0x405),_0x1a4372['dataset'][_0x2864c4(0x29b)]=_0x1de31d['id'];const _0x1e45e4=document[_0x2864c4(0x334)]('button');_0x1e45e4['className']=_0x2864c4(0x427),_0x1e45e4['textContent']='•\x20'+_0x1de31d[_0x2864c4(0x40c)],_0x1e45e4['dataset'][_0x2864c4(0x29b)]=_0x1de31d['id'],_0x1e45e4[_0x2864c4(0x3db)][_0x2864c4(0x406)]=_0x3417d4['id'];if(data['settings'][_0x2864c4(0x446)]===_0x1de31d['id'])_0x1e45e4[_0x2864c4(0x322)]['add']('active');const _0x56581c=document['createElement'](_0x2864c4(0x250));_0x56581c[_0x2864c4(0x205)]=_0x2864c4(0x44e);const _0x5110d3=document[_0x2864c4(0x334)](_0x2864c4(0x250));_0x5110d3[_0x2864c4(0x2f6)][_0x2864c4(0x316)]=_0x2864c4(0x258);const _0x1a07cc=document[_0x2864c4(0x334)](_0x2864c4(0x32a));_0x1a07cc['className']='btn\x20small\x20ghost\x20actions-menu-btn',_0x1a07cc['innerHTML']=_0x2864c4(0x33c),_0x1a07cc[_0x2864c4(0x210)]=_0x2864c4(0x1c1);const _0x3b5927=document['createElement']('div');_0x3b5927['className']=_0x2864c4(0x3d0);const _0x293420=document['createElement']('button');_0x293420[_0x2864c4(0x205)]=_0x2864c4(0x47e),_0x293420[_0x2864c4(0x2e8)]=_0x2864c4(0x1e5);const _0xd2ee52=document['createElement'](_0x2864c4(0x32a));_0xd2ee52[_0x2864c4(0x205)]=_0x2864c4(0x3f1),_0xd2ee52['innerHTML']=_0x2864c4(0x2b9),_0x3b5927[_0x2864c4(0x2f4)](_0x293420,_0xd2ee52),_0x5110d3[_0x2864c4(0x2f4)](_0x1a07cc,_0x3b5927),_0x56581c[_0x2864c4(0x2f4)](_0x5110d3),_0x1a4372['append'](_0x1e45e4,_0x56581c),_0x574732[_0x2864c4(0x27e)](_0x1a4372),_0x1e45e4[_0x2864c4(0x2b2)](_0x2864c4(0x21b),()=>selectSubtopic(_0x3417d4['id'],_0x1de31d['id'])),_0x1a07cc['addEventListener'](_0x2864c4(0x21b),_0x58ebe1=>{const _0x3e4cfe=_0x2864c4;_0x58ebe1[_0x3e4cfe(0x44a)]();const _0x31b011=_0x3b5927[_0x3e4cfe(0x322)][_0x3e4cfe(0x326)]('show');closeAllMenus(),_0x31b011?_0x28d6e0[_0x3e4cfe(0x322)][_0x3e4cfe(0x330)]('menu-active'):(_0x3b5927[_0x3e4cfe(0x322)][_0x3e4cfe(0x28c)](_0x3e4cfe(0x393)),_0x28d6e0[_0x3e4cfe(0x322)][_0x3e4cfe(0x28c)]('menu-active'));}),_0x293420[_0x2864c4(0x2b2)](_0x2864c4(0x21b),()=>showInputModal(_0x2864c4(0x4a1),async _0x2184f8=>{const _0x1c1b92=_0x2864c4;if(!_0x2184f8)return;_0x1de31d['name']=_0x2184f8,await storageManager[_0x1c1b92(0x428)](_0x1c1b92(0x2ea),_0x1de31d),renderAll();},_0x1de31d['name'])),_0xd2ee52['addEventListener'](_0x2864c4(0x21b),()=>showConfirmModal(_0x2864c4(0x3a8),_0x2864c4(0x367)+_0x1de31d[_0x2864c4(0x40c)]+_0x2864c4(0x268),async _0x529335=>{const _0x316711=_0x2864c4;if(!_0x529335)return;_0x3417d4[_0x316711(0x2ea)]=_0x3417d4['subtopics']['filter'](_0x4f04ad=>_0x4f04ad['id']!==_0x1de31d['id']);const _0x34192d=data[_0x316711(0x218)];_0x34192d[_0x316711(0x446)]===_0x1de31d['id']&&(_0x34192d[_0x316711(0x446)]='',_0x34192d[_0x316711(0x3b2)]='',ensureValidSelection()),await storageManager[_0x316711(0x25a)](_0x316711(0x2ea),_0x1de31d['id']),renderAll();}));}),_0x5eeb9f['addEventListener'](_0x1cf5e8(0x21b),_0x4973ac=>{const _0x4e5290=_0x1cf5e8;_0x4973ac[_0x4e5290(0x44a)]();const _0x4bc1b4=_0x19db45[_0x4e5290(0x322)][_0x4e5290(0x326)](_0x4e5290(0x393));closeAllMenus(),_0x4bc1b4?_0x28d6e0['classList']['remove'](_0x4e5290(0x3dc)):(_0x19db45['classList'][_0x4e5290(0x28c)](_0x4e5290(0x393)),_0x28d6e0[_0x4e5290(0x322)][_0x4e5290(0x28c)](_0x4e5290(0x3dc)));}),_0x51bbf1['addEventListener'](_0x1cf5e8(0x21b),()=>showInputModal('Tên\x20Chủ\x20đề\x20con\x20mới?',async _0x26e20f=>{const _0x1ecd08=_0x1cf5e8;if(!_0x26e20f)return;const _0x15dd36={'id':uid('s'),'topicId':_0x3417d4['id'],'name':_0x26e20f,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':_0x1ecd08(0x1d7),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x3417d4['subtopics'][_0x1ecd08(0x42e)](_0x15dd36),await storageManager[_0x1ecd08(0x28c)](_0x1ecd08(0x2ea),_0x15dd36),renderTopics();})),_0x20210e[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),()=>showInputModal(_0x1cf5e8(0x463),async _0x92637f=>{const _0x38a4f9=_0x1cf5e8;if(!_0x92637f)return;_0x3417d4[_0x38a4f9(0x40c)]=_0x92637f,await storageManager['update'](_0x38a4f9(0x295),_0x3417d4),renderTopics();},_0x3417d4[_0x1cf5e8(0x40c)])),_0x3c219c[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),()=>showConfirmModal(_0x1cf5e8(0x3a8),_0x1cf5e8(0x2d1)+_0x3417d4[_0x1cf5e8(0x40c)]+_0x1cf5e8(0x1aa),async _0x1bf27f=>{const _0x4b93b7=_0x1cf5e8;if(!_0x1bf27f)return;data['topics']=data['topics'][_0x4b93b7(0x1be)](_0x3bb409=>_0x3bb409['id']!==_0x3417d4['id']),delete _0x39def8[_0x3417d4['id']];data[_0x4b93b7(0x218)][_0x4b93b7(0x3b2)]===_0x3417d4['id']&&(data[_0x4b93b7(0x218)][_0x4b93b7(0x3b2)]='',data[_0x4b93b7(0x218)][_0x4b93b7(0x446)]='',ensureValidSelection());await storageManager['delete'](_0x4b93b7(0x295),_0x3417d4['id']);for(const _0x2f8814 of _0x3417d4['subtopics']){await storageManager['delete'](_0x4b93b7(0x2ea),_0x2f8814['id']);}renderAll();})),_0x51bbf1[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),_0x455193=>_0x455193['stopPropagation']()),_0x20210e[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),_0x5a20e6=>_0x5a20e6['stopPropagation']()),_0x3c219c[_0x1cf5e8(0x2b2)](_0x1cf5e8(0x21b),_0x561b68=>_0x561b68[_0x1cf5e8(0x44a)]()),_0x28d6e0[_0x1cf5e8(0x2f4)](_0x1fc48e,_0x574732),_0x297b64[_0x1cf5e8(0x27e)](_0x28d6e0);});if(window[_0x12f783(0x279)]){const _0x5b076a=document[_0x12f783(0x3e7)](_0x12f783(0x2aa));if(_0x5b076a){if(_0x5b076a[_0x12f783(0x1c4)])try{_0x5b076a[_0x12f783(0x1c4)]['destroy']();}catch(_0x491a03){}_0x5b076a[_0x12f783(0x1c4)]=new Sortable(_0x5b076a,{'animation':0x96,'draggable':'.topic-item','onEnd':async function(_0x285a98){const _0x3b0f04=_0x12f783;if(_0x285a98['oldIndex']===_0x285a98[_0x3b0f04(0x398)])return;const _0x26d31e=data[_0x3b0f04(0x295)]['splice'](_0x285a98[_0x3b0f04(0x3f2)],0x1)[0x0];data[_0x3b0f04(0x295)][_0x3b0f04(0x35c)](_0x285a98[_0x3b0f04(0x398)],0x0,_0x26d31e),await saveData(),renderTopics();}}),_0x5b076a['querySelectorAll']('.subtopics')[_0x12f783(0x395)](_0x25d4e3=>{const _0x1fa656=_0x12f783;new Sortable(_0x25d4e3,{'group':_0x1fa656(0x2e4),'animation':0x96,'draggable':_0x1fa656(0x252),'onEnd':async function(_0x2ae3b1){const _0x2fca81=_0x1fa656,_0x111228=_0x2ae3b1[_0x2fca81(0x30f)]?.[_0x2fca81(0x3db)]?.[_0x2fca81(0x406)]||_0x2ae3b1[_0x2fca81(0x30f)]?.[_0x2fca81(0x1c2)](_0x2fca81(0x1df))?.[_0x2fca81(0x3db)]?.['tid'],_0x11b5ac=_0x2ae3b1['to']?.['dataset']?.[_0x2fca81(0x406)]||_0x2ae3b1['to']?.['closest']('.topic-item')?.[_0x2fca81(0x3db)]?.[_0x2fca81(0x406)],_0x2e837b=data[_0x2fca81(0x295)][_0x2fca81(0x30d)](_0x353778=>_0x353778['id']===_0x111228),_0x2ff14e=data[_0x2fca81(0x295)][_0x2fca81(0x30d)](_0xf8ad20=>_0xf8ad20['id']===_0x11b5ac);if(!_0x2e837b||!_0x2ff14e)return;let _0xd4e8e8=null;const _0x691688=_0x2ae3b1['item']?.[_0x2fca81(0x3db)]?.[_0x2fca81(0x29b)]||_0x2ae3b1[_0x2fca81(0x3da)]?.['querySelector'](_0x2fca81(0x3fe))?.[_0x2fca81(0x3db)]?.[_0x2fca81(0x29b)];if(_0x691688){const _0x1292d0=_0x2e837b[_0x2fca81(0x2ea)][_0x2fca81(0x48f)](_0x5b4f7c=>_0x5b4f7c['id']===_0x691688);if(_0x1292d0>=0x0)_0xd4e8e8=_0x2e837b[_0x2fca81(0x2ea)]['splice'](_0x1292d0,0x1)[0x0];}!_0xd4e8e8&&(_0xd4e8e8=_0x2e837b[_0x2fca81(0x2ea)][_0x2fca81(0x35c)](_0x2ae3b1[_0x2fca81(0x3f2)],0x1)[0x0]);if(!_0xd4e8e8)return;_0xd4e8e8[_0x2fca81(0x22c)]=_0x2ff14e['id'],_0x2ff14e[_0x2fca81(0x2ea)][_0x2fca81(0x35c)](_0x2ae3b1['newIndex'],0x0,_0xd4e8e8),data[_0x2fca81(0x218)]['selectedSubtopicId']===_0xd4e8e8['id']&&(data['settings'][_0x2fca81(0x3b2)]=_0x2ff14e['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x5c145f,_0x707377){const _0x5956b4=_0x1318bc,_0x17791c=$(_0x5956b4(0x349)),_0x588edb=getCurrentSubtopic();_0x588edb&&timer[_0x5956b4(0x1a3)]!==_0x5956b4(0x1d7)&&(_0x588edb[_0x5956b4(0x3e3)]={'state':timer['state'],'prevState':timer[_0x5956b4(0x2b3)],'remaining':timer['remaining'],'segmentTotal':timer[_0x5956b4(0x385)],'cycleIndex':timer[_0x5956b4(0x2a4)]}),_0x17791c['classList'][_0x5956b4(0x28c)](_0x5956b4(0x414)),setTimeout(async()=>{const _0x50421c=_0x5956b4;data[_0x50421c(0x218)][_0x50421c(0x3b2)]=_0x5c145f,data['settings']['selectedSubtopicId']=_0x707377;const _0x51f4a3=getCurrentSubtopic();_0x51f4a3[_0x50421c(0x3e3)]?(timer['state']=_0x51f4a3[_0x50421c(0x3e3)][_0x50421c(0x1a3)],timer[_0x50421c(0x2b3)]=_0x51f4a3['timerState'][_0x50421c(0x2b3)]||null,timer[_0x50421c(0x32e)]=_0x51f4a3[_0x50421c(0x3e3)]['remaining'],timer[_0x50421c(0x385)]=_0x51f4a3['timerState'][_0x50421c(0x385)],timer[_0x50421c(0x2a4)]=_0x51f4a3[_0x50421c(0x3e3)]['cycleIndex']):timer[_0x50421c(0x435)](),await saveData(),timer['updateUI'](),renderAll(),switchView('timer'),_0x17791c[_0x50421c(0x322)][_0x50421c(0x330)](_0x50421c(0x414));},0xc8);}function getCurrentSubtopic(){const _0x208a69=_0x1318bc,_0xd04e64=data[_0x208a69(0x218)][_0x208a69(0x3b2)],_0x4058ce=data[_0x208a69(0x218)][_0x208a69(0x446)];if(!_0xd04e64||!_0x4058ce)return null;const _0x4c91e0=data[_0x208a69(0x295)][_0x208a69(0x30d)](_0x424681=>_0x424681['id']===_0xd04e64);if(!_0x4c91e0)return null;return _0x4c91e0[_0x208a69(0x2ea)][_0x208a69(0x30d)](_0x2a8425=>_0x2a8425['id']===_0x4058ce)||null;}function renderContextBadge(){const _0xb25ac3=_0x1318bc,_0xedb020=getCurrentSubtopic(),_0x41a8b5=_0xedb020?_0xedb020['name']:'(chưa\x20chọn)',_0x4aae1a=$(_0xb25ac3(0x3cc)),_0xe59d98=$('#currentSubtopicName'),_0x1295a7=$('#currentSubtopicNameChat');if(_0x4aae1a)_0x4aae1a[_0xb25ac3(0x1ee)]=_0xedb020?_0xb25ac3(0x2ad)+_0xedb020[_0xb25ac3(0x40c)]:_0xb25ac3(0x1e2);if(_0xe59d98)_0xe59d98[_0xb25ac3(0x1ee)]=_0x41a8b5;if(_0x1295a7)_0x1295a7[_0xb25ac3(0x1ee)]=_0x41a8b5;}function renderSubtopicTasks(){const _0x7356d8=_0x1318bc,_0x1f6b28=getCurrentSubtopic(),_0x327d63=$(_0x7356d8(0x1b5)),_0xa8a518=$(_0x7356d8(0x1f4));if(!_0x327d63||!_0xa8a518)return;const _0x20ed0f=_0xa8a518[_0x7356d8(0x356)];if(!_0x1f6b28){_0x327d63[_0x7356d8(0x2e8)]=_0x7356d8(0x2cb),_0x20ed0f[_0x7356d8(0x322)]['add'](_0x7356d8(0x2da));return;}_0x20ed0f[_0x7356d8(0x322)][_0x7356d8(0x330)]('hidden'),_0x327d63[_0x7356d8(0x2e8)]='';const _0x2a0951=_0x1f6b28[_0x7356d8(0x1f7)]?_0x1f6b28[_0x7356d8(0x1f7)][_0x7356d8(0x1be)](_0x2a743c=>!_0x2a743c[_0x7356d8(0x48c)]):[];_0x2a0951[_0x7356d8(0x469)]===0x0&&(_0x327d63[_0x7356d8(0x2e8)]='<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>'),_0x2a0951[_0x7356d8(0x395)](_0x1eaf43=>{const _0x35fddb=_0x7356d8,_0x1fcd59=document[_0x35fddb(0x334)]('li');_0x1fcd59[_0x35fddb(0x2e8)]=_0x35fddb(0x1d1)+_0x1eaf43['id']+_0x35fddb(0x3f9)+_0x1eaf43['id']+'\x22>'+escapeHTML(_0x1eaf43[_0x35fddb(0x1bb)])+'</label>',_0x1fcd59[_0x35fddb(0x3f3)](_0x35fddb(0x3a5))['addEventListener'](_0x35fddb(0x404),_0x227384=>toggleSubtopicTask(_0x227384[_0x35fddb(0x31c)]['id'],_0x1fcd59)),_0x327d63[_0x35fddb(0x27e)](_0x1fcd59);});}async function addSubtopicTask(){const _0x30d500=_0x1318bc,_0x4a6c06=getCurrentSubtopic();if(!_0x4a6c06){toast(t('timer.selectSubtopicPrompt'));return;}const _0x5857af=$(_0x30d500(0x1f4)),_0x3b3811=_0x5857af[_0x30d500(0x470)][_0x30d500(0x3f0)]();if(_0x3b3811){if(!_0x4a6c06[_0x30d500(0x1f7)])_0x4a6c06[_0x30d500(0x1f7)]=[];_0x4a6c06[_0x30d500(0x1f7)][_0x30d500(0x42e)]({'id':uid(_0x30d500(0x4b0)),'text':_0x3b3811,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x5857af['value']='';}_0x5857af[_0x30d500(0x425)]();}async function toggleSubtopicTask(_0x1c7aaf,_0x4f3aa1){const _0x45d4c4=_0x1318bc,_0x8e28ad=getCurrentSubtopic();if(!_0x8e28ad||!_0x8e28ad[_0x45d4c4(0x1f7)])return;const _0x2b7a60=_0x8e28ad[_0x45d4c4(0x1f7)]['find'](_0x489d78=>_0x489d78['id']===_0x1c7aaf);_0x2b7a60&&(_0x2b7a60[_0x45d4c4(0x48c)]=!![],_0x8e28ad[_0x45d4c4(0x49b)][_0x45d4c4(0x3bd)]=(_0x8e28ad[_0x45d4c4(0x49b)][_0x45d4c4(0x3bd)]||0x0)+0x1,await saveData(),_0x4f3aa1[_0x45d4c4(0x322)][_0x45d4c4(0x28c)](_0x45d4c4(0x4a8)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':'idle','prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0x53f068,{silent:silent=![]}={}){const _0x38d41d=_0x1318bc,_0x5e3642=data['settings'];this[_0x38d41d(0x3c9)]=_0x53f068,this[_0x38d41d(0x1bf)]=_0x53f068==='A'?_0x5e3642[_0x38d41d(0x309)]:_0x53f068==='B'?_0x5e3642['cyclesB']:0x0,_0x5e3642[_0x38d41d(0x3e0)]=_0x53f068,await saveData(),this[_0x38d41d(0x1a3)]===_0x38d41d(0x1d7)&&this[_0x38d41d(0x435)]();},'currentDurations'(){const _0x5de429=_0x1318bc,_0x59e085=data[_0x5de429(0x218)][_0x5de429(0x25d)];if(this['mode']==='A')return{'work':_0x59e085[_0x5de429(0x2c5)],'short':_0x59e085[_0x5de429(0x1a2)],'long':_0x59e085[_0x5de429(0x235)],'winddown':_0x59e085[_0x5de429(0x337)]??0x0};if(this[_0x5de429(0x3c9)]==='B')return{'work':_0x59e085['B_work'],'short':_0x59e085[_0x5de429(0x412)],'long':_0x59e085[_0x5de429(0x42a)],'winddown':_0x59e085['B_winddown']??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x409a59=_0x1318bc,_0xbc5945=data['settings'];if(this[_0x409a59(0x3c9)]==='A')return{'cycles':_0xbc5945[_0x409a59(0x309)],'interval':_0xbc5945[_0x409a59(0x308)]};if(this[_0x409a59(0x3c9)]==='B')return{'cycles':_0xbc5945[_0x409a59(0x31d)],'interval':_0xbc5945[_0x409a59(0x311)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x5cea32=_0x1318bc,_0xec86f2=$(_0x5cea32(0x3f6)),_0x34596a=$(_0x5cea32(0x481)),_0x29e5c6=$(_0x5cea32(0x2ac));if(!_0xec86f2||!_0x34596a||!_0x29e5c6)return;const _0x31838c=this['mode']==='C';$(_0x5cea32(0x242))['classList'][_0x5cea32(0x261)](_0x5cea32(0x2da),this['state']!==_0x5cea32(0x1d7)||_0x31838c&&this[_0x5cea32(0x1a3)]===_0x5cea32(0x3d2)),$(_0x5cea32(0x300))['classList'][_0x5cea32(0x261)](_0x5cea32(0x2da),!(_0x31838c&&this[_0x5cea32(0x1a3)]===_0x5cea32(0x3d2))),$('#btnPause')[_0x5cea32(0x322)]['toggle'](_0x5cea32(0x2da),!['work','break',_0x5cea32(0x2bd)][_0x5cea32(0x2d7)](this['state'])),$('#btnResume')[_0x5cea32(0x322)][_0x5cea32(0x261)]('hidden',this['state']!==_0x5cea32(0x3bf));let _0x47174d=_0x5cea32(0x2b8);if(this['state']===_0x5cea32(0x3d2))_0xec86f2['textContent']=_0x31838c?_0x5cea32(0x379):_0x5cea32(0x2c2),_0xec86f2[_0x5cea32(0x205)]='badge\x20state\x20work',_0x47174d=_0x5cea32(0x3c1);else{if(this[_0x5cea32(0x1a3)]==='break')_0xec86f2['textContent']=_0x5cea32(0x200),_0xec86f2[_0x5cea32(0x205)]=_0x5cea32(0x394),_0x47174d='var(--warn)';else{if(this[_0x5cea32(0x1a3)]===_0x5cea32(0x2bd))_0xec86f2['textContent']='NGHỈ\x20DÀI',_0xec86f2[_0x5cea32(0x205)]=_0x5cea32(0x40a),_0x47174d=_0x5cea32(0x22e);else{if(this['state']==='wind_down'){_0xec86f2[_0x5cea32(0x1ee)]=_0x5cea32(0x2e5),_0xec86f2['className']=_0x5cea32(0x45d),_0x47174d='var(--acc-2)';try{$('#windDownChecklist')[_0x5cea32(0x322)][_0x5cea32(0x330)](_0x5cea32(0x2da)),$(_0x5cea32(0x2d3))[_0x5cea32(0x322)][_0x5cea32(0x330)](_0x5cea32(0x2da));}catch(_0x57a492){}}else this['state']==='paused'?(_0xec86f2[_0x5cea32(0x1ee)]=_0x5cea32(0x489),_0xec86f2['className']=_0x5cea32(0x1e9)):(_0xec86f2[_0x5cea32(0x1ee)]='SẴN\x20SÀNG',_0xec86f2[_0x5cea32(0x205)]=_0x5cea32(0x1e9));}}}[_0x5cea32(0x3d2),_0x5cea32(0x21e),_0x5cea32(0x2bd),'wind_down'][_0x5cea32(0x2d7)](this['state'])?_0x29e5c6[_0x5cea32(0x322)][_0x5cea32(0x28c)](_0x5cea32(0x3b6)):_0x29e5c6['classList'][_0x5cea32(0x330)](_0x5cea32(0x3b6));_0x34596a[_0x5cea32(0x2f6)][_0x5cea32(0x27f)]=_0x47174d,_0x29e5c6[_0x5cea32(0x322)]['remove'](_0x5cea32(0x2ec));const _0x9a5a3e=$(_0x5cea32(0x243));if(_0x9a5a3e)_0x9a5a3e[_0x5cea32(0x1ee)]=formatMMSS(this[_0x5cea32(0x32e)]);const _0x3e6e1c=_0x34596a['r'][_0x5cea32(0x351)]['value'],_0x56860a=0x2*Math['PI']*_0x3e6e1c,_0x40d4f8=this[_0x5cea32(0x385)]>0x0?_0x56860a-this[_0x5cea32(0x32e)]/this[_0x5cea32(0x385)]*_0x56860a:_0x56860a;_0x34596a[_0x5cea32(0x2f6)]['strokeDasharray']=_0x56860a,_0x34596a[_0x5cea32(0x2f6)][_0x5cea32(0x38c)]=isNaN(_0x40d4f8)?_0x56860a:_0x40d4f8;const _0x50d907=$(_0x5cea32(0x314));if(_0x50d907){const _0x271365=this['currentConfig']();_0x50d907['textContent']=t(_0x5cea32(0x1e7),{'current':this[_0x5cea32(0x2a4)],'target':_0x271365[_0x5cea32(0x411)]}),_0x50d907['classList'][_0x5cea32(0x261)](_0x5cea32(0x2da),_0x31838c);}const _0xc404e5=$('#breakSuggestionDisplay');_0xc404e5&&_0xc404e5['classList']['toggle'](_0x5cea32(0x2da),_0x31838c&&this[_0x5cea32(0x1a3)]===_0x5cea32(0x3d2));const _0x1db30f=$(_0x5cea32(0x265));if(_0x1db30f)_0x1db30f[_0x5cea32(0x1ee)]=formatMMSS(this[_0x5cea32(0x32e)]);if(this[_0x5cea32(0x1a3)]!==_0x5cea32(0x312))try{$('#windDownChecklist')['classList']['add'](_0x5cea32(0x2da)),$(_0x5cea32(0x2d3))[_0x5cea32(0x322)]['add'](_0x5cea32(0x2da));}catch(_0x2ff170){}},'persistTimerState'(_0x24d26e=![]){const _0x569f83=_0x1318bc;try{const _0x2f47fd=getCurrentSubtopic();if(!_0x2f47fd)return;const _0x4a370f={'state':this[_0x569f83(0x1a3)],'prevState':this[_0x569f83(0x2b3)],'remaining':this['remaining'],'segmentTotal':this[_0x569f83(0x385)],'cycleIndex':this[_0x569f83(0x2a4)]};_0x2f47fd[_0x569f83(0x3e3)]=_0x4a370f;try{localStorage['setItem'](_0x569f83(0x35a)+_0x2f47fd['id'],JSON[_0x569f83(0x484)](_0x4a370f));}catch(_0x38c019){}this['lastPersist']=Date[_0x569f83(0x429)]();}catch(_0x13d248){}},'_startTick'(){const _0x67f0c1=_0x1318bc;if(this[_0x67f0c1(0x38e)])clearInterval(this[_0x67f0c1(0x38e)]);if(this['mode']==='C'&&this[_0x67f0c1(0x1a3)]==='work'){this[_0x67f0c1(0x38e)]=setInterval(()=>{const _0x4755c8=_0x67f0c1;this['remaining']+=0x1,this[_0x4755c8(0x33a)](),this[_0x4755c8(0x1e4)]();},0x3e8);return;}this[_0x67f0c1(0x38e)]=setInterval(()=>{const _0x348fca=_0x67f0c1;this[_0x348fca(0x32e)]>0x0&&(this[_0x348fca(0x32e)]-=0x1,this[_0x348fca(0x33a)](),this[_0x348fca(0x1e4)]()),this[_0x348fca(0x32e)]<=0x0&&(clearInterval(this[_0x348fca(0x38e)]),this[_0x348fca(0x38e)]=null,this['_onFinishSegment']());},0x3e8);},'_onFinishSegment'(){const _0x45e636=_0x1318bc;if(this['state']===_0x45e636(0x3d2)){const _0x50bb6a=getCurrentSubtopic();if(_0x50bb6a){const _0x1ae5f6=this[_0x45e636(0x1f1)]()[_0x45e636(0x3d2)];_0x50bb6a[_0x45e636(0x49b)][_0x45e636(0x4b5)]=(_0x50bb6a['stats'][_0x45e636(0x4b5)]||0x0)+_0x1ae5f6,_0x50bb6a[_0x45e636(0x49b)][_0x45e636(0x211)]=(_0x50bb6a[_0x45e636(0x49b)]['sessionsCompleted']||0x0)+0x1;const _0x52ad90={'id':uid(_0x45e636(0x34e)),'dateISO':todayISO(),'durationMinutes':_0x1ae5f6,'mode':this[_0x45e636(0x3c9)],'note':''};if(!_0x50bb6a['sessions'])_0x50bb6a[_0x45e636(0x23e)]=[];_0x50bb6a[_0x45e636(0x23e)]['unshift'](_0x52ad90);if(data?.[_0x45e636(0x218)]?.[_0x45e636(0x1f8)]!==![])try{openNoteModal(_0x52ad90['id']);}catch(_0x1e3cda){}saveData(),renderStatsHistory(),checkAndShowMilestones();}this[_0x45e636(0x2a4)]++;}if(typeof data!==_0x45e636(0x448)&&data&&data[_0x45e636(0x218)]&&data[_0x45e636(0x218)][_0x45e636(0x28a)]===![]&&this['state']==='work')playSound(_0x45e636(0x4a4));else(this[_0x45e636(0x1a3)]===_0x45e636(0x312)||this[_0x45e636(0x1a3)]===_0x45e636(0x21e)||this[_0x45e636(0x1a3)]==='long_break')&&playSound(_0x45e636(0x402));const _0x67d3b4=$(_0x45e636(0x2ac));if(_0x67d3b4)_0x67d3b4[_0x45e636(0x322)][_0x45e636(0x28c)]('finished');if(data[_0x45e636(0x218)]['autoStartNext']){if(this[_0x45e636(0x1a3)]===_0x45e636(0x3d2))data[_0x45e636(0x218)][_0x45e636(0x28a)]===![]?this[_0x45e636(0x36c)]():this[_0x45e636(0x19c)]();else this['state']==='wind_down'?this['beginBreak']():this[_0x45e636(0x3e4)]();}else this[_0x45e636(0x38e)]&&(clearInterval(this[_0x45e636(0x38e)]),this[_0x45e636(0x38e)]=null),this[_0x45e636(0x1a3)]=_0x45e636(0x1d7),this['prevState']=null,this['updateUI'](),toast(_0x45e636(0x37e));},'beginWindDown'(){const _0x1b1e5c=_0x1318bc;if(data?.['settings']?.[_0x1b1e5c(0x28a)]===![]){this['beginBreak']();return;}this[_0x1b1e5c(0x2b3)]=this['state'],this['state']=_0x1b1e5c(0x312);const _0x4baa0d=(this[_0x1b1e5c(0x1f1)]()[_0x1b1e5c(0x49c)]||0x0)*0x3c;if(_0x4baa0d<=0x0){this[_0x1b1e5c(0x36c)]();return;}this[_0x1b1e5c(0x385)]=_0x4baa0d,this['remaining']=_0x4baa0d;try{playSound(_0x1b1e5c(0x402));}catch(_0x29514a){}try{toast('Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.');}catch(_0x41c572){}this[_0x1b1e5c(0x22f)](),this[_0x1b1e5c(0x33a)]();},'beginWork'(){const _0x4cbdfd=_0x1318bc;this[_0x4cbdfd(0x2b3)]=this[_0x4cbdfd(0x1a3)],this['state']=_0x4cbdfd(0x3d2);if(this[_0x4cbdfd(0x3c9)]==='C'){this[_0x4cbdfd(0x385)]=0x0;if(this[_0x4cbdfd(0x2b3)]!==_0x4cbdfd(0x3bf))this[_0x4cbdfd(0x32e)]=0x0;}else{const _0x1d5e45=this['currentDurations']()[_0x4cbdfd(0x3d2)]*0x3c;this['segmentTotal']=_0x1d5e45;if(this[_0x4cbdfd(0x2b3)]!=='paused')this[_0x4cbdfd(0x32e)]=_0x1d5e45;}const _0x1513bd=$(_0x4cbdfd(0x376));_0x1513bd&&(_0x1513bd[_0x4cbdfd(0x1ee)]=''),this[_0x4cbdfd(0x22f)](),this[_0x4cbdfd(0x33a)]();},'finishFlowSession'(){const _0x48392f=_0x1318bc;if(this[_0x48392f(0x3c9)]!=='C'||this['state']!==_0x48392f(0x3d2))return;this[_0x48392f(0x38e)]&&(clearInterval(this[_0x48392f(0x38e)]),this[_0x48392f(0x38e)]=null);const _0x5af27f=Math[_0x48392f(0x380)](0x1,parseInt(data[_0x48392f(0x218)][_0x48392f(0x458)]??0x5,0xa)),_0x5982e0=Math[_0x48392f(0x380)](0x0,this['remaining']|0x0),_0x2cc7fd=Math[_0x48392f(0x380)](0x3c,Math[_0x48392f(0x208)](_0x5982e0/_0x5af27f));try{const _0x44ba86=getCurrentSubtopic();if(_0x44ba86){const _0x37a40e=Math['max'](0x1,Math[_0x48392f(0x388)](_0x5982e0/0x3c));_0x44ba86['stats'][_0x48392f(0x4b5)]=(_0x44ba86[_0x48392f(0x49b)][_0x48392f(0x4b5)]||0x0)+_0x37a40e,_0x44ba86['stats'][_0x48392f(0x211)]=(_0x44ba86[_0x48392f(0x49b)][_0x48392f(0x211)]||0x0)+0x1;const _0x3c2b17={'id':uid(_0x48392f(0x34e)),'dateISO':todayISO(),'durationMinutes':_0x37a40e,'mode':this['mode'],'note':''};if(!_0x44ba86['sessions'])_0x44ba86[_0x48392f(0x23e)]=[];_0x44ba86[_0x48392f(0x23e)][_0x48392f(0x455)](_0x3c2b17),saveData(),renderStatsHistory(),data?.[_0x48392f(0x218)]?.[_0x48392f(0x1f8)]!==![]&&openNoteModal(_0x3c2b17['id']);}}catch(_0x3ba9aa){}this['state']=_0x48392f(0x21e),this[_0x48392f(0x385)]=_0x2cc7fd,this[_0x48392f(0x32e)]=_0x2cc7fd,this['_startTick'](),this[_0x48392f(0x33a)](),this['persistTimerState'](!![]);try{toast('Nghỉ\x20'+Math[_0x48392f(0x388)](_0x2cc7fd/0x3c)+_0x48392f(0x454)+_0x5af27f+').');}catch(_0x47c21b){}},'beginBreak'(){const _0x10e9b3=_0x1318bc;this[_0x10e9b3(0x2b3)]=this[_0x10e9b3(0x1a3)];const _0xfb6b7d=this[_0x10e9b3(0x3b7)](),_0x3e8e9e=this['currentDurations']();if(this[_0x10e9b3(0x2a4)]>0x0&&this[_0x10e9b3(0x2a4)]%_0xfb6b7d[_0x10e9b3(0x19e)]===0x0){this[_0x10e9b3(0x1a3)]=_0x10e9b3(0x2bd);const _0x38d0be=_0x3e8e9e[_0x10e9b3(0x447)]*0x3c;this[_0x10e9b3(0x385)]=_0x38d0be;if(this[_0x10e9b3(0x2b3)]!==_0x10e9b3(0x3bf))this[_0x10e9b3(0x32e)]=_0x38d0be;toast('Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.');}else{this['state']=_0x10e9b3(0x21e);const _0xe8ebc6=_0x3e8e9e[_0x10e9b3(0x4a6)]*0x3c;this[_0x10e9b3(0x385)]=_0xe8ebc6;if(this[_0x10e9b3(0x2b3)]!==_0x10e9b3(0x3bf))this[_0x10e9b3(0x32e)]=_0xe8ebc6;}const _0x420b3d=$('#breakSuggestionDisplay');if(_0x420b3d){const _0x189178=Math['floor'](Math[_0x10e9b3(0x40b)]()*breakSuggestions[_0x10e9b3(0x469)]);_0x420b3d[_0x10e9b3(0x1ee)]=_0x10e9b3(0x2c1)+breakSuggestions[_0x189178];}this[_0x10e9b3(0x22f)](),this['updateUI']();},async 'start'(){const _0x3ed1c7=_0x1318bc;if(!getCurrentSubtopic()){toast(_0x3ed1c7(0x19b));return;}ensureAudio();if(this[_0x3ed1c7(0x3c9)]==='C'&&this[_0x3ed1c7(0x1a3)]===_0x3ed1c7(0x1d7))this[_0x3ed1c7(0x1a3)]=_0x3ed1c7(0x3d2),this[_0x3ed1c7(0x32e)]=0x0,this[_0x3ed1c7(0x385)]=0x0,this[_0x3ed1c7(0x2a4)]=0x0,this['_startTick'](),this[_0x3ed1c7(0x33a)]();else{if(this[_0x3ed1c7(0x1a3)]===_0x3ed1c7(0x1d7))this[_0x3ed1c7(0x2a4)]=this[_0x3ed1c7(0x2a4)]||0x0,this[_0x3ed1c7(0x3e4)]();else this[_0x3ed1c7(0x1a3)]===_0x3ed1c7(0x3bf)&&this[_0x3ed1c7(0x363)]();}await this['persistTimerState'](!![]);},async 'pause'(){const _0x47220a=_0x1318bc;this['tickHandle']&&(clearInterval(this[_0x47220a(0x38e)]),this[_0x47220a(0x38e)]=null),this['prevState']=this[_0x47220a(0x1a3)],this['state']=_0x47220a(0x3bf),this[_0x47220a(0x33a)](),await this['persistTimerState'](!![]);},async 'resume'(){const _0x392d2d=_0x1318bc;if(this['state']!==_0x392d2d(0x3bf))return;this[_0x392d2d(0x1a3)]=this[_0x392d2d(0x2b3)]||_0x392d2d(0x3d2),this[_0x392d2d(0x22f)](),this[_0x392d2d(0x33a)](),await this[_0x392d2d(0x1e4)](!![]);},async 'skip'(){const _0x4fc6ac=_0x1318bc;if(this[_0x4fc6ac(0x3c9)]==='C'&&this[_0x4fc6ac(0x1a3)]===_0x4fc6ac(0x3d2)){this[_0x4fc6ac(0x327)](),await this[_0x4fc6ac(0x1e4)](!![]);return;}this[_0x4fc6ac(0x1a3)]===_0x4fc6ac(0x3d2)?(this[_0x4fc6ac(0x38e)]&&(clearInterval(this[_0x4fc6ac(0x38e)]),this[_0x4fc6ac(0x38e)]=null),this['remaining']=0x0,this[_0x4fc6ac(0x332)]()):(this[_0x4fc6ac(0x32e)]=0x0,this[_0x4fc6ac(0x38e)]&&(clearInterval(this[_0x4fc6ac(0x38e)]),this['tickHandle']=null),this['_onFinishSegment']()),await this[_0x4fc6ac(0x1e4)](!![]);},async 'reset'(){const _0x500a34=_0x1318bc;this[_0x500a34(0x38e)]&&(clearInterval(this[_0x500a34(0x38e)]),this['tickHandle']=null);this['state']=_0x500a34(0x1d7),this['prevState']=null,this[_0x500a34(0x32e)]=0x0,this['segmentTotal']=0x0,this[_0x500a34(0x2a4)]=0x0;const _0x1be6b7=$(_0x500a34(0x376));_0x1be6b7&&(_0x1be6b7[_0x500a34(0x1ee)]=''),this[_0x500a34(0x33a)](),await this[_0x500a34(0x1e4)](!![]);}};async function deleteSummary(_0x486630){const _0x12e67c=_0x1318bc;showConfirmModal(_0x12e67c(0x3a8),_0x12e67c(0x2c3),async _0x964845=>{const _0x478f98=_0x12e67c;if(!_0x964845)return;const _0x4b8cd8=getCurrentSubtopic();if(!_0x4b8cd8||!_0x4b8cd8[_0x478f98(0x3f8)])return;const _0x54529d=[..._0x4b8cd8['summaries']];_0x4b8cd8[_0x478f98(0x3f8)]=_0x4b8cd8[_0x478f98(0x3f8)]['filter'](_0x3c1a7d=>_0x3c1a7d['id']!==_0x486630);try{await storageManager[_0x478f98(0x428)](_0x478f98(0x2ea),_0x4b8cd8),renderSummaries(),toast(_0x478f98(0x222));}catch(_0x20edbe){console[_0x478f98(0x40f)]('Failed\x20to\x20delete\x20summary:',_0x20edbe),_0x4b8cd8['summaries']=_0x54529d,toast('Không\x20thể\x20lưu\x20thay\x20đổi.');}});}function exportSummary(_0x542ccf){const _0x311b45=_0x1318bc,_0x3d0315=new Blob([_0x542ccf['content']],{'type':'text/plain'}),_0x25d001=document[_0x311b45(0x334)]('a'),_0x3b7d0d=new Date(_0x542ccf['createdAt']),_0x1317f9=_0x59f443=>(''+_0x59f443)[_0x311b45(0x2b6)](0x2,'0');_0x25d001[_0x311b45(0x1b6)]=URL[_0x311b45(0x445)](_0x3d0315),_0x25d001[_0x311b45(0x2f7)]='summary_'+_0x3b7d0d[_0x311b45(0x37c)]()+_0x1317f9(_0x3b7d0d['getMonth']()+0x1)+_0x1317f9(_0x3b7d0d[_0x311b45(0x45a)]())+'.txt',_0x25d001[_0x311b45(0x21b)](),URL[_0x311b45(0x291)](_0x25d001[_0x311b45(0x1b6)]);}function renderStatsHistory(){const _0x43839d=_0x1318bc,_0x22947f=getCurrentSubtopic(),_0x56e7aa=$('#statTotal'),_0x3c389f=$(_0x43839d(0x1b0)),_0x6fc278=$(_0x43839d(0x2c7)),_0x1601dd=$(_0x43839d(0x462));if(!_0x56e7aa||!_0x3c389f||!_0x6fc278||!_0x1601dd)return;if(!_0x22947f){_0x56e7aa[_0x43839d(0x1ee)]=_0x43839d(0x4a2),_0x3c389f[_0x43839d(0x1ee)]='0',_0x6fc278[_0x43839d(0x1ee)]='0',_0x1601dd[_0x43839d(0x2e8)]=_0x43839d(0x282);return;}const _0x46d1bc=_0x22947f[_0x43839d(0x49b)]&&_0x22947f[_0x43839d(0x49b)][_0x43839d(0x4b5)]?_0x22947f[_0x43839d(0x49b)]['totalMinutes']:0x0,_0x645079=_0x22947f[_0x43839d(0x49b)]&&_0x22947f['stats'][_0x43839d(0x211)]?_0x22947f['stats'][_0x43839d(0x211)]:0x0,_0x19cc1d=_0x22947f[_0x43839d(0x1f7)]?_0x22947f[_0x43839d(0x1f7)][_0x43839d(0x1be)](_0x3beb75=>_0x3beb75['isCompleted'])['length']:0x0;_0x56e7aa[_0x43839d(0x1ee)]=formatDaysHoursMinutes(_0x46d1bc),_0x3c389f['textContent']=String(_0x645079),_0x6fc278[_0x43839d(0x1ee)]=String(_0x19cc1d),_0x1601dd[_0x43839d(0x2e8)]='';const _0x1f8f96=Array[_0x43839d(0x366)](_0x22947f['sessions'])?_0x22947f[_0x43839d(0x23e)]:[];if(_0x1f8f96['length']===0x0){_0x1601dd[_0x43839d(0x2e8)]=_0x43839d(0x216);return;}_0x1f8f96['forEach'](_0x4319be=>{const _0x3b77a6=_0x43839d,_0x32c76f=document[_0x3b77a6(0x334)](_0x3b77a6(0x250));_0x32c76f[_0x3b77a6(0x205)]='hist-item';const _0x464b11=document[_0x3b77a6(0x334)](_0x3b77a6(0x250)),_0x1728e3=_0x4319be[_0x3b77a6(0x2fb)]?new Date(_0x4319be[_0x3b77a6(0x2fb)]):new Date(),_0x4b3a6d=_0x4319be['durationMinutes']!=null?_0x4319be['durationMinutes']:_0x4319be[_0x3b77a6(0x213)]||0x0,_0x41a155=_0x3b77a6(0x2e2)+_0x1728e3['toLocaleString']()+_0x3b77a6(0x37a)+_0x4b3a6d+'\x27\x20·\x20Mode\x20'+(_0x4319be[_0x3b77a6(0x3c9)]||'')+'</div>';let _0x4fd4e4='';if(_0x4319be[_0x3b77a6(0x4ad)])_0x4fd4e4=_0x3b77a6(0x471)+escapeHTML(_0x4319be['note'])+'</div>';else data?.[_0x3b77a6(0x218)]?.[_0x3b77a6(0x1f8)]!==![]&&(_0x4fd4e4='<div><span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span></div>');_0x464b11[_0x3b77a6(0x2e8)]=_0x41a155+_0x4fd4e4,_0x32c76f[_0x3b77a6(0x27e)](_0x464b11),_0x1601dd[_0x3b77a6(0x27e)](_0x32c76f);});}function renderGeneralNotes(){const _0x40c6a3=_0x1318bc,_0x49e051=$(_0x40c6a3(0x1fc));if(!_0x49e051)return;const _0x53f584=getCurrentSubtopic();if(!_0x53f584){_0x49e051[_0x40c6a3(0x2e8)]=_0x40c6a3(0x46b);return;}_0x53f584[_0x40c6a3(0x281)]=_0x53f584[_0x40c6a3(0x281)]||[];if(_0x53f584[_0x40c6a3(0x281)][_0x40c6a3(0x469)]===0x0){_0x49e051['innerHTML']=_0x40c6a3(0x488);return;}_0x49e051['innerHTML']='',_0x53f584[_0x40c6a3(0x281)][_0x40c6a3(0x395)](_0x53e1f7=>{const _0x4c37fb=_0x40c6a3,_0xf62301=document[_0x4c37fb(0x334)](_0x4c37fb(0x250));_0xf62301[_0x4c37fb(0x205)]=_0x4c37fb(0x219);const _0x34f41a=document[_0x4c37fb(0x334)]('div');_0x34f41a[_0x4c37fb(0x205)]='note-content',_0x34f41a['textContent']=typeof _0x53e1f7===_0x4c37fb(0x31b)?_0x53e1f7:_0x53e1f7[_0x4c37fb(0x1bb)]||'';const _0x3bb09d=document[_0x4c37fb(0x334)](_0x4c37fb(0x250));_0x3bb09d['className']=_0x4c37fb(0x362),_0x3bb09d['textContent']=_0x53e1f7[_0x4c37fb(0x2d0)]?new Date(_0x53e1f7[_0x4c37fb(0x2d0)])[_0x4c37fb(0x1d9)]():'';const _0x1af121=document[_0x4c37fb(0x334)](_0x4c37fb(0x250)),_0x1adb9d=document['createElement']('button');_0x1adb9d[_0x4c37fb(0x205)]=_0x4c37fb(0x273),_0x1adb9d[_0x4c37fb(0x1ee)]=_0x4c37fb(0x241),_0x1adb9d[_0x4c37fb(0x2dc)]=async _0x1dfe4e=>{const _0x32a959=_0x4c37fb;_0x1dfe4e[_0x32a959(0x44a)]();const _0x2e79c3=getCurrentSubtopic();if(!_0x2e79c3)return;_0x2e79c3['generalNotes']=(_0x2e79c3[_0x32a959(0x281)]||[])['filter'](_0x441bca=>(_0x441bca['id']||_0x441bca)!==(_0x53e1f7['id']||_0x53e1f7)),await saveData(),renderGeneralNotes();},_0x1af121[_0x4c37fb(0x27e)](_0x1adb9d);const _0x3a94b1=document[_0x4c37fb(0x334)]('div');_0x3a94b1[_0x4c37fb(0x205)]='note-content-wrapper',_0x3a94b1['append'](_0x34f41a,_0x3bb09d),_0xf62301[_0x4c37fb(0x2f4)](_0x3a94b1,_0x1af121),_0x49e051['appendChild'](_0xf62301);});}function renderMethods(){const _0xd1236d=_0x1318bc,_0x28616f=document[_0xd1236d(0x3f3)](_0xd1236d(0x390));if(!_0x28616f)return;_0x28616f[_0xd1236d(0x2e8)]='';const _0x5d67b5=data?.[_0xd1236d(0x218)]?.[_0xd1236d(0x307)]||[];if(_0x5d67b5[_0xd1236d(0x469)]===0x0){_0x28616f['innerHTML']=_0xd1236d(0x3d7);return;}_0x5d67b5['forEach'](_0xe197d1=>{const _0x2e6968=_0xd1236d,_0x56a355=document[_0x2e6968(0x334)](_0x2e6968(0x2e6));_0x56a355[_0x2e6968(0x205)]='method-item',_0x56a355[_0x2e6968(0x3db)][_0x2e6968(0x29d)]=_0xe197d1['id'];const _0x45c2d3=document[_0x2e6968(0x334)]('summary'),_0x10ef48=document[_0x2e6968(0x334)](_0x2e6968(0x254));_0x10ef48['className']=_0x2e6968(0x352),_0x10ef48[_0x2e6968(0x1ee)]=_0xe197d1['title']||_0x2e6968(0x43d),_0x10ef48[_0x2e6968(0x2b2)](_0x2e6968(0x21b),_0x425e55=>{const _0x40ae8c=_0x2e6968;_0x425e55[_0x40ae8c(0x494)](),_0x425e55[_0x40ae8c(0x44a)](),_0x56a355[_0x40ae8c(0x353)]=!_0x56a355[_0x40ae8c(0x353)];});const _0x26675c=document['createElement'](_0x2e6968(0x250));_0x26675c[_0x2e6968(0x205)]='topic-actions';const _0x4f0eb9=document['createElement'](_0x2e6968(0x32a));_0x4f0eb9[_0x2e6968(0x205)]='btn\x20small\x20ghost\x20method-edit',_0x4f0eb9[_0x2e6968(0x1ee)]=_0x2e6968(0x2d6),_0x4f0eb9[_0x2e6968(0x3db)]['id']=_0xe197d1['id'];const _0x180b1c=document['createElement'](_0x2e6968(0x32a));_0x180b1c[_0x2e6968(0x205)]='btn\x20small\x20danger\x20method-delete',_0x180b1c['textContent']=_0x2e6968(0x241),_0x180b1c[_0x2e6968(0x3db)]['id']=_0xe197d1['id'],_0x26675c[_0x2e6968(0x2f4)](_0x4f0eb9,_0x180b1c),_0x45c2d3['append'](_0x10ef48,_0x26675c);const _0x4ac8d9=document[_0x2e6968(0x334)](_0x2e6968(0x250));_0x4ac8d9['className']=_0x2e6968(0x1ba),_0x4ac8d9['innerHTML']=_0xe197d1['content']||'',_0x56a355[_0x2e6968(0x2f4)](_0x45c2d3,_0x4ac8d9),_0x28616f[_0x2e6968(0x27e)](_0x56a355),_0x56a355['addEventListener'](_0x2e6968(0x21b),_0x226ba5=>{const _0x427e3a=_0x2e6968,_0x1677eb=_0x226ba5['target'];if(!_0x1677eb)return;if(_0x1677eb[_0x427e3a(0x1c2)](_0x427e3a(0x32a))||_0x1677eb['closest']('a')||_0x1677eb['closest'](_0x427e3a(0x3c3))||_0x1677eb[_0x427e3a(0x1c2)](_0x427e3a(0x4b2)))return;if(!_0x56a355['open'])_0x56a355[_0x427e3a(0x353)]=!![];});});const _0x148beb=_0x28616f[_0xd1236d(0x32c)]('.method-item');_0x148beb[_0xd1236d(0x395)](_0x205865=>{const _0x2ea142=_0xd1236d;_0x205865['addEventListener'](_0x2ea142(0x261),()=>{const _0x50660b=_0x2ea142;_0x205865[_0x50660b(0x353)]&&_0x148beb[_0x50660b(0x395)](_0xfe56e5=>{const _0x19248a=_0x50660b;if(_0xfe56e5!==_0x205865)_0xfe56e5[_0x19248a(0x353)]=![];});});});}function addGeneralNote(){const _0x5e7dd3=_0x1318bc;showInputModal(_0x5e7dd3(0x284),async _0x188bb2=>{const _0x173f8b=_0x5e7dd3;if(!_0x188bb2)return;const _0x22bc01=getCurrentSubtopic();if(!_0x22bc01){toast(_0x173f8b(0x466));return;}_0x22bc01[_0x173f8b(0x281)]=_0x22bc01[_0x173f8b(0x281)]||[],_0x22bc01[_0x173f8b(0x281)][_0x173f8b(0x455)]({'id':uid('gn'),'text':_0x188bb2,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0x18c68d=_0x1318bc,_0x5e7ca2=getCurrentSubtopic();if(!_0x5e7ca2){toast(_0x18c68d(0x43c));return;}const _0x42f255=(_0x5e7ca2[_0x18c68d(0x281)]||[])[_0x18c68d(0x43e)](_0xbc92a5=>typeof _0xbc92a5===_0x18c68d(0x31b)?_0xbc92a5:_0xbc92a5[_0x18c68d(0x1bb)]||'')[_0x18c68d(0x1be)](Boolean);if(_0x42f255[_0x18c68d(0x469)]===0x0){toast(_0x18c68d(0x426));return;}const _0x3d0ad9=$('#btnSummarize');_0x3d0ad9&&(_0x3d0ad9[_0x18c68d(0x36f)]=!![],_0x3d0ad9[_0x18c68d(0x2e8)]='<div\x20class=\x22spinner\x22></div>');try{const _0x3e6b4b=_0x18c68d(0x272)+_0x42f255['join'](_0x18c68d(0x4a7)),_0x3f0d45=await callGeminiAPI(_0x3e6b4b);if(!_0x5e7ca2[_0x18c68d(0x3f8)])_0x5e7ca2[_0x18c68d(0x3f8)]=[];_0x5e7ca2[_0x18c68d(0x3f8)]['unshift']({'id':uid(_0x18c68d(0x377)),'content':_0x3f0d45||'(Không\x20tạo\x20được\x20tóm\x20tắt)','createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x3fbc12){console[_0x18c68d(0x40f)](_0x3fbc12),toast(_0x18c68d(0x29e));}finally{_0x3d0ad9&&(_0x3d0ad9[_0x18c68d(0x36f)]=![],_0x3d0ad9['textContent']=_0x18c68d(0x358));}}function renderSummaries(){const _0x3f92fb=_0x1318bc,_0x53aee3=$(_0x3f92fb(0x374));if(!_0x53aee3)return;const _0x235a36=getCurrentSubtopic();if(!_0x235a36){_0x53aee3['innerHTML']='<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>';return;}_0x53aee3[_0x3f92fb(0x2e8)]='';if(!_0x235a36[_0x3f92fb(0x3f8)]||_0x235a36['summaries'][_0x3f92fb(0x469)]===0x0){_0x53aee3[_0x3f92fb(0x2e8)]=_0x3f92fb(0x2ed);return;}_0x235a36[_0x3f92fb(0x3f8)][_0x3f92fb(0x395)](_0x1daac6=>{const _0x470e62=_0x3f92fb,_0x1230d9=document[_0x470e62(0x334)](_0x470e62(0x250));_0x1230d9['className']=_0x470e62(0x219);const _0x2da917=document[_0x470e62(0x334)](_0x470e62(0x250));_0x2da917[_0x470e62(0x205)]=_0x470e62(0x28f);const _0x17fdcc=document[_0x470e62(0x334)](_0x470e62(0x250));_0x17fdcc['className']=_0x470e62(0x3d3),_0x17fdcc[_0x470e62(0x1ee)]=_0x1daac6['content'];const _0xe75731=document[_0x470e62(0x334)](_0x470e62(0x250));_0xe75731[_0x470e62(0x205)]=_0x470e62(0x362),_0xe75731['textContent']=new Date(_0x1daac6[_0x470e62(0x2d0)])[_0x470e62(0x1d9)](),_0x2da917['append'](_0x17fdcc,_0xe75731);const _0x128b1c=document['createElement'](_0x470e62(0x250)),_0x5bbf06=document[_0x470e62(0x334)]('button');_0x5bbf06[_0x470e62(0x205)]=_0x470e62(0x37d),_0x5bbf06[_0x470e62(0x1ee)]=_0x470e62(0x3fc),_0x5bbf06[_0x470e62(0x2dc)]=_0x4748f2=>{const _0x5944f0=_0x470e62;_0x4748f2[_0x5944f0(0x44a)](),exportSummary(_0x1daac6);};const _0x359d96=document[_0x470e62(0x334)](_0x470e62(0x32a));_0x359d96[_0x470e62(0x205)]=_0x470e62(0x273),_0x359d96['textContent']=_0x470e62(0x241),_0x359d96[_0x470e62(0x2dc)]=_0x2db49e=>{const _0x15baec=_0x470e62;_0x2db49e[_0x15baec(0x44a)](),deleteSummary(_0x1daac6['id']);},_0x128b1c['append'](_0x5bbf06,_0x359d96),_0x1230d9[_0x470e62(0x2f4)](_0x2da917,_0x128b1c),_0x1230d9['addEventListener'](_0x470e62(0x21b),()=>_0x17fdcc['classList']['toggle'](_0x470e62(0x416))),_0x53aee3['appendChild'](_0x1230d9);});}function loadEditingPresetFields(){const _0x10ed37=_0x1318bc,_0x463ca0=data[_0x10ed37(0x218)],_0x377ef1=_0x463ca0[_0x10ed37(0x25d)],_0x34ad0b=$(_0x10ed37(0x1a7)),_0x32bd4d=$(_0x10ed37(0x259));if(_0x34ad0b&&_0x32bd4d){const _0x979bc7=editingPreset==='C';_0x34ad0b['classList'][_0x10ed37(0x261)]('hidden',_0x979bc7),_0x32bd4d[_0x10ed37(0x322)][_0x10ed37(0x261)]('hidden',!_0x979bc7);}if(editingPreset==='A'){$(_0x10ed37(0x419))[_0x10ed37(0x470)]=_0x377ef1['A_work'];if($(_0x10ed37(0x3a7)))$('#set_winddown')['value']=_0x377ef1[_0x10ed37(0x337)]??0x0;$(_0x10ed37(0x42d))[_0x10ed37(0x470)]=_0x377ef1[_0x10ed37(0x1a2)],$(_0x10ed37(0x42f))[_0x10ed37(0x470)]=_0x377ef1['A_long'],$(_0x10ed37(0x4b1))[_0x10ed37(0x470)]=_0x463ca0[_0x10ed37(0x309)],$(_0x10ed37(0x3f7))[_0x10ed37(0x470)]=_0x463ca0[_0x10ed37(0x308)];}else{if(editingPreset==='B'){$(_0x10ed37(0x419))[_0x10ed37(0x470)]=_0x377ef1['B_work'];if($(_0x10ed37(0x3a7)))$(_0x10ed37(0x3a7))[_0x10ed37(0x470)]=_0x377ef1[_0x10ed37(0x1dd)]??0x0;$(_0x10ed37(0x42d))[_0x10ed37(0x470)]=_0x377ef1[_0x10ed37(0x412)],$(_0x10ed37(0x42f))['value']=_0x377ef1[_0x10ed37(0x42a)],$(_0x10ed37(0x4b1))[_0x10ed37(0x470)]=_0x463ca0[_0x10ed37(0x31d)],$(_0x10ed37(0x3f7))[_0x10ed37(0x470)]=_0x463ca0[_0x10ed37(0x311)];}else{if(editingPreset==='C'){const _0x2c0c1c=$(_0x10ed37(0x457));if(_0x2c0c1c)_0x2c0c1c[_0x10ed37(0x470)]=_0x463ca0['flowtimeBreakRatio']??0x5;}}}}function highlightPresetSelector(){const _0x2f9fe0=_0x1318bc;$$(_0x2f9fe0(0x3f4))[_0x2f9fe0(0x395)](_0x5ef730=>{const _0x57c975=_0x2f9fe0,_0x2bb519=_0x5ef730[_0x57c975(0x3db)][_0x57c975(0x410)]===editingPreset;_0x5ef730[_0x57c975(0x322)][_0x57c975(0x261)]('acc',_0x2bb519),_0x5ef730['classList'][_0x57c975(0x261)](_0x57c975(0x1af),!_0x2bb519);});}function openSettings(){const _0x499749=_0x1318bc,_0x17ac56=data['settings'];editingPreset=_0x17ac56[_0x499749(0x3e0)],$(_0x499749(0x256))[_0x499749(0x470)]=_0x17ac56['apiKey']||'',loadEditingPresetFields(),highlightPresetSelector(),$(_0x499749(0x20e))[_0x499749(0x470)]=_0x17ac56[_0x499749(0x3b8)]??0.8,$('#set_theme')[_0x499749(0x470)]=_0x17ac56[_0x499749(0x3ef)]||_0x499749(0x1ce),$(_0x499749(0x298))[_0x499749(0x470)]=_0x17ac56[_0x499749(0x373)]||_0x499749(0x26f);const _0x10663c=getActiveYoutubeUrl();$(_0x499749(0x20f))[_0x499749(0x470)]=_0x10663c||'';const _0x367ea2=extractYouTubeID(_0x10663c);$(_0x499749(0x20c))[_0x499749(0x36f)]=!_0x367ea2;$('#ytUrlFeedback')&&($(_0x499749(0x2a3))['textContent']='');$(_0x499749(0x262))[_0x499749(0x470)]=_0x17ac56['youtubeVolume']||0x50,$(_0x499749(0x1f2))[_0x499749(0x46a)]=!!_0x17ac56['useYtThumbnailAsBg'],$(_0x499749(0x1fb))['value']=_0x17ac56[_0x499749(0x2bc)]||0.85;$(_0x499749(0x304))&&($(_0x499749(0x304))[_0x499749(0x470)]=_0x17ac56['backgroundMode']||_0x499749(0x3f5));$(_0x499749(0x204))&&($(_0x499749(0x204))[_0x499749(0x46a)]=!!_0x17ac56[_0x499749(0x19a)]);$(_0x499749(0x38d))&&($('#set_enableWinddown')[_0x499749(0x46a)]=_0x17ac56[_0x499749(0x28a)]!==![]);$('#set_enableSessionNotes')&&($(_0x499749(0x280))[_0x499749(0x46a)]=_0x17ac56[_0x499749(0x1f8)]!==![]);$(_0x499749(0x1e6))&&($(_0x499749(0x1e6))[_0x499749(0x470)]=_0x17ac56['backupDaysToKeep']||0x7);const _0x4ed53b=$(_0x499749(0x1c7));_0x4ed53b&&storageManager[_0x499749(0x1c5)]()['then'](_0x490df1=>{const _0x1930cf=_0x499749;_0x4ed53b[_0x1930cf(0x2e8)]=_0x1930cf(0x46d),_0x490df1&&_0x490df1[_0x1930cf(0x469)]>0x0?_0x490df1[_0x1930cf(0x395)](_0x48658d=>{const _0x2b408d=_0x1930cf,_0x3d685e=document[_0x2b408d(0x334)](_0x2b408d(0x32f));_0x3d685e[_0x2b408d(0x470)]=_0x48658d[_0x2b408d(0x480)],_0x3d685e['textContent']=_0x2b408d(0x27d)+new Date(_0x48658d[_0x2b408d(0x480)])[_0x2b408d(0x1c6)](_0x2b408d(0x2b1)),_0x4ed53b[_0x2b408d(0x27e)](_0x3d685e);}):_0x4ed53b[_0x1930cf(0x2e8)]=_0x1930cf(0x19d);});$(_0x499749(0x479))[_0x499749(0x322)]['add'](_0x499749(0x393));try{trapFocus($(_0x499749(0x479)));}catch(_0x4f4a7c){}}function closeSettings(){const _0x48525a=_0x1318bc;$('#modalSettings')[_0x48525a(0x322)][_0x48525a(0x330)](_0x48525a(0x393));try{releaseFocus();}catch(_0x2e001f){}}async function setDefaults(){const _0x44f649=_0x1318bc;data[_0x44f649(0x218)][_0x44f649(0x25d)]={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data[_0x44f649(0x218)][_0x44f649(0x309)]=0x4,data['settings'][_0x44f649(0x308)]=0x4,data[_0x44f649(0x218)][_0x44f649(0x31d)]=0x4,data[_0x44f649(0x218)][_0x44f649(0x311)]=0x4,data[_0x44f649(0x218)][_0x44f649(0x458)]=0x5,data['settings'][_0x44f649(0x3e0)]='A',data[_0x44f649(0x218)][_0x44f649(0x3b8)]=0.8,data[_0x44f649(0x218)][_0x44f649(0x3ef)]='beep',await saveData(),openSettings(),toast(_0x44f649(0x381));}function _0x293e(){const _0xae765=['files','#view-','#btnAddMethod','<strong>$1</strong>','string','target','cyclesB','topic-title','1820300YBvoph','#methodEditorTitle','Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.','classList','parse','width','Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.','contains','finishFlowSession','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.','backupDaysToKeep','button','.nav-btn[data-view]','querySelectorAll','url(','remaining','option','remove','insertOrderedList','_onFinishSegment','Xác\x20nhận\x20phục\x20hồi','createElement','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>','#noteText','A_winddown','exitFullscreen','\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22','updateUI','play','...','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.','\x20(B)','useYtThumbnailAsBg','customSounds','Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','Lỗi\x20khởi\x20tạo:\x20','getSettings','toLowerCase','readonly','autoplay;\x20encrypted-media;\x20picture-in-picture','</ol>','Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.','.app-content','ArrowUp','Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.','<i>$1</i>','Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.','sess','Failed\x20to\x20save\x20data:','Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.','baseVal','method-title','open','5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.','#btnSummarizeNote','parentElement','flex','Tóm\x20tắt','Đang\x20tải\x20API\x20YouTube...','timerState_','&lt;','splice','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','exportData','setAttribute','opacity','subtopic','note-meta','resume','start','data:','isArray','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','<ol>','#btnGenericOk','#btnDefaults','beginBreak','reverse','setRangeText','disabled','absolute','https://www.youtube.com','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.','theme','#summariesList','var(--acc-2)','#breakSuggestionDisplay','sum','#btnEnableSound','LÀM\x20VIỆC\x20(FLOW)','\x20·\x20','contentWindow','getFullYear','btn\x20small','Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.','scrollTop','max','Đã\x20khôi\x20phục\x20mặc\x20định','#btnSettings','Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.','onerror','segmentTotal','Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','getVolume','round','objectStoreNames','#btnClearBg','pointerdown','strokeDashoffset','#set_enableWinddown','tickHandle','offsetWidth','#view-methods\x20.methods-container','#methodEditorId','postMessage','show','badge\x20state\x20break','forEach','abs','cleanupOldBackups','newIndex','frequency','skip','select','stopVideo','#btnSkip','clientY','backups','lastBackupDate','.actions-menu.show','ArrowRight','Player','right','input','bg-view-mode','#set_winddown','Xác\x20nhận\x20xóa','function','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','auto','tagName','</td><td>','iframe','keydown','message','data','selectedTopicId','<ul>','setValueAtTime','Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.','breathing','currentConfig','volume','webkitAudioContext','sort','sine','promptFeedback','tasksCompleted','Tên\x20Chủ\x20đề\x20mới?','paused','\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]','var(--acc)','\x20phút','.color-picker-wrapper','topic-header','status','catch','img.youtube.com/vi/','offsetHeight','mode','<div\x20class=\x22spinner\x22></div>','#modalGeneric','#selectedContext','#toolItalic','createObjectStore','PlayerState','actions-menu','result','work','note-content','Nhập\x20thất\x20bại:\x20','foreColor','Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20được\x20thêm\x20vào.</p>','Đã\x20chuyển\x20sang\x20Kiểu\x20','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','item','dataset','menu-active','documentElement','youtube-player-container','#btnPause','preset','main_settings','ENDED','timerState','beginWork','toISOString','100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.','getElementById','textarea','mute','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.','file:','#btnToggleCustomSounds','Gemini\x20API\x20Error:','soundTheme','trim','menu-item\x20danger','oldIndex','querySelector','#timerPresetSelector\x20button','cover','#stateBadge','#set_interval','summaries','\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22','#btnExport','Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.','Xuất','BUFFERING','.subtopic-btn','#toolBold','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','#uploadSoundWork','break_end','POST','change','sub-row','tid','timer.selectSubtopicPrompt','#uploadSoundLong','soundPermissionBar','badge\x20state\x20long','random','name','match','resolve','error','presetTarget','cycles','B_short','IndexedDB\x20error:','reloading','removeEventListener','expanded','\x20tiếng\x20','content','#set_work','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','1368410MwiWZF','####\x20','.json','.method-delete','location','B_work','http:','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','async','onYouTubeIframeAPIReady','focus','Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.','btn\x20subtopic-btn','update','now','B_long','createIndex','Lỗi\x20khi\x20gọi\x20Gemini\x20API:','#set_short','push','#set_long','mousemove','defer','onload','410898dMsyPv','#uploadBg','reset','btnToggleYtSound','Space','#btnCancelMethodEditor','<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>','transition','setVolume','Chọn\x20chủ\x20đề\x20con\x20trước.','Chưa\x20có\x20tiêu\x20đề','map','<h4>','onsuccess','#btnFullscreen','command','?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.','#editorPreview','createObjectURL','selectedSubtopicId','long','undefined','slice','stopPropagation','Đang\x20phát\x20nhạc\x20nền...','IndexedDB\x20initialized\x20successfully.','loadLanguage','actions','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.','script','Enter','#chatMessages','localeCompare','\x20phút\x20theo\x20Flowtime\x20(','unshift','chatHistory','#set_flowRatio','flowtimeBreakRatio','\x20hidden','getDate','fullscreenElement','log','badge\x20state\x20work','Chỉnh-sửa\x20Tri\x20thức','block','Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.','allow','#historyList','Đổi\x20tên\x20Chủ\x20đề','Đã\x20dừng\x20nhạc\x20nền.','Thêm\x20Tri\x20thức\x20mới','Chọn\x20một\x20chủ\x20đề\x20con\x20trước.','#genericInput','customBg','length','checked','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>','currentView','<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>','Thoát\x20toàn\x20màn\x20hình','Deleted\x20old\x20backup:\x20','value','<div>','Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.','.color-swatch','readwrite','Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.','altKey','<tr><td>','Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','#modalSettings','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','input,select,textarea','set_youtubeUrl','#audioLongEnd','menu-item','topic-item','date','.timer-circle-progress','Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!','tab','stringify','space','/maxresdefault.jpg','#audioBreakEnd','<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>','TẠM\x20DỪNG','triangle','autoBackup','isCompleted','setPreset','beforeunload','findIndex','#toolColor','AI\x20đã\x20định\x20dạng\x20xong!','backgroundRepeat','</tbody></table>','preventDefault','then','statusText','Toàn\x20màn\x20hình','Nội\x20dung\x20bị\x20chặn\x20vì:\x20','load','Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.','stats','winddown','.aux-panel,\x20.modal-card','pauseVideo','Missing\x20element','all','Đổi\x20tên\x20Chủ\x20đề\x20con','0\x20phút','playVideo','work_end','lofi','short','\x0a-\x20','removing','.modal','getPlayerState','</li>','Lỗi\x20lưu\x20dữ\x20liệu:\x20','note','user','&amp;','task','#set_cycles','.color-palette','youtubeVolume','replace','totalMinutes','#view-timer','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','.subtopics','#methodEditorContentInput','requestFullscreen','#toolH4','autoStartNext','Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu','beginWindDown','<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>','interval','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>','about:blank','#btnSkipNote','A_short','state','#btnGenericCancel','1177430hsWWHf','no-repeat','#settings-pomodoro','-9999px','model','\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','#btnSendMessage','styleWithCSS','#toasts','#btnSaveSettings','ghost','#statSessions','79011tFKsDt','Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','min','values','#subtopicTasksList','href','Initialization\x20error:','long_end','#btnAutoFormat','method-content','text','no-subtopic-selected','indexOf','filter','cyclesTarget','light','Thêm\x20tùy\x20chọn','closest','AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.','_sortable','getBackupList','toLocaleDateString','#backupList','errorCode','key','role','Lỗi\x20HTTP:\x20','Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.','gain','beep','#modalDashboard','italic','<input\x20type=\x22checkbox\x22\x20id=\x22','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.','Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','pastel','5450228lopIik','<span\x20class=\x22ico\x22>▾</span>','idle','backgroundMode','toLocaleString','getIframe','hours','aria-expanded','B_winddown','#customSoundsContainer','.topic-item','head','Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','Chưa\x20chọn\x20Chủ\x20đề\x20con','connect','persistTimerState','Sửa\x20tên\x20Chủ\x20đề\x20con','#set_backupDays','timer.cycleInfo','#modalMethodEditor','badge','Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.','pomodoroData_v11','apiKey','textContent','warn','onkeydown','currentDurations','#set_ytThumbAsBg','startsWith','#newSubtopicTaskInput','#set_theme','<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>','tasks','enableSessionNotes','pause','#btnAddSubtopicTask','#set_panelOpacity','#generalNotesList','#chatInput','Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.','pomodoro_backup_','NGHỈ\x20NGẮN','updateSettings','removeProperty','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','#set_autoStartNext','className','innerHeight','button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])','floor','exponentialRampToValueAtTime','✨\x20Tự\x20động\x20định\x20dạng','#methodEditorTitleInput','#btnToggleYtSound','stop','#set_volume','#set_youtubeUrl','title','sessionsCompleted','display','workMinutes','#aiPromptSuggestions\x20button','Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>','Tệp\x20không\x20đúng\x20định\x20dạng','settings','note-item','Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.','click','__ytApiWatchdog','activeElement','break','#milestoneTitle','<li>','Failed\x20to\x20load\x20YouTube\x20API','Đã\x20xóa\x20tóm\x20tắt.','save','removeChild','isNaN','timer','#btnHelpCreateTopic','Sửa\x20tên\x20Chủ\x20đề','bottom','toString','transaction','topicId','blob:','var(--danger)','_startTick','left','createOscillator','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=','insertUnorderedList','collapsedTopics','A_long','.nav-btn[data-view=\x22','aria-pressed','backgroundImage','blockReason','#btnCloseDashboard','cueVideoById','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.','#uploadSoundBreak','sessions','achievedMilestones','Lỗi\x20từ\x20Gemini:\x20','Xóa','#btnStart','#timeDisplay','Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20','pomodoro_files','get','by_topic','#modalNote','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','onupgradeneeded','none','Đã\x20lưu\x20ghi\x20chú','API\x20response\x20structure\x20is\x20unexpected:','#btnSaveNote','getAll','div','height','.sub-row','＋\x20Thêm','span','8QopRPf','#set_apiKey','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','relative','#settings-flowtime','delete','objectStore','6UEgiVI','durations','1EfOWdt','.tab-btn','\x20(A)','toggle','#ytSoundVolume','không\x20rõ','ArrowLeft','#draggableTimer','reload','json','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','fullscreenchange','<p>','top','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','#dashboardContent','getItem','default','__ytApiPromise','_getStore','Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a','btn\x20small\x20danger','version','#modalMilestone','code','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.','chime','Sortable','cancel','Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','#btnResume','Bản\x20sao\x20lưu\x20ngày:\x20','appendChild','stroke','#set_enableSessionNotes','generalNotes','<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>','sound_unlocked','Thêm\x20ghi\x20chú','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','https://img.youtube.com/vi/','application/json','getBoundingClientRect','#btnMilestoneClose','enableWinddown','restoreBackup','add','scrollHeight','protocol','note-content-wrapper','parts','revokeObjectURL','Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.','toast','Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.','topics','ytUrlFeedback','view','#set_theme_color','flatMap','#welcomePanel','sid','&gt;','methodId','Tóm\x20tắt\x20thất\x20bại.','DB_NAME','btn\x20small\x20ghost\x20actions-menu-btn','--bg-image','AutoBackup\x20error:','#ytUrlFeedback','cycleIndex','put','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','#genericTitle','http','#audioWorkEnd','topicsList','Backup\x20failed:','.timer-circle-container','Chủ\x20đề\x20con:\x20','linearRampToValueAtTime','<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>','#view-methods\x20.method-item','vi-VN','addEventListener','prevState','clear','AudioContext','padStart','setProperty','var(--muted)','Xóa\x20Chủ\x20đề\x20con','Hiện\x20giao\x20diện','initDB','panelOpacity','long_break','setItem','body','Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.','💡\x20Gợi\x20ý:\x20','LÀM\x20VIỆC','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?','#btnDashboard','A_work','#btnSaveMethod','#statTasks','Xóa\x20Chủ\x20đề','Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.','substring','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>','unMute','prompt','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>','object','createdAt','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22','Đã\x20cập\x20nhật\x20hình\x20nền.','#btnBreakEarly','src','origin','Sửa','includes','Creating\x20backup\x20for\x20','Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','hidden','--panel-opacity','onclick','</td></tr>','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','.view','.actions-menu-btn','lang','<div\x20class=\x22hist-meta\x22>','shiftKey','subtopics-group','HẠ\x20NHIỆT','details','reduce','innerHTML','Lỗi\x20phát\x20âm\x20thanh:','subtopics','execCommand','finished','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','bold','active','#btnTestSound','candidates','test','#btnClearChat','append','oncomplete','style','download','Lỗi:\x20','Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.','\x20|\x20<strong>Tổng\x20phiên:</strong>\x20','dateISO','selectionEnd','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','color','#btnReset','#btnFinishFlow','PLAYING','🌊\x20Flow','.actions-menu','#set_backgroundMode','14439340NLRfhU','Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','methods','longBreakIntervalA','cyclesA','#btnToggleBg','createGain','&quot;','find','Chu\x20kỳ\x20','from','Escape','longBreakIntervalB','wind_down','mouseup','#cycleInfo','?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.','position'];_0x293e=function(){return _0xae765;};return _0x293e();}async function saveSettings(){const _0x22125f=_0x1318bc,_0x3822b8=data[_0x22125f(0x218)];_0x3822b8[_0x22125f(0x1ed)]=$(_0x22125f(0x256))['value'][_0x22125f(0x3f0)]();const _0x54040c=_0x3822b8[_0x22125f(0x25d)];if(editingPreset==='A')_0x54040c['A_work']=clampInt($('#set_work')['value'],0x1,0x3e7),_0x54040c[_0x22125f(0x337)]=clampInt($(_0x22125f(0x3a7))[_0x22125f(0x470)],0x0,0x3e7),_0x54040c[_0x22125f(0x1a2)]=clampInt($(_0x22125f(0x42d))[_0x22125f(0x470)],0x1,0x3e7),_0x54040c['A_long']=clampInt($(_0x22125f(0x42f))[_0x22125f(0x470)],0x1,0x3e7),_0x3822b8['cyclesA']=clampInt($('#set_cycles')['value'],0x1,0xc),_0x3822b8[_0x22125f(0x308)]=clampInt($('#set_interval')[_0x22125f(0x470)],0x2,0xc);else{if(editingPreset==='B')_0x54040c[_0x22125f(0x420)]=clampInt($(_0x22125f(0x419))[_0x22125f(0x470)],0x1,0x3e7),_0x54040c[_0x22125f(0x1dd)]=clampInt($(_0x22125f(0x3a7))[_0x22125f(0x470)],0x0,0x3e7),_0x54040c[_0x22125f(0x412)]=clampInt($(_0x22125f(0x42d))[_0x22125f(0x470)],0x1,0x3e7),_0x54040c['B_long']=clampInt($('#set_long')[_0x22125f(0x470)],0x1,0x3e7),_0x3822b8[_0x22125f(0x31d)]=clampInt($(_0x22125f(0x4b1))['value'],0x1,0xc),_0x3822b8[_0x22125f(0x311)]=clampInt($(_0x22125f(0x3f7))['value'],0x2,0xc);else{if(editingPreset==='C'){const _0x3871d7=$(_0x22125f(0x457));if(_0x3871d7)_0x3822b8[_0x22125f(0x458)]=clampInt(_0x3871d7[_0x22125f(0x470)],0x1,0x14);}}}_0x3822b8[_0x22125f(0x3b8)]=clampFloat($(_0x22125f(0x20e))[_0x22125f(0x470)],0x0,0x1,0.8),_0x3822b8['soundTheme']=$(_0x22125f(0x1f5))['value']==='chime'?_0x22125f(0x278):_0x22125f(0x1ce),_0x3822b8[_0x22125f(0x373)]=$(_0x22125f(0x298))['value'],_0x3822b8[_0x22125f(0x2bc)]=parseFloat($('#set_panelOpacity')[_0x22125f(0x470)])||0.85;$(_0x22125f(0x304))&&(_0x3822b8[_0x22125f(0x1d8)]=$(_0x22125f(0x304))['value']);_0x3822b8[_0x22125f(0x19a)]=!!($(_0x22125f(0x204))&&$(_0x22125f(0x204))[_0x22125f(0x46a)]),_0x3822b8[_0x22125f(0x28a)]=!!($('#set_enableWinddown')&&$(_0x22125f(0x38d))[_0x22125f(0x46a)]),_0x3822b8[_0x22125f(0x1f8)]=!!($(_0x22125f(0x280))&&$(_0x22125f(0x280))[_0x22125f(0x46a)]);$('#set_backupDays')&&(_0x3822b8[_0x22125f(0x329)]=clampInt($(_0x22125f(0x1e6))[_0x22125f(0x470)],0x1,0x1e));_0x3822b8[_0x22125f(0x373)]==='light'||_0x3822b8[_0x22125f(0x373)]===_0x22125f(0x1d4)?(_0x3822b8[_0x22125f(0x33f)]=![],typeof _0x3822b8[_0x22125f(0x468)]===_0x22125f(0x31b)&&_0x3822b8[_0x22125f(0x468)][_0x22125f(0x2d7)](_0x22125f(0x3c7))&&(_0x3822b8[_0x22125f(0x468)]='')):_0x3822b8[_0x22125f(0x33f)]=!![];const _0x69ea9f=$(_0x22125f(0x20f))[_0x22125f(0x470)][_0x22125f(0x3f0)]();_0x3822b8[_0x22125f(0x33f)]=$('#set_ytThumbAsBg')[_0x22125f(0x46a)],_0x3822b8[_0x22125f(0x4b3)]=parseInt($(_0x22125f(0x262))[_0x22125f(0x470)],0xa),sessionYoutubeUrl=_0x69ea9f;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer[_0x22125f(0x43b)])ytPlayer[_0x22125f(0x43b)](_0x3822b8[_0x22125f(0x4b3)]);}else try{fallbackPostMessage(_0x22125f(0x43b),[_0x3822b8['youtubeVolume']]);}catch(_0x48cfb7){}}catch(_0x551eaa){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x22125f(0x48d)](_0x3822b8[_0x22125f(0x3e0)],{'silent':!![]}),closeSettings(),toast('Đã\x20lưu\x20cài\x20đặt');}function clampInt(_0x736b3b,_0x78ef18,_0x4ef2c3){const _0x3a0117=_0x1318bc;_0x736b3b=parseInt(_0x736b3b||0x0,0xa);if(isNaN(_0x736b3b))_0x736b3b=_0x78ef18;return Math[_0x3a0117(0x380)](_0x78ef18,Math[_0x3a0117(0x1b3)](_0x4ef2c3,_0x736b3b));}function clampFloat(_0x421918,_0x597d14,_0x348f39,_0x280f44){const _0x3d1573=_0x1318bc;_0x421918=parseFloat(_0x421918);if(Number[_0x3d1573(0x225)](_0x421918))_0x421918=_0x280f44;return Math[_0x3d1573(0x380)](_0x597d14,Math[_0x3d1573(0x1b3)](_0x348f39,_0x421918));}const dbPromise=new Promise((_0x41ab3e,_0x3709a1)=>{const _0x4b8417=_0x1318bc,_0x35b54e=indexedDB[_0x4b8417(0x353)](_0x4b8417(0x245),0x1);_0x35b54e[_0x4b8417(0x24a)]=_0x32a092=>_0x32a092['target'][_0x4b8417(0x3d1)][_0x4b8417(0x3ce)]('files'),_0x35b54e[_0x4b8417(0x440)]=_0x1c6bd5=>_0x41ab3e(_0x1c6bd5[_0x4b8417(0x31c)][_0x4b8417(0x3d1)]),_0x35b54e[_0x4b8417(0x384)]=_0x53a47a=>_0x3709a1(_0x53a47a);}),fileCache={};function handleFileUpload(_0x4cacc4,_0x2cd261){const _0x34b6c4=_0x1318bc;if(!_0x4cacc4)return;dbPromise[_0x34b6c4(0x495)](_0x34f2ee=>{const _0x4a3924=_0x34b6c4,_0x1899c3=uid('file'),_0xbdccac=_0x34f2ee['transaction'](_0x4a3924(0x317),_0x4a3924(0x474));_0xbdccac[_0x4a3924(0x25b)](_0x4a3924(0x317))[_0x4a3924(0x2a5)](_0x4cacc4,_0x1899c3),_0xbdccac[_0x4a3924(0x2f5)]=()=>_0x2cd261(_0x1899c3),_0xbdccac['onerror']=()=>toast('Lỗi\x20lưu\x20file.');});}function getStoredFileUrl(_0x52f300){const _0x1bc92f=_0x1318bc;if(!_0x52f300)return Promise[_0x1bc92f(0x40e)]('');if(fileCache[_0x52f300])return Promise['resolve'](fileCache[_0x52f300]);return dbPromise['then'](_0x4f50e4=>new Promise(_0x1aa6ac=>{const _0x1dbd6d=_0x1bc92f,_0x9a0938=_0x4f50e4[_0x1dbd6d(0x22b)](_0x1dbd6d(0x317),_0x1dbd6d(0x345)),_0x315f37=_0x9a0938['objectStore']('files')[_0x1dbd6d(0x246)](_0x52f300);_0x315f37['onsuccess']=_0x4a93cd=>{const _0x1dacf6=_0x1dbd6d,_0x3fd2b7=_0x4a93cd[_0x1dacf6(0x31c)][_0x1dacf6(0x3d1)];if(_0x3fd2b7){const _0x1cb515=URL['createObjectURL'](_0x3fd2b7);fileCache[_0x52f300]=_0x1cb515,_0x1aa6ac(_0x1cb515);}else _0x1aa6ac('');},_0x315f37[_0x1dbd6d(0x384)]=()=>_0x1aa6ac('');}));}function applyCustomBg(){const _0x56e883=_0x1318bc,_0x232081=data[_0x56e883(0x218)],_0x545a1c=_0x232081[_0x56e883(0x468)],_0x25d20a=_0x232081[_0x56e883(0x373)],_0x27aa2b=[_0x56e883(0x4a5),_0x56e883(0x485)]['includes'](_0x25d20a),_0x461a7b=_0x25d20a===_0x56e883(0x1c0)||_0x25d20a===_0x56e883(0x1d4),_0x5e5ff3=_0x232081['backgroundMode']||_0x56e883(0x3f5);document[_0x56e883(0x2bf)][_0x56e883(0x2f6)]['backgroundSize']=_0x5e5ff3,document[_0x56e883(0x2bf)]['style'][_0x56e883(0x492)]=_0x5e5ff3===_0x56e883(0x3ab)?'repeat':_0x56e883(0x1a6);const _0xa3aa81=()=>{const _0x48cc76=_0x56e883;try{document[_0x48cc76(0x2bf)][_0x48cc76(0x2f6)][_0x48cc76(0x238)]='';}catch(_0x2dff79){}};if(_0x545a1c){const _0x3c13a6=_0x545a1c[_0x56e883(0x1f3)](_0x56e883(0x365))||_0x545a1c[_0x56e883(0x1f3)](_0x56e883(0x2a8))||_0x545a1c[_0x56e883(0x1f3)](_0x56e883(0x22d))?Promise[_0x56e883(0x40e)](_0x545a1c):getStoredFileUrl(_0x545a1c);_0x3c13a6[_0x56e883(0x495)](_0x344202=>{const _0x2eb50e=_0x56e883;_0x344202?document[_0x2eb50e(0x2bf)][_0x2eb50e(0x2f6)][_0x2eb50e(0x2b7)](_0x2eb50e(0x2a1),_0x2eb50e(0x32d)+_0x344202+')'):document['body'][_0x2eb50e(0x2f6)][_0x2eb50e(0x2b7)](_0x2eb50e(0x2a1),_0x461a7b?_0x2eb50e(0x24b):''),_0xa3aa81();});}else!_0x27aa2b?_0x461a7b?(document[_0x56e883(0x2bf)][_0x56e883(0x2f6)]['setProperty'](_0x56e883(0x2a1),_0x56e883(0x24b)),_0xa3aa81()):document[_0x56e883(0x2bf)][_0x56e883(0x2f6)]['setProperty'](_0x56e883(0x2a1),_0x56e883(0x422)):(document[_0x56e883(0x2bf)][_0x56e883(0x2f6)][_0x56e883(0x202)]('--bg-image'),_0xa3aa81());}function applyPanelOpacity(){const _0x4174aa=_0x1318bc;document[_0x4174aa(0x3dd)][_0x4174aa(0x2f6)][_0x4174aa(0x2b7)](_0x4174aa(0x2db),data[_0x4174aa(0x218)][_0x4174aa(0x2bc)]);}function renderDashboard(){const _0x455cef=_0x1318bc,_0x2c7c3d=data[_0x455cef(0x295)][_0x455cef(0x299)](_0x215449=>_0x215449['subtopics'][_0x455cef(0x43e)](_0x30ffe1=>({'topic':_0x215449[_0x455cef(0x40c)],'subtopic':_0x30ffe1[_0x455cef(0x40c)],'m':_0x30ffe1[_0x455cef(0x49b)]['totalMinutes']||0x0,'c':_0x30ffe1[_0x455cef(0x49b)][_0x455cef(0x211)]||0x0,'t':_0x30ffe1[_0x455cef(0x49b)][_0x455cef(0x3bd)]||0x0}))),_0x77c1d2=_0x2c7c3d[_0x455cef(0x2e7)]((_0x2fdb85,_0x47aa56)=>_0x2fdb85+_0x47aa56['m'],0x0),_0x51741f=_0x2c7c3d[_0x455cef(0x2e7)]((_0xa76737,_0x216029)=>_0xa76737+_0x216029['c'],0x0),_0x3f1106=_0x2c7c3d[_0x455cef(0x2e7)]((_0x1c9a6d,_0x2ec1e0)=>_0x1c9a6d+_0x2ec1e0['t'],0x0);let _0x3ab579='<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20'+formatDaysHoursMinutes(_0x77c1d2)+_0x455cef(0x2fa)+_0x51741f+_0x455cef(0x203)+_0x3f1106+_0x455cef(0x2ce);_0x2c7c3d[_0x455cef(0x395)](_0x35cd3f=>{const _0x202520=_0x455cef;_0x3ab579+=_0x202520(0x477)+escapeHTML(_0x35cd3f['topic'])+_0x202520(0x3ad)+escapeHTML(_0x35cd3f[_0x202520(0x361)])+_0x202520(0x3ad)+formatDaysHoursMinutes(_0x35cd3f['m'])+_0x202520(0x3ad)+_0x35cd3f['c']+_0x202520(0x3ad)+_0x35cd3f['t']+_0x202520(0x2dd);}),_0x3ab579+=_0x455cef(0x493);const _0x5ad297=$(_0x455cef(0x26d));if(_0x5ad297)_0x5ad297['innerHTML']=_0x3ab579;}function getMilestones(){const _0x5392d2=_0x1318bc;return[{'hours':0x5,'title':_0x5392d2(0x1ea),'message':_0x5392d2(0x482)},{'hours':0x14,'title':_0x5392d2(0x2a6),'message':_0x5392d2(0x21a)},{'hours':0x32,'title':_0x5392d2(0x27b),'message':'50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.'},{'hours':0x64,'title':_0x5392d2(0x386),'message':_0x5392d2(0x3e6)},{'hours':0xfa,'title':'Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','message':_0x5392d2(0x3ea)},{'hours':0x1f4,'title':_0x5392d2(0x478),'message':'Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.'},{'hours':0x3e8,'title':_0x5392d2(0x215),'message':_0x5392d2(0x3b5)},{'hours':0x1388,'title':_0x5392d2(0x2d9),'message':_0x5392d2(0x354)}][_0x5392d2(0x3ba)]((_0x4f5f16,_0x348259)=>_0x348259[_0x5392d2(0x1db)]-_0x4f5f16['hours']);}async function checkAndShowMilestones(){const _0x2aca3e=_0x1318bc;if(!data||!data[_0x2aca3e(0x218)])return;if(!Array['isArray'](data['settings'][_0x2aca3e(0x23f)]))data[_0x2aca3e(0x218)]['achievedMilestones']=[];const _0x2049ef=data[_0x2aca3e(0x295)][_0x2aca3e(0x2e7)]((_0x8809dc,_0x3d5336)=>{const _0x5531ad=_0x2aca3e;return _0x8809dc+_0x3d5336['subtopics'][_0x5531ad(0x2e7)]((_0x24e033,_0x1f4988)=>{const _0x222ea4=_0x5531ad;return _0x24e033+(_0x1f4988['stats'][_0x222ea4(0x4b5)]||0x0);},0x0);},0x0),_0x48668=_0x2049ef/0x3c,_0x3c119b=getMilestones(),_0x11101b=Array[_0x2aca3e(0x366)](data[_0x2aca3e(0x218)]['achievedMilestones'])?data[_0x2aca3e(0x218)][_0x2aca3e(0x23f)]:[],_0x4738f3=_0x3c119b[_0x2aca3e(0x1be)](_0x5a408a=>_0x48668>=_0x5a408a[_0x2aca3e(0x1db)]&&!_0x11101b[_0x2aca3e(0x2d7)](_0x5a408a[_0x2aca3e(0x1db)]));if(_0x4738f3[_0x2aca3e(0x469)]===0x0)return![];const _0x4b6dc8=_0x4738f3[_0x2aca3e(0x2e7)]((_0x5c4b99,_0x2f57bf)=>_0x5c4b99&&_0x5c4b99[_0x2aca3e(0x1db)]>_0x2f57bf[_0x2aca3e(0x1db)]?_0x5c4b99:_0x2f57bf,null);if(!_0x4b6dc8)return![];$(_0x2aca3e(0x21f))[_0x2aca3e(0x1ee)]=_0x4b6dc8[_0x2aca3e(0x210)],$('#milestoneMessage')['textContent']=_0x4b6dc8['message'],$(_0x2aca3e(0x275))['classList'][_0x2aca3e(0x28c)](_0x2aca3e(0x393));try{trapFocus($(_0x2aca3e(0x275)));}catch(_0x1fef0b){}return data[_0x2aca3e(0x218)]['achievedMilestones'][_0x2aca3e(0x42e)](_0x4b6dc8[_0x2aca3e(0x1db)]),await saveData(),!![];}async function seedAchievedMilestones(){const _0x1d8bd6=_0x1318bc;if(!data||!data[_0x1d8bd6(0x218)])return;!Array[_0x1d8bd6(0x366)](data['settings'][_0x1d8bd6(0x23f)])&&(data[_0x1d8bd6(0x218)][_0x1d8bd6(0x23f)]=[],await saveData());}async function handleSendMessage(){const _0x5865fc=_0x1318bc,_0x460417=$(_0x5865fc(0x1ab)),_0x5dc222=$(_0x5865fc(0x1fd)),_0x49f0a0=_0x5dc222['value'][_0x5865fc(0x3f0)](),_0x3b2a2f=getCurrentSubtopic();if(!_0x49f0a0)return;if(!_0x3b2a2f){toast(t('timer.selectSubtopicPrompt'));return;}_0x5dc222[_0x5865fc(0x470)]='',_0x460417['disabled']=!![],_0x460417[_0x5865fc(0x2e8)]=_0x5865fc(0x3ca),_0x3b2a2f[_0x5865fc(0x456)][_0x5865fc(0x42e)]({'role':_0x5865fc(0x4ae),'text':_0x49f0a0}),renderChat();const _0x4b9605=await callGeminiAPI(_0x49f0a0);_0x4b9605&&(_0x3b2a2f[_0x5865fc(0x456)][_0x5865fc(0x42e)]({'role':_0x5865fc(0x1a9),'text':_0x4b9605}),await saveData(),renderChat()),_0x460417['disabled']=![],_0x460417['innerHTML']='Gửi';}function renderChat(){const _0x1e60ae=_0x1318bc,_0x15e817=getCurrentSubtopic(),_0x5d2228=$(_0x1e60ae(0x452)),_0x1981bf=$(_0x1e60ae(0x1fd)),_0x139004=$(_0x1e60ae(0x1ab));if(!_0x5d2228||!_0x1981bf||!_0x139004)return;if(!_0x15e817){_0x5d2228[_0x1e60ae(0x2e8)]='<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>',_0x1981bf[_0x1e60ae(0x36f)]=!![],_0x139004[_0x1e60ae(0x36f)]=!![];return;}_0x1981bf['disabled']=![],_0x139004[_0x1e60ae(0x36f)]=![],_0x5d2228[_0x1e60ae(0x2e8)]='';if(!_0x15e817[_0x1e60ae(0x456)]||_0x15e817[_0x1e60ae(0x456)][_0x1e60ae(0x469)]===0x0){_0x5d2228[_0x1e60ae(0x2e8)]=_0x1e60ae(0x368);return;}_0x15e817[_0x1e60ae(0x456)][_0x1e60ae(0x395)](_0x39bcb0=>{const _0x4375c6=_0x1e60ae,_0x8004c5=document['createElement'](_0x4375c6(0x250));_0x8004c5['className']='chat-msg\x20'+_0x39bcb0[_0x4375c6(0x1ca)],_0x8004c5[_0x4375c6(0x1ee)]=_0x39bcb0[_0x4375c6(0x1bb)],_0x5d2228['appendChild'](_0x8004c5);}),_0x5d2228[_0x1e60ae(0x37f)]=_0x5d2228[_0x1e60ae(0x28d)];}async function handleSummarizeNote(){const _0x5cbd9e=_0x1318bc,_0x4f4a22=$(_0x5cbd9e(0x355)),_0x26bb10=$(_0x5cbd9e(0x336)),_0x59b133=_0x26bb10[_0x5cbd9e(0x470)][_0x5cbd9e(0x3f0)](),_0x34e628=getCurrentSubtopic();if(!_0x59b133){toast(_0x5cbd9e(0x475));return;}const _0x881fd1=_0x4f4a22[_0x5cbd9e(0x2e8)];_0x4f4a22[_0x5cbd9e(0x2e8)]=_0x5cbd9e(0x3ca),_0x4f4a22[_0x5cbd9e(0x36f)]=!![];const _0x345bc9='Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22'+(_0x34e628?.['name']||_0x5cbd9e(0x263))+_0x5cbd9e(0x339)+_0x59b133+_0x5cbd9e(0x3c0),_0x1033c0=await callGeminiAPI(_0x345bc9);_0x1033c0&&(_0x26bb10[_0x5cbd9e(0x470)]+='\x0a\x0a'+_0x1033c0),_0x4f4a22[_0x5cbd9e(0x2e8)]=_0x881fd1,_0x4f4a22[_0x5cbd9e(0x36f)]=![];}function clearChat(){const _0x2e6222=_0x1318bc,_0x30d439=getCurrentSubtopic();if(!_0x30d439){toast(t(_0x2e6222(0x407)));return;}showConfirmModal('Xác\x20nhận\x20xóa','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?',async _0x8023f2=>{const _0x1e63e5=_0x2e6222;_0x8023f2&&(_0x30d439[_0x1e63e5(0x456)]=[],await saveData(),renderChat(),toast('Đã\x20xóa\x20lịch\x20sử\x20chat.'));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0x347255,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x2e1d53=_0x1318bc,_0x11f19c=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0x347255,'enablejsapi':'1','origin':'https://www.youtube.com'})[_0x2e1d53(0x22a)]();return'https://www.youtube.com/embed/'+_0x347255+'?'+_0x11f19c;}function ensureFallbackFrame(){const _0x8df928=_0x1318bc,_0x49a625=document[_0x8df928(0x3e7)]('youtube-player-container');if(!_0x49a625)return null;if(ytFallbackFrame&&ytFallbackFrame['isConnected'])return ytFallbackFrame;const _0x1de16f=document[_0x8df928(0x334)](_0x8df928(0x3ae));return _0x1de16f['id']='yt-fallback',_0x1de16f[_0x8df928(0x324)]='1',_0x1de16f[_0x8df928(0x251)]='1',_0x1de16f[_0x8df928(0x2f6)]['position']=_0x8df928(0x370),_0x1de16f[_0x8df928(0x2f6)][_0x8df928(0x26b)]=_0x8df928(0x1a8),_0x1de16f[_0x8df928(0x2f6)]['left']=_0x8df928(0x1a8),_0x1de16f['allow']=_0x8df928(0x346),_0x49a625[_0x8df928(0x2e8)]='',_0x49a625['appendChild'](_0x1de16f),ytFallbackFrame=_0x1de16f,_0x1de16f;}function fallbackLoadVideo(_0x3c3629,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0xd31a50=_0x1318bc,_0x599a79=document[_0xd31a50(0x3e7)](_0xd31a50(0x3de));if(!_0x599a79)return;_0x599a79['innerHTML']='';const _0x32f017=document[_0xd31a50(0x334)](_0xd31a50(0x3ae));_0x32f017['id']='yt-fallback',_0x32f017['width']='1',_0x32f017[_0xd31a50(0x251)]='1',_0x32f017['style'][_0xd31a50(0x316)]=_0xd31a50(0x370),_0x32f017[_0xd31a50(0x2f6)][_0xd31a50(0x26b)]=_0xd31a50(0x1a8),_0x32f017[_0xd31a50(0x2f6)][_0xd31a50(0x230)]='-9999px',_0x32f017[_0xd31a50(0x461)]=_0xd31a50(0x346),_0x32f017[_0xd31a50(0x2d4)]=buildFallbackSrc(_0x3c3629,{'autoplay':autoplay,'mute':mute}),_0x599a79[_0xd31a50(0x27e)](_0x32f017),ytFallbackFrame=_0x32f017,ytFallbackIsPlaying=!!autoplay;try{const _0x1dcc71=document[_0xd31a50(0x3e7)](_0xd31a50(0x436));if(_0x1dcc71)_0x1dcc71['textContent']=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0x59bb89){}}function fallbackPostMessage(_0x37f517,_0x2fbc95=[]){const _0xf65e30=_0x1318bc;try{if(!ytFallbackFrame||!ytFallbackFrame[_0xf65e30(0x37b)])return;ytFallbackFrame['contentWindow'][_0xf65e30(0x392)](JSON[_0xf65e30(0x484)]({'event':_0xf65e30(0x442),'func':_0x37f517,'args':_0x2fbc95}),'https://www.youtube.com');}catch(_0x123f95){}}function fallbackPlay(){const _0x1d3505=_0x1318bc;fallbackPostMessage(_0x1d3505(0x4a3));}function fallbackStop(){const _0x4498e0=_0x1318bc;try{ytFallbackFrame&&(ytFallbackFrame[_0x4498e0(0x2d4)]=_0x4498e0(0x1a0),ytFallbackIsPlaying=![]);}catch(_0x4f8149){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){const _0x39a4ff=_0x1318bc;fallbackPostMessage(_0x39a4ff(0x2cc));}function fallbackMute(){const _0x102c9c=_0x1318bc;fallbackPostMessage(_0x102c9c(0x3e9));}window[_0x1318bc(0x424)]=function(){const _0x5e042a=_0x1318bc;if(IS_FILE_PROTOCOL){try{window[_0x5e042a(0x21c)]&&window[_0x5e042a(0x21c)][_0x5e042a(0x27a)]();}catch(_0x53e1af){}return;}const _0x3c72fe={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0x5e042a(0x371)};(window['location'][_0x5e042a(0x28e)]===_0x5e042a(0x421)||window[_0x5e042a(0x41f)][_0x5e042a(0x28e)]==='https:')&&(_0x3c72fe[_0x5e042a(0x2d5)]=window['location']['origin']);ytPlayer=new YT[(_0x5e042a(0x3a3))](_0x5e042a(0x3de),_0x3c72fe);try{window[_0x5e042a(0x21c)]&&window[_0x5e042a(0x21c)][_0x5e042a(0x27a)]();const _0x205d41=document['getElementById'](_0x5e042a(0x296));_0x205d41&&(_0x205d41[_0x5e042a(0x1ee)]='');}catch(_0xea6aea){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x1318bc(0x26e)](_0x1318bc(0x283))==='1';}catch(_0x225dba){}function showSoundPermission(){const _0x2ea8e2=_0x1318bc,_0x2c39ff=document[_0x2ea8e2(0x3e7)](_0x2ea8e2(0x409));if(!_0x2c39ff)return;if(_ytUnlocked){_0x2c39ff[_0x2ea8e2(0x322)][_0x2ea8e2(0x330)](_0x2ea8e2(0x393));return;}_0x2c39ff[_0x2ea8e2(0x322)][_0x2ea8e2(0x28c)](_0x2ea8e2(0x393));}function hideSoundPermission(){const _0x4f32d4=_0x1318bc,_0x21db81=document['getElementById'](_0x4f32d4(0x409));if(!_0x21db81)return;_0x21db81[_0x4f32d4(0x322)][_0x4f32d4(0x330)]('show');}function unlockAudioChain(){const _0x48b3e9=_0x1318bc;try{if(AUDIO_CTX&&typeof AUDIO_CTX[_0x48b3e9(0x363)]===_0x48b3e9(0x3a9))AUDIO_CTX['resume']();}catch(_0x58a710){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer['unMute']&&(ytPlayer['unMute'](),ytPlayer[_0x48b3e9(0x4a3)]());}catch(_0x1159d8){}_ytUnlocked=!![];try{localStorage[_0x48b3e9(0x2be)](_0x48b3e9(0x283),'1');}catch(_0x2a9571){}hideSoundPermission(),toast('Âm\x20thanh\x20đã\x20được\x20bật!');}function onPlayerReady(_0x3028fc){const _0x481fc1=_0x1318bc;try{const _0x302eb8=ytPlayer&&ytPlayer[_0x481fc1(0x1da)]?ytPlayer[_0x481fc1(0x1da)]():null;_0x302eb8&&_0x302eb8[_0x481fc1(0x35f)](_0x481fc1(0x461),_0x481fc1(0x346));}catch(_0x347ab5){}try{if(ytPlayer&&ytPlayer['setVolume'])ytPlayer[_0x481fc1(0x43b)](data&&data[_0x481fc1(0x218)]&&data[_0x481fc1(0x218)]['youtubeVolume']||0x50);}catch(_0x2be9e8){}try{const _0x2eecbf=getActiveVideoId&&getActiveVideoId();if(_0x2eecbf&&ytPlayer&&ytPlayer[_0x481fc1(0x3e9)]&&ytPlayer[_0x481fc1(0x4a3)]){ytPlayer[_0x481fc1(0x3e9)](),ytPlayer[_0x481fc1(0x4a3)](),_ytPrimed=!![];const _0x1153f8=()=>{const _0x177b1d=_0x481fc1;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x1a4f70){}window['removeEventListener'](_0x177b1d(0x38b),_0x1153f8,!![]),window[_0x177b1d(0x415)](_0x177b1d(0x3af),_0x1153f8,!![]);};window['addEventListener'](_0x481fc1(0x38b),_0x1153f8,!![]),window['addEventListener'](_0x481fc1(0x3af),_0x1153f8,!![]),showSoundPermission();}}catch(_0x262b04){}updateYouTubePlayer();}function onPlayerStateChange(_0x5ce175){const _0x43749e=_0x1318bc,_0x5d4a62=$(_0x43749e(0x20c));_0x5ce175['data']==YT[_0x43749e(0x3cf)][_0x43749e(0x301)]?(_0x5d4a62[_0x43749e(0x1ee)]='⏸️',hideSoundPermission()):_0x5d4a62[_0x43749e(0x1ee)]='▶️';if(_0x5ce175['data']===YT[_0x43749e(0x3cf)][_0x43749e(0x3e2)]){if(!ytUserPaused)ytPlayer[_0x43749e(0x4a3)]();}}async function ytFadeTo(_0x412e81,_0x5e1dda=0xfa){const _0x4aeb6a=_0x1318bc;try{if(!ytPlayer||!ytPlayer[_0x4aeb6a(0x387)]||!ytPlayer[_0x4aeb6a(0x43b)])return;ytPlayer[_0x4aeb6a(0x2cc)]();const _0x20fd33=ytPlayer['getVolume'](),_0x1cdd0f=_0x412e81-_0x20fd33;if(Math[_0x4aeb6a(0x396)](_0x1cdd0f)<0x1||_0x5e1dda<=0x0){ytPlayer[_0x4aeb6a(0x43b)](_0x412e81);return;}const _0x7359b=performance[_0x4aeb6a(0x429)]();await new Promise(_0x5c38cd=>{const _0x1a2b3b=_0x41e00d=>{const _0x4ee83d=_0x2a57,_0x5b74bb=Math[_0x4ee83d(0x1b3)](0x1,(_0x41e00d-_0x7359b)/_0x5e1dda),_0x37f97d=Math[_0x4ee83d(0x388)](_0x20fd33+_0x1cdd0f*_0x5b74bb);ytPlayer[_0x4ee83d(0x43b)](_0x37f97d);if(_0x5b74bb<0x1)requestAnimationFrame(_0x1a2b3b);else _0x5c38cd();};requestAnimationFrame(_0x1a2b3b);});}catch(_0x2fe827){}}async function ytFadeInPlay(_0x4cce94=0xdc){const _0x34e40b=_0x1318bc;try{const _0x6e3f61=Math['max'](0x0,Math[_0x34e40b(0x1b3)](0x64,data&&data['settings']&&data['settings']['youtubeVolume']||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer['unMute'](),ytPlayer[_0x34e40b(0x4a3)]();try{ytPlayer['setVolume'](0x0);}catch(_0x3a4b3c){}await ytFadeTo(_0x6e3f61,_0x4cce94);}else{const _0x590b74=getActiveVideoId();_0x590b74&&fallbackLoadVideo(_0x590b74,{'autoplay':0x1,'mute':0x0});}}catch(_0x5f0a2f){}}async function ytFadeOutPause(_0x57f04e=0xb4){const _0x33c95e=_0x1318bc;try{const _0x247f44=Math[_0x33c95e(0x380)](0x0,Math[_0x33c95e(0x1b3)](0x64,data&&data[_0x33c95e(0x218)]&&data[_0x33c95e(0x218)][_0x33c95e(0x4b3)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0x57f04e);try{ytPlayer[_0x33c95e(0x49e)](),ytPlayer[_0x33c95e(0x43b)](_0x247f44);}catch(_0x380b2e){}}else try{fallbackPause();}catch(_0x33f25f){}}catch(_0x30d3a2){}}async function updateYouTubePlayer(){const _0x16cf64=_0x1318bc,_0x2574b1=getActiveVideoId();if(data['settings']['useYtThumbnailAsBg']&&_0x2574b1){const _0x4d7f6c=_0x16cf64(0x286)+_0x2574b1+_0x16cf64(0x486),_0x501ff5=new Image();_0x501ff5[_0x16cf64(0x432)]=async()=>{const _0x4c2ba2=_0x16cf64;data['settings'][_0x4c2ba2(0x468)]=_0x4d7f6c,await saveData(),applyCustomBg();},_0x501ff5[_0x16cf64(0x384)]=async()=>{const _0x2cf9b9=_0x16cf64,_0x2322fa=_0x2cf9b9(0x286)+_0x2574b1+'/hqdefault.jpg';data[_0x2cf9b9(0x218)][_0x2cf9b9(0x468)]=_0x2322fa,await saveData(),applyCustomBg();},_0x501ff5['src']=_0x4d7f6c;}else!_0x2574b1&&(data[_0x16cf64(0x218)][_0x16cf64(0x468)]='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0x2574b1){fallbackStop(),hideSoundPermission();return;}const _0x406497=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x2574b1,{'autoplay':0x1,'mute':_0x406497});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer[_0x16cf64(0x23b)]){try{ensureYouTubeAPI();}catch(_0x599798){}return;}if(!_0x2574b1){if(ytPlayer[_0x16cf64(0x39c)])ytPlayer[_0x16cf64(0x39c)]();hideSoundPermission();return;}ytPlayer[_0x16cf64(0x23b)](_0x2574b1),ytPlayer[_0x16cf64(0x43b)](data[_0x16cf64(0x218)][_0x16cf64(0x4b3)]);}function toggleYtSound(){const _0x586b09=_0x1318bc;if(!_ytUnlocked){try{ensureAudio();}catch(_0x1cd488){}try{unlockAudioChain();}catch(_0x54fb3c){}return;}if(IS_FILE_PROTOCOL){const _0x44e769=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame['isConnected']){if(!_0x44e769){toast(_0x586b09(0x1fe));return;}fallbackLoadVideo(_0x44e769,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x122fda=document['getElementById'](_0x586b09(0x436));if(_0x122fda)_0x122fda[_0x586b09(0x1ee)]='⏸️';}catch(_0x4f1eaa){}toast(_0x586b09(0x44b));return;}if(ytFallbackIsPlaying)fallbackPostMessage(_0x586b09(0x49e)),ytFallbackIsPlaying=![],toast(_0x586b09(0x464));else{if(!_0x44e769){toast('Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶️.');return;}fallbackPostMessage('playVideo'),ytFallbackIsPlaying=!![],toast(_0x586b09(0x44b));}try{const _0x3c427f=document[_0x586b09(0x3e7)](_0x586b09(0x436));if(_0x3c427f)_0x3c427f[_0x586b09(0x1ee)]=ytFallbackIsPlaying?'⏸️':'▶️';}catch(_0xf07e55){}return;}if(!ytPlayer||typeof ytPlayer[_0x586b09(0x4aa)]!==_0x586b09(0x3a9)){try{ensureYouTubeAPI();}catch(_0x4d0080){}return;}const _0xb67e55=ytPlayer['getPlayerState']();_0xb67e55===YT[_0x586b09(0x3cf)][_0x586b09(0x301)]||_0xb67e55===YT[_0x586b09(0x3cf)][_0x586b09(0x3fd)]?(ytFadeOutPause(),ytUserPaused=!![],toast(_0x586b09(0x464))):(ytFadeInPlay(),ytUserPaused=![],toast(_0x586b09(0x44b)));}function bindEvents(){const _0x5e374f=_0x1318bc;try{const _0x41ffb7=document[_0x5e374f(0x3f3)]('#welcomePanel\x20p');_0x41ffb7&&(_0x41ffb7['innerHTML']=_0x5e374f(0x325));}catch(_0xe133e9){}on($(_0x5e374f(0x30a)),_0x5e374f(0x21b),toggleBackgroundView),on($(_0x5e374f(0x289)),_0x5e374f(0x21b),()=>{const _0x964e54=_0x5e374f;$(_0x964e54(0x275))['classList']['remove'](_0x964e54(0x393));try{releaseFocus();}catch(_0x347c25){}}),on($('#btnAddTopic'),'click',()=>showInputModal(_0x5e374f(0x3be),async _0x2b155f=>{const _0x3c2614=_0x5e374f;if(!_0x2b155f)return;data['topics'][_0x3c2614(0x42e)]({'id':uid('t'),'name':_0x2b155f,'subtopics':[]}),await saveData(),renderTopics();})),on($(_0x5e374f(0x3fa)),_0x5e374f(0x21b),()=>storageManager[_0x5e374f(0x35e)](data)),on($('#importFile'),_0x5e374f(0x404),_0x4c3203=>{const _0x401447=_0x5e374f,_0x9e3fd8=_0x4c3203[_0x401447(0x31c)]['files'][0x0];if(!_0x9e3fd8)return;storageManager['importData'](_0x9e3fd8)[_0x401447(0x495)](async _0x43c782=>{data=_0x43c782,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast('Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!'),renderAll();})[_0x401447(0x3c6)](_0x4e69f4=>toast(_0x401447(0x3d4)+_0x4e69f4[_0x401447(0x3b0)])),_0x4c3203[_0x401447(0x31c)][_0x401447(0x470)]=null;}),on($('#btnRestoreBackup'),_0x5e374f(0x21b),()=>{const _0x3eab49=_0x5e374f,_0x266510=$(_0x3eab49(0x1c7)),_0x3fd071=_0x266510?_0x266510['value']:'';if(!_0x3fd071){toast(_0x3eab49(0x34d));return;}showConfirmModal(_0x3eab49(0x333),'Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20'+new Date(_0x3fd071)[_0x3eab49(0x1c6)]()+_0x3eab49(0x315),_0x59d39e=>{const _0x3a68fb=_0x3eab49;_0x59d39e&&storageManager[_0x3a68fb(0x28b)](_0x3fd071)[_0x3a68fb(0x495)](_0x33ccff=>{const _0x316a53=_0x3a68fb;data=_0x33ccff,toast('Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...'),setTimeout(()=>window['location'][_0x316a53(0x266)](),0x5dc);})[_0x3a68fb(0x3c6)](_0x625ea8=>{const _0x54f104=_0x3a68fb;toast(_0x54f104(0x2f8)+_0x625ea8[_0x54f104(0x3b0)]);});});}),on($('#set_theme_color'),_0x5e374f(0x3a5),_0x56f852=>{const _0x5c56ae=_0x5e374f,_0x357017=_0x56f852['target'][_0x5c56ae(0x470)];applyTheme(_0x357017);if(_0x357017==='light'||_0x357017===_0x5c56ae(0x1d4)){const _0x3db068=$('#set_ytThumbAsBg');_0x3db068&&(_0x3db068['checked']=![],toast(_0x5c56ae(0x3fb),0x7d0));try{document[_0x5c56ae(0x2bf)][_0x5c56ae(0x2f6)][_0x5c56ae(0x2b7)](_0x5c56ae(0x2a1),_0x5c56ae(0x24b));}catch(_0x35b951){}}else{const _0x24037a=$(_0x5c56ae(0x1f2));_0x24037a&&(_0x24037a['checked']=!![]);try{updateYouTubePlayer();}catch(_0x5605a6){}}}),on($(_0x5e374f(0x382)),'click',openSettings),on($(_0x5e374f(0x227)),'click',()=>{const _0x565ee3=_0x5e374f;switchView(_0x565ee3(0x295)),$('#btnAddTopic')[_0x565ee3(0x21b)]();}),on($(_0x5e374f(0x2c4)),_0x5e374f(0x21b),()=>{const _0xf2a5d9=_0x5e374f;renderDashboard(),$('#modalDashboard')[_0xf2a5d9(0x322)]['add'](_0xf2a5d9(0x393));}),on($(_0x5e374f(0x23a)),_0x5e374f(0x21b),()=>{const _0x5f5061=_0x5e374f;$(_0x5f5061(0x1cf))[_0x5f5061(0x322)]['remove']('show');}),on($('#btnCloseSettings'),'click',closeSettings),on($(_0x5e374f(0x1ae)),'click',saveSettings),on($(_0x5e374f(0x36b)),_0x5e374f(0x21b),setDefaults),on($(_0x5e374f(0x2f0)),'click',()=>{const _0xd6ee45=_0x5e374f;ensureAudio(),playSound(_0xd6ee45(0x4a4));}),on($(_0x5e374f(0x3ed)),_0x5e374f(0x21b),_0x559be6=>{const _0x380980=_0x5e374f;_0x559be6[_0x380980(0x494)]();const _0xdb313=$(_0x380980(0x1de));if(_0xdb313)_0xdb313[_0x380980(0x322)][_0x380980(0x261)](_0x380980(0x2da));}),on($(_0x5e374f(0x24e)),_0x5e374f(0x21b),async()=>{const _0x25b062=_0x5e374f,_0x105e83=getCurrentSubtopic();if(!_0x105e83)return;const _0x2adf0d=pendingNoteSessionId,_0x11486b=_0x105e83[_0x25b062(0x23e)][_0x25b062(0x30d)](_0x568409=>_0x568409['id']===_0x2adf0d);_0x11486b&&(_0x11486b[_0x25b062(0x4ad)]=$('#noteText')[_0x25b062(0x470)][_0x25b062(0x3f0)](),await saveData(),renderStatsHistory(),toast(_0x25b062(0x24c))),closeNoteModal();}),on($(_0x5e374f(0x1a1)),_0x5e374f(0x21b),()=>closeNoteModal()),on($('#btnAddGeneralNote'),_0x5e374f(0x21b),addGeneralNote),on($(_0x5e374f(0x355)),_0x5e374f(0x21b),handleSummarizeNote),on($('#btnSendMessage'),_0x5e374f(0x21b),handleSendMessage),on($(_0x5e374f(0x1fd)),'keydown',_0x1740ae=>{const _0x419226=_0x5e374f;if(_0x1740ae[_0x419226(0x1c9)]===_0x419226(0x451))handleSendMessage();}),$$(_0x5e374f(0x214))[_0x5e374f(0x395)](_0x1515e1=>{on(_0x1515e1,'click',()=>{const _0x229c21=_0x2a57,_0x172653=_0x1515e1['dataset'][_0x229c21(0x2cd)];$(_0x229c21(0x1fd))[_0x229c21(0x470)]=_0x172653,$(_0x229c21(0x1fd))['focus']();});}),on($(_0x5e374f(0x2f3)),_0x5e374f(0x21b),clearChat),on($(_0x5e374f(0x1fa)),_0x5e374f(0x21b),addSubtopicTask),on($(_0x5e374f(0x1f4)),_0x5e374f(0x3af),_0x108e97=>{const _0x328e99=_0x5e374f;if(_0x108e97[_0x328e99(0x1c9)]==='Enter')addSubtopicTask();}),on($(_0x5e374f(0x20c)),_0x5e374f(0x21b),toggleYtSound),on($(_0x5e374f(0x378)),'click',()=>{ensureAudio(),unlockAudioChain();}),on($('#ytSoundVolume'),_0x5e374f(0x3a5),_0x4de707=>{const _0x5b4bd8=_0x5e374f,_0x6dcbbd=parseInt(_0x4de707['target'][_0x5b4bd8(0x470)],0xa);ytPlayer&&ytPlayer['setVolume']&&ytPlayer[_0x5b4bd8(0x43b)](_0x6dcbbd);}),on($('#set_youtubeUrl'),'input',handleYoutubeUrlInput),$$(_0x5e374f(0x32b))['forEach'](_0x30a242=>{const _0x37bbd3=_0x5e374f;_0x30a242[_0x37bbd3(0x2b2)](_0x37bbd3(0x21b),()=>{const _0x558dc1=_0x37bbd3,_0x5610d1=_0x30a242[_0x558dc1(0x3db)][_0x558dc1(0x297)],_0xb5b42e=data?.[_0x558dc1(0x218)]?.['currentView']||_0x558dc1(0x226);if(_0xb5b42e===_0x5610d1&&_0x5610d1!==_0x558dc1(0x226))switchView(_0x558dc1(0x226));else switchView(_0x5610d1);});}),$$('.tab-btn')['forEach'](_0x587531=>{const _0x1f471d=_0x5e374f;_0x587531[_0x1f471d(0x2b2)](_0x1f471d(0x21b),()=>{const _0x29f20a=_0x1f471d,_0x402fcd=_0x587531[_0x29f20a(0x3db)][_0x29f20a(0x483)],_0x26abcf=_0x587531['closest'](_0x29f20a(0x49d));if(!_0x26abcf)return;_0x26abcf[_0x29f20a(0x32c)](_0x29f20a(0x25f))['forEach'](_0x186a43=>_0x186a43['classList']['remove']('active')),_0x587531['classList'][_0x29f20a(0x28c)](_0x29f20a(0x2ef)),_0x26abcf['querySelectorAll']('.tab-content')['forEach'](_0x10e7be=>{const _0x160d6c=_0x29f20a;_0x10e7be[_0x160d6c(0x322)]['remove']('active'),_0x10e7be[_0x160d6c(0x2f6)][_0x160d6c(0x212)]=_0x160d6c(0x24b);});const _0x29a051=_0x26abcf[_0x29f20a(0x3f3)]('#'+_0x402fcd);_0x29a051&&(_0x29a051[_0x29f20a(0x322)][_0x29f20a(0x28c)]('active'),_0x29a051[_0x29f20a(0x2f6)][_0x29f20a(0x212)]=_0x29f20a(0x45f),_0x26abcf[_0x29f20a(0x1c2)](_0x29f20a(0x479))&&(_0x29a051[_0x29f20a(0x2f6)][_0x29f20a(0x212)]=_0x29f20a(0x357)));});});const _0x3a9e04=$('#methodEditorContentInput');function _0x449760(_0x5e36d7,_0x491fb9=null){const _0x5a4b26=_0x5e374f;try{document[_0x5a4b26(0x2eb)](_0x5a4b26(0x1ac),![],!![]);}catch(_0x2c86f2){}try{document['execCommand'](_0x5e36d7,![],_0x491fb9);}catch(_0x256ad5){}if(_0x3a9e04)_0x3a9e04[_0x5a4b26(0x425)]();}on($(_0x5e374f(0x3ff)),'click',()=>_0x449760(_0x5e374f(0x2ee))),on($(_0x5e374f(0x3cd)),_0x5e374f(0x21b),()=>_0x449760(_0x5e374f(0x1d0))),on($(_0x5e374f(0x199)),_0x5e374f(0x21b),()=>_0x449760('formatBlock',_0x5e374f(0x43f))),on($('#toolList'),_0x5e374f(0x21b),()=>_0x449760(_0x5e374f(0x331))),on($('#toolBullet'),'click',()=>_0x449760(_0x5e374f(0x233)));const _0x69b267=$(_0x5e374f(0x3c3)),_0x4b562f=$(_0x5e374f(0x4b2));on($(_0x5e374f(0x490)),_0x5e374f(0x21b),_0xd0b1ef=>{const _0x233c6e=_0x5e374f;if(!_0x4b562f)return;_0xd0b1ef[_0x233c6e(0x44a)](),_0x4b562f[_0x233c6e(0x322)][_0x233c6e(0x261)](_0x233c6e(0x2da));}),$$(_0x5e374f(0x473))[_0x5e374f(0x395)](_0x5e7db8=>{const _0x17f3fe=_0x5e374f;on(_0x5e7db8,_0x17f3fe(0x21b),_0x338839=>{const _0x24e810=_0x17f3fe;_0x338839[_0x24e810(0x494)]();const _0x4071e1=_0x5e7db8[_0x24e810(0x3db)]['color']||'';let _0x499036=_0x4071e1;try{const _0x5db507=_0x4071e1[_0x24e810(0x40d)](/--[a-zA-Z0-9_-]+/);if(_0x5db507)_0x499036=getComputedStyle(document[_0x24e810(0x2bf)])['getPropertyValue'](_0x5db507[0x0])[_0x24e810(0x3f0)]();}catch(_0x595d22){}_0x449760(_0x24e810(0x3d5),_0x499036);if(_0x4b562f)_0x4b562f[_0x24e810(0x322)][_0x24e810(0x28c)]('hidden');});}),on(document,'click',_0x28a036=>{const _0x49b0c=_0x5e374f;if(!_0x69b267||!_0x4b562f)return;!_0x69b267[_0x49b0c(0x326)](_0x28a036[_0x49b0c(0x31c)])&&!_0x4b562f[_0x49b0c(0x322)][_0x49b0c(0x326)](_0x49b0c(0x2da))&&_0x4b562f['classList'][_0x49b0c(0x28c)](_0x49b0c(0x2da));});function _0x40b700(_0x418ab6){const _0x45925d=_0x5e374f,_0x26fda3=data?.['settings']?.[_0x45925d(0x307)]||[],_0x5a0660=_0x418ab6?_0x26fda3[_0x45925d(0x30d)](_0x105770=>_0x105770['id']===_0x418ab6):null;$(_0x45925d(0x391))[_0x45925d(0x470)]=_0x5a0660&&_0x5a0660['id']||'',$(_0x45925d(0x320))[_0x45925d(0x1ee)]=_0x5a0660?_0x45925d(0x45e):_0x45925d(0x465),$(_0x45925d(0x20b))[_0x45925d(0x470)]=_0x5a0660&&_0x5a0660[_0x45925d(0x210)]||'';const _0x55e799=$(_0x45925d(0x197));if(_0x55e799)_0x55e799[_0x45925d(0x2e8)]=_0x5a0660&&_0x5a0660['content']||'';$(_0x45925d(0x1e8))[_0x45925d(0x322)][_0x45925d(0x28c)](_0x45925d(0x393));try{trapFocus($('#modalMethodEditor'));}catch(_0x159577){}try{const _0x21cbcb=$(_0x45925d(0x1b9));if(_0x21cbcb){const _0x181ecc=!!(data?.[_0x45925d(0x218)]?.[_0x45925d(0x1ed)]&&data[_0x45925d(0x218)][_0x45925d(0x1ed)][_0x45925d(0x3f0)]());_0x21cbcb['disabled']=!_0x181ecc,_0x21cbcb[_0x45925d(0x210)]=_0x181ecc?_0x45925d(0x195):'Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.';}}catch(_0x24c6cf){}}on($(_0x5e374f(0x438)),'click',()=>{const _0x1f7ff6=_0x5e374f;$(_0x1f7ff6(0x1e8))[_0x1f7ff6(0x322)][_0x1f7ff6(0x330)](_0x1f7ff6(0x393));try{releaseFocus();}catch(_0x5ec726){}}),on($(_0x5e374f(0x2c6)),'click',async()=>{const _0x530e78=_0x5e374f,_0x59fd5d=$('#methodEditorId')[_0x530e78(0x470)]||uid('m'),_0x288644=($('#methodEditorTitleInput')[_0x530e78(0x470)]||'')[_0x530e78(0x3f0)](),_0xbc5a9b=$(_0x530e78(0x197)),_0x21926a=_0xbc5a9b?_0xbc5a9b[_0x530e78(0x2e8)]||'':'';if(!Array[_0x530e78(0x366)](data[_0x530e78(0x218)][_0x530e78(0x307)]))data['settings'][_0x530e78(0x307)]=[];const _0x1acff7=data[_0x530e78(0x218)][_0x530e78(0x307)][_0x530e78(0x48f)](_0x1f9086=>_0x1f9086['id']===_0x59fd5d),_0xfa554d={'id':_0x59fd5d,'title':_0x288644,'content':_0x21926a};if(_0x1acff7>=0x0)data[_0x530e78(0x218)][_0x530e78(0x307)][_0x1acff7]=_0xfa554d;else data[_0x530e78(0x218)][_0x530e78(0x307)][_0x530e78(0x455)](_0xfa554d);await storageManager['updateSettings'](data['settings']),renderMethods(),$('#modalMethodEditor')['classList'][_0x530e78(0x330)](_0x530e78(0x393));try{releaseFocus();}catch(_0x1f6ec8){}}),on($('#btnAutoFormat'),_0x5e374f(0x21b),async()=>{const _0xa2c728=_0x5e374f,_0x3c3c0d=$('#methodEditorContentInput');if(!_0x3c3c0d)return;const _0x4d9e73=(_0x3c3c0d[_0xa2c728(0x1ee)]||'')[_0xa2c728(0x3f0)]();if(!_0x4d9e73||_0x4d9e73[_0xa2c728(0x469)]<0x14){toast(_0xa2c728(0x348));return;}const _0x2ff9b4=$(_0xa2c728(0x1b9));_0x2ff9b4&&(_0x2ff9b4[_0xa2c728(0x36f)]=!![],_0x2ff9b4[_0xa2c728(0x2e8)]='<div\x20class=\x22spinner\x22></div>');const _0x538f4f='Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22'+_0x4d9e73+'\x22',_0x57cefb=await callGeminiAPI(_0x538f4f);_0x57cefb?(_0x3c3c0d[_0xa2c728(0x2e8)]=_0x57cefb,toast(_0xa2c728(0x491))):toast(_0xa2c728(0x1c3)),_0x2ff9b4&&(_0x2ff9b4[_0xa2c728(0x36f)]=![],_0x2ff9b4['innerHTML']=_0xa2c728(0x20a));}),on($(_0x5e374f(0x319)),_0x5e374f(0x21b),()=>_0x40b700());const _0x57af29=document[_0x5e374f(0x3f3)]('#view-methods');_0x57af29&&_0x57af29['addEventListener'](_0x5e374f(0x21b),_0xfcd2bb=>{const _0x5b4a38=_0x5e374f,_0x3dc766=_0xfcd2bb[_0x5b4a38(0x31c)][_0x5b4a38(0x1c2)]&&_0xfcd2bb[_0x5b4a38(0x31c)][_0x5b4a38(0x1c2)]('.method-edit'),_0x174242=!_0x3dc766&&_0xfcd2bb[_0x5b4a38(0x31c)][_0x5b4a38(0x1c2)]&&_0xfcd2bb[_0x5b4a38(0x31c)]['closest'](_0x5b4a38(0x41e));if(_0x3dc766){_0xfcd2bb[_0x5b4a38(0x494)](),_0xfcd2bb[_0x5b4a38(0x44a)]();const _0x39ec1e=_0x3dc766[_0x5b4a38(0x3db)]['id'];if(_0x39ec1e)_0x40b700(_0x39ec1e);return;}if(_0x174242){_0xfcd2bb['preventDefault'](),_0xfcd2bb['stopPropagation']();const _0x598e2e=_0x174242['dataset']['id'];if(!_0x598e2e)return;const _0x335ef0=data?.[_0x5b4a38(0x218)]?.['methods']||[],_0x376eaf=_0x335ef0['find'](_0x459b08=>_0x459b08['id']===_0x598e2e);if(!_0x376eaf)return;showConfirmModal(_0x5b4a38(0x3a8),'Xóa\x20tri\x20thức\x20\x22'+(_0x376eaf[_0x5b4a38(0x210)]||'')+'\x22?',async _0x454ac2=>{const _0x47a4=_0x5b4a38;if(!_0x454ac2)return;data[_0x47a4(0x218)][_0x47a4(0x307)]=_0x335ef0[_0x47a4(0x1be)](_0x5d4e60=>_0x5d4e60['id']!==_0x598e2e),await storageManager[_0x47a4(0x201)](data[_0x47a4(0x218)]),renderMethods();});}});$$('#timerPresetSelector\x20button')['forEach'](_0x5346ec=>{const _0x518dd1=_0x5e374f;_0x5346ec[_0x518dd1(0x2b2)](_0x518dd1(0x21b),()=>{const _0x37399a=_0x518dd1;editingPreset=_0x5346ec[_0x37399a(0x3db)][_0x37399a(0x410)],highlightPresetSelector(),loadEditingPresetFields();});}),$$('.presets\x20button')['forEach'](_0x142fb8=>{const _0xfb066=_0x5e374f;_0x142fb8[_0xfb066(0x2b2)](_0xfb066(0x21b),_0x2e66eb=>{const _0x56e528=_0xfb066,_0x49c5da=_0x2e66eb['target'][_0x56e528(0x3db)][_0x56e528(0x3e0)],_0x3bc979=data[_0x56e528(0x218)][_0x56e528(0x3e0)];if(_0x49c5da===_0x3bc979)return;timer[_0x56e528(0x1a3)]!==_0x56e528(0x1d7)?showConfirmModal('Xác\x20nhận\x20chuyển\x20đổi','Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20'+_0x49c5da+_0x56e528(0x443),_0x575997=>{const _0x445f4a=_0x56e528;_0x575997&&(timer[_0x445f4a(0x435)](),timer[_0x445f4a(0x48d)](_0x49c5da),renderAll(),toast(_0x445f4a(0x3d8)+_0x49c5da+'.'));}):(timer['setPreset'](_0x49c5da),renderAll(),toast('Đã\x20chuyển\x20sang\x20Kiểu\x20'+_0x49c5da+'.'));});}),on($(_0x5e374f(0x242)),_0x5e374f(0x21b),()=>timer[_0x5e374f(0x364)]()),on($(_0x5e374f(0x300)),_0x5e374f(0x21b),()=>timer['finishFlowSession']()),on($(_0x5e374f(0x3df)),'click',()=>timer['pause']()),on($(_0x5e374f(0x27c)),'click',()=>timer[_0x5e374f(0x363)]()),on($(_0x5e374f(0x39d)),_0x5e374f(0x21b),()=>timer[_0x5e374f(0x39a)]()),on($(_0x5e374f(0x2ff)),_0x5e374f(0x21b),()=>timer['reset']()),on($(_0x5e374f(0x2d3)),'click',()=>timer[_0x5e374f(0x36c)]()),on($(_0x5e374f(0x434)),_0x5e374f(0x404),_0xb13ab2=>{const _0x3c4e71=_0x5e374f;handleFileUpload(_0xb13ab2[_0x3c4e71(0x31c)][_0x3c4e71(0x317)][0x0],async _0x30922e=>{const _0x560cb8=_0x3c4e71;data[_0x560cb8(0x218)][_0x560cb8(0x468)]=_0x30922e,await saveData(),applyCustomBg(),toast(_0x560cb8(0x2d2));}),_0xb13ab2[_0x3c4e71(0x31c)][_0x3c4e71(0x470)]=null;}),on($(_0x5e374f(0x38a)),_0x5e374f(0x21b),async()=>{const _0x2b3e43=_0x5e374f;data[_0x2b3e43(0x218)][_0x2b3e43(0x468)]='',data['settings']['useYtThumbnailAsBg']=![],await saveData(),applyCustomBg(),toast(_0x2b3e43(0x460)),$(_0x2b3e43(0x479))['classList'][_0x2b3e43(0x326)](_0x2b3e43(0x393))&&openSettings();}),on($(_0x5e374f(0x401)),_0x5e374f(0x404),_0x48fa22=>{const _0x4f392c=_0x5e374f;handleFileUpload(_0x48fa22[_0x4f392c(0x31c)][_0x4f392c(0x317)][0x0],async _0x54cf6e=>{data['settings']['customSounds']['work_end']=_0x54cf6e,await saveData(),toast('Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.');}),_0x48fa22[_0x4f392c(0x31c)][_0x4f392c(0x470)]=null;}),on($(_0x5e374f(0x23d)),_0x5e374f(0x404),_0x3fd15d=>{const _0x431e09=_0x5e374f;handleFileUpload(_0x3fd15d['target']['files'][0x0],async _0x2dfc6f=>{const _0x5d2b6e=_0x2a57;data[_0x5d2b6e(0x218)][_0x5d2b6e(0x340)]['break_end']=_0x2dfc6f,await saveData(),toast(_0x5d2b6e(0x44f));}),_0x3fd15d[_0x431e09(0x31c)][_0x431e09(0x470)]=null;}),on($(_0x5e374f(0x408)),_0x5e374f(0x404),_0x628e97=>{const _0x44c313=_0x5e374f;handleFileUpload(_0x628e97[_0x44c313(0x31c)][_0x44c313(0x317)][0x0],async _0x447389=>{const _0x1218ba=_0x44c313;data[_0x1218ba(0x218)][_0x1218ba(0x340)]['long_end']=_0x447389,await saveData(),toast(_0x1218ba(0x23c));}),_0x628e97[_0x44c313(0x31c)][_0x44c313(0x470)]=null;}),on($(_0x5e374f(0x441)),_0x5e374f(0x21b),toggleFullScreen),document['addEventListener'](_0x5e374f(0x269),updateFullscreenButton),window['addEventListener'](_0x5e374f(0x3af),_0x3a1ea3=>{const _0x477848=_0x5e374f,_0x3dbe7d=(_0x3a1ea3[_0x477848(0x31c)][_0x477848(0x3ac)]||'')[_0x477848(0x344)](),_0x495fa9=[_0x477848(0x3a5),_0x477848(0x3e8),_0x477848(0x39b)]['includes'](_0x3dbe7d);if(_0x3a1ea3[_0x477848(0x276)]===_0x477848(0x437)&&!_0x495fa9){_0x3a1ea3[_0x477848(0x494)]();if(timer[_0x477848(0x1a3)]===_0x477848(0x1d7)||timer[_0x477848(0x1a3)]===_0x477848(0x3bf))timer[_0x477848(0x364)]();else timer[_0x477848(0x1f9)]();}(_0x3a1ea3[_0x477848(0x1c9)]==='n'||_0x3a1ea3[_0x477848(0x1c9)]==='N')&&(!_0x495fa9&&(_0x3a1ea3[_0x477848(0x494)](),timer[_0x477848(0x39a)]()));if(_0x3a1ea3['key']===_0x477848(0x310)){$$(_0x477848(0x4a9))[_0x477848(0x395)](_0x497cb1=>_0x497cb1['classList']['remove']('show'));try{releaseFocus();}catch(_0x1711c9){}}if(_0x3a1ea3[_0x477848(0x476)]&&!_0x495fa9){if(_0x3a1ea3[_0x477848(0x1c9)]===_0x477848(0x34a))_0x3a1ea3['preventDefault'](),_0x53a5d0(0x0,-0xa);else{if(_0x3a1ea3[_0x477848(0x1c9)]==='ArrowDown')_0x3a1ea3[_0x477848(0x494)](),_0x53a5d0(0x0,0xa);else{if(_0x3a1ea3['key']===_0x477848(0x264))_0x3a1ea3[_0x477848(0x494)](),_0x53a5d0(-0xa,0x0);else _0x3a1ea3[_0x477848(0x1c9)]===_0x477848(0x3a2)&&(_0x3a1ea3[_0x477848(0x494)](),_0x53a5d0(0xa,0x0));}}}}),$$(_0x5e374f(0x4a9))[_0x5e374f(0x395)](_0xf0da02=>_0xf0da02[_0x5e374f(0x2b2)](_0x5e374f(0x21b),_0x40e738=>{const _0x308de7=_0x5e374f;if(_0x40e738&&_0x40e738[_0x308de7(0x31c)]&&_0x40e738['target']['id']==='modalMethodEditor')return;if(_0x40e738[_0x308de7(0x31c)]===_0xf0da02){_0xf0da02[_0x308de7(0x322)][_0x308de7(0x330)](_0x308de7(0x393));try{releaseFocus();}catch(_0x408082){}}})),window[_0x5e374f(0x2b2)](_0x5e374f(0x21b),_0x408415=>{const _0x40e386=_0x5e374f;!_0x408415['target'][_0x40e386(0x1c2)](_0x40e386(0x2e0))&&!_0x408415[_0x40e386(0x31c)][_0x40e386(0x1c2)](_0x40e386(0x303))&&closeAllMenus();});try{const _0x4bb20d=document[_0x5e374f(0x3f3)]('.app-content');if(_0x4bb20d)_0x4bb20d['addEventListener']('scroll',closeAllMenus);}catch(_0x3ff393){}try{window[_0x5e374f(0x2b2)]('scroll',closeAllMenus,!![]);}catch(_0x268b3a){}window[_0x5e374f(0x2b2)](_0x5e374f(0x48e),()=>timer[_0x5e374f(0x1e4)](!![]));try{const _0x4ecae4=Array['from'](document['querySelectorAll'](_0x5e374f(0x2b0)));_0x4ecae4[_0x5e374f(0x469)]&&_0x4ecae4[_0x5e374f(0x395)](_0xa425d=>{const _0x54885f=_0x5e374f;_0xa425d[_0x54885f(0x2b2)](_0x54885f(0x261),()=>{const _0x32f7f5=_0x54885f;_0xa425d['open']&&_0x4ecae4[_0x32f7f5(0x395)](_0x3d3e6f=>{const _0x32a643=_0x32f7f5;if(_0x3d3e6f!==_0xa425d)_0x3d3e6f[_0x32a643(0x353)]=![];});});});}catch(_0x31a356){}const _0x3f48c5=$(_0x5e374f(0x265));let _0x30f06a=![],_0x3c88ea,_0x57a614;_0x3f48c5&&(_0x3f48c5[_0x5e374f(0x2b2)]('mousedown',_0x57a865=>{const _0x469c02=_0x5e374f;_0x30f06a=!![];const _0x5cb82d=_0x3f48c5[_0x469c02(0x288)]();_0x3c88ea=_0x57a865['clientX']-_0x5cb82d[_0x469c02(0x230)],_0x57a614=_0x57a865['clientY']-_0x5cb82d['top'],_0x3f48c5[_0x469c02(0x2f6)][_0x469c02(0x43a)]='none';}),document['addEventListener'](_0x5e374f(0x430),_0x272724=>{const _0x2d4b5a=_0x5e374f;if(!_0x30f06a)return;let _0x14eba5=_0x272724['clientX']-_0x3c88ea,_0x582b6f=_0x272724[_0x2d4b5a(0x39e)]-_0x57a614;const _0xc43d59=window['innerWidth']-_0x3f48c5[_0x2d4b5a(0x38f)],_0x214d4a=window[_0x2d4b5a(0x206)]-_0x3f48c5[_0x2d4b5a(0x3c8)];_0x14eba5=Math['max'](0x0,Math[_0x2d4b5a(0x1b3)](_0x14eba5,_0xc43d59)),_0x582b6f=Math[_0x2d4b5a(0x380)](0x0,Math[_0x2d4b5a(0x1b3)](_0x582b6f,_0x214d4a)),_0x3f48c5['style']['left']=_0x14eba5+'px',_0x3f48c5[_0x2d4b5a(0x2f6)][_0x2d4b5a(0x26b)]=_0x582b6f+'px',_0x3f48c5['style'][_0x2d4b5a(0x229)]=_0x2d4b5a(0x3ab),_0x3f48c5['style'][_0x2d4b5a(0x3a4)]='auto';}),document[_0x5e374f(0x2b2)](_0x5e374f(0x313),()=>{const _0x22a500=_0x5e374f;if(!_0x30f06a)return;_0x30f06a=![],_0x3f48c5[_0x22a500(0x2f6)]['transition']='';}));function _0x5d23fd(_0x6c4c79){const _0x1a21ee=_0x5e374f,_0xdb535e=$(_0x1a21ee(0x265));if(!_0xdb535e)return;_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x316)]='fixed',_0xdb535e['style'][_0x1a21ee(0x43a)]='',_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x230)]=_0x1a21ee(0x3ab),_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x26b)]=_0x1a21ee(0x3ab),_0xdb535e['style'][_0x1a21ee(0x3a4)]=_0x1a21ee(0x3ab),_0xdb535e['style'][_0x1a21ee(0x229)]=_0x1a21ee(0x3ab);const _0x46c931=0x10;_0x6c4c79==='tl'&&(_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x230)]=_0x46c931+'px',_0xdb535e['style']['top']=_0x46c931+'px'),_0x6c4c79==='tr'&&(_0xdb535e['style'][_0x1a21ee(0x3a4)]=_0x46c931+'px',_0xdb535e[_0x1a21ee(0x2f6)]['top']=_0x46c931+'px'),_0x6c4c79==='bl'&&(_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x230)]=_0x46c931+'px',_0xdb535e['style'][_0x1a21ee(0x229)]=_0x46c931+'px'),_0x6c4c79==='br'&&(_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x3a4)]=_0x46c931+'px',_0xdb535e[_0x1a21ee(0x2f6)][_0x1a21ee(0x229)]=_0x46c931+'px');}function _0x53a5d0(_0x37b32f,_0x8f6584){const _0x3fe864=_0x5e374f,_0x513992=$('#draggableTimer');if(!_0x513992)return;const _0x486486=_0x513992[_0x3fe864(0x288)](),_0x29800e=Math['max'](0x0,Math[_0x3fe864(0x1b3)](_0x486486[_0x3fe864(0x230)]+_0x37b32f,window['innerWidth']-_0x513992[_0x3fe864(0x38f)])),_0x6286ec=Math[_0x3fe864(0x380)](0x0,Math['min'](_0x486486[_0x3fe864(0x26b)]+_0x8f6584,window[_0x3fe864(0x206)]-_0x513992[_0x3fe864(0x3c8)]));_0x513992[_0x3fe864(0x2f6)]['left']=_0x29800e+'px',_0x513992[_0x3fe864(0x2f6)][_0x3fe864(0x26b)]=_0x6286ec+'px',_0x513992[_0x3fe864(0x2f6)][_0x3fe864(0x3a4)]=_0x3fe864(0x3ab),_0x513992[_0x3fe864(0x2f6)][_0x3fe864(0x229)]=_0x3fe864(0x3ab);}}function toggleBackgroundView(){const _0x419187=_0x1318bc,_0x4435b9=document[_0x419187(0x2bf)];_0x4435b9[_0x419187(0x322)][_0x419187(0x261)](_0x419187(0x3a6));const _0x159a9c=_0x4435b9[_0x419187(0x322)][_0x419187(0x326)](_0x419187(0x3a6)),_0x4f377e=$(_0x419187(0x30a));if(!_0x4f377e)return;_0x159a9c?(_0x4f377e['title']=_0x419187(0x2ba),_0x4f377e[_0x419187(0x2e8)]=_0x419187(0x19f)):(_0x4f377e['title']='Ẩn\x20giao\x20diện',_0x4f377e[_0x419187(0x2e8)]=_0x419187(0x335));}function updateMainViewVisibility(){const _0x39c452=_0x1318bc,_0x331284=!!getCurrentSubtopic(),_0xed31ad=$(_0x39c452(0x194)),_0x2ef628=$(_0x39c452(0x29a));_0x2ef628&&_0x2ef628[_0x39c452(0x322)][_0x39c452(0x261)]('hidden',_0x331284),_0xed31ad&&(_0x331284?_0xed31ad['classList'][_0x39c452(0x330)](_0x39c452(0x1bc)):_0xed31ad[_0x39c452(0x322)]['add'](_0x39c452(0x1bc)));}function updatePresetButtonsText(){const _0x19bd2f=_0x1318bc,_0x1b2379=data[_0x19bd2f(0x218)],_0x283676=_0x1b2379['cyclesA'],_0x33536a=_0x1b2379[_0x19bd2f(0x31d)],_0x3ef501=_0x1b2379[_0x19bd2f(0x25d)]['A_work'],_0x258255=_0x1b2379['durations'][_0x19bd2f(0x420)],_0x194447=$('#btnPresetA'),_0x42c9a5=$('#btnPresetB'),_0x4eaff8=$('#btnPresetC');_0x194447&&(_0x194447['textContent']=_0x283676+'×'+_0x3ef501+_0x19bd2f(0x260)),_0x42c9a5&&(_0x42c9a5['textContent']=_0x33536a+'×'+_0x258255+_0x19bd2f(0x33e)),_0x4eaff8&&(_0x4eaff8['textContent']=_0x19bd2f(0x302));}function renderAll(){const _0x2edecb=_0x1318bc;updatePresetButtonsText();const _0x2b4b5a=data[_0x2edecb(0x218)]['preset'];$$('.presets\x20button')[_0x2edecb(0x395)](_0x58bc51=>{const _0x1c4b3a=_0x2edecb,_0xffcbb0=_0x58bc51[_0x1c4b3a(0x3db)][_0x1c4b3a(0x3e0)]===_0x2b4b5a;_0x58bc51['classList']['toggle']('acc',_0xffcbb0),_0x58bc51[_0x1c4b3a(0x322)][_0x1c4b3a(0x261)](_0x1c4b3a(0x1af),!_0xffcbb0),_0x58bc51[_0x1c4b3a(0x35f)](_0x1c4b3a(0x237),_0xffcbb0);}),updateMainViewVisibility(),timer[_0x2edecb(0x48d)](data[_0x2edecb(0x218)][_0x2edecb(0x3e0)],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data['settings'][_0x2edecb(0x46c)]);}function toggleFullScreen(){const _0x2e540c=_0x1318bc;!document[_0x2e540c(0x45b)]?document[_0x2e540c(0x3dd)][_0x2e540c(0x198)]()[_0x2e540c(0x3c6)](_0x1f68d5=>{const _0x2110a6=_0x2e540c;toast(_0x2110a6(0x244)+_0x1f68d5[_0x2110a6(0x3b0)]);}):document['exitFullscreen']&&document[_0x2e540c(0x338)]();}function updateFullscreenButton(){const _0x5f5063=_0x1318bc,_0x29e49a=$('#btnFullscreen');document[_0x5f5063(0x45b)]?(_0x29e49a['innerHTML']='↙️',_0x29e49a[_0x5f5063(0x210)]=_0x5f5063(0x46e)):(_0x29e49a[_0x5f5063(0x2e8)]='↗️',_0x29e49a[_0x5f5063(0x210)]=_0x5f5063(0x497));}async function initializeApp(){const _0x42b051=_0x1318bc;try{await storageManager[_0x42b051(0x2bb)]();const [_0x4c1f87,_0x22fb82,_0x4c22e9]=await Promise[_0x42b051(0x4a0)]([storageManager[_0x42b051(0x343)](),storageManager[_0x42b051(0x24f)]('topics'),storageManager[_0x42b051(0x24f)](_0x42b051(0x2ea))]);let _0x43404c;if(!_0x4c1f87){const _0x735433=JSON[_0x42b051(0x323)](JSON[_0x42b051(0x484)](defaults));await storageManager[_0x42b051(0x201)](_0x735433[_0x42b051(0x218)]);for(const _0x95bcef of _0x735433['topics']){const {subtopics:_0x1e1e10,..._0xe2889a}=_0x95bcef;await storageManager[_0x42b051(0x28c)](_0x42b051(0x295),_0xe2889a);for(const _0x276364 of _0x1e1e10){await storageManager[_0x42b051(0x28c)]('subtopics',{..._0x276364,'topicId':_0x95bcef['id']});}}_0x43404c=_0x735433;}else{const _0x3e4108={};for(const _0x1868b0 of _0x22fb82)_0x3e4108[_0x1868b0['id']]={..._0x1868b0,'subtopics':[]};for(const _0x4f67ce of _0x4c22e9)_0x3e4108[_0x4f67ce[_0x42b051(0x22c)]]?.[_0x42b051(0x2ea)][_0x42b051(0x42e)](_0x4f67ce);_0x43404c={'version':defaults[_0x42b051(0x274)],'settings':_0x4c1f87,'topics':Object[_0x42b051(0x1b4)](_0x3e4108)};}data=window[_0x42b051(0x3b1)]=_0x43404c,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0x42b051(0x48b)](data);}catch(_0x203375){console['warn'](_0x42b051(0x2a2),_0x203375);}bindEvents(),applyTheme();}catch(_0x2bfa30){console[_0x42b051(0x40f)](_0x42b051(0x1b7),_0x2bfa30),toast(_0x42b051(0x342)+_0x2bfa30[_0x42b051(0x3b0)]);}}callGeminiAPI=async function(_0x1a2526,_0x226bff=0x3,_0x2ae585=0x3e8){const _0x4c04c5=_0x1318bc,_0x382695=data?.[_0x4c04c5(0x218)]?.['apiKey']||'';if(!_0x382695)return toast(_0x4c04c5(0x472)),null;const _0x517e02=_0x4c04c5(0x232)+_0x382695,_0x595e35={'contents':[{'role':'user','parts':[{'text':_0x1a2526}]}]};try{const _0x28fd9c=await fetch(_0x517e02,{'method':_0x4c04c5(0x403),'headers':{'Content-Type':_0x4c04c5(0x287)},'body':JSON[_0x4c04c5(0x484)](_0x595e35)});if(!_0x28fd9c['ok']){if(_0x28fd9c[_0x4c04c5(0x3c5)]===0x1ad&&_0x226bff>0x0)return await new Promise(_0x25be82=>setTimeout(_0x25be82,_0x2ae585)),callGeminiAPI(_0x1a2526,_0x226bff-0x1,_0x2ae585*0x2);let _0x19441f=null;try{_0x19441f=await _0x28fd9c['json']();}catch(_0x55366c){}let _0x42fac6=_0x4c04c5(0x1cb)+_0x28fd9c[_0x4c04c5(0x3c5)];if(_0x28fd9c['status']===0x190)_0x42fac6='Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.';else{if(_0x28fd9c[_0x4c04c5(0x3c5)]===0x1ad)_0x42fac6=_0x4c04c5(0x49a);else _0x19441f?.[_0x4c04c5(0x40f)]?.[_0x4c04c5(0x3b0)]&&(_0x42fac6=_0x4c04c5(0x240)+_0x19441f[_0x4c04c5(0x40f)][_0x4c04c5(0x3b0)]);}return toast(_0x42fac6,0xfa0),console[_0x4c04c5(0x40f)](_0x4c04c5(0x3ee),_0x19441f||_0x28fd9c[_0x4c04c5(0x496)]),null;}const _0x49de13=await _0x28fd9c[_0x4c04c5(0x267)]();if(_0x49de13[_0x4c04c5(0x2f1)]&&_0x49de13[_0x4c04c5(0x2f1)][0x0]?.[_0x4c04c5(0x418)]?.[_0x4c04c5(0x290)]?.[0x0]?.['text'])return formatGeminiResponse(_0x49de13['candidates'][0x0][_0x4c04c5(0x418)]['parts'][0x0]['text']);else{console['error'](_0x4c04c5(0x24d),_0x49de13);if(_0x49de13[_0x4c04c5(0x3bc)]?.[_0x4c04c5(0x239)])return _0x4c04c5(0x498)+_0x49de13[_0x4c04c5(0x3bc)]['blockReason']+_0x4c04c5(0x35d);return _0x4c04c5(0x321);}}catch(_0x2a01fe){return console[_0x4c04c5(0x40f)](_0x4c04c5(0x42c),_0x2a01fe),toast('Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.',0xfa0),null;}},loadLanguage(localStorage[_0x1318bc(0x26e)](_0x1318bc(0x2e1))||'vi')[_0x1318bc(0x495)](initializeApp);
    </script>
</body>
</html>
